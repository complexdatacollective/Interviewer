"undefined"!=typeof require&&(nodeRequire=require),function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){module.exports=function(){"use strict";var edges,dateInterface={};return dateInterface.options={targetEl:$(".container"),edgeType:"Dyad",heading:"Default Heading"},dateInterface.init=function(options){window.tools.extend(dateInterface.options,options),dateInterface.options.targetEl.append('<div class="node-question-container"></div>'),$(".node-question-container").append("<h1>"+dateInterface.options.heading+"</h1>"),$(".node-question-container").append('<p class="lead">'+dateInterface.options.subheading+"</p>"),dateInterface.options.targetEl.append('<div class="date-container"></div>'),edges=window.network.getEdges(dateInterface.options.criteria);var counter=0,row=0;$.each(edges,function(index,value){var dyadEdge=window.network.getEdges({type:"Dyad",from:window.network.getNodes({type_t0:"Ego"})[0].id,to:value.to})[0],markup='<div class="date-picker-item overlay"><div class="row"><div class="col-sm-12"><h2>Regarding <span>'+dyadEdge.nname_t0+'</span></h2></div></div><div class="row"><div class="col-sm-12 alert alert-danger logic-error" role="alert"><span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span><span class="sr-only">Error:</span> Your last sexual encounter cannot come before your first. Please correct the dates before continuing.</div><div class="col-sm-5"><div class="form-group"><p class="lead">When was the first time you had sex?</p><div class="input-group date first row'+row+'" id="datetimepicker'+counter+'"><input type="text" class="form-control" /><span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span></div><div class="checkbox"><label><input type="checkbox" name="checkbox-time" class="checkbox-time checkbox'+counter+'"> More than 6 months ago.</label></div></div></div><div class="col-sm-5 col-sm-offset-2"><div class="form-group"><p class="lead">When was the last time you had sex?</p><div class="input-group date second row'+row+'" id="datetimepicker'+(counter+1)+'"><input type="text" class="form-control" /><span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span></div></div></div></div></div>';$(markup).appendTo(".date-container");var dateoptions={format:"MM/DD/YYYY"};$("#datetimepicker"+counter).datetimepicker(dateoptions),$("#datetimepicker"+(counter+1)).datetimepicker(dateoptions),$("#datetimepicker"+counter+", #datetimepicker"+(counter+1)).on("dp.change",function(e){var target,first,second,incomingDate,properties={},$current=$(this);$(this).hasClass("first")?($(".checkbox"+$current.attr("id").slice(-1)).is(":checked")?(properties.sex_first_before_range=!0,incomingDate=null):(properties.sex_first_before_range=!1,incomingDate=$current.data("DateTimePicker").date().format("MM/DD/YYYY")),target=parseInt($current.attr("id").slice(-1))+1,first=parseInt($current.attr("id").slice(-1)),second=parseInt($current.attr("id").slice(-1))+1,null!==e.date,properties.sex_first_t0=incomingDate):($(".checkbox"+$current.attr("id").slice(-1)).is(":checked")?(properties.sex_last_before_range=!0,incomingDate=null):(properties.sex_last_before_range=!1,incomingDate=$current.data("DateTimePicker").date().format("MM/DD/YYYY")),target=parseInt($current.attr("id").slice(-1))-1,first=parseInt($current.attr("id").slice(-1))-1,second=parseInt($current.attr("id").slice(-1)),null!==e.date,properties.sex_last_t0=incomingDate),window.network.updateEdge(value.id,properties),window.moment($("#datetimepicker"+first).data("DateTimePicker").date()).isAfter($("#datetimepicker"+second).data("DateTimePicker").date())?($current.parent().parent().parent().children(".logic-error").fadeIn(),$(".arrow-next").attr("disabled","disabled")):($current.parent().parent().parent().children(".logic-error").fadeOut(),$(".arrow-next").removeAttr("disabled"))}),"undefined"!=typeof value.sex_first_t0&&(null===value.sex_first_t0?($(".checkbox"+counter).prop("checked",!0),$("#datetimepicker"+counter).data("DateTimePicker").date(window.moment().subtract(6,"months").format("MM/DD/YYYY")),$("#datetimepicker"+counter).children().css({opacity:.5}),$("#datetimepicker"+counter).data("DateTimePicker").disable()):$("#datetimepicker"+counter).data("DateTimePicker").date(value.sex_first_t0)),"undefined"!=typeof value.sex_last_t0&&(null===value.sex_last_t0?($(".checkbox"+(counter+1)).prop("checked",!0),$("#datetimepicker"+(counter+1)).data("DateTimePicker").date(window.moment().subtract(6,"months").format("MM/DD/YYYY")),$("#datetimepicker"+(counter+1)).children().css({opacity:.5}),$("#datetimepicker"+(counter+1)).data("DateTimePicker").disable()):$("#datetimepicker"+(counter+1)).data("DateTimePicker").date(value.sex_last_t0)),$(".checkbox"+counter+", .checkbox"+(counter+1)).change(function(e){var $target=$(e.target);this.checked?($target.parent().parent().parent().children(".date").data("DateTimePicker").date(window.moment().subtract(6,"months").format("MM/DD/YYYY")),$target.parent().parent().parent().children(".date").data("DateTimePicker").disable(),$target.parent().parent().parent().children(".date").children().css({opacity:.5})):($target.parent().parent().parent().children(".date").data("DateTimePicker").enable(),$target.parent().parent().parent().children(".date").children().css({opacity:1}),$target.parent().parent().parent().children(".date").data("DateTimePicker").date(window.moment().format("MM/DD/YYYY")))}),counter+=2,row++})},dateInterface.destroy=function(){},dateInterface}},{}],2:[function(require,module,exports){var IOInterface=function(){"use strict";var db,id,Datastore=require("nedb"),path=require("path"),ioInterface={},initialised=!1;return ioInterface.init=function(callback){return callback?(window.tools.notify("ioInterface initialising.",1),window.tools.notify("Using "+window.netCanvas.Modules.session.name+" as database name.",1),db=new Datastore({filename:path.join("database/",window.netCanvas.Modules.session.name+".db"),autoload:!0}),console.log("db created"),console.log(db),void db.find({}).sort({"sessionParameters.date":1}).exec(function(err,docs){if(err)return!1;if(void 0!==docs.length&&docs.length>0)return window.tools.notify("ioInterface finished initialising.",1),initialised=!0,callback(docs[0]._id),!0;var sessionDate=new Date;db.insert([{sessionParameters:{date:sessionDate}}],function(err,newDoc){return err?!1:(id=newDoc[0]._id,initialised=!0,callback(newDoc[0]._id),window.tools.notify("ioInterface finished initialising.",1),!0)})})):!1},ioInterface.initialised=function(){return initialised?!0:!1},ioInterface.save=function(sessionData,id){delete window.netCanvas.Modules.session.sessionData._id,window.tools.notify("IOInterface being asked to save to data store.",1),window.tools.notify("Data to be saved: ",2),window.tools.notify(sessionData,2),db.update({_id:id},sessionData,{},function(err){return err?!1:void window.tools.notify("Saving complete.",1)})},ioInterface.update=function(key,sessionData,id){window.tools.notify("IOInterface being asked to update data store.",1),db.update({_id:id},sessionData,{},function(err){return err?!1:void window.tools.notify("Updating complete.",1)})},ioInterface.reset=function(callback){db.find({},function(err,docs){if(err)return!1;for(var resultLength=docs.length,i=0;resultLength>i;i++)ioInterface.deleteDocument(docs[i]._id);callback&&callback()})},ioInterface.deleteDocument=function(callback){window.tools.notify("ioInterface being asked to delete document.",2),db.remove({_id:window.netCanvas.Modules.session.id},{},function(err){return err?!1:(window.tools.notify("Deleting complete.",2),void(callback&&callback()))})},ioInterface.load=function(callback,id){window.tools.notify("ioInterface being asked to load data.",2),db.find({_id:id},function(err,docs){return err?!1:void callback(docs[0])})},ioInterface};module.exports=new IOInterface},{nedb:153,path:133}],3:[function(require,module,exports){module.exports=function(){"use strict";var listSelect={};listSelect.options={targetEl:$(".container"),variables:[],heading:"This is a default heading",subheading:"And this is a default subheading"};var itemClickHandler=function(){var properties={},nodeid=$(this).data("nodeid");$(this).data("selected")===!0?($(this).data("selected",!1),$(this).css({border:"2px solid #eee",background:"#eee"}),$.each(listSelect.options.variables,function(index,value){value.value===nodeid&&(properties[value.value]=void 0)}),window.network.updateNode(window.network.getNodes({type_t0:"Ego"})[0].id,properties)):($(this).data("selected",!0),$(this).css({border:"2px solid red",background:"#E8C0C0"}),$.each(listSelect.options.variables,function(index,value){value.value===nodeid&&(properties[value.value]=1)}),window.network.updateNode(window.network.getNodes({type_t0:"Ego"})[0].id,properties))},stageChangeHandler=function(){listSelect.destroy()},processSubmitHandler=function(){window.session.nextStage()};return listSelect.destroy=function(){window.tools.notify("Destroying listSelect.",0),$(window.document).off("click",".inner",itemClickHandler),$(window.document).off("click",".continue",processSubmitHandler),window.removeEventListener("changeStageStart",stageChangeHandler,!1)},listSelect.init=function(options){window.tools.extend(listSelect.options,options),listSelect.options.targetEl.append('<h1 class="text-center">'+listSelect.options.heading+"</h1>"),listSelect.options.targetEl.append('<p class="lead text-center">'+listSelect.options.subheading+"</p>"),listSelect.options.targetEl.append('<div class="form-group list-container"></div>'),$.each(listSelect.options.variables,function(index,value){var el=$('<div class="item"><div class="inner" data-nodeid="'+value.value+'"><h3>'+value.label+"</h3></div></div>"),properties={type_t0:"Ego"};properties[value.value]=1,window.network.getNodes(properties).length>0&&(el.find(".inner").data("selected",!0),el.find(".inner").css({border:"2px solid red",background:"#E8C0C0"})),$(".list-container").append(el)}),$(window.document).on("click",".inner",itemClickHandler),$(window.document).on("click",".continue",processSubmitHandler),window.addEventListener("changeStageStart",stageChangeHandler,!1)},listSelect}},{}],4:[function(require,module,exports){var Logger=function(){"use strict";var logger={};return logger.init=function(){return window.tools.notify("Logger initialising.",1),window.log=window.netCanvas.Modules.session.registerData("log",!0),window.addEventListener("log",function(e){logger.addToLog(e.detail)},!1),!0},logger.addToLog=function(e){if(window.tools.notify("Event being added to log.",1),!e)return!1;var data={eventType:e.eventType,targetObject:e.eventObject,eventTime:new Date};window.netCanvas.Modules.session.addData("log",data,!0);var eventLogged=new window.CustomEvent("eventLogged",{detail:data});window.dispatchEvent(eventLogged);var unsavedChanges=new window.Event("unsavedChanges");return window.dispatchEvent(unsavedChanges),!0},logger.getLog=function(){return window.log},logger.getLastEvent=function(){},logger};module.exports=new Logger},{}],5:[function(require,module,exports){(function(process){"use strict";function getArguments(){var args=!1;if(window.isNodeWebkit)return window.gui=nodeRequire("nw.gui"),args=window.gui.App.argv;if(!window.isCordova){var match,pl=/\+/g,search=/([^&=]+)=?([^&]*)/g,decode=function(s){return decodeURIComponent(s.replace(pl," "))},query=window.location.search.substring(1);for(args={};match=search.exec(query);)args[decode(match[1])]=decode(match[2]);return args}}window.$=$,window.L=L,window.Konva=Konva,window.gui={},window.netCanvas={},window.isNode="undefined"!=typeof process&&"undefined"!=typeof require,window.isCordova=-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://"),window.isNodeWebkit=!1;var moment=require("moment");if(window.moment=moment,window.netCanvas.devMode=!1,window.netCanvas.debugLevel=10,window.netCanvas.studyProtocol="default",window.isNode)try{window.isNodeWebkit="undefined"!=typeof nodeRequire("nw.gui"),window.isNodeWebkit=!0}catch(e){window.isNodeWebkit=!1}var args=getArguments();args&&-1!==args.dev&&(console.log("Development mode enabled."),window.netCanvas.devMode=!0),$(".refresh-button").on("click",function(){console.log("yo");var _window=window.gui.Window.get();_window.reloadDev()}),window.isNodeWebkit&&console.log("netCanvas "+window.gui.App.manifest.version+" running on NWJS "+process.versions["node-webkit"]);var protocolExists=function(protocol,callback){var response=!1,availableProtocols=["RADAR","default","dphil-protocol"];-1!==availableProtocols.indexOf(protocol)&&(response=!0),callback(response)};window.isNodeWebkit&&-1!==window.gui.App.argv.indexOf("dev")&&(console.log("Development mode enabled."),window.netCanvas.devMode=!0),window.netCanvas.devMode?(window.isNodeWebkit&&window.gui.Window.get().showDevTools(),$(".refresh-button").show(),window.netCanvas.debugLevel=1):($(".refresh-button").hide(),window.isNodeWebkit&&window.gui.Window.get().enterFullscreen()),window.tools=require("./tools"),window.netCanvas.Modules={},window.netCanvas.Modules.Network=require("./network.js"),window.netCanvas.Modules.NameGenerator=require("./namegenerator.js"),window.netCanvas.Modules.DateInterface=require("./dateinterface.js"),window.netCanvas.Modules.OrdBin=require("./ordinalbin.js"),window.netCanvas.Modules.IOInterface=require("./iointerface.js"),window.netCanvas.Modules.GeoInterface=require("./map.js"),window.netCanvas.Modules.RoleRevisit=require("./rolerevisit.js"),window.netCanvas.Modules.ListSelect=require("./listselect.js"),window.netCanvas.Modules.MultiBin=require("./multibin.js"),window.netCanvas.Modules.Sociogram=require("./sociogram.js"),window.menu=require("./menu.js"),window.dataStore=require("./iointerface.js"),window.logger=require("./logger.js"),window.netCanvas.Modules.session=require("./session.js"),protocolExists(window.netCanvas.studyProtocol,function(exists){exists||(console.log("WARNING: Specified study protocol was not found. Using default."),window.netCanvas.studyProtocol="default"),window.netCanvas.Modules.session.init(function(){window.netCanvas.Modules.session.loadProtocol()}),window.logger.init(),"addEventListener"in document&&document.addEventListener("DOMContentLoaded",function(){FastClick.attach(document.body)},!1)})}).call(this,require("_process"))},{"./dateinterface.js":1,"./iointerface.js":2,"./listselect.js":3,"./logger.js":4,"./map.js":6,"./menu.js":7,"./multibin.js":8,"./namegenerator.js":9,"./network.js":10,"./ordinalbin.js":11,"./rolerevisit.js":12,"./session.js":13,"./sociogram.js":14,"./tools":15,_process:134,moment:150}],6:[function(require,module,exports){module.exports=function(){"use strict";function toggleFeature(e){if(taskComprehended===!1){var eventProperties={zoomLevel:leaflet.getZoom(),stage:window.netCanvas.Modules.session.currentStage(),timestamp:new Date};log=new window.CustomEvent("log",{detail:{eventType:"taskComprehended",eventObject:eventProperties}}),window.dispatchEvent(log),taskComprehended=!0}var mapEventProperties={zoomLevel:leaflet.getZoom(),timestamp:new Date};log=new window.CustomEvent("log",{detail:{eventType:"mapMarkerPlaced",eventObject:mapEventProperties}}),window.dispatchEvent(log);var properties,layer=e.target;mapNodeClicked===!1?(highlightFeature(e),properties={},properties[variable]=layer.feature.properties.name,window.network.updateEdge(edges[currentPersonIndex].id,properties),$(".map-node-location").html("<strong>Currently marked as:</strong> <br>"+layer.feature.properties.name)):layer.feature.properties.name===mapNodeClicked?(resetHighlight(e),mapNodeClicked=!1,properties={},properties[variable]=void 0,window.network.updateEdge(edges[currentPersonIndex].id,properties)):(resetAllHighlights(),highlightFeature(e),properties={},properties[variable]=layer.feature.properties.name,window.network.updateEdge(edges[currentPersonIndex].id,properties))}function highlightCurrent(){if(void 0!==edges[currentPersonIndex][variable])if(mapNodeClicked=edges[currentPersonIndex][variable],"Homeless"===edges[currentPersonIndex][variable]||"Jail"===edges[currentPersonIndex][variable]){resetPosition();var text="Homeless";"Jail"===edges[currentPersonIndex][variable]&&(text="in Jail"),$(".map-node-location").html("<strong>Currently marked as:</strong> <br>"+text)}else $.each(geojson._layers,function(index,value){value.feature.properties.name===edges[currentPersonIndex][variable]&&($(".map-node-location").html("<strong>Currently marked as:</strong> <br>"+edges[currentPersonIndex][variable]),selectFeature(value))});else resetPosition()}function highlightFeature(e){var layer=e.target;leaflet.fitBounds(e.target.getBounds(),{maxZoom:14}),layer.setStyle({fillOpacity:.8,fillColor:colors[1]}),window.L.Browser.ie||window.L.Browser.opera||layer.bringToFront(),mapNodeClicked=layer.feature.properties.name}function selectFeature(e){var layer=e;leaflet.fitBounds(e.getBounds(),{maxZoom:14}),layer.setStyle({fillOpacity:.8,fillColor:colors[1]}),window.L.Browser.ie||window.L.Browser.opera||layer.bringToFront()}function resetHighlight(e){$(".map-node-location").html(""),mapNodeClicked=!1,geojson.resetStyle(e.target)}function resetAllHighlights(){$(".map-node-location").html(""),mapNodeClicked=!1,$.each(geojson._layers,function(index,value){geojson.resetStyle(value)})}function onEachFeature(feature,layer){layer.on({click:toggleFeature})}function resetPosition(){leaflet.setView([41.798395426119534,-87.83967137233888],11)}function setHomeless(){resetAllHighlights();var properties={};properties[variable]="Homeless",window.network.updateEdge(edges[currentPersonIndex].id,properties),$(".map-node-location").html("<strong>Currently marked as:</strong> <br>Homeless")}function setJail(){resetAllHighlights();var properties={};properties[variable]="Jail",window.network.updateEdge(edges[currentPersonIndex].id,properties),$(".map-node-location").html("<strong>Currently marked as:</strong> <br>in Jail")}var log,leaflet,edges,geojson,taskComprehended=!1,geoInterface={},variable="res_chicago_location_p_t0",currentPersonIndex=0,mapNodeClicked=!1,colors=["#67c2d4","#1ECD97","#B16EFF","#FA920D","#e85657","#20B0CA","#FF2592","#153AFF","#8708FF"],stageChangeHandler=function(){geoInterface.destroy()};return geoInterface.nextPerson=function(){currentPersonIndex<edges.length-1&&(resetAllHighlights(),currentPersonIndex++,$(".current-id").html(currentPersonIndex+1),$(".map-node-status").html("Tap on the map to indicate the general area where <strong>"+edges[currentPersonIndex].nname_t0+"</strong> lives."),highlightCurrent(),currentPersonIndex===edges.length-1?$(".map-forwards").hide():$(".map-forwards").show(),0===currentPersonIndex?$(".map-back").hide():$(".map-back").show())},geoInterface.previousPerson=function(){currentPersonIndex>0&&(resetAllHighlights(),currentPersonIndex--,$(".current-id").html(currentPersonIndex+1),$(".map-node-status").html("Tap on the map to indicate the general area where <strong>"+edges[currentPersonIndex].nname_t0+"</strong> lives."),highlightCurrent(),currentPersonIndex===edges.length-1?$(".map-forwards").hide():$(".map-forwards").show(),0===currentPersonIndex?$(".map-back").hide():$(".map-back").show())},geoInterface.init=function(){leaflet=window.L.map("map",{maxBounds:[[41.4985986599114,-88.49824022406345],[42.1070175291862,-87.07098424716594]],zoomControl:!1}),window.L.tileLayer("http://{s}.{base}.maps.cit.api.here.com/maptile/2.1/maptile/{mapID}/normal.day.transit/{z}/{x}/{y}/256/png8?app_id={app_id}&app_code={app_code}",{subdomains:"1234",mapID:"newest",app_id:"FxdAZ7O0Wh568CHyJWKV",app_code:"FuQ7aPiHQcR8BSnXBCCmuQ",base:"base",minZoom:0,maxZoom:20}).addTo(leaflet),$.ajax({dataType:"json",url:"data/census2010.json",success:function(data){geojson=window.L.geoJson(data,{onEachFeature:onEachFeature,style:function(){return{weight:1,fillOpacity:0,strokeWidth:.2,color:colors[1]}}}).addTo(leaflet),edges=window.network.getEdges({from:window.network.getNodes({type_t0:"Ego"})[0].id,type:"Dyad",res_cat_p_t0:"Chicago"}),$(".map-counter").html('<span class="current-id">1</span>/'+edges.length),$(".map-node-status").html("Tap on the map to indicate the general area where <strong>"+edges[0].nname_t0+"</strong> lives."),highlightCurrent(),$(".map-back").hide(),currentPersonIndex===edges.length-1?$(".map-forwards").hide():$(".map-forwards").show()}}),window.addEventListener("changeStageStart",stageChangeHandler,!1),$(".map-back").on("click",geoInterface.previousPerson),$(".map-forwards").on("click",geoInterface.nextPerson),$(".homeless").on("click",setHomeless),$(".jail").on("click",setJail)},geoInterface.destroy=function(){leaflet.remove(),window.removeEventListener("changeStageStart",stageChangeHandler,!1),$(".map-back").off("click",geoInterface.previousPerson),$(".map-forwards").off("click",geoInterface.nextPerson),$(".homeless").on("click",setHomeless),$(".jail").on("click",setJail)},geoInterface}},{}],7:[function(require,module,exports){var Menu=function(options){"use strict";var menu={},menus=[],isAnimating=!1,contentClickHandler=function(){menu.closeMenu()};return menu.options={onBeforeOpen:function(){$(".black").hide(),$(".arrow-next").transition({marginRight:-550},1e3),$(".arrow-prev").transition({marginLeft:-550},1e3),$(".content").addClass("pushed"),$(".pushed").on("click",contentClickHandler)},onAfterOpen:function(){return!1},onBeforeClose:function(){$(".content").removeClass("pushed"),$(".pushed").off("click",contentClickHandler)},onAfterClose:function(){$("body").css({"background-color":""}),$(".arrow-next").transition({marginRight:0},1e3),$(".arrow-prev").transition({marginLeft:0},1e3)}},menu.getMenus=function(){return menus},menu.closeMenu=function(targetMenu){targetMenu?targetMenu.closeBtn.trigger("click"):$.each(menus,function(index){menus[index].open===!0&&menus[index].closeBtn.trigger("click")})},menu.toggle=function(targetMenu){var targetMenuObj=$("."+targetMenu.name+"-menu");if(isAnimating===!0)return!1;if(isAnimating=!0,targetMenu.open===!0)menu.options.onBeforeClose(),targetMenuObj.removeClass("open"),targetMenu.open=!1,setTimeout(menu.options.onAfterClose,1e3),isAnimating=!1;else{menu.options.onBeforeOpen();var col=window.tools.modifyColor($("."+targetMenu.name+"-menu").css("background-color"),-.2);$("body").css({"background-color":col}),targetMenuObj.addClass("open"),targetMenu.open=!0,setTimeout(menu.options.onAfterOpen,500),isAnimating=!1}},menu.addMenu=function(name,icon){var newMenu={};newMenu.name=name,newMenu.open=!1,newMenu.button=$('<span class="hi-icon menu-btn '+name+' shown"></span>'),newMenu.button.addClass(icon).html(name),$(".menu-container").append(newMenu.button);var menuClass=name+"-menu";return newMenu.menu=$('<div class="menu '+menuClass+'"><div class="menu-content"><h2>'+name+"</h2><ul></ul></div></div>"),newMenu.closeBtn=$('<span class="icon icon-close"><i class="fa fa-times fa-2x"></i></span>'),$(newMenu.menu).append(newMenu.closeBtn),$(".menu-container").append(newMenu.menu),newMenu.button.on("click",function(){$(".menu-btn").removeClass("shown"),menu.toggle(newMenu)}),newMenu.closeBtn.on("click",function(){$(".menu-btn").addClass("shown"),menu.toggle(newMenu)}),menus.push(newMenu),newMenu},menu.removeMenu=function(targetMenu){$(targetMenu.button).remove(),$(targetMenu.items).remove()},menu.addItem=function(targetMenu,item,icon,callback){var listIcon="fa-file-text";icon&&(listIcon=icon);var menuItem=$('<li><span class="fa '+listIcon+' fa-2x menu-icon"></span> '+item+"</li>");targetMenu.menu.find("ul").append(menuItem),menuItem.on("click",function(){$(".paginate").removeAttr("disabled"),menu.closeMenu(targetMenu),setTimeout(function(){callback()},500)})},menu.init=function(){window.tools.notify("Menu initialising.",1),window.tools.extend(menu.options,options)},menu.init(),menu};module.exports=new Menu},{}],8:[function(require,module,exports){module.exports=function(){"use strict";var log,followup,taskComprehended=!1,multiBin={};multiBin.options={targetEl:$(".container"),edgeType:"Dyad",variable:{label:"multibin_variable",values:["Variable 1"]},filter:void 0,heading:"Default Heading",subheading:"Default Subheading."};var open=!1,stageChangeHandler=function(){multiBin.destroy()},followupHandler=function(e){e.preventDefault();var nodeid=followup,criteria={to:nodeid};window.tools.extend(criteria,multiBin.options.criteria);var edge=window.network.getEdges(criteria)[0],followupProperties={};$.each(multiBin.options.followup.questions,function(index){var followupVal=$("#"+multiBin.options.followup.questions[index].variable).val();followupProperties[multiBin.options.followup.questions[index].variable]=followupVal}),window.tools.extend(edge,followupProperties),window.network.updateEdge(edge.id,edge),$.each(multiBin.options.followup.questions,function(index){$("#"+multiBin.options.followup.questions[index].variable).val("")}),$(".followup").hide(),$(".black-overlay").hide()},followupCancelHandler=function(){$("#"+multiBin.options.followup.variable).val(""),$(".followup").hide(),$(".black-overlay").hide()},backgroundClickHandler=function(e){e.stopPropagation(),e.target!==e.currentTarget&&open===!0&&($(".node-bin-container").children().show(),$(".node-question-container").show(),$(".copy").removeClass("node-bin-active"),$(".copy").addClass("node-bin-static"),$(".copy").children("h1, p").show(),$(".copy").removeClass("copy"),$(".draggable").draggable({cursor:"pointer",revert:"invalid",disabled:!1,start:function(){if(taskComprehended===!1){var eventProperties={stage:window.netCanvas.Modules.session.currentStage(),timestamp:new Date};log=new window.CustomEvent("log",{detail:{eventType:"taskComprehended",eventObject:eventProperties}}),window.dispatchEvent(log),taskComprehended=!0}}}),open=!1)},nodeBinClickHandler=function(e){if(e.stopPropagation(),open===!1){if($(".draggable").draggable({cursor:"pointer",revert:"invalid",disabled:!0,start:function(){if(taskComprehended===!1){var eventProperties={stage:window.netCanvas.Modules.session.currentStage(),timestamp:new Date};log=new window.CustomEvent("log",{detail:{eventType:"taskComprehended",eventObject:eventProperties}}),window.dispatchEvent(log),taskComprehended=!0}}}),!$(this).hasClass(".node-bin-active")){$(".node-bin-container").children().not(this).hide(),$(".node-question-container").hide();var position=$(this).offset(),nodeBinDetails=$(this);nodeBinDetails.offset(position),nodeBinDetails.addClass("node-bin-active copy"),nodeBinDetails.removeClass("node-bin-static"),nodeBinDetails.children("h1, p").hide(),nodeBinDetails.children(".active-node-list").children(".node-bucket-item").css({top:0,left:20,opacity:0}),setTimeout(function(){nodeBinDetails.addClass("node-bin-active"),$.each($(".active-node-list").children(),function(index,value){setTimeout(function(){$(value).transition({left:0,opacity:1})},20*index)})},100)}open=!0}},nodeClickHandler=function(e){e.stopPropagation();var el=$(this),id=$(this).parent().parent().data("index");if($(this).parent().hasClass("active-node-list")){var edgeID=window.network.getEdges({from:window.network.getNodes({type_t0:"Ego"})[0].id,to:el.data("node-id"),type:multiBin.options.edgeType})[0].id,properties={};properties[multiBin.options.variable.label]="","undefined"!=typeof multiBin.options.followup&&$.each(multiBin.options.followup.questions,function(index,value){properties[value.variable]=void 0}),window.network.updateEdge(edgeID,properties),$(this).fadeOut(400,function(){$(this).appendTo(".node-bucket"),$(this).css("display","");var noun="people";1===$(".c"+id).children(".active-node-list").children().length&&(noun="person"),0===$(".c"+id).children(".active-node-list").children().length?$(".c"+id).children("p").html("(Empty)"):$(".c"+id).children("p").html($(".c"+id).children(".active-node-list").children().length+" "+noun+".")})}};return multiBin.destroy=function(){window.tools.notify("Destroying multiBin.",0),window.removeEventListener("changeStageStart",stageChangeHandler,!1),$(".node-bin-static").off("click",nodeBinClickHandler),$(".node-bucket-item").off("click",nodeClickHandler),$(".content").off("click",backgroundClickHandler),$(".followup-submit").off("click",followupHandler),$(".followup-cancel").off("click",followupCancelHandler),$(".followup").remove()},multiBin.init=function(options){if(window.tools.extend(multiBin.options,options),multiBin.options.targetEl.append('<div class="node-question-container"></div>'),$(".node-question-container").append("<h1>"+multiBin.options.heading+"</h1>"),$(".node-question-container").append('<div class="node-bucket"></div>'),"undefined"!=typeof multiBin.options.followup){if($("body").append('<div class="followup overlay"><form class="followup-form"></form></div>'),"undefined"!=typeof multiBin.options.followup.linked&&multiBin.options.followup.linked===!0){var first=!0;$.each(multiBin.options.followup.questions,function(index,value){$(".followup").children("form").append("<h2>"+value.prompt+'</h2><div class="row form-group"><input type="number" class="form-control '+value.variable+'" id="'+value.variable+'" name="followup" required></div>'),first&&$("#"+value.variable).change(function(){$("#"+multiBin.options.followup.questions[index+1].variable).val()>$("#"+value.variable).val()&&$("#"+multiBin.options.followup.questions[index+1].variable).val($("#"+value.variable).val()),$("#"+multiBin.options.followup.questions[index+1].variable).attr("max",$("#"+value.variable).val())}),first=!first})}else $.each(multiBin.options.followup.questions,function(index,value){$(".followup").children("form").append("<h2>"+value.prompt+'</h2><div class="row form-group"><input type="text" class="form-control '+value.variable+'" id="'+value.variable+'" name="followup" required></div>')});$(".followup").children("form").append('<div class="row form-group"><button type="submit" class="btn btn-primary btn-block followup-submit">Continue</button></div>'),"undefined"!=typeof multiBin.options.followup.cancel&&$(".overlay").children().last(".form-group").append('<div class="row form-group"><button type="submit" class="btn btn-warning btn-block followup-cancel">'+multiBin.options.followup.cancel+"</button></div>")}multiBin.options.targetEl.append('<div class="node-bin-container"></div>');var containerWidth=$(".node-bin-container").outerWidth(),containerHeight=$(".node-bin-container").outerHeight(),number=multiBin.options.variable.values.length,rowThresh=number>4?Math.floor(.66*number):4,itemSize=0,rows=Math.ceil(number/rowThresh);if(containerWidth>=containerHeight)for(itemSize=number>=rowThresh?containerWidth/rowThresh:containerWidth/number;itemSize>containerHeight/rows;)itemSize=.99*itemSize;else for(itemSize=number>=rowThresh?containerHeight/rowThresh:containerHeight/number;itemSize>containerWidth;)itemSize=.99*itemSize;var edges=window.network.getEdges(multiBin.options.criteria,multiBin.options.filter);$.each(multiBin.options.variable.values,function(index,value){var newBin=$('<div class="node-bin node-bin-static c'+index+'" data-index="'+index+'"><h1>'+value+'</h1><p class="lead">(Empty)</p><div class="active-node-list"></div></div>');newBin.data("index",index),$(".node-bin-container").append(newBin),$(".c"+index).droppable({accept:".draggable",drop:function(event,ui){var dropped=ui.draggable,droppedOn=$(this);if("undefined"!=typeof multiBin.options.followup&&multiBin.options.followup.trigger.indexOf(multiBin.options.variable.values[index])>=0)$(".followup").show(),$(".black-overlay").show(),$("#"+multiBin.options.followup.questions[0].variable).focus(),followup=$(dropped).data("node-id");else if("undefined"!=typeof multiBin.options.followup){var nodeid=$(dropped).data("node-id"),criteria={
to:nodeid};window.tools.extend(criteria,multiBin.options.criteria);var edge=window.network.getEdges(criteria)[0],followupProperties={};$.each(multiBin.options.followup.questions,function(index){followupProperties[multiBin.options.followup.questions[index].variable]=void 0}),window.tools.extend(edge,followupProperties),window.network.updateEdge(edge.id,edge),$.each(multiBin.options.followup.questions,function(index){$("#"+multiBin.options.followup.questions[index].variable).val("")})}$(dropped).appendTo(droppedOn.children(".active-node-list"));var properties={};properties[multiBin.options.variable.label]=multiBin.options.variable.values[index];var edgeID=window.network.getEdges({from:window.network.getNodes({type_t0:"Ego"})[0].id,to:$(dropped).data("node-id"),type:multiBin.options.edgeType})[0].id;window.network.updateEdge(edgeID,properties);var noun="people";1===$(".c"+index+" .active-node-list").children().length&&(noun="person"),$(".c"+index+" p").html($(".c"+index+" .active-node-list").children().length+" "+noun+".");var el=$(".c"+index);el.transition({scale:1.2},200,"ease"),setTimeout(function(){el.transition({background:el.data("oldBg")},200,"ease"),el.transition({scale:1},200,"ease")},0)},over:function(){$(this).data("oldBg",$(this).css("background-color")),$(this).stop().transition({background:"rgba(255, 193, 0, 1.0)"},400,"ease")},out:function(){$(this).stop().transition({background:$(this).data("oldBg")},500,"ease")}})}),$(".node-bin").css({width:itemSize,height:itemSize}),$.each($(".node-bin"),function(index,value){var oldPos=$(value).offset();$(value).data("oldPos",oldPos),$(value).css(oldPos)}),$(".node-bin").css({position:"absolute"}),$.each(edges,function(index,value){var dyadEdge=window.network.getEdges({from:window.network.getNodes({type_t0:"Ego"})[0].id,type:"Dyad",to:value.to})[0];if(void 0!==value[multiBin.options.variable.label]&&""!==value[multiBin.options.variable.label]){index=multiBin.options.variable.values.indexOf(value[multiBin.options.variable.label]),$(".c"+index).children(".active-node-list").append('<div class="node-bucket-item draggable" data-node-id="'+value.to+'">'+dyadEdge.nname_t0+"</div>");var noun="people";1===$(".c"+index).children(".active-node-list").children().length&&(noun="person"),0===$(".c"+index).children(".active-node-list").children().length?$(".c"+index).children("p").html("(Empty)"):$(".c"+index).children("p").html($(".c"+index).children(".active-node-list").children().length+" "+noun+".")}else $(".node-bucket").append('<div class="node-bucket-item draggable" data-node-id="'+value.to+'">'+dyadEdge.nname_t0+"</div>")}),$(".draggable").draggable({cursor:"pointer",revert:"invalid",disabled:!1,start:function(){if(taskComprehended===!1){var eventProperties={stage:window.netCanvas.Modules.session.currentStage(),timestamp:new Date};log=new window.CustomEvent("log",{detail:{eventType:"taskComprehended",eventObject:eventProperties}}),window.dispatchEvent(log),taskComprehended=!0}}}),window.addEventListener("changeStageStart",stageChangeHandler,!1),$(".node-bin-static").on("click",nodeBinClickHandler),$(".node-bucket-item").on("click",nodeClickHandler),$(".content").on("click",backgroundClickHandler),$(".followup-form").on("submit",followupHandler),$(".followup-cancel").on("click",followupCancelHandler)},multiBin}},{}],9:[function(require,module,exports){module.exports=function(){"use strict";var namegenerator={};namegenerator.options={nodeType:"Alter",edgeType:"Dyad",targetEl:$(".container"),variables:[],heading:"This is a default heading",subheading:"And this is a default subheading",panels:[]};var nodeBoxOpen=!1,editing=!1,alterCount=window.network.getNodes({type_t0:"Alter"}).length,roles={Friend:["Best Friend","Friend","Ex-friend","Other type"],"Family / Relative":["Parent / Guardian","Brother / Sister","Grandparent","Other Family","Chosen Family"],"Romantic / Sexual Partner":["Boyfriend / Girlfriend","Ex-Boyfriend / Ex-Girlfriend","Booty Call / Fuck Buddy / Hook Up","One Night Stand","Other type of Partner"],"Acquaintance / Associate":["Coworker / Colleague","Classmate","Roommate","Friend of a Friend","Neighbor","Other"],"Other Support / Source of Advice":["Teacher / Professor","Counselor / Therapist","Community Agency Staff","Religious Leader","Mentor","Coach","Other"],"Drug Use":["Someone you use drugs with","Someone you buy drugs from"],Other:["Other relationship"]},namesList=["Barney","Joshua","Jonathon","Myles","Alethia","Tammera","Veola","Meredith","Renee","Grisel","Celestina","Fausto","Eliana","Raymundo","Lyle","Carry","Kittie","Melonie","Elke","Mattie","Kieth","Lourie","Marcie","Trinity","Librada","Lloyd","Pearlie","Velvet","Stephan","Hildegard","Winfred","Tempie","Maybelle","Melynda","Tiera","Lisbeth","Kiera","Gaye","Edra","Karissa","Manda","Ethelene","Michelle","Pamella","Jospeh","Tonette","Maren","Aundrea","Madelene","Epifania","Olive"],keyPressHandler=function(e){13===e.keyCode&&(e.preventDefault(),nodeBoxOpen===!1?namegenerator.openNodeBox():nodeBoxOpen===!0&&$(".submit-1").click()),27===e.keyCode&&namegenerator.closeNodeBox(),8!==e.keyCode||$(e.target).is("input, textarea")||e.preventDefault()},roleClickHandler=function(){$(this).data("selected")===!0?($(this).data("selected",!1),$(this).removeClass("selected")):($(this).data("selected",!0),$(this).addClass("selected"))},inputKeypressHandler=function(e){if(nodeBoxOpen===!0&&13!==e.keyCode&&$("#fname_t0").val().length>0&&$("#fname_t0").val().length>0){var lname=$("#fname_t0").val()+" "+$("#lname_t0").val().charAt(0);$("#lname_t0").val().length>0&&(lname+=".");var updateName=function(){$("#nname_t0").val(lname)};setTimeout(updateName,0)}},stageChangeHandler=function(){namegenerator.destroy()},cardClickHandler=function(){if($(this).hasClass("ghost"))return!1;var index=$(this).data("index"),edge=window.network.getEdges({from:window.network.getNodes({type_t0:"Ego"})[0].id,to:index,type:"Dyad"})[0];editing=index;var roleCount=window.network.getEdges({from:window.network.getNodes({type_t0:"Ego"})[0].id,to:editing,type:"Role"}).length;$(".relationship-button").html(roleCount+" roles selected.");var roleEdges=window.network.getEdges({from:window.network.getNodes({type_t0:"Ego"})[0].id,to:editing,type:"Role"});$.each(roleEdges,function(index,value){$(".rel-"+value.reltype_main_t0).find('div[data-sub-relationship="'+value.reltype_sub_t0+'"]').addClass("selected").data("selected",!0)}),$.each(namegenerator.options.variables,function(index,value){value["private"]===!1&&("relationship"===value.type?$('select[name="'+value.variable+'"]').val(edge[value.variable]):$("#"+value.variable).val(edge[value.variable]),$(".delete-button").show(),edge.elicited_previously===!0?$("input#age_p_t0").prop("disabled",!0):$("input#age_p_t0").prop("disabled",!1),namegenerator.openNodeBox())})},cancelBtnHandler=function(){$(".delete-button").hide(),namegenerator.closeNodeBox()},submitFormHandler=function(e){e.preventDefault();var newEdgeProperties={},newNodeProperties={};$(".delete-button").hide(),$.each(namegenerator.options.variables,function(index,value){"edge"===value.target?value["private"]===!0?newEdgeProperties[value.variable]=value.value:"relationship"===value.type||"subrelationship"===value.type?newEdgeProperties[value.variable]=$('select[name="'+value.variable+'"]').val():newEdgeProperties[value.variable]=$("#"+value.variable).val():"node"===value.target&&(value["private"]===!0?newNodeProperties[value.variable]=value.value:"relationship"===value.type||"subrelationship"===value.type?newNodeProperties[value.variable]=$('select[name="'+value.variable+'"]').val():newNodeProperties[value.variable]=$("#"+value.variable).val())});var nodeProperties={},edgeProperties={};if(editing===!1){window.tools.extend(nodeProperties,newNodeProperties);var id,newNode=window.network.addNode(nodeProperties);$.each(namegenerator.options.edgeTypes,function(index,value){var currentEdgeProperties={},currentEdge=value;$.each(namegenerator.options.variables,function(index,value){"edge"===value.target&&value.edge===currentEdge&&(value["private"]===!0?currentEdgeProperties[value.variable]=value.value:"relationship"===value.type||"subrelationship"===value.type?currentEdgeProperties[value.variable]=$('select[name="'+value.variable+'"]').val():currentEdgeProperties[value.variable]=$("#"+value.variable).val())}),edgeProperties={from:window.network.getNodes({type_t0:"Ego"})[0].id,to:newNode,type:currentEdge},window.tools.extend(edgeProperties,currentEdgeProperties),id=window.network.addEdge(edgeProperties)}),$.each($(".relationship.selected"),function(){edgeProperties={type:"Role",from:window.network.getNodes({type_t0:"Ego"})[0].id,to:newNode,reltype_main_t0:$(this).parent(".relationship-type").data("main-relationship"),reltype_sub_t0:$(this).data("sub-relationship")},window.network.addEdge(edgeProperties)});var edge=window.network.getEdges({to:newNode,type:"Dyad"})[0];namegenerator.addToList(edge),alterCount++,$(".alter-count-box").html(alterCount)}else{var color=function(){var el=$("div[data-index="+editing+"]"),current=el.css("background-color");el.stop().transition({background:"#1ECD97"},400,"ease"),setTimeout(function(){el.stop().transition({background:current},800,"ease")},700)},nodeID=editing;$.each(namegenerator.options.edgeTypes,function(index,value){var currentEdge=value,currentEdgeProperties={};$.each(namegenerator.options.variables,function(index,value){"edge"===value.target&&value.edge===currentEdge&&(value["private"]===!0?currentEdgeProperties[value.variable]=value.value:"relationship"===value.type||"subrelationship"===value.type?currentEdgeProperties[value.variable]=$('select[name="'+value.variable+'"]').val():currentEdgeProperties[value.variable]=$("#"+value.variable).val())});var edges=window.network.getEdges({from:window.network.getNodes({type_t0:"Ego"})[0].id,to:editing,type:value});$.each(edges,function(index,value){window.network.updateEdge(value.id,currentEdgeProperties,color)})}),window.network.updateNode(nodeID,newNodeProperties);var properties=window.tools.extend(newEdgeProperties,newNodeProperties);window.network.removeEdges(window.network.getEdges({type:"Role",from:window.network.getNodes({type_t0:"Ego"})[0].id,to:editing})),$.each($(".relationship.selected"),function(){edgeProperties={type:"Role",from:window.network.getNodes({type_t0:"Ego"})[0].id,to:editing,reltype_main_t0:$(this).parent(".relationship-type").data("main-relationship"),reltype_sub_t0:$(this).data("sub-relationship")},window.network.addEdge(edgeProperties)}),$("div[data-index="+editing+"]").html(""),$("div[data-index="+editing+"]").append("<h4>"+properties.nname_t0+"</h4>");var list=$("<ul></ul>");$.each(namegenerator.options.variables,function(index,value){value["private"]===!1&&void 0!==properties[value.variable]&&""!==properties[value.variable]&&list.append('<li class="'+properties[value.variable]+'"><strong>'+value.label+"</strong>: "+properties[value.variable]+"</li>")}),$("div[data-index="+editing+"]").append(list),editing=!1}namegenerator.closeNodeBox()};return namegenerator.generateTestAlters=function(number){if(!number)return window.tools.notify("You must specify the number of test alters you want to create. Cancelling!",2),!1;for(var eachTime=4e3,i=0;number>i;i++){var timer=eachTime*i;setTimeout(namegenerator.generateAlter,timer)}},namegenerator.generateAlter=function(){$(".add-button").click(),setTimeout(function(){$("#ngForm").submit()},3e3),$("#fname_t0").val(namesList[Math.floor(window.tools.randomBetween(0,namesList.length))]),$("#lname_t0").val(namesList[Math.floor(window.tools.randomBetween(0,namesList.length))]);var lname=$("#fname_t0").val()+" "+$("#lname_t0").val().charAt(0);$("#lname_t0").val().length>0&&(lname+="."),$("#nname_t0").val(lname),$("#age_p_t0").val(Math.floor(window.tools.randomBetween(18,90))),setTimeout(function(){$(".relationship-button").click()},500),setTimeout(function(){for(var roleNumber=Math.floor(window.tools.randomBetween(1,3)),j=0;roleNumber>j;j++)$($(".relationship")[Math.floor(window.tools.randomBetween(0,$(".relationship").length))]).addClass("selected");$(".relationship-close-button").click()},2e3)},namegenerator.openNodeBox=function(){$(".newNodeBox").addClass("open"),setTimeout(function(){$("#ngForm input:text").first().focus()},1e3),nodeBoxOpen=!0},namegenerator.closeNodeBox=function(){$(".content").removeClass("blurry"),$(".newNodeBox").removeClass("open"),setTimeout(function(){}),nodeBoxOpen=!1,$("#ngForm").trigger("reset"),$(".reltype_oth_t0").hide(),editing=!1,$(".relationship-button").html("Set Relationship Roles"),$(".relationship").removeClass("selected")},namegenerator.destroy=function(){window.tools.notify("Destroying namegenerator.",0),$(window.document).off("keydown",keyPressHandler),$(".cancel").off("click",cancelBtnHandler),$("#fname_t0, #lname_t0").off("keyup",inputKeypressHandler),$(window.document).off("click",".inner-card",cardClickHandler),$(".add-button").off("click",namegenerator.openNodeBox),$(".delete-button").off("click",namegenerator.removeFromList),$("#ngForm").off("submit",submitFormHandler),window.removeEventListener("changeStageStart",stageChangeHandler,!1),$(".newNodeBox").remove(),$(".relationship-types-container").remove(),$(window.document).off("click",".relationship",roleClickHandler),$(window.document).off("click",".relationship-button",namegenerator.toggleRelationshipBox),$(window.document).off("click",".relationship-close-button",namegenerator.toggleRelationshipBox)},namegenerator.init=function(options){window.tools.extend(namegenerator.options,options);var button=$('<span class="hi-icon hi-icon-user add-button">Add</span>');namegenerator.options.targetEl.append(button);var alterCountBox=$('<div class="alter-count-box"></div>');namegenerator.options.targetEl.append(alterCountBox);var newNodeBox=$('<div class="newNodeBox overlay"><form role="form" id="ngForm" class="form"><div class="col-sm-12"><h2 style="margin-top:0">Adding a Person</h2></div><div class="col-sm-12 fields"></div></form></div>');$("body").append(newNodeBox),$.each(namegenerator.options.variables,function(index,value){if(value["private"]!==!0){var formItem;switch(value.type){case"text":formItem=$('<div class="form-group '+value.variable+'"><label class="sr-only" for="'+value.variable+'">'+value.label+'</label><input type="text" class="form-control '+value.variable+'" id="'+value.variable+'" placeholder="'+value.label+'"></div></div>');break;case"number":formItem=$('<div class="form-group '+value.variable+'"><label class="sr-only" for="'+value.variable+'">'+value.label+'</label><input type="number" class="form-control '+value.variable+'" id="'+value.variable+'" placeholder="'+value.label+'"></div></div>');break;case"relationship":formItem=$('<input type="hidden" class="form-control '+value.variable+'" id="'+value.variable+'" placeholder="'+value.label+'">');break;case"subrelationship":formItem=$('<input type="hidden" class="form-control '+value.variable+'" id="'+value.variable+'" placeholder="'+value.label+'">')}$(".newNodeBox .form .fields").append(formItem),value.required===!0&&("relationship"===value.type?$('select[name="'+value.variable+'"]').prop("required",!0):$("#"+value.variable).prop("required",!0))}}),$(".newNodeBox .form .fields").append('<div class="form-group"><div class=""><button type="button" class="btn btn-primary btn-block relationship-button">Set Relationship Roles</div></div></div>');var buttons=$('<div class="row"><div class="col-sm-4"><button type="submit" class="btn btn-success btn-block submit-1"><span class="glyphicon glyphicon-plus-sign"></span> Add</button></div><div class="col-sm-4"><button type="button" class="btn btn-danger btn-block delete-button"><span class="glyphicon glyphicon-trash"></span> Delete</button></div><div class="col-sm-4"><span class="btn btn-warning btn-block cancel">Cancel</span></div></div>');$(".newNodeBox .form .fields").append(buttons),alterCountBox=$('<div class="relationship-types-container"><span class="relationship-close-button">X</span>'),$(".newNodeBox").after(alterCountBox);var counter=0;$.each(roles,function(index){$(".relationship-types-container").append('<div class="relationship-type rel-'+counter+" c"+counter+'" data-main-relationship="'+counter+'"><h1>'+index+"</h1></div>"),$.each(roles[index],function(relIndex,relValue){$(".rel-"+counter).append('<div class="relationship" data-sub-relationship="'+relValue+'">'+relValue+"</div>")}),counter++});var nodeContainer=$('<div class="question-container"></div><div class="node-container-bottom-bg"></div>');namegenerator.options.targetEl.append(nodeContainer);var title=$('<h1 class="text-center"></h1>').html(namegenerator.options.heading);$(".question-container").append(title);var subtitle=$('<p class="lead text-center"></p>').html(namegenerator.options.subheading);$(".question-container").append(subtitle);var nameList=$('<div class="node-container nameList"></div>');if(namegenerator.options.targetEl.append(nameList),window.addEventListener("changeStageStart",stageChangeHandler,!1),$(window.document).on("keydown",keyPressHandler),$(".cancel").on("click",cancelBtnHandler),$(".add-button").on("click",namegenerator.openNodeBox),$(".delete-button").on("click",namegenerator.removeFromList),$("#fname_t0, #lname_t0").on("keyup",inputKeypressHandler),$(window.document).on("click",".inner-card",cardClickHandler),$("#ngForm").on("submit",submitFormHandler),$(window.document).on("click",".relationship",roleClickHandler),$(window.document).on("click",".relationship-button",namegenerator.toggleRelationshipBox),$(window.document).on("click",".relationship-close-button",namegenerator.toggleRelationshipBox),$(".alter-count-box").html(alterCount),$.each(window.network.getEdges({type:"Dyad",from:window.network.getNodes({type_t0:"Ego"})[0].id,ng_t0:namegenerator.options.variables[5].value}),function(index,value){namegenerator.addToList(value)}),namegenerator.options.panels.length>0){var sideContainer=$('<div class="side-container"></div>');-1!==namegenerator.options.panels.indexOf("current")&&(sideContainer.append($('<div class="current-node-list node-lists"><h4>People you already listed:</h4></div>')),$.each(window.network.getEdges({type:"Dyad",from:window.network.getNodes({type_t0:"Ego"})[0].id}),function(index,value){var el=$('<div class="node-list-item">'+value.nname_t0+"</div>");sideContainer.children(".current-node-list").append(el)})),-1!==namegenerator.options.panels.indexOf("previous")&&"undefined"!=typeof window.netCanvas.Modules.session.sessionData.previousNetwork&&("undefined"==typeof window.previousNetwork&&(window.previousNetwork=new window.netCanvas.Modules.Network,window.previousNetwork.loadNetwork(window.netCanvas.Modules.session.sessionData.previousNetwork)),window.previousNetwork.getNodes().length>1&&(sideContainer.append($('<div class="previous-node-list node-lists"><h4>People you listed in other visits:</h4></div>')),$.each(window.previousNetwork.getEdges({type:"Dyad",from:window.previousNetwork.getEgo().id}),function(index,value){var el=$('<div class="node-bucket-item draggable" data-id="'+value.to+'">'+value.nname_t0+"</div>");sideContainer.children(".previous-node-list").append(el)}))),sideContainer.children().length>0&&(sideContainer.insertBefore(".nameList"),$(".nameList").addClass("alt"),$(".draggable").draggable({cursor:"pointer",revert:"invalid",disabled:!1,start:function(){console.log($(this).parent().css("overflow")),$(this).parent().css("overflow","visible"),console.log($(this).parent().css("overflow"))},stop:function(){$("previous-node-list").css("overflow","scroll"),$("current-node-list").css("overflow","scroll")}}),$(".node-container").droppable({accept:".draggable",drop:function(event,ui){$("previous-node-list").css("overflow","scroll"),$("current-node-list").css("overflow","scroll"),$(".card.ghost").remove();var ngStep,dropped=ui.draggable,droppedNode=dropped.data("id"),droppedNodeEdge=window.previousNetwork.getEdges({type:"Dyad",from:window.previousNetwork.getEgo().id,to:droppedNode})[0];$.each(namegenerator.options.variables,function(index,value){"ng_t0"===value.label&&(ngStep=value.value)}),droppedNodeEdge.ng_t0=ngStep,namegenerator.addToList(droppedNodeEdge);var oldNode=window.previousNetwork.getNode(droppedNode);droppedNodeEdge.elicited_previously=!0,window.network.addNode(oldNode,!1,!0),window.network.addEdge(droppedNodeEdge),$(".inner-card").last().click(),setTimeout(function(){$(".relationship-button").click()},300),window.previousNetwork.removeNode(oldNode.id),window.netCanvas.Modules.session.addData("previousNetwork",{nodes:window.previousNetwork.getNodes(),edges:window.previousNetwork.getEdges()}),$(dropped).remove(),$(".card.ghost").removeClass("show")},over:function(){$(".node-container").scrollTop($(".node-container")[0].scrollHeight),$(".node-container").append('<div class="card ghost"><div class="inner-card ghost"><i class="fa fa-5x fa-plus-circle"></i>Add</div></div>'),setTimeout(function(){$(".card.ghost").addClass("show")},100)},out:function(){$(".card.ghost").removeClass("show"),setTimeout(function(){$(".card.ghost").remove()},300)}})),$(".side-container").children().length>1&&$(".node-lists").addClass("double")}},namegenerator.toggleRelationshipBox=function(){if($(".relationship-types-container").hasClass("open")){var roleCount=$(".relationship.selected").length,plural="roles";1===roleCount&&(plural="role"),editing?$(".relationship-button").html(roleCount+" "+plural+" selected."):roleCount>0?$(".relationship-button").html(roleCount+" "+plural+" selected."):$(".relationship-button").html("Set Relationship Roles"),$.each($(".relationship-type"),function(index,value){setTimeout(function(){$(value).transition({opacity:0,top:"-100px"},150),$.each($(value).children(".relationship"),function(index,childvalue){setTimeout(function(){$(childvalue).transition({opacity:0,top:"-200px"},150)},50+20*index)})},50*index)}),setTimeout(function(){$(".relationship-types-container").removeClass("open"),$(".relationship-types-container").removeClass("front"),$(".newNodeBox").removeClass("back")},400)}else $(".newNodeBox").addClass("back"),$(".relationship-types-container").addClass("open front"),$(".relationship").css({position:"relative",opacity:0,top:"-200px"}),$(".relationship-type").css({position:"relative",opacity:0,top:"-100px"}),$.each($(".relationship-type"),function(index,value){setTimeout(function(){$(value).transition({opacity:1,top:"0px"},200),$.each($(value).children(".relationship"),function(index,childvalue){setTimeout(function(){$(childvalue).transition({opacity:1,top:0},100)},100+50*index)})},80*index)})},namegenerator.addToList=function(properties){var card;card=$('<div class="card"><div class="inner-card" data-index="'+properties.to+'"><h4>'+properties.nname_t0+"</h4></div></div>");var list=$("<ul></ul>");$.each(namegenerator.options.variables,function(index,value){value["private"]===!1&&void 0!==properties[value.variable]&&""!==properties[value.variable]&&list.append('<li class="'+properties[value.variable]+'"><strong>'+value.label+"</strong>: "+properties[value.variable]+"</li>")}),card.children(".inner-card").append(list),$(".nameList").append(card)},namegenerator.removeFromList=function(){$(".delete-button").hide();var nodeID=editing;window.network.removeNode(nodeID),$("div[data-index="+editing+"]").addClass("delete");var tempEditing=editing;setTimeout(function(){console.log("removing"),console.log($("div[data-index="+editing+"]").parent()),$("div[data-index="+tempEditing+"]").parent().remove()},700),editing=!1;var alterCount=window.network.getNodes({type_t0:"Alter"}).length;$(".alter-count-box").html(alterCount),namegenerator.closeNodeBox()},namegenerator}},{}],10:[function(require,module,exports){module.exports=function(){"use strict";this.nodes=[],this.edges=[];var _this=this;this.addNode=function(properties,ego,force){var reserved_ids;if(force||(force=!1),ego||(ego=!1),reserved_ids=ego?[]:_this.getEgo().reserved_ids,"undefined"!=typeof properties.id&&this.getNode(properties.id)!==!1)return window.tools.notify("Node already exists with id "+properties.id+". Cancelling!",2),!1;if(!force&&-1!==reserved_ids.indexOf(properties.id))return window.tools.notify("Node id "+properties.id+" is already in use with this ego. Cancelling!",2),!1;for(var newNodeID=0;_this.getNode(newNodeID)!==!1||-1!==reserved_ids.indexOf(newNodeID);)newNodeID++;var nodeProperties={id:newNodeID};window.tools.extend(nodeProperties,properties),_this.nodes.push(nodeProperties),reserved_ids.push(newNodeID);var log=new window.CustomEvent("log",{detail:{eventType:"nodeCreate",eventObject:nodeProperties}});window.dispatchEvent(log);var nodeAddedEvent=new window.CustomEvent("nodeAdded",{detail:nodeProperties});window.dispatchEvent(nodeAddedEvent);var unsavedChanges=new window.Event("unsavedChanges");return window.dispatchEvent(unsavedChanges),nodeProperties.id},this.loadNetwork=function(data,overwrite){return data&&data.nodes&&data.edges?(overwrite||(overwrite=!1),overwrite?(_this.nodes=data.nodes,_this.dges=data.edges):(_this.nodes=_this.nodes.concat(data.nodes),_this.edges=_this.edges.concat(data.edges)),!0):(window.tools.notify("Error loading network. Data format incorrect.",1),!1)},this.createEgo=function(properties){if(_this.egoExists()!==!1)return!1;var egoProperties={id:0,type_t0:"Ego",reserved_ids:[0]};window.tools.extend(egoProperties,properties),_this.addNode(egoProperties,!0)},this.getEgo=function(){return 0!==_this.getNodes({type_t0:"Ego"}).length?_this.getNodes({type_t0:"Ego"})[0]:!1},this.egoExists=function(){return _this.getEgo()!==!1?!0:!1},this.addEdge=function(properties){if("undefined"==typeof properties.from||"undefined"==typeof properties.to)return window.tools.notify('ERROR: "To" and "From" must BOTH be defined.',2),!1;if("undefined"!==properties.id&&_this.getEdge(properties.id)!==!1){window.tools.notify("An edge with this id already exists! I'm generating a new one for you.",2);for(var newEdgeID=0;_this.getEdge(newEdgeID)!==!1;)newEdgeID++;properties.id=newEdgeID}for(var position=0;_this.getEdge(position)!==!1;)position++;var edgeProperties={id:position,type:"Default"};window.tools.extend(edgeProperties,properties);var temp,alreadyExists=!1,reversed={};if(reversed=$.extend(!0,{},properties),temp=reversed.to,reversed.to=reversed.from,reversed.from=temp,(_this.getEdges(properties).length>0||_this.getEdges(reversed).length>0)&&(alreadyExists=!0),alreadyExists===!1){_this.edges.push(edgeProperties);var log=new window.CustomEvent("log",{detail:{eventType:"edgeCreate",eventObject:edgeProperties}});window.dispatchEvent(log);var edgeAddedEvent=new window.CustomEvent("edgeAdded",{detail:edgeProperties});window.dispatchEvent(edgeAddedEvent);var unsavedChanges=new window.Event("unsavedChanges");return window.dispatchEvent(unsavedChanges),edgeProperties.id}return window.tools.notify("ERROR: Edge already exists!",2),!1},this.removeEdges=function(edges){_this.removeEdge(edges)},this.removeEdge=function(edge){if(!edge)return!1;var log,edgeRemovedEvent;if("object"==typeof edge&&"undefined"!=typeof edge.length)for(var i=0;i<edge.length;i++)window.tools.removeFromObject(edge[i],_this.edges),log=new window.CustomEvent("log",{detail:{eventType:"edgeRemove",eventObject:edge[i]}}),edgeRemovedEvent=new window.CustomEvent("edgeRemoved",{detail:edge[i]}),window.dispatchEvent(log),window.dispatchEvent(edgeRemovedEvent);else window.tools.removeFromObject(edge,_this.edges),log=new window.CustomEvent("log",{detail:{eventType:"edgeRemove",eventObject:edge}}),edgeRemovedEvent=new window.CustomEvent("edgeRemoved",{detail:edge}),window.dispatchEvent(log),window.dispatchEvent(edgeRemovedEvent);var unsavedChanges=new window.Event("unsavedChanges");return window.dispatchEvent(unsavedChanges),!0},this.removeNode=function(id,preserveEdges){preserveEdges||(preserveEdges=!1),preserveEdges?window.tools.notify("NOTICE: preserving node edges after deletion.",2):this.removeEdge(_this.getNodeEdges(id));for(var nodeRemovedEvent,log,i=0;i<_this.nodes.length;i++)if(_this.nodes[i].id===id)return log=new window.CustomEvent("log",{detail:{eventType:"nodeRemove",eventObject:_this.nodes[i]}}),window.dispatchEvent(log),nodeRemovedEvent=new window.CustomEvent("nodeRemoved",{detail:_this.nodes[i]}),window.dispatchEvent(nodeRemovedEvent),window.tools.removeFromObject(_this.nodes[i],_this.nodes),!0;return!1},this.updateEdge=function(id,properties,callback){if(_this.getEdge(id)===!1||void 0===properties)return!1;var edgeUpdateEvent,log,edge=_this.getEdge(id);window.tools.extend(edge,properties),edgeUpdateEvent=new window.CustomEvent("edgeUpdatedEvent",{detail:edge}),window.dispatchEvent(edgeUpdateEvent),log=new window.CustomEvent("log",{detail:{eventType:"edgeUpdate",eventObject:edge}}),window.dispatchEvent(log);var unsavedChanges=new window.Event("unsavedChanges");window.dispatchEvent(unsavedChanges),callback&&callback()},this.updateNode=function(id,properties,callback){if(this.getNode(id)===!1||void 0===properties)return!1;var nodeUpdateEvent,log,node=this.getNode(id);window.tools.extend(node,properties),nodeUpdateEvent=new window.CustomEvent("nodeUpdatedEvent",{detail:node}),window.dispatchEvent(nodeUpdateEvent),log=new window.CustomEvent("log",{detail:{eventType:"nodeUpdate",eventObject:node}}),window.dispatchEvent(log);var unsavedChanges=new window.Event("unsavedChanges");window.dispatchEvent(unsavedChanges),callback&&callback()},this.getNode=function(id){if(void 0===id)return!1;for(var i=0;i<_this.nodes.length;i++)if(_this.nodes[i].id===id)return _this.nodes[i];return!1},this.getEdge=function(id){if(void 0===id)return!1;for(var i=0;i<_this.edges.length;i++)if(_this.edges[i].id===id)return _this.edges[i];return!1},this.filterObject=function(targetArray,criteria){if(!criteria)return!1;var result=targetArray.filter(function(el){var match=!0;for(var criteriaKey in criteria)void 0!==el[criteriaKey]?el[criteriaKey]!==criteria[criteriaKey]&&(match=!1):match=!1;return match===!0?el:void 0});if("undefined"!=typeof criteria.from&&"undefined"!=typeof criteria.to){var temp,reversed={};reversed=$.extend(!0,{},criteria),temp=reversed.to,reversed.to=reversed.from,reversed.from=temp;var result2=targetArray.filter(function(el){var match=!0;for(var criteriaKey in reversed)void 0!==el[criteriaKey]?el[criteriaKey]!==reversed[criteriaKey]&&(match=!1):match=!1;return match===!0?el:void 0});result=result.concat(result2)}return result},this.getNodes=function(criteria,filter){var results;return results="undefined"!=typeof criteria&&0!==Object.keys(criteria).length?_this.filterObject(_this.nodes,criteria):_this.nodes,filter&&(results=filter(results)),results},this.getEdges=function(criteria,filter){var results;return results="undefined"!=typeof criteria&&0!==Object.keys(criteria).length?_this.filterObject(_this.edges,criteria):_this.edges,filter&&(results=filter(results)),results},this.getNodeInboundEdges=function(nodeID){return _this.getEdges({to:nodeID})},this.getNodeOutboundEdges=function(nodeID){return _this.getEdges({from:nodeID})},this.getNodeEdges=function(nodeID){if(_this.getNode(nodeID)===!1)return!1;var inbound=_this.getNodeInboundEdges(nodeID),outbound=_this.getNodeOutboundEdges(nodeID),concat=inbound.concat(outbound);return concat},this.setProperties=function(object,properties){if("undefined"==typeof object)return!1;if("object"==typeof object&&object.length>0)for(var i=0;i<object.length;i++)$.extend(object[i],properties);else $.extend(object,properties)},this.returnAllNodes=function(){return _this.nodes},this.returnAllEdges=function(){return _this.edges},this.clearGraph=function(){_this.edges=[],_this.nodes=[]},this.createRandomGraph=function(nodeCount,edgeProbability){nodeCount=nodeCount||10,edgeProbability=edgeProbability||.4,window.tools.notify("Creating random graph...",1);for(var i=0;nodeCount>i;i++){var current=i+1;window.tools.notify("Adding node "+current+" of "+nodeCount,2);var nodeOptions={coords:[Math.round(randomBetween(100,window.innerWidth-100)),Math.round(randomBetween(100,window.innerHeight-100))]};this.addNode(nodeOptions);
}window.tools.notify("Adding _this.edges.",3),$.each(_this.nodes,function(index){if(randomBetween(0,1)<edgeProbability){var randomFriend=Math.round(randomBetween(0,_this.nodes.length-1));_this.addEdge({from:_this.nodes[index].id,to:_this.nodes[randomFriend].id})}})}}},{}],11:[function(require,module,exports){module.exports=function(){"use strict";var log,ordinalBin={},taskComprehended=!1;ordinalBin.options={targetEl:$(".container"),edgeType:"Dyad",criteria:{},variable:{label:"gender_p_t0",values:["Female","Male","Transgender","Don't Know","Won't Answer"]},heading:"Default Heading",subheading:"Default Subheading."};var followup,stageChangeHandler=function(){ordinalBin.destroy()},followupHandler=function(){var followupVal=$(this).data("value"),nodeid=followup,criteria={to:nodeid};window.tools.extend(criteria,ordinalBin.options.criteria);var edge=window.network.getEdges(criteria)[0],followupProperties={};followupProperties[ordinalBin.options.followup.variable]=followupVal,window.tools.extend(edge,followupProperties),window.network.updateEdge(edge.id,edge),$(".followup").hide()};return ordinalBin.destroy=function(){window.tools.notify("Destroying ordinalBin.",0),window.removeEventListener("changeStageStart",stageChangeHandler,!1),$(window.document).off("click",".followup-option",followupHandler)},ordinalBin.init=function(options){window.tools.extend(ordinalBin.options,options),ordinalBin.options.targetEl.append('<div class="node-question-container"></div>'),$(".node-question-container").append("<h1>"+ordinalBin.options.heading+"</h1>"),$(".node-question-container").append('<p class="lead">'+ordinalBin.options.subheading+"</p>"),$(".node-question-container").append('<div class="node-bucket"></div>'),"undefined"!=typeof ordinalBin.options.followup&&($(".node-question-container").append('<div class="followup"><h2>'+ordinalBin.options.followup.prompt+"</h2></div>"),$.each(ordinalBin.options.followup.values,function(index,value){$(".followup").append('<span class="btn btn-primary btn-block followup-option" data-value="'+value.value+'">'+value.label+"</span>")})),ordinalBin.options.targetEl.append('<div class="ord-bin-container"></div>');var binNumber=ordinalBin.options.variable.values.length;$.each(ordinalBin.options.variable.values,function(index,value){var newBin=$('<div class="ord-node-bin size-'+binNumber+" d"+index+'" data-index="'+index+'"><h1>'+value.label+'</h1><div class="active-node-list"></div></div>');newBin.data("index",index),$(".ord-bin-container").append(newBin),$(".d"+index).droppable({accept:".draggable",drop:function(event,ui){console.log("dropped");var dropped=ui.draggable,droppedOn=$(this);ordinalBin.options.variable.values[index].value>0&&($(".followup").show(),followup=$(dropped).data("node-id")),console.log(droppedOn.children(".active-node-list")),console.log(dropped),dropped.css({position:"inherit"}),droppedOn.children(".active-node-list").append(dropped),$(dropped).appendTo(droppedOn.children(".active-node-list"));var properties={};properties[ordinalBin.options.variable.label]=ordinalBin.options.variable.values[index].value;var edgeID=window.network.getEdges({from:window.network.getNodes({type_t0:"Ego"})[0].id,to:$(dropped).data("node-id"),type:ordinalBin.options.edgeType})[0].id;window.network.updateEdge(edgeID,properties),$.each($(".ord-node-bin"),function(oindex){var length=$(".d"+oindex).children(".active-node-list").children().length;if(length>0){var noun="people";1===length&&(noun="person"),$(".d"+oindex+" p").html(length+" "+noun+".")}else $(".d"+oindex+" p").html("(Empty)")});var el=$(".d"+index);setTimeout(function(){el.transition({background:el.data("oldBg")},200,"ease")},0),$(".draggable").draggable({cursor:"pointer",revert:"invalid",start:function(){if(console.log($(this).css("top")),"auto"!==$(this).css("top")&&"0px"!==$(this).css("top")?(console.log("has class"),$(this).css({position:"absolute"})):(console.log("not"),$(this).css({position:"relative"})),taskComprehended===!1){var eventProperties={stage:window.netCanvas.Modules.session.currentStage(),timestamp:new Date};log=new window.CustomEvent("log",{detail:{eventType:"taskComprehended",eventObject:eventProperties}}),window.dispatchEvent(log),taskComprehended=!0}},stop:function(){$(this).css({position:"inerit"})}})},over:function(){$(this).data("oldBg",$(this).css("background-color")),$(this).stop().transition({background:"rgba(255, 193, 0, 1.0)"},400,"ease")},out:function(){$(this).stop().transition({background:$(this).data("oldBg")},500,"ease")}})});var edges=window.network.getEdges(ordinalBin.options.criteria);$.each(edges,function(index,value){var dyadEdge;"Dyad"!==ordinalBin.options.criteria.type&&(dyadEdge=window.network.getEdges({from:value.from,to:value.to,type:"Dyad"})[0]),void 0!==value[ordinalBin.options.variable.label]&&""!==value[ordinalBin.options.variable.label]?(index="error",$.each(ordinalBin.options.variable.values,function(vindex,vvalue){value[ordinalBin.options.variable.label]===vvalue.value&&(index=vindex)}),"Dyad"!==ordinalBin.options.criteria.type?$(".d"+index).children(".active-node-list").append('<div class="node-bucket-item draggable" data-node-id="'+value.to+'">'+dyadEdge.nname_t0+"</div>"):$(".d"+index).children(".active-node-list").append('<div class="node-bucket-item draggable" data-node-id="'+value.to+'">'+value.nname_t0+"</div>")):"Dyad"!==ordinalBin.options.criteria.type?$(".node-bucket").append('<div class="node-bucket-item draggable" data-node-id="'+value.to+'">'+dyadEdge.nname_t0+"</div>"):$(".node-bucket").append('<div class="node-bucket-item draggable" data-node-id="'+value.to+'">'+value.nname_t0+"</div>")}),$(".draggable").draggable({cursor:"pointer",revert:"invalid",start:function(){if($(this).css({position:"relative"}),taskComprehended===!1){var eventProperties={stage:window.netCanvas.Modules.session.currentStage(),timestamp:new Date};log=new window.CustomEvent("log",{detail:{eventType:"taskComprehended",eventObject:eventProperties}}),window.dispatchEvent(log),taskComprehended=!0}},stop:function(){$(this).css({position:"inerit"})}}),window.addEventListener("changeStageStart",stageChangeHandler,!1),$(window.document).on("click",".followup-option",followupHandler)},ordinalBin}},{}],12:[function(require,module,exports){var RoleRevisit=function(){"use strict";var roleRevisit={};roleRevisit.options={nodeType:"Alter",edgeType:"Dyad",targetEl:$(".container"),variables:[],heading:"This is a default heading",subheading:"And this is a default subheading"};var nodeBoxOpen=!1,editing=!1,roles={Friend:["Best Friend","Friend","Ex-friend","Other type"],"Family / Relative":["Parent / Guardian","Brother / Sister","Grandparent","Other Family","Chosen Family"],"Romantic / Sexual Partner":["Boyfriend / Girlfriend","Ex-Boyfriend / Ex-Girlfriend","Booty Call / Fuck Buddy / Hook Up","One Night Stand","Other type of Partner"],"Acquaintance / Associate":["Coworker / Colleague","Classmate","Roommate","Friend of a Friend","Neighbor","Other"],"Other Support / Source of Advice":["Teacher / Professor","Counselor / Therapist","Community Agency Staff","Religious Leader","Mentor","Coach","Other"],"Drug Use":["Someone you use drugs with","Someone you buy drugs from"],Other:["Other relationship"]},roleClickHandler=function(){$(this).data("selected")===!0?($(this).data("selected",!1),$(this).removeClass("selected")):($(this).data("selected",!0),$(this).addClass("selected"))},stageChangeHandler=function(){roleRevisit.destroy()},cardClickHandler=function(e){console.log("card click"),console.log(e);var index=$(this).data("index");console.log(index),editing=index;var roleCount=window.network.getEdges({from:window.network.getNodes({type_t0:"Ego"})[0].id,to:editing,type:"Role"}).length;$('div[data-index="'+index+'"]').children().children(".role-count").html(roleCount+" roles selected.");var roleEdges=window.network.getEdges({from:window.network.getNodes({type_t0:"Ego"})[0].id,to:editing,type:"Role"});$.each(roleEdges,function(index,value){$(".rel-"+value.reltype_main_t0).find('div[data-sub-relationship="'+value.reltype_sub_t0+'"]').addClass("selected").data("selected",!0)}),window.network.removeEdges(window.network.getEdges({from:window.network.getNodes({type_t0:"Ego"})[0].id,to:editing,type:"Role"})),roleRevisit.openNodeBox()},submitFormHandler=function(){var el=$("div[data-index="+editing+"]");el.stop().transition({background:"#1ECD97"},400,"ease"),$.each($(".relationship.selected"),function(){var edgeProperties={type:"Role",from:window.network.getNodes({type_t0:"Ego"})[0].id,to:editing,reltype_main_t0:$(this).parent(".relationship-type").data("main-relationship"),reltype_sub_t0:$(this).data("sub-relationship")};window.network.addEdge(edgeProperties)}),$(".relationship").removeClass("selected");var roleCount=window.network.getEdges({from:window.network.getNodes({type_t0:"Ego"})[0].id,to:editing,type:"Role"}).length;$('div[data-index="'+editing+'"]').children().children(".role-count").html(roleCount+" roles selected."),roleRevisit.closeNodeBox()};return roleRevisit.openNodeBox=function(){$(".content").addClass("blurry"),$(".relationship-types-container").addClass("open"),nodeBoxOpen=!0},roleRevisit.closeNodeBox=function(){$(".content").removeClass("blurry"),$(".relationship-types-container").removeClass("open"),setTimeout(function(){}),nodeBoxOpen=!1},roleRevisit.addToList=function(properties){var card;card=$('<div class="card" data-index="'+properties.to+'"><h4>'+properties.nname_t0+"</h4></div>");var list=$("<ul></ul>");list.append('<li class="'+properties.fname_t0+'"><strong>First Name</strong>: '+properties.fname_t0+"</li>"),list.append('<li class="'+properties.lname_t0+'"><strong>Last Name</strong>: '+properties.lname_t0+"</li>");var roles=window.network.getEdges({from:window.network.getNodes({type_t0:"Ego"})[0].id,to:properties.to,type:"Role"}),roleString="";$.each(roles,function(index,value){roleString+=" "+value.reltype_sub_t0+","}),roleString=roleString.substring(0,roleString.length-1),list.append("<li><strong>Roles</strong>: "+roleString+"</li>"),card.append(list),$(".nameList").append(card)},roleRevisit.destroy=function(){window.tools.notify("Destroying roleRevisit.",0),$(window.document).off("click",".card",cardClickHandler),window.removeEventListener("changeStageStart",stageChangeHandler,!1),$(".relationship-types-container").remove(),$(window.document).off("click",".relationship",roleClickHandler),$(window.document).off("click",".relationship-close-button",roleRevisit.toggleRelationshipBox)},roleRevisit.init=function(options){window.tools.extend(roleRevisit.options,options);var title=$('<h1 class="text-center"></h1>').html(roleRevisit.options.heading);roleRevisit.options.targetEl.append(title);var subtitle=$('<p class="lead text-center"></p>').html(roleRevisit.options.subheading);roleRevisit.options.targetEl.append(subtitle);var roleBox=$('<div class="relationship-types-container"><button class="btn btn-primary relationship-close-button">Close</button></div>');$("body").append(roleBox);var counter=0;$.each(roles,function(index){$(".relationship-types-container").append('<div class="relationship-type rel-'+counter+" c"+counter+'" data-main-relationship="'+counter+'"><h1>'+index+"</h1></div>"),$.each(roles[index],function(relIndex,relValue){$(".rel-"+counter).append('<div class="relationship" data-sub-relationship="'+relValue+'">'+relValue+"</div>")}),counter++});var nodeContainer=$('<div class="node-container"></div>');roleRevisit.options.targetEl.append(nodeContainer);var nameList=$('<div class="table nameList"></div>');$(".node-container").append(nameList),window.addEventListener("changeStageStart",stageChangeHandler,!1),$(window.document).on("click",".card",cardClickHandler),$(window.document).on("click",".relationship",roleClickHandler),$(window.document).on("click",".relationship-close-button",submitFormHandler)},roleRevisit};module.exports=new RoleRevisit},{}],13:[function(require,module,exports){var Session=function(){"use strict";function saveFile(path){var data=JSON.stringify(session.sessionData,void 0,2),fs=require("browserify-fs");fs.writeFile(path,data)}function clickDownloadInput(){$("#save").prop("nwsaveas",session.returnSessionID()+"_"+Math.floor(Date.now()/1e3)+".json");var event=window.document.createEvent("MouseEvents");event.initMouseEvent("click"),window.document.getElementById("save").dispatchEvent(event)}function sessionNextHandler(){session.nextStage()}function sessionPreviousHandler(){session.prevStage()}var session={},currentStage=0,content=$("#content");session.id=0,session.sessionData={};var lastSaveTime,saveTimer;return session.options={fnBeforeStageChange:function(oldStage,newStage){var eventProperties={stage:currentStage,timestamp:new Date},log=new window.CustomEvent("log",{detail:{eventType:"stageCompleted",eventObject:eventProperties}});window.dispatchEvent(log);var changeStageStartEvent=new window.CustomEvent("changeStageStart",{detail:{oldStage:oldStage,newStage:newStage}});window.dispatchEvent(changeStageStartEvent)},fnAfterStageChange:function(oldStage,newStage){session.sessionData.sessionParameters.stage=newStage;var changeStageEndEvent=new window.CustomEvent("changeStageEnd",{detail:{oldStage:oldStage,newStage:newStage}});window.dispatchEvent(changeStageEndEvent),currentStage+1===session.stages.length?$(".arrow-next").hide():0===currentStage?($(".arrow-prev").hide(),$(".arrow-next").attr("disabled","disabled")):($(".arrow-next").show().removeAttr("disabled"),$(".arrow-prev").show())}},session.loadProtocol=function(){console.log("loading protocol"),$.getScript("protocols/"+window.netCanvas.studyProtocol+"/protocol.js",function(){var study=protocol;if(session.parameters=session.registerData("sessionParameters"),session.updateSessionData({sessionParameters:study.sessionParameters}),session.stages=study.stages,$("head").append('<link rel="stylesheet" href="protocols/'+window.netCanvas.studyProtocol+'/css/style.css" type="text/css" />'),session.skipFunctions=study.skipFunctions,!study.sessionParameters.name)throw new Error('Study protocol must have key "name" under sessionParameters.');session.name=study.sessionParameters.name,window.dataStore.init(function(sessionid){session.id=sessionid,window.dataStore.load(function(data){console.log(data),console.log(study),session.updateSessionData(data,function(){session.sessionData.nodes&&session.sessionData.edges&&window.network.loadNetwork({nodes:session.sessionData.nodes,edges:session.sessionData.edges}),"undefined"!=typeof session.sessionData.sessionParameters.stage?session.goToStage(session.sessionData.sessionParameters.stage):session.goToStage(0)})},session.id)});var stagesMenu=window.menu.addMenu("Stages","hi-icon-list");$.each(session.stages,function(index,value){window.menu.addItem(stagesMenu,value.label,null,function(){setTimeout(function(){session.goToStage(index)},500)})})}).fail(function(jqxhr,textStatus,error){var err=textStatus+", "+error;console.log("Request Failed: "+err)})},session.init=function(callback){window.tools.notify("Session initialising.",1),$(".arrow-next").on("click",sessionNextHandler),$(".arrow-prev").on("click",sessionPreviousHandler),window.addEventListener("changeStageStart",function(){$(".loader").transition({opacity:1})},!1),window.addEventListener("changeStageEnd",function(){$(".loader").transition({opacity:0})},!1),window.document.getElementById("save").addEventListener("change",function(){saveFile(this.value)}),window.network=new window.netCanvas.Modules.Network,window.addEventListener("unsavedChanges",function(){session.saveManager()},!1);var sessionMenu=window.menu.addMenu("Session","hi-icon-cog");window.menu.addItem(sessionMenu,"Reset Session","fa-undo",function(){window.BootstrapDialog.show({type:window.BootstrapDialog.TYPE_DANGER,title:"",message:"<h3>Are you sure you want to reset the session?</h3> <p><strong>IMPORTANT:</strong> This will delete all data.",buttons:[{label:"Continue",cssClass:"btn-modal-success",action:function(){window.dataStore.deleteDocument(session.reset)}},{label:"Cancel",cssClass:"btn-modal-danger",action:function(dialogItself){dialogItself.close()}}]})}),window.menu.addItem(sessionMenu,"Download Data","fa-download",function(){clickDownloadInput()}),window.menu.addItem(sessionMenu,"Purge Database","fa-trash",function(){window.BootstrapDialog.show({type:window.BootstrapDialog.TYPE_DANGER,title:"",message:"<h3>Are you sure you want to purge the database?</h3><p><strong>IMPORTANT:</strong> This will delete all data.",buttons:[{label:"Continue",cssClass:"btn-modal-success",action:function(){window.dataStore.reset(session.reset)}},{label:" Cancel",cssClass:"btn-modal-danger",action:function(dialogItself){dialogItself.close()}}]})}),window.menu.addItem(sessionMenu,"Quit Network Canvas","fa-sign-out",function(){window.close()}),callback&&callback()},session.downloadData=function(){var filename=session.returnSessionID()+".json",text=JSON.stringify(session.sessionData,void 0,2),pom=document.createElement("a");pom.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(text)),pom.setAttribute("download",filename),pom.click()},session.reset=function(){if(window.tools.notify("Resetting session.",2),session.id=0,session.currentStage=0,window.isNodeWebkit){var _window=window.gui.Window.get();_window.reloadDev()}else window.location.reload()},session.saveManager=function(){clearTimeout(saveTimer),saveTimer=setTimeout(session.saveData,3e3)},session.updateSessionData=function(data,callback){window.tools.notify("Updating user data.",2),window.tools.notify("Using the following to update:",1),window.tools.notify(data,1),window.tools.notify("session.sessionData is:",1),window.tools.notify(session.sessionData,1),$.extend(!0,session.sessionData,data),window.tools.notify("Combined output is:",1),window.tools.notify(session.sessionData,1);var newDataLoaded=new window.Event("newDataLoaded");window.dispatchEvent(newDataLoaded);var unsavedChanges=new window.Event("unsavedChanges");window.dispatchEvent(unsavedChanges),callback&&callback()},session.returnSessionID=function(){return session.id},session.saveData=function(){if(session.sessionData.nodes=window.network.getNodes(),session.sessionData.edges=window.network.getEdges(),window.dataStore.initialised())window.dataStore.save(session.sessionData,session.returnSessionID());else{var unsavedChanges=new window.Event("unsavedChanges");window.dispatchEvent(unsavedChanges)}lastSaveTime=new Date},session.goToStage=function(stage){if("undefined"==typeof stage||"undefined"==typeof session.stages[stage])return!1;if(session.stages[stage].skip){var outcome=session.stages[stage].skip();if(outcome===!0)return console.log("Skipping because skip condition was met."),stage>currentStage?session.goToStage(stage+1):session.goToStage(stage-1),!1}window.tools.notify("Session is moving to stage "+stage,3);var eventProperties={stage:stage,timestamp:new Date},log=new window.CustomEvent("log",{detail:{eventType:"stageVisible",eventObject:eventProperties}});window.dispatchEvent(log),session.options.fnBeforeStageChange(currentStage,stage);var newStage=stage,stagePath="./protocols/"+window.netCanvas.studyProtocol+"/stages/"+session.stages[stage].page;content.transition({opacity:"0"},400,"easeInSine").promise().done(function(){content.load(stagePath,function(){content.transition({opacity:"1"},400,"easeInSine")})});var oldStage=currentStage;currentStage=newStage,session.options.fnAfterStageChange(oldStage,currentStage);var unsavedChanges=new window.Event("unsavedChanges");window.dispatchEvent(unsavedChanges)},session.nextStage=function(){session.goToStage(currentStage+1)},session.prevStage=function(){session.goToStage(currentStage-1)},session.registerData=function(dataKey,isArray){window.tools.notify('A script requested a data store be registered with the key "'+dataKey+'".',2),void 0===session.sessionData[dataKey]?(window.tools.notify('Key named "'+dataKey+'" was not already registered. Creating.',1),isArray?session.sessionData[dataKey]=[]:session.sessionData[dataKey]={}):window.tools.notify("A data store with this key already existed. Returning a reference.",1);var unsavedChanges=new window.Event("unsavedChanges");return window.dispatchEvent(unsavedChanges),session.sessionData[dataKey]},session.addData=function(dataKey,newData,append){append||(append=!1),append===!0?session.sessionData[dataKey].push(newData):window.tools.extend(session.sessionData[dataKey],newData),window.tools.notify('Adding data to key "'+dataKey+'".',2),window.tools.notify(newData,1);var unsavedChanges=new window.Event("unsavedChanges");window.dispatchEvent(unsavedChanges)},session.currentStage=function(){return currentStage},session.returnData=function(dataKey){return dataKey&&"undefined"!=typeof session.sessionData[dataKey]?session.sessionData[dataKey]:session.sessionData},session};module.exports=new Session},{"browserify-fs":16}],14:[function(require,module,exports){module.exports=function(){"use strict";function padText(text,container,amount){for(;1.1*text.width()<container.width()-2*amount;)text.fontSize(1.1*text.fontSize()),text.y((container.height()-text.height())/2);text.setX(container.getX()-text.getWidth()/2),text.setY(container.getY()-text.getHeight()/1.8)}var stage,circleLayer,edgeLayer,nodeLayer,uiLayer,log,sociogram={},selectedNodes=[],menuOpen=!1,cancelKeyBindings=!1,taskComprehended=!1,colors={blue:"#0174DF",placidblue:"#83b5dd",violettulip:"#9B90C8",hemlock:"#9eccb3",paloma:"#aab1b0",freesia:"#ffd600",cayenne:"#c40000",celosiaorange:"#f47d44",sand:"#ceb48d",dazzlingblue:"#006bb6",edge:"#e85657",selected:"gold"};sociogram.settings={network:window.network,defaultNodeSize:35,defaultNodeColor:colors.blue,defaultEdgeColor:colors.edge,concentricCircleColor:"#ffffff",concentricCircleNumber:4,criteria:{},nodeTypes:[{name:"Person",color:colors.blue},{name:"OnlinePerson",color:colors.hemlock},{name:"Organisation",color:colors.cayenne},{name:"Professional",color:colors.violettulip}]};var nodeAddedHandler=function(e){sociogram.addNode(e.detail)},edgeAddedHandler=function(e){"undefined"!=typeof e.detail.from&&e.detail.from!==sociogram.settings.network.getNodes({type_t0:"Ego"})[0].id&&sociogram.addEdge(e.detail)},nodeRemovedHandler=function(e){sociogram.removeNode(e.detail)},edgeRemovedHandler=function(e){sociogram.removeEdge(e.detail)},closePopoverHandler=function(){var buttonOffset=$(".info-button").offset(),currentOffset=$(".sociogram-title").offset();$(".sociogram-title").data("oldPos",currentOffset),$(".sociogram-title").css({position:"absolute"}),$(".sociogram-title").offset(currentOffset),$(".sociogram-title").children().hide(),$(".sociogram-title").addClass("closed"),$(".sociogram-title").offset(buttonOffset),setTimeout(function(){$(".sociogram-popover").hide(),$(".info-button").css("visibility","visible")},500)},openPopoverHandler=function(){$(".info-button").css("visibility","hidden"),$(".sociogram-popover").show(),$(".sociogram-title").offset($(".sociogram-title").data("oldPos")),$(".sociogram-title").removeClass("closed"),setTimeout(function(){$(".sociogram-title").children().show()},500)},keyPressHandler=function(e){cancelKeyBindings||(menuOpen||($(".new-node-form").addClass("node-form-open"),$(".content").addClass("blurry"),menuOpen=!0,$(".name-box").focus()),8!==e.which||$(e.target).is("input, textarea, div")||e.preventDefault())},stageChangeHandler=function(){sociogram.destroy()};return sociogram.init=function(userSettings){window.tools.notify("Sociogram initialising.",1),window.tools.extend(sociogram.settings,userSettings),$('<div class="sociogram-title"><h3>'+sociogram.settings.heading+'</h3><p class="lead">'+sociogram.settings.subheading+"</p></div>").insertBefore("#kineticCanvas"),sociogram.initKinetic(),window.addEventListener("nodeAdded",nodeAddedHandler,!1),window.addEventListener("edgeAdded",edgeAddedHandler,!1),window.addEventListener("nodeRemoved",nodeRemovedHandler,!1),window.addEventListener("edgeRemoved",edgeRemovedHandler,!1),window.addEventListener("changeStageStart",stageChangeHandler,!1),$(".close-popover").on("click",closePopoverHandler),$(".info-button").on("click",openPopoverHandler),console.log(sociogram);for(var criteriaEdges=sociogram.settings.network.getEdges(sociogram.settings.criteria),i=0;i<criteriaEdges.length;i++){var dyadEdge=sociogram.settings.network.getEdges({from:criteriaEdges[i].from,to:criteriaEdges[i].to,type:"Dyad"})[0],newNode=sociogram.addNode(dyadEdge);if("Select"===sociogram.settings.mode)if(sociogram.settings.variable){var properties={from:sociogram.settings.network.getNodes({type_t0:"Ego"})[0].id,to:criteriaEdges[i].to};properties[sociogram.settings.variable]=1,sociogram.settings.network.getEdges(properties).length>0&&(newNode.children[0].stroke(colors.selected),nodeLayer.draw())}else sociogram.settings.network.getEdges({from:sociogram.settings.network.getNodes({type_t0:"Ego"})[0].id,to:criteriaEdges[i].to,type:sociogram.settings.edgeType}).length>0&&(newNode.children[0].stroke(colors.selected),nodeLayer.draw())}setTimeout(function(){sociogram.drawUIComponents()},0);var edges,edgeProperties;"Edge"===sociogram.settings.mode?(edgeProperties={type:sociogram.settings.edgeType},edges=sociogram.settings.network.getEdges(edgeProperties,function(results){var filteredResults=[];return $.each(results,function(index,value){value.from!==sociogram.settings.network.getEgo().id&&value.to!==sociogram.settings.network.getEgo().id&&filteredResults.push(value)}),filteredResults}),$.each(edges,function(index,value){sociogram.addEdge(value)})):"Select"===sociogram.settings.mode||"Update"===sociogram.settings.mode?(edgeProperties={},edgeProperties=sociogram.settings.showEdge?{type:sociogram.settings.showEdge}:{type:"Dyad"},edges=sociogram.settings.network.getEdges(edgeProperties,function(results){var filteredResults=[];return $.each(results,function(index,value){value.from!==sociogram.settings.network.getNodes({type_t0:"Ego"})[0].id&&value.to!==sociogram.settings.network.getNodes({type_t0:"Ego"})[0].id&&filteredResults.push(value)}),filteredResults}),$.each(edges,function(index,value){sociogram.addEdge(value)})):"Position"===sociogram.settings.mode},sociogram.getSelectedNodes=function(){return selectedNodes},sociogram.destroy=function(){console.log("sociogram being destroyed"),$(".new-node-form").remove(),window.removeEventListener("nodeAdded",nodeAddedHandler,!1),window.removeEventListener("edgeAdded",edgeAddedHandler,!1),window.removeEventListener("nodeRemoved",nodeRemovedHandler,!1),window.removeEventListener("edgeRemoved",edgeRemovedHandler,!1),window.removeEventListener("changeStageStart",stageChangeHandler,!1),$(window.document).off("keypress",keyPressHandler),$(".close-popover").off("click",closePopoverHandler),$(".info-button").off("click",openPopoverHandler)},sociogram.resetPositions=function(){var dyadEdges=sociogram.settings.network.getEdges({type:"Dyad"});$.each(dyadEdges,function(index){sociogram.settings.network.updateEdge(dyadEdges[index].id,{coords:[]})})},sociogram.addNode=function(options){window.tools.notify("Sociogram is creating a node.",2),console.log(options);for(var nodeShape,nodeID=0;sociogram.settings.network.getNode(nodeID)!==!1;)nodeID++;var dragStatus=!1;("Position"===sociogram.settings.mode||"Edge"===sociogram.settings.mode)&&(dragStatus=!0),options.label=options.nname_t0;var nodeOptions={coords:[$(window).width()+50,100],id:nodeID,label:"Undefined",size:sociogram.settings.defaultNodeSize,color:"rgb(0,0,0)",strokeWidth:4,draggable:dragStatus,dragDistance:20};window.tools.extend(nodeOptions,options),nodeOptions.id=parseInt(nodeOptions.id,10),nodeOptions.type="Person",nodeOptions.x=nodeOptions.coords[0],nodeOptions.y=nodeOptions.coords[1];var nodeGroup=new Konva.Group(nodeOptions);switch(nodeOptions.type){case"Person":nodeShape=new Konva.Circle({radius:nodeOptions.size,fill:nodeOptions.color,stroke:"white",strokeWidth:nodeOptions.strokeWidth});break;case"Organisation":nodeShape=new Konva.Rect({width:2*nodeOptions.size,height:2*nodeOptions.size,fill:nodeOptions.color,stroke:sociogram.calculateStrokeColor(nodeOptions.color),strokeWidth:nodeOptions.strokeWidth});break;case"OnlinePerson":nodeShape=new Konva.RegularPolygon({sides:3,fill:nodeOptions.color,radius:1.2*nodeOptions.size,stroke:sociogram.calculateStrokeColor(nodeOptions.color),strokeWidth:nodeOptions.strokeWidth});break;case"Professional":nodeShape=new Konva.Star({numPoints:6,fill:nodeOptions.color,innerRadius:nodeOptions.size-nodeOptions.size/3,outerRadius:nodeOptions.size+nodeOptions.size/3,stroke:sociogram.calculateStrokeColor(nodeOptions.color),strokeWidth:nodeOptions.strokeWidth})}var nodeLabel=new Konva.Text({text:nodeOptions.label,fontFamily:"Lato",fill:"white",align:"center",fontStyle:500});if(window.tools.notify("Putting node "+nodeOptions.label+" at coordinates x:"+nodeOptions.coords[0]+", y:"+nodeOptions.coords[1],2),nodeGroup.on("dragstart",function(){if(taskComprehended===!1){var eventProperties={stage:window.netCanvas.Modules.session.currentStage(),timestamp:new Date};log=new window.CustomEvent("log",{detail:{eventType:"taskComprehended",eventObject:eventProperties}}),window.dispatchEvent(log),taskComprehended=!0}window.tools.notify("dragstart",1),this.attrs.oldx=this.attrs.x,this.attrs.oldy=this.attrs.y,this.moveToTop(),nodeLayer.draw()}),nodeGroup.on("dragmove",function(){if(taskComprehended===!1){var eventProperties={stage:window.netCanvas.Modules.session.currentStage(),timestamp:new Date};log=new window.CustomEvent("log",{detail:{eventType:"taskComprehended",eventObject:eventProperties}}),window.dispatchEvent(log),taskComprehended=!0}window.tools.notify("Dragmove",0);var dragNode=nodeOptions.id;$.each(edgeLayer.children,function(index,value){if(value.attrs.from.id===dragNode||value.attrs.to.id===dragNode){var points=[sociogram.getNodeByID(value.attrs.from.id).getX(),sociogram.getNodeByID(value.attrs.from.id).getY(),sociogram.getNodeByID(value.attrs.to.id).getX(),sociogram.getNodeByID(value.attrs.to.id).getY()];value.attrs.points=points}}),edgeLayer.draw()}),nodeGroup.on("tap click",function(){if(taskComprehended===!1){var eventProperties={stage:window.netCanvas.Modules.session.currentStage(),timestamp:new Date};log=new window.CustomEvent("log",{detail:{eventType:"taskComprehended",eventObject:eventProperties}}),window.dispatchEvent(log),taskComprehended=!0}log=new window.CustomEvent("log",{detail:{eventType:"nodeClick",eventObject:this.attrs.id}});var currentNode=this;if(window.dispatchEvent(log),"Select"===sociogram.settings.mode){var edge;if(sociogram.settings.variable){var properties={},currentValue=sociogram.settings.network.getEdge(currentNode.attrs.id)[sociogram.settings.variable];0===currentValue||"undefined"==typeof currentValue?(properties[sociogram.settings.variable]=1,currentNode.children[0].stroke(colors.selected)):(properties[sociogram.settings.variable]=0,currentNode.children[0].stroke("white")),sociogram.settings.network.setProperties(sociogram.settings.network.getEdge(currentNode.attrs.id),properties)}else sociogram.settings.network.getEdges({type:sociogram.settings.edgeType,from:sociogram.settings.network.getEgo().id,to:this.attrs.to}).length>0?(this.children[0].stroke("white"),sociogram.settings.network.removeEdge(sociogram.settings.network.getEdges({type:sociogram.settings.edgeType,from:sociogram.settings.network.getEgo().id,to:this.attrs.to})[0])):(edge={from:sociogram.settings.network.getEgo().id,to:this.attrs.to,type:sociogram.settings.edgeType},"undefined"!=typeof sociogram.settings.variables&&$.each(sociogram.settings.variables,function(index,value){edge[value.label]=value.value}),this.children[0].stroke(colors.selected),sociogram.settings.network.addEdge(edge))}else if("Update"===sociogram.settings.mode)console.log(currentNode),-1===selectedNodes.indexOf(currentNode)?(selectedNodes.push(currentNode.attrs.id),currentNode.children[0].stroke(colors.selected)):(selectedNodes.remove(currentNode.attrs.id),currentNode.children[0].stroke("white")),console.log(selectedNodes);else if("Edge"===sociogram.settings.mode){
if(selectedNodes[0]===this)return!1;if(selectedNodes.push(this),2===selectedNodes.length){selectedNodes[1].children[0].stroke("white"),selectedNodes[0].children[0].stroke("white");var edgeProperties={from:selectedNodes[0].attrs.to,to:selectedNodes[1].attrs.to,type:sociogram.settings.edgeType};edgeProperties[sociogram.settings.variables[0]]="perceived",sociogram.settings.network.addEdge(edgeProperties)===!1&&(window.tools.notify("Sociogram removing edge.",2),sociogram.settings.network.removeEdge(sociogram.settings.network.getEdges(edgeProperties))),selectedNodes=[],nodeLayer.draw()}else this.children[0].stroke(colors.selected),nodeLayer.draw()}this.moveToTop(),nodeLayer.draw()}),nodeGroup.on("dragend",function(){window.tools.notify("dragend",1);var from={},to={};from.x=this.attrs.oldx,from.y=this.attrs.oldy,to.x=this.attrs.x,to.y=this.attrs.y;var eventObject={from:from,to:to},currentNode=this;log=new window.CustomEvent("log",{detail:{eventType:"nodeMove",eventObject:eventObject}}),window.dispatchEvent(log),sociogram.settings.network.setProperties(sociogram.settings.network.getEdge(currentNode.attrs.id),{coords:[currentNode.attrs.x,currentNode.attrs.y]}),delete this.attrs.oldx,delete this.attrs.oldy}),padText(nodeLabel,nodeShape,10),nodeGroup.add(nodeShape),nodeGroup.add(nodeLabel),nodeLayer.add(nodeGroup),setTimeout(function(){nodeLayer.draw()},0),!options.coords||0===options.coords.length){var tween=new Konva.Tween({node:nodeGroup,x:$(window).width()-150,y:100,duration:.7,easing:Konva.Easings.EaseOut});tween.play(),sociogram.settings.network.setProperties(sociogram.settings.network.getNode(nodeOptions.id),{coords:[$(window).width()-150,100]})}return nodeGroup},sociogram.debug=function(){console.log(sociogram.settings),console.log(sociogram.settings.network)},sociogram.addEdge=function(properties){sociogram.debug(),window.tools.notify("Sociogram is adding an edge.",2),console.log(properties);var toObject=sociogram.settings.network.getEdges({from:sociogram.settings.network.getEgo().id,to:properties.to,type:"Dyad"})[0],fromObject=sociogram.settings.network.getEdges({from:sociogram.settings.network.getEgo().id,to:properties.from,type:"Dyad"})[0];console.log(toObject),console.log(fromObject),console.log(sociogram.settings.network.getEgo());var points=[fromObject.coords[0],fromObject.coords[1],toObject.coords[0],toObject.coords[1]],edge=new Konva.Line({strokeWidth:4,opacity:1,stroke:sociogram.settings.defaultEdgeColor,from:fromObject,to:toObject,points:points});return edgeLayer.add(edge),setTimeout(function(){edgeLayer.draw()},0),nodeLayer.draw(),window.tools.notify("Created Edge between "+fromObject.label+" and "+toObject.label,"success",2),!0},sociogram.removeEdge=function(properties){var toNode=sociogram.settings.network.getEdges({from:sociogram.settings.network.getEgo().id,to:properties.to,type:"Dyad"})[0],fromNode=sociogram.settings.network.getEdges({from:sociogram.settings.network.getEgo().id,to:properties.from,type:"Dyad"})[0];window.tools.notify("Removing edge."),$.each(sociogram.getKineticEdges(),function(index,value){void 0!==value&&(value.attrs.from===fromNode&&value.attrs.to===toNode||value.attrs.from===toNode&&value.attrs.to===fromNode)&&(edgeLayer.children[index].remove(),edgeLayer.draw())})},sociogram.removeNode=function(){console.log("removenode kinetic")},sociogram.clearGraph=function(){edgeLayer.removeChildren(),edgeLayer.clear(),nodeLayer.removeChildren(),nodeLayer.clear()},sociogram.initKinetic=function(){stage=new Konva.Stage({container:"kineticCanvas",width:window.innerWidth,height:window.innerHeight}),circleLayer=new Konva.Layer,nodeLayer=new Konva.Layer,edgeLayer=new Konva.Layer,uiLayer=new Konva.Layer,stage.add(circleLayer),stage.add(edgeLayer),stage.add(nodeLayer),stage.add(uiLayer),window.tools.notify("Konva stage initialised.",1)},sociogram.drawUIComponents=function(){for(var circleFills,circleLines,currentColor=sociogram.settings.concentricCircleColor,totalHeight=window.innerHeight-sociogram.settings.defaultNodeSize,currentOpacity=.1,i=0;i<sociogram.settings.concentricCircleNumber;i++){var ratio=1-i/sociogram.settings.concentricCircleNumber,currentRadius=totalHeight/2*ratio;circleLines=new Konva.Circle({x:window.innerWidth/2,y:window.innerHeight/2,radius:currentRadius,stroke:"white",strokeWidth:1.5,opacity:0}),circleFills=new Konva.Circle({x:window.innerWidth/2,y:window.innerHeight/2,radius:currentRadius,fill:currentColor,opacity:currentOpacity,strokeWidth:0}),currentOpacity+=(.3-currentOpacity)/sociogram.settings.concentricCircleNumber,circleLayer.add(circleFills),circleLayer.add(circleLines)}circleLayer.draw(),uiLayer.draw(),window.tools.notify("User interface initialised.",1)},sociogram.initNewNodeForm=function(){var form=$('<div class="new-node-form"></div>'),innerForm=$('<div class="new-node-inner"></div>');form.append(innerForm),innerForm.append("<h1>Add a new contact</h1>"),innerForm.append("<p>Some text accompanying the node creation box.</p>"),innerForm.append('<input type="text" class="form-control name-box"></input>'),$(".content").after(form),$(window.document).on("keypress",keyPressHandler)},sociogram.getKineticNodes=function(){return nodeLayer.children},sociogram.getKineticEdges=function(){return edgeLayer.children},sociogram.getSimpleNodes=function(){var simpleNodes={},nodes=sociogram.getKineticNodes();return $.each(nodes,function(index,value){simpleNodes[value.attrs.id]={},simpleNodes[value.attrs.id].x=value.attrs.x,simpleNodes[value.attrs.id].y=value.attrs.y,simpleNodes[value.attrs.id].name=value.attrs.name,simpleNodes[value.attrs.id].type=value.attrs.type,simpleNodes[value.attrs.id].size=value.attrs.size,simpleNodes[value.attrs.id].color=value.attrs.color}),simpleNodes},sociogram.getSimpleEdges=function(){var simpleEdges={},edgeCounter=0;return $.each(edgeLayer.children,function(index,value){simpleEdges[edgeCounter]={},simpleEdges[edgeCounter].from=value.attrs.from.attrs.id,simpleEdges[edgeCounter].to=value.attrs.to.attrs.id,edgeCounter++}),simpleEdges},sociogram.getSimpleEdge=function(id){var simpleEdges=sociogram.getSimpleEdges();if(!id)return!1;var simpleEdge=simpleEdges[id];return simpleEdge},sociogram.getEdgeLayer=function(){return edgeLayer},sociogram.getNodeByID=function(id){var node={},nodes=sociogram.getKineticNodes();return $.each(nodes,function(index,value){value.attrs.id===id&&(node=value)}),node},sociogram.getNodeColorByType=function(type){var returnVal=null;return $.each(sociogram.settings.nodeTypes,function(index,value){value.name===type&&(returnVal=value.color)}),returnVal?returnVal:!1},sociogram}},{}],15:[function(require,module,exports){"use strict";window.Storage.prototype.showUsage=function(){var total=0;for(var x in localStorage){var amount=2*localStorage[x].length/1024/1024;total+=amount,console.log(x+" = "+amount.toFixed(2)+" MB")}console.log("Total: "+total.toFixed(2)+" MB")},window.Storage.prototype.setObject=function(key,value){this.setItem(key,JSON.stringify(value))},window.Storage.prototype.getObject=function(key){if(null===this.getItem(key))return!1;var value=this.getItem(key);return value&&JSON.parse(value)},Object.defineProperty(Array.prototype,"remove",{enumerable:!1,value:function(item){for(var removeCounter=0,index=0;index<this.length;index++)this[index]===item&&(this.splice(index,1),removeCounter++,index--);return removeCounter}}),exports.arrayDifference=function(a1,a2){var a2Set=new Set(a2);return a1.filter(function(x){return!a2Set.has(x)})},exports.removeFromObject=function(item,object){console.log("removeFromObject"),console.log(item),console.log(object);for(var removeCounter=0,index=0;index<object.length;index++)object[index]===item&&(object.splice(index,1),removeCounter++,index--);return console.log(object),removeCounter},exports.deepEquals=function(a,x){var p;for(p in a)if("undefined"==typeof x[p])return!1;for(p in a)if(a[p])switch(typeof a[p]){case"object":if(a[p].sort&&(a[p].sort(),x[p].sort()),!deepEquals(a[p],x[p]))return!1;break;case"function":if("undefined"==typeof x[p]||a[p].toString()!==x[p].toString())return!1;break;default:if(a[p]!==x[p])return!1}else if(x[p])return!1;for(p in x)if("undefined"==typeof a[p])return!1;return!0},exports.isInNestedObject=function(targetArray,objectKey,objectKeyValue){for(var i=0;i<targetArray.length;i++)for(var prop in targetArray[i])if(prop===objectKey&&targetArray[i][prop]===objectKeyValue)return!0;return!1},exports.getValueFromNestedObject=function(targetArray,objectKey){for(var i=0;i<targetArray.length;i++)for(var prop in targetArray[i])if(prop===objectKey)return targetArray[i][prop];return!1},exports.extend=function(a,b){for(var key in b)b.hasOwnProperty(key)&&(a[key]=b[key]);return a},exports.notify=function(text,level){level=level||0,console.log(text)},exports.randomBetween=function(min,max){return Math.random()*(max-min)+min},exports.hex=function(x){return("0"+parseInt(x).toString(16)).slice(-2)},$.cssHooks.backgroundColor={get:function(elem){var bg;return elem.currentStyle?bg=elem.currentStyle.backgroundColor:window.getComputedStyle&&(bg=window.document.defaultView.getComputedStyle(elem,null).getPropertyValue("background-color")),-1===bg.search("rgb")?bg:(bg=bg.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),"#"+window.tools.hex(bg[1])+window.tools.hex(bg[2])+window.tools.hex(bg[3]))}},exports.modifyColor=function(hex,lum){hex=String(hex).replace(/[^0-9a-f]/gi,""),hex.length<6&&(hex=hex[0]+hex[0]+hex[1]+hex[1]+hex[2]+hex[2]),lum=lum||0;var c,i,rgb="#";for(i=0;3>i;i++)c=parseInt(hex.substr(2*i,2),16),c=Math.round(Math.min(Math.max(0,c+c*lum),255)).toString(16),rgb+=("00"+c).substr(c.length);return rgb}},{}],16:[function(require,module,exports){var leveljs=require("level-js"),levelup=require("levelup"),fs=require("level-filesystem"),db=levelup("level-filesystem",{db:leveljs});module.exports=fs(db)},{"level-filesystem":18,"level-js":83,levelup:101}],17:[function(require,module,exports){var errno=require("errno");Object.keys(errno.code).forEach(function(code){var e=errno.code[code];exports[code]=function(path){var err=new Error(code+", "+e.description+(path?" '"+path+"'":""));return err.errno=e.errno,err.code=code,err.path=path,err}})},{errno:34}],18:[function(require,module,exports){(function(process,Buffer){var fwd=require("fwd-stream"),sublevel=require("level-sublevel"),blobs=require("level-blobs"),peek=require("level-peek"),once=require("once"),errno=require("./errno"),paths=require("./paths"),watchers=require("./watchers"),nextTick=function(cb,err,val){process.nextTick(function(){cb(err,val)})},noop=function(){};module.exports=function(db,opts){var fs={};db=sublevel(db);var bl=blobs(db.sublevel("blobs"),opts),ps=paths(db.sublevel("stats")),links=db.sublevel("links"),listeners=watchers(),fds=[],now=Date.now(),inc=function(){return++now};fs.mkdir=function(key,mode,cb){return"function"==typeof mode?fs.mkdir(key,null,mode):(mode||(mode=511),cb||(cb=noop),void ps.follow(key,function(err,stat,key){return err&&"ENOENT"!==err.code?cb(err):stat?cb(errno.EEXIST(key)):void ps.put(key,{type:"directory",mode:mode,size:4096},listeners.cb(key,cb))}))},fs.rmdir=function(key,cb){cb||(cb=noop),ps.follow(key,function(err,stat,key){return err?cb(err):void fs.readdir(key,function(err,files){return err?cb(err):files.length?cb(errno.ENOTEMPTY(key)):void ps.del(key,listeners.cb(key,cb))})})},fs.readdir=function(key,cb){ps.follow(key,function(err,stat,key){return err?cb(err):stat?stat.isDirectory()?void ps.list(key,cb):cb(errno.ENOTDIR(key)):cb(errno.ENOENT(key))})};var stat=function(key,lookup,cb){lookup(key,function(err,stat,key){if(err)return cb(err);if(!stat.isFile())return cb(null,stat);var blob=stat&&stat.blob||key;bl.size(blob,function(err,size){return err?cb(err):(stat.size=size,void cb(null,stat))})})};fs.stat=function(key,cb){stat(key,ps.follow,cb)},fs.lstat=function(key,cb){stat(key,ps.get,cb)},fs.exists=function(key,cb){ps.follow(key,function(err){cb(!err)})};var chmod=function(key,lookup,mode,cb){cb||(cb=noop),lookup(key,function(err,stat,key){return err?cb(err):void ps.update(key,{mode:mode},listeners.cb(key,cb))})};fs.chmod=function(key,mode,cb){chmod(key,ps.follow,mode,cb)},fs.lchmod=function(key,mode,cb){chmod(key,ps.get,mode,cb)};var chown=function(key,lookup,uid,gid,cb){cb||(cb=noop),lookup(key,function(err,stat,key){return err?cb(err):void ps.update(key,{uid:uid,gid:gid},listeners.cb(key,cb))})};return fs.chown=function(key,uid,gid,cb){chown(key,ps.follow,uid,gid,cb)},fs.lchown=function(key,uid,gid,cb){chown(key,ps.get,uid,gid,cb)},fs.utimes=function(key,atime,mtime,cb){cb||(cb=noop),ps.follow(key,function(err,stat,key){if(err)return cb(err);var upd={};atime&&(upd.atime=atime),mtime&&(upd.mtime=mtime),ps.update(key,upd,listeners.cb(key,cb))})},fs.rename=function(from,to,cb){cb||(cb=noop),ps.follow(from,function(err,statFrom,from){if(err)return cb(err);var rename=function(){cb=listeners.cb(to,listeners.cb(from,cb)),ps.put(to,statFrom,function(err){return err?cb(err):void ps.del(from,cb)})};ps.follow(to,function(err,statTo,to){return err&&"ENOENT"!==err.code?cb(err):statTo?statFrom.isDirectory()!==statTo.isDirectory()?cb(errno.EISDIR(from)):statTo.isDirectory()?void fs.readdir(to,function(err,list){return err?cb(err):list.length?cb(errno.ENOTEMPTY(from)):void rename()}):void rename():rename()})})},fs.realpath=function(key,cache,cb){return"function"==typeof cache?fs.realpath(key,null,cache):void ps.follow(key,function(err,stat,key){return err?cb(err):void cb(null,key)})},fs.writeFile=function(key,data,opts,cb){if("function"==typeof opts)return fs.writeFile(key,data,null,opts);"string"==typeof opts&&(opts={encoding:opts}),opts||(opts={}),cb||(cb=noop),Buffer.isBuffer(data)||(data=new Buffer(data,opts.encoding||"utf-8"));var flags=opts.flags||"w";opts.append="w"!==flags[0],ps.follow(key,function(err,stat,key){if(err&&"ENOENT"!==err.code)return cb(err);if(stat&&stat.isDirectory())return cb(errno.EISDIR(key));if(stat&&"x"===flags[1])return cb(errno.EEXIST(key));var blob=stat&&stat.blob||key;ps.writable(key,function(err){return err?cb(err):void bl.write(blob,data,opts,function(err){return err?cb(err):void ps.put(key,{ctime:stat&&stat.ctime,mtime:new Date,mode:opts.mode||438,type:"file"},listeners.cb(key,cb))})})})},fs.appendFile=function(key,data,opts,cb){return"function"==typeof opts?fs.appendFile(key,data,null,opts):("string"==typeof opts&&(opts={encoding:opts}),opts||(opts={}),opts.flags="a",void fs.writeFile(key,data,opts,cb))},fs.unlink=function(key,cb){cb||(cb=noop),ps.get(key,function(err,stat,key){if(err)return cb(err);if(stat.isDirectory())return cb(errno.EISDIR(key));var clean=function(target){peek(links,{start:target+"",end:target+""},function(err){return err?bl.remove(target,cb):void cb()})},onlink=function(){var target=stat.link.slice(0,stat.link.indexOf(""));links.del(stat.link,function(err){return err?cb(err):void clean(target)})};ps.del(key,listeners.cb(key,function(err){return err?cb(err):stat.link?onlink():void links.del(key+"",function(err){return err?cb(err):void clean(key)})}))})},fs.readFile=function(key,opts,cb){if("function"==typeof opts)return fs.readFile(key,null,opts);"string"==typeof opts&&(opts={encoding:opts}),opts||(opts={});opts.encoding||"binary",opts.flag||"r";ps.follow(key,function(err,stat,key){if(err)return cb(err);if(stat.isDirectory())return cb(errno.EISDIR(key));var blob=stat&&stat.blob||key;bl.read(blob,function(err,data){return err?cb(err):void cb(null,opts.encoding?data.toString(opts.encoding):data)})})},fs.createReadStream=function(key,opts){opts||(opts={});var closed=!1,rs=fwd.readable(function(cb){ps.follow(key,function(err,stat,key){if(err)return cb(err);if(stat.isDirectory())return cb(errno.EISDIR(key));var blob=stat&&stat.blob||key,r=bl.createReadStream(blob,opts);rs.emit("open"),r.on("end",function(){process.nextTick(function(){closed||rs.emit("close")})}),cb(null,r)})});return rs.on("close",function(){closed=!0}),rs},fs.createWriteStream=function(key,opts){opts||(opts={});var flags=opts.flags||"w",closed=!1,mode=opts.mode||438;opts.append="a"===flags[0];var ws=fwd.writable(function(cb){ps.follow(key,function(err,stat,key){if(err&&"ENOENT"!==err.code)return cb(err);if(stat&&stat.isDirectory())return cb(errno.EISDIR(key));if(stat&&"x"===flags[1])return cb(errno.EEXIST(key));var blob=stat&&stat.blob||key;ps.writable(blob,function(err){if(err)return cb(err);var ctime=stat?stat.ctime:new Date,s={ctime:ctime,mtime:new Date,mode:mode,type:"file"};ps.put(key,s,function(err){if(err)return cb(err);var w=bl.createWriteStream(blob,opts);ws.emit("open"),w.on("finish",function(){s.mtime=new Date,ps.put(key,s,function(){listeners.change(key),closed||ws.emit("close")})}),cb(null,w)})})})});return ws.on("close",function(){closed=!0}),ws},fs.truncate=function(key,len,cb){ps.follow(key,function(err,stat,key){if(err)return cb(err);var blob=stat&&stat.blob||key;bl.size(blob,function(err,size){return err?cb(err):void ps.writable(key,function(err){if(err)return cb(err);if(cb=once(listeners.cb(key,cb)),!len)return bl.remove(blob,cb);var ws=bl.createWriteStream(blob,{start:len>size?len-1:len});ws.on("error",cb),ws.on("finish",cb),len>size&&ws.write(new Buffer([0])),ws.end()})})})},fs.watchFile=function(key,opts,cb){return"function"==typeof opts?fs.watchFile(key,null,opts):listeners.watch(ps.normalize(key),cb)},fs.unwatchFile=function(key,cb){listeners.unwatch(ps.normalize(key),cb)},fs.watch=function(key,opts,cb){return"function"==typeof opts?fs.watch(key,null,opts):listeners.watcher(ps.normalize(key),cb)},fs.notify=function(cb){listeners.on("change",cb)},fs.open=function(key,flags,mode,cb){return"function"==typeof mode?fs.open(key,flags,null,mode):void ps.follow(key,function(err,stat,key){if(err&&"ENOENT"!==err.code)return cb(err);var fl=flags[0],plus="+"===flags[1]||"+"===flags[2],blob=stat&&stat.blob||key,f={key:key,blob:blob,mode:mode||438,readable:"r"===fl||("w"===fl||"a"===fl)&&plus,writable:"w"===fl||"a"===fl||"r"===fl&&plus,append:"a"===fl};return"r"===fl&&err?cb(err):"x"===flags[1]&&stat?cb(errno.EEXIST(key)):stat&&stat.isDirectory()?cb(errno.EISDIR(key)):void bl.size(blob,function(err,size){return err?cb(err):(f.append&&(f.writePos=size),void ps.writable(key,function(err){if(err)return cb(err);var onready=function(err){if(err)return cb(err);var i=fds.indexOf(null);-1===i&&(i=10+fds.push(fds.length+10)-1),f.fd=i,fds[i]=f,listeners.change(key),cb(null,f.fd)},ontruncate=function(err){return err?cb(err):stat?onready():void ps.put(blob,{ctime:stat&&stat.ctime,type:"file"},onready)};return!f.append&&f.writable?bl.remove(blob,ontruncate):void ontruncate()}))})})},fs.close=function(fd,cb){var f=fds[fd];return f?(fds[fd]=null,void nextTick(listeners.cb(f.key,cb))):nextTick(cb,errno.EBADF())},fs.write=function(fd,buf,off,len,pos,cb){var f=fds[fd];if(cb||(cb=noop),!f||!f.writable)return nextTick(cb,errno.EBADF());null===pos&&(pos=f.writePos||0);var slice=buf.slice(off,off+len);f.writePos=pos+slice.length,bl.write(f.blob,slice,{start:pos,append:!0},function(err){return err?cb(err):void cb(null,len,buf)})},fs.read=function(fd,buf,off,len,pos,cb){var f=fds[fd];return cb||(cb=noop),f&&f.readable?(null===pos&&(pos=fs.readPos||0),void bl.read(f.blob,{start:pos,end:pos+len-1},function(err,read){if(err)return cb(err);var slice=read.slice(0,len);slice.copy(buf,off),fs.readPos=pos+slice.length,cb(null,slice.length,buf)})):nextTick(cb,errno.EBADF())},fs.fsync=function(fd,cb){var f=fds[fd];return cb||(cb=noop),f&&f.writable?void nextTick(cb):nextTick(cb,errno.EBADF())},fs.ftruncate=function(fd,len,cb){var f=fds[fd];return cb||(cb=noop),f?void fs.truncate(f.blob,len,cb):nextTick(cb,errno.EBADF())},fs.fchown=function(fd,uid,gid,cb){var f=fds[fd];return cb||(cb=noop),f?void fs.chown(f.key,uid,gid,cb):nextTick(cb,errno.EBADF())},fs.fchmod=function(fd,mode,cb){var f=fds[fd];return cb||(cb=noop),f?void fs.chmod(f.key,mode,cb):nextTick(cb,errno.EBADF())},fs.futimes=function(fd,atime,mtime,cb){var f=fds[fd];return cb||(cb=noop),f?void fs.utimes(f.key,atime,mtime,cb):nextTick(cb,errno.EBADF())},fs.fstat=function(fd,cb){var f=fds[fd];return f?void fs.stat(f.key,cb):nextTick(cb,errno.EBADF())},fs.symlink=function(target,name,cb){cb||(cb=noop),ps.follow(target,function(err,stat,target){return err?cb(err):void ps.get(name,function(err,stat){return err&&"ENOENT"!==err.code?cb(err):stat?cb(errno.EEXIST(name)):void ps.put(name,{type:"symlink",target:target,mode:511},cb)})})},fs.readlink=function(key,cb){ps.get(key,function(err,stat){return err?cb(err):stat.target?void cb(null,stat.target):cb(errno.EINVAL(key))})},fs.link=function(target,name,cb){cb||(cb=noop),ps.follow(target,function(err,stat,target){return err?cb(err):stat.isFile()?void ps.get(name,function(err,st){if(err&&"ENOENT"!==err.code)return cb(err);if(st)return cb(errno.EEXIST(name));var link=target+""+inc();links.put(target+"",target,function(err){return err?cb(err):void links.put(link,target,function(err){return err?cb(err):void ps.put(name,{type:"file",link:link,blob:target,mode:stat.mode},cb)})})}):cb(errno.EINVAL(target))})},fs}}).call(this,require("_process"),require("buffer").Buffer)},{"./errno":17,"./paths":80,"./watchers":82,_process:134,buffer:126,"fwd-stream":36,"level-blobs":49,"level-peek":61,"level-sublevel":64,once:77}],19:[function(require,module,exports){(function(Buffer){function ConcatStream(opts,cb){if(!(this instanceof ConcatStream))return new ConcatStream(opts,cb);"function"==typeof opts&&(cb=opts,opts={}),opts||(opts={});var encoding=opts.encoding,shouldInferEncoding=!1;encoding?(encoding=String(encoding).toLowerCase(),("u8"===encoding||"uint8"===encoding)&&(encoding="uint8array")):shouldInferEncoding=!0,Writable.call(this,{objectMode:!0}),this.encoding=encoding,this.shouldInferEncoding=shouldInferEncoding,cb&&this.on("finish",function(){cb(this.getBody())}),this.body=[]}function isArrayish(arr){return/Array\]$/.test(Object.prototype.toString.call(arr))}function stringConcat(parts){for(var strings=[],i=0;i<parts.length;i++){var p=parts[i];"string"==typeof p?strings.push(p):Buffer.isBuffer(p)?strings.push(p):strings.push(Buffer(p))}return Buffer.isBuffer(parts[0])?(strings=Buffer.concat(strings),strings=strings.toString("utf8")):strings=strings.join(""),strings}function bufferConcat(parts){for(var bufs=[],i=0;i<parts.length;i++){var p=parts[i];Buffer.isBuffer(p)?bufs.push(p):"string"==typeof p||isArrayish(p)||p&&"function"==typeof p.subarray?bufs.push(Buffer(p)):bufs.push(Buffer(String(p)))}return Buffer.concat(bufs)}function arrayConcat(parts){for(var res=[],i=0;i<parts.length;i++)res.push.apply(res,parts[i]);return res}function u8Concat(parts){for(var len=0,i=0;i<parts.length;i++)"string"==typeof parts[i]&&(parts[i]=Buffer(parts[i])),len+=parts[i].length;for(var u8=new U8(len),i=0,offset=0;i<parts.length;i++)for(var part=parts[i],j=0;j<part.length;j++)u8[offset++]=part[j];return u8}var Writable=require("readable-stream").Writable,inherits=require("inherits");if("undefined"==typeof Uint8Array)var U8=require("typedarray").Uint8Array;else var U8=Uint8Array;module.exports=ConcatStream,inherits(ConcatStream,Writable),ConcatStream.prototype._write=function(chunk,enc,next){this.body.push(chunk),next()},ConcatStream.prototype.inferEncoding=function(buff){var firstBuffer=void 0===buff?this.body[0]:buff;return Buffer.isBuffer(firstBuffer)?"buffer":"undefined"!=typeof Uint8Array&&firstBuffer instanceof Uint8Array?"uint8array":Array.isArray(firstBuffer)?"array":"string"==typeof firstBuffer?"string":"[object Object]"===Object.prototype.toString.call(firstBuffer)?"object":"buffer"},ConcatStream.prototype.getBody=function(){return this.encoding||0!==this.body.length?(this.shouldInferEncoding&&(this.encoding=this.inferEncoding()),"array"===this.encoding?arrayConcat(this.body):"string"===this.encoding?stringConcat(this.body):"buffer"===this.encoding?bufferConcat(this.body):"uint8array"===this.encoding?u8Concat(this.body):this.body):[]};Array.isArray||function(arr){return"[object Array]"==Object.prototype.toString.call(arr)}}).call(this,require("buffer").Buffer)},{buffer:126,inherits:20,"readable-stream":31,typedarray:32}],20:[function(require,module,exports){"function"==typeof Object.create?module.exports=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},{}],21:[function(require,module,exports){"use strict";function Duplex(options){return this instanceof Duplex?(Readable.call(this,options),Writable.call(this,options),options&&options.readable===!1&&(this.readable=!1),options&&options.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,options&&options.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",onend)):new Duplex(options)}function onend(){this.allowHalfOpen||this._writableState.ended||processNextTick(onEndNT,this)}function onEndNT(self){self.end()}var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys};module.exports=Duplex;var processNextTick=require("process-nextick-args"),util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable"),Writable=require("./_stream_writable");util.inherits(Duplex,Readable);for(var keys=objectKeys(Writable.prototype),v=0;v<keys.length;v++){var method=keys[v];Duplex.prototype[method]||(Duplex.prototype[method]=Writable.prototype[method])}},{"./_stream_readable":23,"./_stream_writable":25,"core-util-is":26,inherits:20,"process-nextick-args":28}],22:[function(require,module,exports){"use strict";function PassThrough(options){return this instanceof PassThrough?void Transform.call(this,options):new PassThrough(options)}module.exports=PassThrough;var Transform=require("./_stream_transform"),util=require("core-util-is");util.inherits=require("inherits"),util.inherits(PassThrough,Transform),PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":24,"core-util-is":26,inherits:20}],23:[function(require,module,exports){(function(process){"use strict";function ReadableState(options,stream){var Duplex=require("./_stream_duplex");options=options||{},this.objectMode=!!options.objectMode,stream instanceof Duplex&&(this.objectMode=this.objectMode||!!options.readableObjectMode);var hwm=options.highWaterMark,defaultHwm=this.objectMode?16:16384;this.highWaterMark=hwm||0===hwm?hwm:defaultHwm,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.defaultEncoding=options.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,options.encoding&&(StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this.decoder=new StringDecoder(options.encoding),this.encoding=options.encoding)}function Readable(options){require("./_stream_duplex");return this instanceof Readable?(this._readableState=new ReadableState(options,this),this.readable=!0,options&&"function"==typeof options.read&&(this._read=options.read),void Stream.call(this)):new Readable(options)}function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er)stream.emit("error",er);else if(null===chunk)state.reading=!1,onEofChunk(stream,state);else if(state.objectMode||chunk&&chunk.length>0)if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var e=new Error("stream.unshift() after end event");stream.emit("error",e)}else!state.decoder||addToFront||encoding||(chunk=state.decoder.write(chunk)),addToFront||(state.reading=!1),state.flowing&&0===state.length&&!state.sync?(stream.emit("data",chunk),stream.read(0)):(state.length+=state.objectMode?1:chunk.length,addToFront?state.buffer.unshift(chunk):state.buffer.push(chunk),state.needReadable&&emitReadable(stream)),maybeReadMore(stream,state);else addToFront||(state.reading=!1);return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||0===state.length)}function roundUpToNextPowerOf2(n){if(n>=MAX_HWM)n=MAX_HWM;else{n--;for(var p=1;32>p;p<<=1)n|=n>>p;n++}return n}function howMuchToRead(n,state){return 0===state.length&&state.ended?0:state.objectMode?0===n?0:1:null===n||isNaN(n)?state.flowing&&state.buffer.length?state.buffer[0].length:state.length:0>=n?0:(n>state.highWaterMark&&(state.highWaterMark=roundUpToNextPowerOf2(n)),n>state.length?state.ended?state.length:(state.needReadable=!0,0):n)}function chunkInvalid(state,chunk){var er=null;return Buffer.isBuffer(chunk)||"string"==typeof chunk||null===chunk||void 0===chunk||state.objectMode||(er=new TypeError("Invalid non-string/buffer chunk")),er}function onEofChunk(stream,state){if(!state.ended){if(state.decoder){var chunk=state.decoder.end();chunk&&chunk.length&&(state.buffer.push(chunk),state.length+=state.objectMode?1:chunk.length)}state.ended=!0,emitReadable(stream)}}function emitReadable(stream){var state=stream._readableState;state.needReadable=!1,state.emittedReadable||(debug("emitReadable",state.flowing),state.emittedReadable=!0,state.sync?processNextTick(emitReadable_,stream):emitReadable_(stream))}function emitReadable_(stream){debug("emit readable"),stream.emit("readable"),flow(stream)}function maybeReadMore(stream,state){state.readingMore||(state.readingMore=!0,processNextTick(maybeReadMore_,stream,state))}function maybeReadMore_(stream,state){for(var len=state.length;!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark&&(debug("maybeReadMore read 0"),stream.read(0),len!==state.length);)len=state.length;state.readingMore=!1}function pipeOnDrain(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain),state.awaitDrain&&state.awaitDrain--,0===state.awaitDrain&&EE.listenerCount(src,"data")&&(state.flowing=!0,flow(src))}}function nReadingNextTick(self){debug("readable nexttick read 0"),self.read(0)}function resume(stream,state){state.resumeScheduled||(state.resumeScheduled=!0,processNextTick(resume_,stream,state))}function resume_(stream,state){state.reading||(debug("resume read 0"),stream.read(0)),state.resumeScheduled=!1,stream.emit("resume"),flow(stream),state.flowing&&!state.reading&&stream.read(0)}function flow(stream){var state=stream._readableState;if(debug("flow",state.flowing),state.flowing)do var chunk=stream.read();while(null!==chunk&&state.flowing)}function fromList(n,state){var ret,list=state.buffer,length=state.length,stringMode=!!state.decoder,objectMode=!!state.objectMode;if(0===list.length)return null;if(0===length)ret=null;else if(objectMode)ret=list.shift();else if(!n||n>=length)ret=stringMode?list.join(""):Buffer.concat(list,length),list.length=0;else if(n<list[0].length){var buf=list[0];ret=buf.slice(0,n),list[0]=buf.slice(n)}else if(n===list[0].length)ret=list.shift();else{ret=stringMode?"":new Buffer(n);for(var c=0,i=0,l=list.length;l>i&&n>c;i++){var buf=list[0],cpy=Math.min(n-c,buf.length);stringMode?ret+=buf.slice(0,cpy):buf.copy(ret,c,0,cpy),cpy<buf.length?list[0]=buf.slice(cpy):list.shift(),c+=cpy}}return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error("endReadable called on non-empty stream");state.endEmitted||(state.ended=!0,processNextTick(endReadableNT,state,stream))}function endReadableNT(state,stream){state.endEmitted||0!==state.length||(state.endEmitted=!0,stream.readable=!1,stream.emit("end"))}function forEach(xs,f){for(var i=0,l=xs.length;l>i;i++)f(xs[i],i)}function indexOf(xs,x){for(var i=0,l=xs.length;l>i;i++)if(xs[i]===x)return i;return-1}module.exports=Readable;var processNextTick=require("process-nextick-args"),isArray=require("isarray"),Buffer=require("buffer").Buffer;
Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;EE.listenerCount||(EE.listenerCount=function(emitter,type){return emitter.listeners(type).length});var Stream;!function(){try{Stream=require("stream")}catch(_){Stream=require("events").EventEmitter}}();var Buffer=require("buffer").Buffer,util=require("core-util-is");util.inherits=require("inherits");var debug=require("util");debug=debug&&debug.debuglog?debug.debuglog("stream"):function(){};var StringDecoder;util.inherits(Readable,Stream),Readable.prototype.push=function(chunk,encoding){var state=this._readableState;return state.objectMode||"string"!=typeof chunk||(encoding=encoding||state.defaultEncoding,encoding!==state.encoding&&(chunk=new Buffer(chunk,encoding),encoding="")),readableAddChunk(this,state,chunk,encoding,!1)},Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",!0)},Readable.prototype.isPaused=function(){return this._readableState.flowing===!1},Readable.prototype.setEncoding=function(enc){return StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this._readableState.decoder=new StringDecoder(enc),this._readableState.encoding=enc,this};var MAX_HWM=8388608;Readable.prototype.read=function(n){debug("read",n);var state=this._readableState,nOrig=n;if(("number"!=typeof n||n>0)&&(state.emittedReadable=!1),0===n&&state.needReadable&&(state.length>=state.highWaterMark||state.ended))return debug("read: emitReadable",state.length,state.ended),0===state.length&&state.ended?endReadable(this):emitReadable(this),null;if(n=howMuchToRead(n,state),0===n&&state.ended)return 0===state.length&&endReadable(this),null;var doRead=state.needReadable;debug("need readable",doRead),(0===state.length||state.length-n<state.highWaterMark)&&(doRead=!0,debug("length less than watermark",doRead)),(state.ended||state.reading)&&(doRead=!1,debug("reading or ended",doRead)),doRead&&(debug("do read"),state.reading=!0,state.sync=!0,0===state.length&&(state.needReadable=!0),this._read(state.highWaterMark),state.sync=!1),doRead&&!state.reading&&(n=howMuchToRead(nOrig,state));var ret;return ret=n>0?fromList(n,state):null,null===ret&&(state.needReadable=!0,n=0),state.length-=n,0!==state.length||state.ended||(state.needReadable=!0),nOrig!==n&&state.ended&&0===state.length&&endReadable(this),null!==ret&&this.emit("data",ret),ret},Readable.prototype._read=function(n){this.emit("error",new Error("not implemented"))},Readable.prototype.pipe=function(dest,pipeOpts){function onunpipe(readable){debug("onunpipe"),readable===src&&cleanup()}function onend(){debug("onend"),dest.end()}function cleanup(){debug("cleanup"),dest.removeListener("close",onclose),dest.removeListener("finish",onfinish),dest.removeListener("drain",ondrain),dest.removeListener("error",onerror),dest.removeListener("unpipe",onunpipe),src.removeListener("end",onend),src.removeListener("end",cleanup),src.removeListener("data",ondata),!state.awaitDrain||dest._writableState&&!dest._writableState.needDrain||ondrain()}function ondata(chunk){debug("ondata");var ret=dest.write(chunk);!1===ret&&(debug("false write response, pause",src._readableState.awaitDrain),src._readableState.awaitDrain++,src.pause())}function onerror(er){debug("onerror",er),unpipe(),dest.removeListener("error",onerror),0===EE.listenerCount(dest,"error")&&dest.emit("error",er)}function onclose(){dest.removeListener("finish",onfinish),unpipe()}function onfinish(){debug("onfinish"),dest.removeListener("close",onclose),unpipe()}function unpipe(){debug("unpipe"),src.unpipe(dest)}var src=this,state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest)}state.pipesCount+=1,debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var doEnd=(!pipeOpts||pipeOpts.end!==!1)&&dest!==process.stdout&&dest!==process.stderr,endFn=doEnd?onend:cleanup;state.endEmitted?processNextTick(endFn):src.once("end",endFn),dest.on("unpipe",onunpipe);var ondrain=pipeOnDrain(src);return dest.on("drain",ondrain),src.on("data",ondata),dest._events&&dest._events.error?isArray(dest._events.error)?dest._events.error.unshift(onerror):dest._events.error=[onerror,dest._events.error]:dest.on("error",onerror),dest.once("close",onclose),dest.once("finish",onfinish),dest.emit("pipe",src),state.flowing||(debug("pipe resume"),src.resume()),dest},Readable.prototype.unpipe=function(dest){var state=this._readableState;if(0===state.pipesCount)return this;if(1===state.pipesCount)return dest&&dest!==state.pipes?this:(dest||(dest=state.pipes),state.pipes=null,state.pipesCount=0,state.flowing=!1,dest&&dest.emit("unpipe",this),this);if(!dest){var dests=state.pipes,len=state.pipesCount;state.pipes=null,state.pipesCount=0,state.flowing=!1;for(var i=0;len>i;i++)dests[i].emit("unpipe",this);return this}var i=indexOf(state.pipes,dest);return-1===i?this:(state.pipes.splice(i,1),state.pipesCount-=1,1===state.pipesCount&&(state.pipes=state.pipes[0]),dest.emit("unpipe",this),this)},Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if("data"===ev&&!1!==this._readableState.flowing&&this.resume(),"readable"===ev&&this.readable){var state=this._readableState;state.readableListening||(state.readableListening=!0,state.emittedReadable=!1,state.needReadable=!0,state.reading?state.length&&emitReadable(this,state):processNextTick(nReadingNextTick,this))}return res},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){var state=this._readableState;return state.flowing||(debug("resume"),state.flowing=!0,resume(this,state)),this},Readable.prototype.pause=function(){return debug("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(debug("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Readable.prototype.wrap=function(stream){var state=this._readableState,paused=!1,self=this;stream.on("end",function(){if(debug("wrapped end"),state.decoder&&!state.ended){var chunk=state.decoder.end();chunk&&chunk.length&&self.push(chunk)}self.push(null)}),stream.on("data",function(chunk){if(debug("wrapped data"),state.decoder&&(chunk=state.decoder.write(chunk)),(!state.objectMode||null!==chunk&&void 0!==chunk)&&(state.objectMode||chunk&&chunk.length)){var ret=self.push(chunk);ret||(paused=!0,stream.pause())}});for(var i in stream)void 0===this[i]&&"function"==typeof stream[i]&&(this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i));var events=["error","close","destroy","pause","resume"];return forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))}),self._read=function(n){debug("wrapped _read",n),paused&&(paused=!1,stream.resume())},self},Readable._fromList=fromList}).call(this,require("_process"))},{"./_stream_duplex":21,_process:134,buffer:126,"core-util-is":26,events:130,inherits:20,isarray:27,"process-nextick-args":28,"string_decoder/":29,util:125}],24:[function(require,module,exports){"use strict";function TransformState(stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=!1;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null,ts.writecb=null,null!==data&&void 0!==data&&stream.push(data),cb&&cb(er);var rs=stream._readableState;rs.reading=!1,(rs.needReadable||rs.length<rs.highWaterMark)&&stream._read(rs.highWaterMark)}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options),this._transformState=new TransformState(this);var stream=this;this._readableState.needReadable=!0,this._readableState.sync=!1,options&&("function"==typeof options.transform&&(this._transform=options.transform),"function"==typeof options.flush&&(this._flush=options.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(er){done(stream,er)}):done(stream)})}function done(stream,er){if(er)return stream.emit("error",er);var ws=stream._writableState,ts=stream._transformState;if(ws.length)throw new Error("calling transform done when ws.length != 0");if(ts.transforming)throw new Error("calling transform done when still transforming");return stream.push(null)}module.exports=Transform;var Duplex=require("./_stream_duplex"),util=require("core-util-is");util.inherits=require("inherits"),util.inherits(Transform,Duplex),Transform.prototype.push=function(chunk,encoding){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,chunk,encoding)},Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("not implemented")},Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;if(ts.writecb=cb,ts.writechunk=chunk,ts.writeencoding=encoding,!ts.transforming){var rs=this._readableState;(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)&&this._read(rs.highWaterMark)}},Transform.prototype._read=function(n){var ts=this._transformState;null!==ts.writechunk&&ts.writecb&&!ts.transforming?(ts.transforming=!0,this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)):ts.needTransform=!0}},{"./_stream_duplex":21,"core-util-is":26,inherits:20}],25:[function(require,module,exports){"use strict";function nop(){}function WriteReq(chunk,encoding,cb){this.chunk=chunk,this.encoding=encoding,this.callback=cb,this.next=null}function WritableState(options,stream){var Duplex=require("./_stream_duplex");options=options||{},this.objectMode=!!options.objectMode,stream instanceof Duplex&&(this.objectMode=this.objectMode||!!options.writableObjectMode);var hwm=options.highWaterMark,defaultHwm=this.objectMode?16:16384;this.highWaterMark=hwm||0===hwm?hwm:defaultHwm,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var noDecode=options.decodeStrings===!1;this.decodeStrings=!noDecode,this.defaultEncoding=options.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(er){onwrite(stream,er)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1}function Writable(options){var Duplex=require("./_stream_duplex");return this instanceof Writable||this instanceof Duplex?(this._writableState=new WritableState(options,this),this.writable=!0,options&&("function"==typeof options.write&&(this._write=options.write),"function"==typeof options.writev&&(this._writev=options.writev)),void Stream.call(this)):new Writable(options)}function writeAfterEnd(stream,cb){var er=new Error("write after end");stream.emit("error",er),processNextTick(cb,er)}function validChunk(stream,state,chunk,cb){var valid=!0;if(!Buffer.isBuffer(chunk)&&"string"!=typeof chunk&&null!==chunk&&void 0!==chunk&&!state.objectMode){var er=new TypeError("Invalid non-string/buffer chunk");stream.emit("error",er),processNextTick(cb,er),valid=!1}return valid}function decodeChunk(state,chunk,encoding){return state.objectMode||state.decodeStrings===!1||"string"!=typeof chunk||(chunk=new Buffer(chunk,encoding)),chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding),Buffer.isBuffer(chunk)&&(encoding="buffer");var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(ret||(state.needDrain=!0),state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest=new WriteReq(chunk,encoding,cb),last?last.next=state.lastBufferedRequest:state.bufferedRequest=state.lastBufferedRequest}else doWrite(stream,state,!1,len,chunk,encoding,cb);return ret}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len,state.writecb=cb,state.writing=!0,state.sync=!0,writev?stream._writev(chunk,state.onwrite):stream._write(chunk,encoding,state.onwrite),state.sync=!1}function onwriteError(stream,state,sync,er,cb){--state.pendingcb,sync?processNextTick(cb,er):cb(er),stream._writableState.errorEmitted=!0,stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=!1,state.writecb=null,state.length-=state.writelen,state.writelen=0}function onwrite(stream,er){var state=stream._writableState,sync=state.sync,cb=state.writecb;if(onwriteStateUpdate(state),er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(state);finished||state.corked||state.bufferProcessing||!state.bufferedRequest||clearBuffer(stream,state),sync?processNextTick(afterWrite,stream,state,finished,cb):afterWrite(stream,state,finished,cb)}}function afterWrite(stream,state,finished,cb){finished||onwriteDrain(stream,state),state.pendingcb--,cb(),finishMaybe(stream,state)}function onwriteDrain(stream,state){0===state.length&&state.needDrain&&(state.needDrain=!1,stream.emit("drain"))}function clearBuffer(stream,state){state.bufferProcessing=!0;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){for(var buffer=[],cbs=[];entry;)cbs.push(entry.callback),buffer.push(entry),entry=entry.next;state.pendingcb++,state.lastBufferedRequest=null,doWrite(stream,state,!0,state.length,buffer,"",function(err){for(var i=0;i<cbs.length;i++)state.pendingcb--,cbs[i](err)})}else{for(;entry;){var chunk=entry.chunk,encoding=entry.encoding,cb=entry.callback,len=state.objectMode?1:chunk.length;if(doWrite(stream,state,!1,len,chunk,encoding,cb),entry=entry.next,state.writing)break}null===entry&&(state.lastBufferedRequest=null)}state.bufferedRequest=entry,state.bufferProcessing=!1}function needFinish(state){return state.ending&&0===state.length&&null===state.bufferedRequest&&!state.finished&&!state.writing}function prefinish(stream,state){state.prefinished||(state.prefinished=!0,stream.emit("prefinish"))}function finishMaybe(stream,state){var need=needFinish(state);return need&&(0===state.pendingcb?(prefinish(stream,state),state.finished=!0,stream.emit("finish")):prefinish(stream,state)),need}function endWritable(stream,state,cb){state.ending=!0,finishMaybe(stream,state),cb&&(state.finished?processNextTick(cb):stream.once("finish",cb)),state.ended=!0}module.exports=Writable;var processNextTick=require("process-nextick-args"),Buffer=require("buffer").Buffer;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var Stream;!function(){try{Stream=require("stream")}catch(_){Stream=require("events").EventEmitter}}();var Buffer=require("buffer").Buffer;util.inherits(Writable,Stream),WritableState.prototype.getBuffer=function(){for(var current=this.bufferedRequest,out=[];current;)out.push(current),current=current.next;return out},function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:require("util-deprecate")(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer() instead.")})}catch(_){}}(),Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState,ret=!1;return"function"==typeof encoding&&(cb=encoding,encoding=null),Buffer.isBuffer(chunk)?encoding="buffer":encoding||(encoding=state.defaultEncoding),"function"!=typeof cb&&(cb=nop),state.ended?writeAfterEnd(this,cb):validChunk(this,state,chunk,cb)&&(state.pendingcb++,ret=writeOrBuffer(this,state,chunk,encoding,cb)),ret},Writable.prototype.cork=function(){var state=this._writableState;state.corked++},Writable.prototype.uncork=function(){var state=this._writableState;state.corked&&(state.corked--,state.writing||state.corked||state.finished||state.bufferProcessing||!state.bufferedRequest||clearBuffer(this,state))},Writable.prototype.setDefaultEncoding=function(encoding){if("string"==typeof encoding&&(encoding=encoding.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((encoding+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+encoding);this._writableState.defaultEncoding=encoding},Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))},Writable.prototype._writev=null,Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;"function"==typeof chunk?(cb=chunk,chunk=null,encoding=null):"function"==typeof encoding&&(cb=encoding,encoding=null),null!==chunk&&void 0!==chunk&&this.write(chunk,encoding),state.corked&&(state.corked=1,this.uncork()),state.ending||state.finished||endWritable(this,state,cb)}},{"./_stream_duplex":21,buffer:126,"core-util-is":26,events:130,inherits:20,"process-nextick-args":28,"util-deprecate":30}],26:[function(require,module,exports){(function(Buffer){function isArray(ar){return Array.isArray(ar)}function isBoolean(arg){return"boolean"==typeof arg}function isNull(arg){return null===arg}function isNullOrUndefined(arg){return null==arg}function isNumber(arg){return"number"==typeof arg}function isString(arg){return"string"==typeof arg}function isSymbol(arg){return"symbol"==typeof arg}function isUndefined(arg){return void 0===arg}function isRegExp(re){return isObject(re)&&"[object RegExp]"===objectToString(re)}function isObject(arg){return"object"==typeof arg&&null!==arg}function isDate(d){return isObject(d)&&"[object Date]"===objectToString(d)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(arg){return"function"==typeof arg}function isPrimitive(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||"undefined"==typeof arg}function isBuffer(arg){return Buffer.isBuffer(arg)}function objectToString(o){return Object.prototype.toString.call(o)}exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=isBuffer}).call(this,require("buffer").Buffer)},{buffer:126}],27:[function(require,module,exports){module.exports=Array.isArray||function(arr){return"[object Array]"==Object.prototype.toString.call(arr)}},{}],28:[function(require,module,exports){(function(process){"use strict";function nextTick(fn){for(var args=new Array(arguments.length-1),i=0;i<arguments.length;)args[i++]=arguments[i];process.nextTick(function(){fn.apply(null,args)})}module.exports=nextTick}).call(this,require("_process"))},{_process:134}],29:[function(require,module,exports){function assertEncoding(encoding){if(encoding&&!isBufferEncoding(encoding))throw new Error("Unknown encoding: "+encoding)}function passThroughWrite(buffer){return buffer.toString(this.encoding)}function utf16DetectIncompleteChar(buffer){this.charReceived=buffer.length%2,this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(buffer){this.charReceived=buffer.length%3,this.charLength=this.charReceived?3:0}var Buffer=require("buffer").Buffer,isBufferEncoding=Buffer.isEncoding||function(encoding){switch(encoding&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},StringDecoder=exports.StringDecoder=function(encoding){switch(this.encoding=(encoding||"utf8").toLowerCase().replace(/[-_]/,""),assertEncoding(encoding),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=base64DetectIncompleteChar;break;default:return void(this.write=passThroughWrite)}this.charBuffer=new Buffer(6),this.charReceived=0,this.charLength=0};StringDecoder.prototype.write=function(buffer){for(var charStr="";this.charLength;){var available=buffer.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:buffer.length;if(buffer.copy(this.charBuffer,this.charReceived,0,available),this.charReceived+=available,this.charReceived<this.charLength)return"";buffer=buffer.slice(available,buffer.length),charStr=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var charCode=charStr.charCodeAt(charStr.length-1);if(!(charCode>=55296&&56319>=charCode)){if(this.charReceived=this.charLength=0,0===buffer.length)return charStr;break}this.charLength+=this.surrogateSize,charStr=""}this.detectIncompleteChar(buffer);var end=buffer.length;this.charLength&&(buffer.copy(this.charBuffer,0,buffer.length-this.charReceived,end),end-=this.charReceived),charStr+=buffer.toString(this.encoding,0,end);var end=charStr.length-1,charCode=charStr.charCodeAt(end);if(charCode>=55296&&56319>=charCode){var size=this.surrogateSize;return this.charLength+=size,this.charReceived+=size,this.charBuffer.copy(this.charBuffer,size,0,size),buffer.copy(this.charBuffer,0,0,size),charStr.substring(0,end)}return charStr},StringDecoder.prototype.detectIncompleteChar=function(buffer){for(var i=buffer.length>=3?3:buffer.length;i>0;i--){var c=buffer[buffer.length-i];if(1==i&&c>>5==6){this.charLength=2;break}if(2>=i&&c>>4==14){this.charLength=3;break}if(3>=i&&c>>3==30){this.charLength=4;break}}this.charReceived=i},StringDecoder.prototype.end=function(buffer){var res="";if(buffer&&buffer.length&&(res=this.write(buffer)),this.charReceived){var cr=this.charReceived,buf=this.charBuffer,enc=this.encoding;res+=buf.slice(0,cr).toString(enc)}return res}},{buffer:126}],30:[function(require,module,exports){(function(global){function deprecate(fn,msg){function deprecated(){if(!warned){if(config("throwDeprecation"))throw new Error(msg);config("traceDeprecation")?console.trace(msg):console.warn(msg),warned=!0}return fn.apply(this,arguments)}if(config("noDeprecation"))return fn;var warned=!1;return deprecated}function config(name){if(!global.localStorage)return!1;var val=global.localStorage[name];return null==val?!1:"true"===String(val).toLowerCase()}module.exports=deprecate}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],31:[function(require,module,exports){var Stream=function(){try{return require("stream")}catch(_){}}();exports=module.exports=require("./lib/_stream_readable.js"),exports.Stream=Stream||exports,exports.Readable=exports,exports.Writable=require("./lib/_stream_writable.js"),exports.Duplex=require("./lib/_stream_duplex.js"),exports.Transform=require("./lib/_stream_transform.js"),exports.PassThrough=require("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":21,"./lib/_stream_passthrough.js":22,"./lib/_stream_readable.js":23,"./lib/_stream_transform.js":24,"./lib/_stream_writable.js":25}],32:[function(require,module,exports){function configureProperties(obj){if(getOwnPropNames&&defineProp){var i,props=getOwnPropNames(obj);for(i=0;i<props.length;i+=1)defineProp(obj,props[i],{value:obj[props[i]],writable:!1,enumerable:!1,configurable:!1})}}function makeArrayAccessors(obj){function makeArrayAccessor(index){defineProp(obj,index,{get:function(){return obj._getter(index)},set:function(v){obj._setter(index,v)},enumerable:!0,configurable:!1})}if(defineProp){if(obj.length>MAX_ARRAY_LENGTH)throw new RangeError("Array too large for polyfill");var i;for(i=0;i<obj.length;i+=1)makeArrayAccessor(i)}}function as_signed(value,bits){var s=32-bits;return value<<s>>s}function as_unsigned(value,bits){var s=32-bits;return value<<s>>>s}function packI8(n){return[255&n]}function unpackI8(bytes){return as_signed(bytes[0],8)}function packU8(n){return[255&n]}function unpackU8(bytes){return as_unsigned(bytes[0],8)}function packU8Clamped(n){return n=round(Number(n)),[0>n?0:n>255?255:255&n]}function packI16(n){return[n>>8&255,255&n]}function unpackI16(bytes){return as_signed(bytes[0]<<8|bytes[1],16)}function packU16(n){return[n>>8&255,255&n]}function unpackU16(bytes){return as_unsigned(bytes[0]<<8|bytes[1],16)}function packI32(n){return[n>>24&255,n>>16&255,n>>8&255,255&n]}function unpackI32(bytes){return as_signed(bytes[0]<<24|bytes[1]<<16|bytes[2]<<8|bytes[3],32)}function packU32(n){return[n>>24&255,n>>16&255,n>>8&255,255&n]}function unpackU32(bytes){return as_unsigned(bytes[0]<<24|bytes[1]<<16|bytes[2]<<8|bytes[3],32)}function packIEEE754(v,ebits,fbits){function roundToEven(n){var w=floor(n),f=n-w;return.5>f?w:f>.5?w+1:w%2?w+1:w}var s,e,f,i,bits,str,bytes,bias=(1<<ebits-1)-1;for(v!==v?(e=(1<<ebits)-1,f=pow(2,fbits-1),s=0):v===1/0||v===-(1/0)?(e=(1<<ebits)-1,f=0,s=0>v?1:0):0===v?(e=0,f=0,s=1/v===-(1/0)?1:0):(s=0>v,v=abs(v),v>=pow(2,1-bias)?(e=min(floor(log(v)/LN2),1023),f=roundToEven(v/pow(2,e)*pow(2,fbits)),f/pow(2,fbits)>=2&&(e+=1,f=1),e>bias?(e=(1<<ebits)-1,f=0):(e+=bias,f-=pow(2,fbits))):(e=0,f=roundToEven(v/pow(2,1-bias-fbits)))),bits=[],i=fbits;i;i-=1)bits.push(f%2?1:0),f=floor(f/2);for(i=ebits;i;i-=1)bits.push(e%2?1:0),e=floor(e/2);for(bits.push(s?1:0),bits.reverse(),str=bits.join(""),bytes=[];str.length;)bytes.push(parseInt(str.substring(0,8),2)),str=str.substring(8);return bytes}function unpackIEEE754(bytes,ebits,fbits){var i,j,b,str,bias,s,e,f,bits=[];for(i=bytes.length;i;i-=1)for(b=bytes[i-1],j=8;j;j-=1)bits.push(b%2?1:0),b>>=1;return bits.reverse(),str=bits.join(""),bias=(1<<ebits-1)-1,s=parseInt(str.substring(0,1),2)?-1:1,e=parseInt(str.substring(1,1+ebits),2),f=parseInt(str.substring(1+ebits),2),e===(1<<ebits)-1?0!==f?NaN:s*(1/0):e>0?s*pow(2,e-bias)*(1+f/pow(2,fbits)):0!==f?s*pow(2,-(bias-1))*(f/pow(2,fbits)):0>s?-0:0}function unpackF64(b){return unpackIEEE754(b,11,52)}function packF64(v){return packIEEE754(v,11,52)}function unpackF32(b){return unpackIEEE754(b,8,23)}function packF32(v){return packIEEE754(v,8,23)}var defineProp,undefined=void 0,MAX_ARRAY_LENGTH=1e5,ECMAScript=function(){var opts=Object.prototype.toString,ophop=Object.prototype.hasOwnProperty;return{Class:function(v){return opts.call(v).replace(/^\[object *|\]$/g,"")},HasProperty:function(o,p){return p in o},HasOwnProperty:function(o,p){return ophop.call(o,p)},IsCallable:function(o){return"function"==typeof o},ToInt32:function(v){return v>>0},ToUint32:function(v){return v>>>0}}}(),LN2=Math.LN2,abs=Math.abs,floor=Math.floor,log=Math.log,min=Math.min,pow=Math.pow,round=Math.round;defineProp=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}}()?Object.defineProperty:function(o,p,desc){if(!o===Object(o))throw new TypeError("Object.defineProperty called on non-object");return ECMAScript.HasProperty(desc,"get")&&Object.prototype.__defineGetter__&&Object.prototype.__defineGetter__.call(o,p,desc.get),ECMAScript.HasProperty(desc,"set")&&Object.prototype.__defineSetter__&&Object.prototype.__defineSetter__.call(o,p,desc.set),ECMAScript.HasProperty(desc,"value")&&(o[p]=desc.value),o};var getOwnPropNames=Object.getOwnPropertyNames||function(o){if(o!==Object(o))throw new TypeError("Object.getOwnPropertyNames called on non-object");var p,props=[];for(p in o)ECMAScript.HasOwnProperty(o,p)&&props.push(p);return props};!function(){function makeConstructor(bytesPerElement,pack,unpack){var ctor;return ctor=function(buffer,byteOffset,length){var array,sequence,i,s;if(arguments.length&&"number"!=typeof arguments[0])if("object"==typeof arguments[0]&&arguments[0].constructor===ctor)for(array=arguments[0],this.length=array.length,this.byteLength=this.length*this.BYTES_PER_ELEMENT,this.buffer=new ArrayBuffer(this.byteLength),this.byteOffset=0,i=0;i<this.length;i+=1)this._setter(i,array._getter(i));else if("object"!=typeof arguments[0]||(arguments[0]instanceof ArrayBuffer||"ArrayBuffer"===ECMAScript.Class(arguments[0]))){if("object"!=typeof arguments[0]||!(arguments[0]instanceof ArrayBuffer||"ArrayBuffer"===ECMAScript.Class(arguments[0])))throw new TypeError("Unexpected argument type(s)");if(this.buffer=buffer,this.byteOffset=ECMAScript.ToUint32(byteOffset),this.byteOffset>this.buffer.byteLength)throw new RangeError("byteOffset out of range");if(this.byteOffset%this.BYTES_PER_ELEMENT)throw new RangeError("ArrayBuffer length minus the byteOffset is not a multiple of the element size.");if(arguments.length<3){if(this.byteLength=this.buffer.byteLength-this.byteOffset,this.byteLength%this.BYTES_PER_ELEMENT)throw new RangeError("length of buffer minus byteOffset not a multiple of the element size");this.length=this.byteLength/this.BYTES_PER_ELEMENT}else this.length=ECMAScript.ToUint32(length),this.byteLength=this.length*this.BYTES_PER_ELEMENT;if(this.byteOffset+this.byteLength>this.buffer.byteLength)throw new RangeError("byteOffset and length reference an area beyond the end of the buffer")}else for(sequence=arguments[0],this.length=ECMAScript.ToUint32(sequence.length),this.byteLength=this.length*this.BYTES_PER_ELEMENT,this.buffer=new ArrayBuffer(this.byteLength),this.byteOffset=0,i=0;i<this.length;i+=1)s=sequence[i],this._setter(i,Number(s));else{if(this.length=ECMAScript.ToInt32(arguments[0]),0>length)throw new RangeError("ArrayBufferView size is not a small enough positive integer");this.byteLength=this.length*this.BYTES_PER_ELEMENT,this.buffer=new ArrayBuffer(this.byteLength),this.byteOffset=0}this.constructor=ctor,configureProperties(this),makeArrayAccessors(this)},ctor.prototype=new ArrayBufferView,ctor.prototype.BYTES_PER_ELEMENT=bytesPerElement,ctor.prototype._pack=pack,ctor.prototype._unpack=unpack,ctor.BYTES_PER_ELEMENT=bytesPerElement,ctor.prototype._getter=function(index){if(arguments.length<1)throw new SyntaxError("Not enough arguments");if(index=ECMAScript.ToUint32(index),index>=this.length)return undefined;var i,o,bytes=[];for(i=0,o=this.byteOffset+index*this.BYTES_PER_ELEMENT;i<this.BYTES_PER_ELEMENT;i+=1,o+=1)bytes.push(this.buffer._bytes[o]);return this._unpack(bytes)},ctor.prototype.get=ctor.prototype._getter,ctor.prototype._setter=function(index,value){if(arguments.length<2)throw new SyntaxError("Not enough arguments");if(index=ECMAScript.ToUint32(index),index>=this.length)return undefined;var i,o,bytes=this._pack(value);for(i=0,o=this.byteOffset+index*this.BYTES_PER_ELEMENT;i<this.BYTES_PER_ELEMENT;i+=1,o+=1)this.buffer._bytes[o]=bytes[i]},ctor.prototype.set=function(index,value){if(arguments.length<1)throw new SyntaxError("Not enough arguments");var array,sequence,offset,len,i,s,d,byteOffset,byteLength,tmp;if("object"==typeof arguments[0]&&arguments[0].constructor===this.constructor){if(array=arguments[0],offset=ECMAScript.ToUint32(arguments[1]),offset+array.length>this.length)throw new RangeError("Offset plus length of array is out of range");if(byteOffset=this.byteOffset+offset*this.BYTES_PER_ELEMENT,byteLength=array.length*this.BYTES_PER_ELEMENT,array.buffer===this.buffer){for(tmp=[],i=0,s=array.byteOffset;byteLength>i;i+=1,s+=1)tmp[i]=array.buffer._bytes[s];for(i=0,d=byteOffset;byteLength>i;i+=1,d+=1)this.buffer._bytes[d]=tmp[i]}else for(i=0,s=array.byteOffset,d=byteOffset;byteLength>i;i+=1,s+=1,d+=1)this.buffer._bytes[d]=array.buffer._bytes[s]}else{if("object"!=typeof arguments[0]||"undefined"==typeof arguments[0].length)throw new TypeError("Unexpected argument type(s)");if(sequence=arguments[0],len=ECMAScript.ToUint32(sequence.length),offset=ECMAScript.ToUint32(arguments[1]),offset+len>this.length)throw new RangeError("Offset plus length of array is out of range");for(i=0;len>i;i+=1)s=sequence[i],this._setter(offset+i,Number(s))}},ctor.prototype.subarray=function(start,end){function clamp(v,min,max){return min>v?min:v>max?max:v}start=ECMAScript.ToInt32(start),end=ECMAScript.ToInt32(end),arguments.length<1&&(start=0),arguments.length<2&&(end=this.length),0>start&&(start=this.length+start),0>end&&(end=this.length+end),start=clamp(start,0,this.length),
end=clamp(end,0,this.length);var len=end-start;return 0>len&&(len=0),new this.constructor(this.buffer,this.byteOffset+start*this.BYTES_PER_ELEMENT,len)},ctor}var ArrayBuffer=function(length){if(length=ECMAScript.ToInt32(length),0>length)throw new RangeError("ArrayBuffer size is not a small enough positive integer");this.byteLength=length,this._bytes=[],this._bytes.length=length;var i;for(i=0;i<this.byteLength;i+=1)this._bytes[i]=0;configureProperties(this)};exports.ArrayBuffer=exports.ArrayBuffer||ArrayBuffer;var ArrayBufferView=function(){},Int8Array=makeConstructor(1,packI8,unpackI8),Uint8Array=makeConstructor(1,packU8,unpackU8),Uint8ClampedArray=makeConstructor(1,packU8Clamped,unpackU8),Int16Array=makeConstructor(2,packI16,unpackI16),Uint16Array=makeConstructor(2,packU16,unpackU16),Int32Array=makeConstructor(4,packI32,unpackI32),Uint32Array=makeConstructor(4,packU32,unpackU32),Float32Array=makeConstructor(4,packF32,unpackF32),Float64Array=makeConstructor(8,packF64,unpackF64);exports.Int8Array=exports.Int8Array||Int8Array,exports.Uint8Array=exports.Uint8Array||Uint8Array,exports.Uint8ClampedArray=exports.Uint8ClampedArray||Uint8ClampedArray,exports.Int16Array=exports.Int16Array||Int16Array,exports.Uint16Array=exports.Uint16Array||Uint16Array,exports.Int32Array=exports.Int32Array||Int32Array,exports.Uint32Array=exports.Uint32Array||Uint32Array,exports.Float32Array=exports.Float32Array||Float32Array,exports.Float64Array=exports.Float64Array||Float64Array}(),function(){function r(array,index){return ECMAScript.IsCallable(array.get)?array.get(index):array[index]}function makeGetter(arrayType){return function(byteOffset,littleEndian){if(byteOffset=ECMAScript.ToUint32(byteOffset),byteOffset+arrayType.BYTES_PER_ELEMENT>this.byteLength)throw new RangeError("Array index out of range");byteOffset+=this.byteOffset;var i,uint8Array=new exports.Uint8Array(this.buffer,byteOffset,arrayType.BYTES_PER_ELEMENT),bytes=[];for(i=0;i<arrayType.BYTES_PER_ELEMENT;i+=1)bytes.push(r(uint8Array,i));return Boolean(littleEndian)===Boolean(IS_BIG_ENDIAN)&&bytes.reverse(),r(new arrayType(new exports.Uint8Array(bytes).buffer),0)}}function makeSetter(arrayType){return function(byteOffset,value,littleEndian){if(byteOffset=ECMAScript.ToUint32(byteOffset),byteOffset+arrayType.BYTES_PER_ELEMENT>this.byteLength)throw new RangeError("Array index out of range");var i,byteView,typeArray=new arrayType([value]),byteArray=new exports.Uint8Array(typeArray.buffer),bytes=[];for(i=0;i<arrayType.BYTES_PER_ELEMENT;i+=1)bytes.push(r(byteArray,i));Boolean(littleEndian)===Boolean(IS_BIG_ENDIAN)&&bytes.reverse(),byteView=new exports.Uint8Array(this.buffer,byteOffset,arrayType.BYTES_PER_ELEMENT),byteView.set(bytes)}}var IS_BIG_ENDIAN=function(){var u16array=new exports.Uint16Array([4660]),u8array=new exports.Uint8Array(u16array.buffer);return 18===r(u8array,0)}(),DataView=function(buffer,byteOffset,byteLength){if(0===arguments.length)buffer=new exports.ArrayBuffer(0);else if(!(buffer instanceof exports.ArrayBuffer||"ArrayBuffer"===ECMAScript.Class(buffer)))throw new TypeError("TypeError");if(this.buffer=buffer||new exports.ArrayBuffer(0),this.byteOffset=ECMAScript.ToUint32(byteOffset),this.byteOffset>this.buffer.byteLength)throw new RangeError("byteOffset out of range");if(arguments.length<3?this.byteLength=this.buffer.byteLength-this.byteOffset:this.byteLength=ECMAScript.ToUint32(byteLength),this.byteOffset+this.byteLength>this.buffer.byteLength)throw new RangeError("byteOffset and length reference an area beyond the end of the buffer");configureProperties(this)};DataView.prototype.getUint8=makeGetter(exports.Uint8Array),DataView.prototype.getInt8=makeGetter(exports.Int8Array),DataView.prototype.getUint16=makeGetter(exports.Uint16Array),DataView.prototype.getInt16=makeGetter(exports.Int16Array),DataView.prototype.getUint32=makeGetter(exports.Uint32Array),DataView.prototype.getInt32=makeGetter(exports.Int32Array),DataView.prototype.getFloat32=makeGetter(exports.Float32Array),DataView.prototype.getFloat64=makeGetter(exports.Float64Array),DataView.prototype.setUint8=makeSetter(exports.Uint8Array),DataView.prototype.setInt8=makeSetter(exports.Int8Array),DataView.prototype.setUint16=makeSetter(exports.Uint16Array),DataView.prototype.setInt16=makeSetter(exports.Int16Array),DataView.prototype.setUint32=makeSetter(exports.Uint32Array),DataView.prototype.setInt32=makeSetter(exports.Int32Array),DataView.prototype.setFloat32=makeSetter(exports.Float32Array),DataView.prototype.setFloat64=makeSetter(exports.Float64Array),exports.DataView=exports.DataView||DataView}()},{}],33:[function(require,module,exports){function init(type,message,cause){prr(this,{type:type,name:type,cause:"string"!=typeof message?message:cause,message:message&&"string"!=typeof message?message.message:message},"ewr")}function CustomError(message,cause){Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,arguments.callee),init.call(this,"CustomError",message,cause)}function createError(errno,type,proto){var err=function(message,cause){init.call(this,type,message,cause),"FilesystemError"==type&&(this.code=this.cause.code,this.path=this.cause.path,this.errno=this.cause.errno,this.message=(errno.errno[this.cause.errno]?errno.errno[this.cause.errno].description:this.cause.message)+(this.cause.path?" ["+this.cause.path+"]":"")),Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,arguments.callee)};return err.prototype=proto?new proto:new CustomError,err}var prr=require("prr");CustomError.prototype=new Error,module.exports=function(errno){var ce=function(type,proto){return createError(errno,type,proto)};return{CustomError:CustomError,FilesystemError:ce("FilesystemError"),createError:ce}}},{prr:35}],34:[function(require,module,exports){var all=module.exports.all=[{errorno:-2,code:"ENOENT",description:"no such file or directory"},{errno:-1,code:"UNKNOWN",description:"unknown error"},{errno:0,code:"OK",description:"success"},{errno:1,code:"EOF",description:"end of file"},{errno:2,code:"EADDRINFO",description:"getaddrinfo error"},{errno:3,code:"EACCES",description:"permission denied"},{errno:4,code:"EAGAIN",description:"resource temporarily unavailable"},{errno:5,code:"EADDRINUSE",description:"address already in use"},{errno:6,code:"EADDRNOTAVAIL",description:"address not available"},{errno:7,code:"EAFNOSUPPORT",description:"address family not supported"},{errno:8,code:"EALREADY",description:"connection already in progress"},{errno:9,code:"EBADF",description:"bad file descriptor"},{errno:10,code:"EBUSY",description:"resource busy or locked"},{errno:11,code:"ECONNABORTED",description:"software caused connection abort"},{errno:12,code:"ECONNREFUSED",description:"connection refused"},{errno:13,code:"ECONNRESET",description:"connection reset by peer"},{errno:14,code:"EDESTADDRREQ",description:"destination address required"},{errno:15,code:"EFAULT",description:"bad address in system call argument"},{errno:16,code:"EHOSTUNREACH",description:"host is unreachable"},{errno:17,code:"EINTR",description:"interrupted system call"},{errno:18,code:"EINVAL",description:"invalid argument"},{errno:19,code:"EISCONN",description:"socket is already connected"},{errno:20,code:"EMFILE",description:"too many open files"},{errno:21,code:"EMSGSIZE",description:"message too long"},{errno:22,code:"ENETDOWN",description:"network is down"},{errno:23,code:"ENETUNREACH",description:"network is unreachable"},{errno:24,code:"ENFILE",description:"file table overflow"},{errno:25,code:"ENOBUFS",description:"no buffer space available"},{errno:26,code:"ENOMEM",description:"not enough memory"},{errno:27,code:"ENOTDIR",description:"not a directory"},{errno:28,code:"EISDIR",description:"illegal operation on a directory"},{errno:29,code:"ENONET",description:"machine is not on the network"},{errno:31,code:"ENOTCONN",description:"socket is not connected"},{errno:32,code:"ENOTSOCK",description:"socket operation on non-socket"},{errno:33,code:"ENOTSUP",description:"operation not supported on socket"},{errno:34,code:"ENOENT",description:"no such file or directory"},{errno:35,code:"ENOSYS",description:"function not implemented"},{errno:36,code:"EPIPE",description:"broken pipe"},{errno:37,code:"EPROTO",description:"protocol error"},{errno:38,code:"EPROTONOSUPPORT",description:"protocol not supported"},{errno:39,code:"EPROTOTYPE",description:"protocol wrong type for socket"},{errno:40,code:"ETIMEDOUT",description:"connection timed out"},{errno:41,code:"ECHARSET",description:"invalid Unicode character"},{errno:42,code:"EAIFAMNOSUPPORT",description:"address family for hostname not supported"},{errno:44,code:"EAISERVICE",description:"servname not supported for ai_socktype"},{errno:45,code:"EAISOCKTYPE",description:"ai_socktype not supported"},{errno:46,code:"ESHUTDOWN",description:"cannot send after transport endpoint shutdown"},{errno:47,code:"EEXIST",description:"file already exists"},{errno:48,code:"ESRCH",description:"no such process"},{errno:49,code:"ENAMETOOLONG",description:"name too long"},{errno:50,code:"EPERM",description:"operation not permitted"},{errno:51,code:"ELOOP",description:"too many symbolic links encountered"},{errno:52,code:"EXDEV",description:"cross-device link not permitted"},{errno:53,code:"ENOTEMPTY",description:"directory not empty"},{errno:54,code:"ENOSPC",description:"no space left on device"},{errno:55,code:"EIO",description:"i/o error"},{errno:56,code:"EROFS",description:"read-only file system"},{errno:57,code:"ENODEV",description:"no such device"},{errno:58,code:"ESPIPE",description:"invalid seek"},{errno:59,code:"ECANCELED",description:"operation canceled"}];module.exports.errno={},module.exports.code={},all.forEach(function(error){module.exports.errno[error.errno]=error,module.exports.code[error.code]=error}),module.exports.custom=require("./custom")(module.exports),module.exports.create=module.exports.custom.createError},{"./custom":33}],35:[function(require,module,exports){!function(name,context,definition){"undefined"!=typeof module&&module.exports?module.exports=definition():context[name]=definition()}("prr",this,function(){var setProperty="function"==typeof Object.defineProperty?function(obj,key,options){return Object.defineProperty(obj,key,options),obj}:function(obj,key,options){return obj[key]=options.value,obj},makeOptions=function(value,options){var oo="object"==typeof options,os=!oo&&"string"==typeof options,op=function(p){return oo?!!options[p]:os?options.indexOf(p[0])>-1:!1};return{enumerable:op("enumerable"),configurable:op("configurable"),writable:op("writable"),value:value}},prr=function(obj,key,value,options){var k;if(options=makeOptions(value,options),"object"==typeof key){for(k in key)Object.hasOwnProperty.call(key,k)&&(options.value=key[k],setProperty(obj,k,options));return obj}return setProperty(obj,key,options)};return prr})},{}],36:[function(require,module,exports){(function(process,Buffer){var Writable=require("readable-stream/writable"),Readable=require("readable-stream/readable"),Duplex=require("readable-stream/duplex"),DUMMY=new Buffer(0),noop=function(){},toFunction=function(fn){return"function"==typeof fn?fn:function(cb){cb(null,fn)}},onreadable=function(rs,init){var reading=!1,destroyed=!1;return rs._read=function(){reading=!0},rs.destroy=function(){destroyed=!0},init(function(err,source){if(err)return rs.emit("error",err);var fwd=function(){for(var data;null!==(data=source.read());)reading=!1,rs.push(data)};return source.on("readable",function(){reading&&fwd()}),source.on("end",function(){fwd(),rs.push(null)}),source.on("error",function(err){rs.emit("error",err)}),source.on("close",function(){fwd(),process.nextTick(function(){rs.emit("close")})}),rs._read=function(){reading=!0,fwd()},rs.destroy=function(){destroyed||(destroyed=!0,source.destroy&&source.destroy())},destroyed?(destroyed=!1,void rs.destroy()):void(reading&&fwd())}),rs},onwritable=function(ws,init){var ready=noop,destroyed=!1;return ws._write=function(data,enc,cb){ready=cb},ws.destroy=function(){destroyed=!0},ws.write(DUMMY),init(function(err,source){if(err)return ws.emit("error",err);source.on("close",function(){ws.emit("close")}),source.on("error",function(err){ws.emit("error",err)}),ws._write=function(data,enc,cb){return data===DUMMY?cb():void source.write(data,enc,cb)};var emit=ws.emit;return source.on("finish",function(){emit.call(ws,"finish")}),ws.destroy=function(){destroyed||(destroyed=!0,source.destroy&&source.destroy())},ws.emit=function(name){return"finish"!==name?emit.apply(ws,arguments):void source.end()},destroyed?(destroyed=!1,void ws.destroy()):void ready()}),ws};exports.readable=function(opts,init){return 1===arguments.length?exports.readable(null,opts):(opts||(opts={}),onreadable(new Readable(opts),toFunction(init)))},exports.writable=function(opts,init){return 1===arguments.length?exports.writable(null,opts):(opts||(opts={}),onwritable(new Writable(opts),toFunction(init)))},exports.duplex=function(opts,initWritable,initReadable){if(2===arguments.length)return exports.duplex(null,opts,initWritable);opts||(opts={});var dupl=new Duplex(opts);return onwritable(dupl,toFunction(initWritable)),onreadable(dupl,toFunction(initReadable)),dupl}}).call(this,require("_process"),require("buffer").Buffer)},{_process:134,buffer:126,"readable-stream/duplex":37,"readable-stream/readable":47,"readable-stream/writable":48}],37:[function(require,module,exports){module.exports=require("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":38}],38:[function(require,module,exports){(function(process){function Duplex(options){return this instanceof Duplex?(Readable.call(this,options),Writable.call(this,options),options&&options.readable===!1&&(this.readable=!1),options&&options.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,options&&options.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",onend)):new Duplex(options)}function onend(){this.allowHalfOpen||this._writableState.ended||process.nextTick(this.end.bind(this))}function forEach(xs,f){for(var i=0,l=xs.length;l>i;i++)f(xs[i],i)}module.exports=Duplex;var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys},util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable"),Writable=require("./_stream_writable");util.inherits(Duplex,Readable),forEach(objectKeys(Writable.prototype),function(method){Duplex.prototype[method]||(Duplex.prototype[method]=Writable.prototype[method])})}).call(this,require("_process"))},{"./_stream_readable":40,"./_stream_writable":42,_process:134,"core-util-is":43,inherits:44}],39:[function(require,module,exports){function PassThrough(options){return this instanceof PassThrough?void Transform.call(this,options):new PassThrough(options)}module.exports=PassThrough;var Transform=require("./_stream_transform"),util=require("core-util-is");util.inherits=require("inherits"),util.inherits(PassThrough,Transform),PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":41,"core-util-is":43,inherits:44}],40:[function(require,module,exports){(function(process){function ReadableState(options,stream){options=options||{};var hwm=options.highWaterMark;this.highWaterMark=hwm||0===hwm?hwm:16384,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=!1,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.calledRead=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!options.objectMode,this.defaultEncoding=options.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,options.encoding&&(StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this.decoder=new StringDecoder(options.encoding),this.encoding=options.encoding)}function Readable(options){return this instanceof Readable?(this._readableState=new ReadableState(options,this),this.readable=!0,void Stream.call(this)):new Readable(options)}function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er)stream.emit("error",er);else if(null===chunk||void 0===chunk)state.reading=!1,state.ended||onEofChunk(stream,state);else if(state.objectMode||chunk&&chunk.length>0)if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var e=new Error("stream.unshift() after end event");stream.emit("error",e)}else!state.decoder||addToFront||encoding||(chunk=state.decoder.write(chunk)),state.length+=state.objectMode?1:chunk.length,addToFront?state.buffer.unshift(chunk):(state.reading=!1,state.buffer.push(chunk)),state.needReadable&&emitReadable(stream),maybeReadMore(stream,state);else addToFront||(state.reading=!1);return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||0===state.length)}function roundUpToNextPowerOf2(n){if(n>=MAX_HWM)n=MAX_HWM;else{n--;for(var p=1;32>p;p<<=1)n|=n>>p;n++}return n}function howMuchToRead(n,state){return 0===state.length&&state.ended?0:state.objectMode?0===n?0:1:null===n||isNaN(n)?state.flowing&&state.buffer.length?state.buffer[0].length:state.length:0>=n?0:(n>state.highWaterMark&&(state.highWaterMark=roundUpToNextPowerOf2(n)),n>state.length?state.ended?state.length:(state.needReadable=!0,0):n)}function chunkInvalid(state,chunk){var er=null;return Buffer.isBuffer(chunk)||"string"==typeof chunk||null===chunk||void 0===chunk||state.objectMode||(er=new TypeError("Invalid non-string/buffer chunk")),er}function onEofChunk(stream,state){if(state.decoder&&!state.ended){var chunk=state.decoder.end();chunk&&chunk.length&&(state.buffer.push(chunk),state.length+=state.objectMode?1:chunk.length)}state.ended=!0,state.length>0?emitReadable(stream):endReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=!1,state.emittedReadable||(state.emittedReadable=!0,state.sync?process.nextTick(function(){emitReadable_(stream)}):emitReadable_(stream))}function emitReadable_(stream){stream.emit("readable")}function maybeReadMore(stream,state){state.readingMore||(state.readingMore=!0,process.nextTick(function(){maybeReadMore_(stream,state)}))}function maybeReadMore_(stream,state){for(var len=state.length;!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark&&(stream.read(0),len!==state.length);)len=state.length;state.readingMore=!1}function pipeOnDrain(src){return function(){var state=src._readableState;state.awaitDrain--,0===state.awaitDrain&&flow(src)}}function flow(src){function write(dest,i,list){var written=dest.write(chunk);!1===written&&state.awaitDrain++}var chunk,state=src._readableState;for(state.awaitDrain=0;state.pipesCount&&null!==(chunk=src.read());)if(1===state.pipesCount?write(state.pipes,0,null):forEach(state.pipes,write),src.emit("data",chunk),state.awaitDrain>0)return;return 0===state.pipesCount?(state.flowing=!1,void(EE.listenerCount(src,"data")>0&&emitDataEvents(src))):void(state.ranOut=!0)}function pipeOnReadable(){this._readableState.ranOut&&(this._readableState.ranOut=!1,flow(this))}function emitDataEvents(stream,startPaused){var state=stream._readableState;if(state.flowing)throw new Error("Cannot switch to old mode now.");var paused=startPaused||!1,readable=!1;stream.readable=!0,stream.pipe=Stream.prototype.pipe,stream.on=stream.addListener=Stream.prototype.on,stream.on("readable",function(){readable=!0;for(var c;!paused&&null!==(c=stream.read());)stream.emit("data",c);null===c&&(readable=!1,stream._readableState.needReadable=!0)}),stream.pause=function(){paused=!0,this.emit("pause")},stream.resume=function(){paused=!1,readable?process.nextTick(function(){stream.emit("readable")}):this.read(0),this.emit("resume")},stream.emit("readable")}function fromList(n,state){var ret,list=state.buffer,length=state.length,stringMode=!!state.decoder,objectMode=!!state.objectMode;if(0===list.length)return null;if(0===length)ret=null;else if(objectMode)ret=list.shift();else if(!n||n>=length)ret=stringMode?list.join(""):Buffer.concat(list,length),list.length=0;else if(n<list[0].length){var buf=list[0];ret=buf.slice(0,n),list[0]=buf.slice(n)}else if(n===list[0].length)ret=list.shift();else{ret=stringMode?"":new Buffer(n);for(var c=0,i=0,l=list.length;l>i&&n>c;i++){var buf=list[0],cpy=Math.min(n-c,buf.length);stringMode?ret+=buf.slice(0,cpy):buf.copy(ret,c,0,cpy),cpy<buf.length?list[0]=buf.slice(cpy):list.shift(),c+=cpy}}return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error("endReadable called on non-empty stream");!state.endEmitted&&state.calledRead&&(state.ended=!0,process.nextTick(function(){state.endEmitted||0!==state.length||(state.endEmitted=!0,stream.readable=!1,stream.emit("end"))}))}function forEach(xs,f){for(var i=0,l=xs.length;l>i;i++)f(xs[i],i)}function indexOf(xs,x){for(var i=0,l=xs.length;l>i;i++)if(xs[i]===x)return i;return-1}module.exports=Readable;var isArray=require("isarray"),Buffer=require("buffer").Buffer;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;EE.listenerCount||(EE.listenerCount=function(emitter,type){return emitter.listeners(type).length});var Stream=require("stream"),util=require("core-util-is");util.inherits=require("inherits");var StringDecoder;util.inherits(Readable,Stream),Readable.prototype.push=function(chunk,encoding){var state=this._readableState;return"string"!=typeof chunk||state.objectMode||(encoding=encoding||state.defaultEncoding,encoding!==state.encoding&&(chunk=new Buffer(chunk,encoding),encoding="")),readableAddChunk(this,state,chunk,encoding,!1)},Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",!0)},Readable.prototype.setEncoding=function(enc){StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this._readableState.decoder=new StringDecoder(enc),this._readableState.encoding=enc};var MAX_HWM=8388608;Readable.prototype.read=function(n){var state=this._readableState;state.calledRead=!0;var ret,nOrig=n;if(("number"!=typeof n||n>0)&&(state.emittedReadable=!1),0===n&&state.needReadable&&(state.length>=state.highWaterMark||state.ended))return emitReadable(this),null;if(n=howMuchToRead(n,state),0===n&&state.ended)return ret=null,state.length>0&&state.decoder&&(ret=fromList(n,state),state.length-=ret.length),0===state.length&&endReadable(this),ret;var doRead=state.needReadable;return state.length-n<=state.highWaterMark&&(doRead=!0),(state.ended||state.reading)&&(doRead=!1),doRead&&(state.reading=!0,state.sync=!0,0===state.length&&(state.needReadable=!0),this._read(state.highWaterMark),state.sync=!1),doRead&&!state.reading&&(n=howMuchToRead(nOrig,state)),ret=n>0?fromList(n,state):null,null===ret&&(state.needReadable=!0,n=0),state.length-=n,0!==state.length||state.ended||(state.needReadable=!0),state.ended&&!state.endEmitted&&0===state.length&&endReadable(this),ret},Readable.prototype._read=function(n){this.emit("error",new Error("not implemented"))},Readable.prototype.pipe=function(dest,pipeOpts){function onunpipe(readable){readable===src&&cleanup()}function onend(){dest.end()}function cleanup(){dest.removeListener("close",onclose),dest.removeListener("finish",onfinish),dest.removeListener("drain",ondrain),dest.removeListener("error",onerror),dest.removeListener("unpipe",onunpipe),src.removeListener("end",onend),src.removeListener("end",cleanup),(!dest._writableState||dest._writableState.needDrain)&&ondrain()}function onerror(er){unpipe(),dest.removeListener("error",onerror),0===EE.listenerCount(dest,"error")&&dest.emit("error",er)}function onclose(){dest.removeListener("finish",onfinish),unpipe()}function onfinish(){dest.removeListener("close",onclose),unpipe()}function unpipe(){src.unpipe(dest)}var src=this,state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest)}state.pipesCount+=1;var doEnd=(!pipeOpts||pipeOpts.end!==!1)&&dest!==process.stdout&&dest!==process.stderr,endFn=doEnd?onend:cleanup;state.endEmitted?process.nextTick(endFn):src.once("end",endFn),dest.on("unpipe",onunpipe);var ondrain=pipeOnDrain(src);return dest.on("drain",ondrain),dest._events&&dest._events.error?isArray(dest._events.error)?dest._events.error.unshift(onerror):dest._events.error=[onerror,dest._events.error]:dest.on("error",onerror),dest.once("close",onclose),dest.once("finish",onfinish),dest.emit("pipe",src),state.flowing||(this.on("readable",pipeOnReadable),state.flowing=!0,process.nextTick(function(){flow(src)})),dest},Readable.prototype.unpipe=function(dest){var state=this._readableState;if(0===state.pipesCount)return this;if(1===state.pipesCount)return dest&&dest!==state.pipes?this:(dest||(dest=state.pipes),state.pipes=null,state.pipesCount=0,this.removeListener("readable",pipeOnReadable),state.flowing=!1,dest&&dest.emit("unpipe",this),this);if(!dest){var dests=state.pipes,len=state.pipesCount;state.pipes=null,state.pipesCount=0,this.removeListener("readable",pipeOnReadable),state.flowing=!1;for(var i=0;len>i;i++)dests[i].emit("unpipe",this);return this}var i=indexOf(state.pipes,dest);return-1===i?this:(state.pipes.splice(i,1),state.pipesCount-=1,1===state.pipesCount&&(state.pipes=state.pipes[0]),dest.emit("unpipe",this),this)},Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if("data"!==ev||this._readableState.flowing||emitDataEvents(this),"readable"===ev&&this.readable){var state=this._readableState;state.readableListening||(state.readableListening=!0,state.emittedReadable=!1,state.needReadable=!0,state.reading?state.length&&emitReadable(this,state):this.read(0))}return res},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){emitDataEvents(this),this.read(0),this.emit("resume")},Readable.prototype.pause=function(){emitDataEvents(this,!0),this.emit("pause")},Readable.prototype.wrap=function(stream){var state=this._readableState,paused=!1,self=this;stream.on("end",function(){if(state.decoder&&!state.ended){var chunk=state.decoder.end();chunk&&chunk.length&&self.push(chunk)}self.push(null)}),stream.on("data",function(chunk){if(state.decoder&&(chunk=state.decoder.write(chunk)),(!state.objectMode||null!==chunk&&void 0!==chunk)&&(state.objectMode||chunk&&chunk.length)){var ret=self.push(chunk);ret||(paused=!0,stream.pause())}});for(var i in stream)"function"==typeof stream[i]&&"undefined"==typeof this[i]&&(this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i));var events=["error","close","destroy","pause","resume"];return forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))}),self._read=function(n){paused&&(paused=!1,stream.resume())},self},Readable._fromList=fromList}).call(this,require("_process"))},{_process:134,buffer:126,"core-util-is":43,events:130,inherits:44,isarray:45,stream:146,"string_decoder/":46}],41:[function(require,module,exports){function TransformState(options,stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=!1;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null,ts.writecb=null,null!==data&&void 0!==data&&stream.push(data),cb&&cb(er);var rs=stream._readableState;rs.reading=!1,(rs.needReadable||rs.length<rs.highWaterMark)&&stream._read(rs.highWaterMark)}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);var stream=(this._transformState=new TransformState(options,this),this);this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("finish",function(){"function"==typeof this._flush?this._flush(function(er){done(stream,er)}):done(stream)})}function done(stream,er){if(er)return stream.emit("error",er);var ws=stream._writableState,ts=(stream._readableState,stream._transformState);if(ws.length)throw new Error("calling transform done when ws.length != 0");if(ts.transforming)throw new Error("calling transform done when still transforming");return stream.push(null)}module.exports=Transform;var Duplex=require("./_stream_duplex"),util=require("core-util-is");util.inherits=require("inherits"),util.inherits(Transform,Duplex),Transform.prototype.push=function(chunk,encoding){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,chunk,encoding)},Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("not implemented")},Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;if(ts.writecb=cb,ts.writechunk=chunk,ts.writeencoding=encoding,!ts.transforming){var rs=this._readableState;(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)&&this._read(rs.highWaterMark)}},Transform.prototype._read=function(n){var ts=this._transformState;null!==ts.writechunk&&ts.writecb&&!ts.transforming?(ts.transforming=!0,this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)):ts.needTransform=!0}},{"./_stream_duplex":38,"core-util-is":43,inherits:44}],42:[function(require,module,exports){(function(process){function WriteReq(chunk,encoding,cb){this.chunk=chunk,this.encoding=encoding,this.callback=cb}function WritableState(options,stream){options=options||{};var hwm=options.highWaterMark;this.highWaterMark=hwm||0===hwm?hwm:16384,this.objectMode=!!options.objectMode,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var noDecode=options.decodeStrings===!1;this.decodeStrings=!noDecode,this.defaultEncoding=options.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(er){onwrite(stream,er)},this.writecb=null,this.writelen=0,this.buffer=[],this.errorEmitted=!1}function Writable(options){var Duplex=require("./_stream_duplex");return this instanceof Writable||this instanceof Duplex?(this._writableState=new WritableState(options,this),this.writable=!0,void Stream.call(this)):new Writable(options)}function writeAfterEnd(stream,state,cb){var er=new Error("write after end");stream.emit("error",er),process.nextTick(function(){cb(er)})}function validChunk(stream,state,chunk,cb){var valid=!0;if(!Buffer.isBuffer(chunk)&&"string"!=typeof chunk&&null!==chunk&&void 0!==chunk&&!state.objectMode){var er=new TypeError("Invalid non-string/buffer chunk");stream.emit("error",er),process.nextTick(function(){cb(er)}),valid=!1}return valid}function decodeChunk(state,chunk,encoding){return state.objectMode||state.decodeStrings===!1||"string"!=typeof chunk||(chunk=new Buffer(chunk,encoding)),chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding),Buffer.isBuffer(chunk)&&(encoding="buffer");var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;return ret||(state.needDrain=!0),state.writing?state.buffer.push(new WriteReq(chunk,encoding,cb)):doWrite(stream,state,len,chunk,encoding,cb),ret}function doWrite(stream,state,len,chunk,encoding,cb){state.writelen=len,state.writecb=cb,state.writing=!0,state.sync=!0,stream._write(chunk,encoding,state.onwrite),state.sync=!1}function onwriteError(stream,state,sync,er,cb){sync?process.nextTick(function(){cb(er)}):cb(er),stream._writableState.errorEmitted=!0,stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=!1,state.writecb=null,state.length-=state.writelen,state.writelen=0}function onwrite(stream,er){var state=stream._writableState,sync=state.sync,cb=state.writecb;if(onwriteStateUpdate(state),er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(stream,state);
finished||state.bufferProcessing||!state.buffer.length||clearBuffer(stream,state),sync?process.nextTick(function(){afterWrite(stream,state,finished,cb)}):afterWrite(stream,state,finished,cb)}}function afterWrite(stream,state,finished,cb){finished||onwriteDrain(stream,state),cb(),finished&&finishMaybe(stream,state)}function onwriteDrain(stream,state){0===state.length&&state.needDrain&&(state.needDrain=!1,stream.emit("drain"))}function clearBuffer(stream,state){state.bufferProcessing=!0;for(var c=0;c<state.buffer.length;c++){var entry=state.buffer[c],chunk=entry.chunk,encoding=entry.encoding,cb=entry.callback,len=state.objectMode?1:chunk.length;if(doWrite(stream,state,len,chunk,encoding,cb),state.writing){c++;break}}state.bufferProcessing=!1,c<state.buffer.length?state.buffer=state.buffer.slice(c):state.buffer.length=0}function needFinish(stream,state){return state.ending&&0===state.length&&!state.finished&&!state.writing}function finishMaybe(stream,state){var need=needFinish(stream,state);return need&&(state.finished=!0,stream.emit("finish")),need}function endWritable(stream,state,cb){state.ending=!0,finishMaybe(stream,state),cb&&(state.finished?process.nextTick(cb):stream.once("finish",cb)),state.ended=!0}module.exports=Writable;var Buffer=require("buffer").Buffer;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var Stream=require("stream");util.inherits(Writable,Stream),Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState,ret=!1;return"function"==typeof encoding&&(cb=encoding,encoding=null),Buffer.isBuffer(chunk)?encoding="buffer":encoding||(encoding=state.defaultEncoding),"function"!=typeof cb&&(cb=function(){}),state.ended?writeAfterEnd(this,state,cb):validChunk(this,state,chunk,cb)&&(ret=writeOrBuffer(this,state,chunk,encoding,cb)),ret},Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))},Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;"function"==typeof chunk?(cb=chunk,chunk=null,encoding=null):"function"==typeof encoding&&(cb=encoding,encoding=null),"undefined"!=typeof chunk&&null!==chunk&&this.write(chunk,encoding),state.ending||state.finished||endWritable(this,state,cb)}}).call(this,require("_process"))},{"./_stream_duplex":38,_process:134,buffer:126,"core-util-is":43,inherits:44,stream:146}],43:[function(require,module,exports){arguments[4][26][0].apply(exports,arguments)},{buffer:126,dup:26}],44:[function(require,module,exports){arguments[4][20][0].apply(exports,arguments)},{dup:20}],45:[function(require,module,exports){arguments[4][27][0].apply(exports,arguments)},{dup:27}],46:[function(require,module,exports){arguments[4][29][0].apply(exports,arguments)},{buffer:126,dup:29}],47:[function(require,module,exports){var Stream=require("stream");exports=module.exports=require("./lib/_stream_readable.js"),exports.Stream=Stream,exports.Readable=exports,exports.Writable=require("./lib/_stream_writable.js"),exports.Duplex=require("./lib/_stream_duplex.js"),exports.Transform=require("./lib/_stream_transform.js"),exports.PassThrough=require("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":38,"./lib/_stream_passthrough.js":39,"./lib/_stream_readable.js":40,"./lib/_stream_transform.js":41,"./lib/_stream_writable.js":42,stream:146}],48:[function(require,module,exports){module.exports=require("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":42}],49:[function(require,module,exports){(function(process,Buffer){var Writable=require("readable-stream/writable"),Readable=require("readable-stream/readable"),peek=require("level-peek"),util=require("util"),once=require("once"),EMPTY=new Buffer(0),ENCODER={encode:function(data){return"string"==typeof data?data=new Buffer(data):data},decode:function(data){return Buffer.isBuffer(data)?data:new Buffer(data)},buffer:!0,type:"raw"},noop=function(){},pad=function(n){return n=n.toString(16),"00000000".slice(0,-n.length)+n},expand=function(buf,len){var tmp=new Buffer(len);return buf.copy(tmp),tmp};module.exports=function(db,opts){opts||(opts={});var blobs={},blockSize=opts.blockSize||65536,maxBatch=opts.batch||100,blank=new Buffer(blockSize);db.put("\x00","ignore",noop);var reservations={},mutateBlock=function(key,offset,block,append,cb){var release=function(){--reservations[key].locks||delete reservations[key]},onreservation=function(r){return r.locks++,r.block||offset?(r.block||(r.block=new Buffer(blockSize)),r.block.length<offset+block.length&&(r.block=expand(r.block,offset+block.length)),block.copy(r.block,offset),!append&&offset+block.length<r.block.length&&(r.block=r.block.slice(0,offset+block.length)),void cb(null,r.block,release)):(r.block=block,void cb(null,r.block,release))};return reservations[key]?onreservation(reservations[key]):void db.get(key,{valueEncoding:ENCODER},function(err,block){return err&&!err.notFound?cb(err):(reservations[key]||(reservations[key]={locks:0,block:block}),void onreservation(reservations[key]))})},WriteStream=function(name,opts){return this instanceof WriteStream?(opts||(opts={}),this.name=name,this.blocks=[],this.batch=[],this.bytesWritten=0,this.truncate=!opts.append,this.append=opts.append,this._shouldInitAppend=this.append&&void 0===opts.start,this._destroyed=!1,this._init(opts.start||0),void Writable.call(this)):new WriteStream(name,opts)};util.inherits(WriteStream,Writable),WriteStream.prototype._init=function(start){this.blockIndex=start/blockSize|0,this.blockOffset=start-this.blockIndex*blockSize,this.blockLength=this.blockOffset},WriteStream.prototype._flush=function(cb){if(!this.batch.length)return cb();var key=this.batch[this.batch.length-1].key,batch=this.batch;return this.batch=[],this.truncate?(this.truncate=!1,void this._truncate(batch,key,cb)):db.batch(batch,cb)},WriteStream.prototype._truncate=function(batch,key,cb){cb=once(cb);var dels=[],keys=db.createKeyStream({start:key,end:this.name+""});keys.on("error",cb),keys.on("data",function(key){dels.push({type:"del",key:key})}),keys.on("end",function(){dels.push.apply(dels,batch),db.batch(dels,cb)})},WriteStream.prototype._writeBlock=function(cb){var block=1===this.blocks.length?this.blocks[0]:Buffer.concat(this.blocks,this.blockLength-this.blockOffset),index=this.blockIndex,offset=this.blockOffset,self=this;this.blockOffset=0,this.blockLength=0,this.blockIndex++,this.blocks=[];var key=this.name+""+pad(index),append=function(block,force,cb){return block.length&&self.batch.push({type:"put",key:key,value:block,valueEncoding:ENCODER}),!force&&self.batch.length<maxBatch?cb():self._flush(cb)};return(offset||block.length!==blockSize)&&(offset||this.append)?void mutateBlock(key,offset,block,this.append,function(err,block,release){return err?cb(err):void append(block,!0,function(err){release(),cb(err)})}):append(block,!1,cb)},WriteStream.prototype._initAppend=function(data,enc,cb){var self=this;this._shouldInitAppend=!1,blobs.size(this.name,function(err,size){return err?cb(err):(self._init(size),void self._write(data,enc,cb))})},WriteStream.prototype._write=function(data,enc,cb){if(!data.length||this._destroyed)return cb();if(this._shouldInitAppend)return this._initAppend(data,enc,cb);var overflow,self=this,free=blockSize-this.blockLength,done=function(err){return err?cb(err):overflow?self._write(overflow,enc,cb):void cb()};return data.length>free&&(overflow=data.slice(free),data=data.slice(0,free)),this.bytesWritten+=data.length,this.blockLength+=data.length,this.blocks.push(data),data.length<free?done():void this._writeBlock(done)},WriteStream.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,process.nextTick(this.emit.bind(this,"close")))},WriteStream.prototype.end=function(data){var self=this,args=arguments;data&&"function"!=typeof data&&(this.write(data),data=EMPTY),this.write(EMPTY,function(){self._writeBlock(function(err){return err?self.emit("error",err):void self._flush(function(err){return err?self.emit("error",err):void Writable.prototype.end.apply(self,args)})})})};var ReadStream=function(name,opts){opts||(opts={});var self=this,start=opts.start||0,blockIndex=start/blockSize|0,blockOffset=start-blockIndex*blockSize,key=name+""+pad(blockIndex);this.name=name,this._missing=("number"==typeof opts.end?opts.end:1/0)-start+1,this._paused=!1,this._destroyed=!1,this._reader=db.createReadStream({start:key,end:name+"",valueEncoding:ENCODER});var onblock=function(val){return key=name+""+pad(++blockIndex),self._missing?blockOffset&&(val=val.slice(blockOffset),blockOffset=0,!val.length)?!0:(val.length>self._missing&&(val=val.slice(0,self._missing)),self._missing-=val.length,self._pause(!self.push(val)),!!self._missing):!1};this._reader.on("data",function(data){for(;data.key>key;)if(!onblock(blank))return;onblock(data.value)}),this._reader.on("error",function(err){self.emit("error",err)}),this._reader.on("end",function(){self.push(null)}),Readable.call(this)};return util.inherits(ReadStream,Readable),ReadStream.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,this._reader.destroy(),process.nextTick(this.emit.bind(this,"close")))},ReadStream.prototype._pause=function(paused){this._paused!==paused&&(this._paused=paused,this._paused?this._reader.pause():this._reader.resume())},ReadStream.prototype._read=function(){this._pause(!1)},blobs.remove=function(name,cb){cb=once(cb||noop);var batch=[],keys=db.createKeyStream({start:name+"",end:name+""});keys.on("error",cb),keys.on("data",function(key){batch.push({type:"del",key:key})}),keys.on("end",function(){db.batch(batch,cb)})},blobs.size=function(name,cb){peek.last(db,{start:name+"",end:name+"",valueEncoding:ENCODER},function(err,latest,val){return err&&"range not found"===err.message?cb(null,0):err?cb(err):latest.slice(0,name.length+1)!==name+""?cb(null,0):void cb(null,parseInt(latest.toString().slice(name.length+1),16)*blockSize+val.length)})},blobs.write=function(name,data,opts,cb){if("function"==typeof opts)return blobs.write(name,data,null,opts);opts||(opts={}),cb||(cb=noop);var ws=blobs.createWriteStream(name,opts);ws.on("error",cb),ws.on("finish",function(){cb()}),ws.write(data),ws.end()},blobs.read=function(name,opts,cb){if("function"==typeof opts)return blobs.read(name,null,opts);opts||(opts={});var rs=blobs.createReadStream(name,opts),list=[];rs.on("error",cb),rs.on("data",function(data){list.push(data)}),rs.on("end",function(){cb(null,1===list.length?list[0]:Buffer.concat(list))})},blobs.createReadStream=function(name,opts){return new ReadStream(name,opts)},blobs.createWriteStream=function(name,opts){return new WriteStream(name,opts)},blobs}}).call(this,require("_process"),require("buffer").Buffer)},{_process:134,buffer:126,"level-peek":61,once:77,"readable-stream/readable":59,"readable-stream/writable":60,util:149}],50:[function(require,module,exports){arguments[4][38][0].apply(exports,arguments)},{"./_stream_readable":52,"./_stream_writable":54,_process:134,"core-util-is":55,dup:38,inherits:56}],51:[function(require,module,exports){arguments[4][39][0].apply(exports,arguments)},{"./_stream_transform":53,"core-util-is":55,dup:39,inherits:56}],52:[function(require,module,exports){(function(process){function ReadableState(options,stream){var Duplex=require("./_stream_duplex");options=options||{};var hwm=options.highWaterMark,defaultHwm=options.objectMode?16:16384;this.highWaterMark=hwm||0===hwm?hwm:defaultHwm,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!options.objectMode,stream instanceof Duplex&&(this.objectMode=this.objectMode||!!options.readableObjectMode),this.defaultEncoding=options.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,options.encoding&&(StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this.decoder=new StringDecoder(options.encoding),this.encoding=options.encoding)}function Readable(options){require("./_stream_duplex");return this instanceof Readable?(this._readableState=new ReadableState(options,this),this.readable=!0,void Stream.call(this)):new Readable(options)}function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er)stream.emit("error",er);else if(util.isNullOrUndefined(chunk))state.reading=!1,state.ended||onEofChunk(stream,state);else if(state.objectMode||chunk&&chunk.length>0)if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var e=new Error("stream.unshift() after end event");stream.emit("error",e)}else!state.decoder||addToFront||encoding||(chunk=state.decoder.write(chunk)),addToFront||(state.reading=!1),state.flowing&&0===state.length&&!state.sync?(stream.emit("data",chunk),stream.read(0)):(state.length+=state.objectMode?1:chunk.length,addToFront?state.buffer.unshift(chunk):state.buffer.push(chunk),state.needReadable&&emitReadable(stream)),maybeReadMore(stream,state);else addToFront||(state.reading=!1);return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||0===state.length)}function roundUpToNextPowerOf2(n){if(n>=MAX_HWM)n=MAX_HWM;else{n--;for(var p=1;32>p;p<<=1)n|=n>>p;n++}return n}function howMuchToRead(n,state){return 0===state.length&&state.ended?0:state.objectMode?0===n?0:1:isNaN(n)||util.isNull(n)?state.flowing&&state.buffer.length?state.buffer[0].length:state.length:0>=n?0:(n>state.highWaterMark&&(state.highWaterMark=roundUpToNextPowerOf2(n)),n>state.length?state.ended?state.length:(state.needReadable=!0,0):n)}function chunkInvalid(state,chunk){var er=null;return util.isBuffer(chunk)||util.isString(chunk)||util.isNullOrUndefined(chunk)||state.objectMode||(er=new TypeError("Invalid non-string/buffer chunk")),er}function onEofChunk(stream,state){if(state.decoder&&!state.ended){var chunk=state.decoder.end();chunk&&chunk.length&&(state.buffer.push(chunk),state.length+=state.objectMode?1:chunk.length)}state.ended=!0,emitReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=!1,state.emittedReadable||(debug("emitReadable",state.flowing),state.emittedReadable=!0,state.sync?process.nextTick(function(){emitReadable_(stream)}):emitReadable_(stream))}function emitReadable_(stream){debug("emit readable"),stream.emit("readable"),flow(stream)}function maybeReadMore(stream,state){state.readingMore||(state.readingMore=!0,process.nextTick(function(){maybeReadMore_(stream,state)}))}function maybeReadMore_(stream,state){for(var len=state.length;!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark&&(debug("maybeReadMore read 0"),stream.read(0),len!==state.length);)len=state.length;state.readingMore=!1}function pipeOnDrain(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain),state.awaitDrain&&state.awaitDrain--,0===state.awaitDrain&&EE.listenerCount(src,"data")&&(state.flowing=!0,flow(src))}}function resume(stream,state){state.resumeScheduled||(state.resumeScheduled=!0,process.nextTick(function(){resume_(stream,state)}))}function resume_(stream,state){state.resumeScheduled=!1,stream.emit("resume"),flow(stream),state.flowing&&!state.reading&&stream.read(0)}function flow(stream){var state=stream._readableState;if(debug("flow",state.flowing),state.flowing)do var chunk=stream.read();while(null!==chunk&&state.flowing)}function fromList(n,state){var ret,list=state.buffer,length=state.length,stringMode=!!state.decoder,objectMode=!!state.objectMode;if(0===list.length)return null;if(0===length)ret=null;else if(objectMode)ret=list.shift();else if(!n||n>=length)ret=stringMode?list.join(""):Buffer.concat(list,length),list.length=0;else if(n<list[0].length){var buf=list[0];ret=buf.slice(0,n),list[0]=buf.slice(n)}else if(n===list[0].length)ret=list.shift();else{ret=stringMode?"":new Buffer(n);for(var c=0,i=0,l=list.length;l>i&&n>c;i++){var buf=list[0],cpy=Math.min(n-c,buf.length);stringMode?ret+=buf.slice(0,cpy):buf.copy(ret,c,0,cpy),cpy<buf.length?list[0]=buf.slice(cpy):list.shift(),c+=cpy}}return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error("endReadable called on non-empty stream");state.endEmitted||(state.ended=!0,process.nextTick(function(){state.endEmitted||0!==state.length||(state.endEmitted=!0,stream.readable=!1,stream.emit("end"))}))}function forEach(xs,f){for(var i=0,l=xs.length;l>i;i++)f(xs[i],i)}function indexOf(xs,x){for(var i=0,l=xs.length;l>i;i++)if(xs[i]===x)return i;return-1}module.exports=Readable;var isArray=require("isarray"),Buffer=require("buffer").Buffer;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;EE.listenerCount||(EE.listenerCount=function(emitter,type){return emitter.listeners(type).length});var Stream=require("stream"),util=require("core-util-is");util.inherits=require("inherits");var StringDecoder,debug=require("util");debug=debug&&debug.debuglog?debug.debuglog("stream"):function(){},util.inherits(Readable,Stream),Readable.prototype.push=function(chunk,encoding){var state=this._readableState;return util.isString(chunk)&&!state.objectMode&&(encoding=encoding||state.defaultEncoding,encoding!==state.encoding&&(chunk=new Buffer(chunk,encoding),encoding="")),readableAddChunk(this,state,chunk,encoding,!1)},Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",!0)},Readable.prototype.setEncoding=function(enc){return StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this._readableState.decoder=new StringDecoder(enc),this._readableState.encoding=enc,this};var MAX_HWM=8388608;Readable.prototype.read=function(n){debug("read",n);var state=this._readableState,nOrig=n;if((!util.isNumber(n)||n>0)&&(state.emittedReadable=!1),0===n&&state.needReadable&&(state.length>=state.highWaterMark||state.ended))return debug("read: emitReadable",state.length,state.ended),0===state.length&&state.ended?endReadable(this):emitReadable(this),null;if(n=howMuchToRead(n,state),0===n&&state.ended)return 0===state.length&&endReadable(this),null;var doRead=state.needReadable;debug("need readable",doRead),(0===state.length||state.length-n<state.highWaterMark)&&(doRead=!0,debug("length less than watermark",doRead)),(state.ended||state.reading)&&(doRead=!1,debug("reading or ended",doRead)),doRead&&(debug("do read"),state.reading=!0,state.sync=!0,0===state.length&&(state.needReadable=!0),this._read(state.highWaterMark),state.sync=!1),doRead&&!state.reading&&(n=howMuchToRead(nOrig,state));var ret;return ret=n>0?fromList(n,state):null,util.isNull(ret)&&(state.needReadable=!0,n=0),state.length-=n,0!==state.length||state.ended||(state.needReadable=!0),nOrig!==n&&state.ended&&0===state.length&&endReadable(this),util.isNull(ret)||this.emit("data",ret),ret},Readable.prototype._read=function(n){this.emit("error",new Error("not implemented"))},Readable.prototype.pipe=function(dest,pipeOpts){function onunpipe(readable){debug("onunpipe"),readable===src&&cleanup()}function onend(){debug("onend"),dest.end()}function cleanup(){debug("cleanup"),dest.removeListener("close",onclose),dest.removeListener("finish",onfinish),dest.removeListener("drain",ondrain),dest.removeListener("error",onerror),dest.removeListener("unpipe",onunpipe),src.removeListener("end",onend),src.removeListener("end",cleanup),src.removeListener("data",ondata),!state.awaitDrain||dest._writableState&&!dest._writableState.needDrain||ondrain()}function ondata(chunk){debug("ondata");var ret=dest.write(chunk);!1===ret&&(debug("false write response, pause",src._readableState.awaitDrain),src._readableState.awaitDrain++,src.pause())}function onerror(er){debug("onerror",er),unpipe(),dest.removeListener("error",onerror),0===EE.listenerCount(dest,"error")&&dest.emit("error",er)}function onclose(){dest.removeListener("finish",onfinish),unpipe()}function onfinish(){debug("onfinish"),dest.removeListener("close",onclose),unpipe()}function unpipe(){debug("unpipe"),src.unpipe(dest)}var src=this,state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest)}state.pipesCount+=1,debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var doEnd=(!pipeOpts||pipeOpts.end!==!1)&&dest!==process.stdout&&dest!==process.stderr,endFn=doEnd?onend:cleanup;state.endEmitted?process.nextTick(endFn):src.once("end",endFn),dest.on("unpipe",onunpipe);var ondrain=pipeOnDrain(src);return dest.on("drain",ondrain),src.on("data",ondata),dest._events&&dest._events.error?isArray(dest._events.error)?dest._events.error.unshift(onerror):dest._events.error=[onerror,dest._events.error]:dest.on("error",onerror),dest.once("close",onclose),dest.once("finish",onfinish),dest.emit("pipe",src),state.flowing||(debug("pipe resume"),src.resume()),dest},Readable.prototype.unpipe=function(dest){var state=this._readableState;if(0===state.pipesCount)return this;if(1===state.pipesCount)return dest&&dest!==state.pipes?this:(dest||(dest=state.pipes),state.pipes=null,state.pipesCount=0,state.flowing=!1,dest&&dest.emit("unpipe",this),this);if(!dest){var dests=state.pipes,len=state.pipesCount;state.pipes=null,state.pipesCount=0,state.flowing=!1;for(var i=0;len>i;i++)dests[i].emit("unpipe",this);return this}var i=indexOf(state.pipes,dest);return-1===i?this:(state.pipes.splice(i,1),state.pipesCount-=1,1===state.pipesCount&&(state.pipes=state.pipes[0]),dest.emit("unpipe",this),this)},Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if("data"===ev&&!1!==this._readableState.flowing&&this.resume(),"readable"===ev&&this.readable){var state=this._readableState;if(!state.readableListening)if(state.readableListening=!0,state.emittedReadable=!1,state.needReadable=!0,state.reading)state.length&&emitReadable(this,state);else{var self=this;process.nextTick(function(){debug("readable nexttick read 0"),self.read(0)})}}return res},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){var state=this._readableState;return state.flowing||(debug("resume"),state.flowing=!0,state.reading||(debug("resume read 0"),this.read(0)),resume(this,state)),this},Readable.prototype.pause=function(){return debug("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(debug("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Readable.prototype.wrap=function(stream){var state=this._readableState,paused=!1,self=this;stream.on("end",function(){if(debug("wrapped end"),state.decoder&&!state.ended){var chunk=state.decoder.end();chunk&&chunk.length&&self.push(chunk)}self.push(null)}),stream.on("data",function(chunk){if(debug("wrapped data"),state.decoder&&(chunk=state.decoder.write(chunk)),chunk&&(state.objectMode||chunk.length)){var ret=self.push(chunk);ret||(paused=!0,stream.pause())}});for(var i in stream)util.isFunction(stream[i])&&util.isUndefined(this[i])&&(this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i));var events=["error","close","destroy","pause","resume"];return forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))}),self._read=function(n){debug("wrapped _read",n),paused&&(paused=!1,stream.resume())},self},Readable._fromList=fromList}).call(this,require("_process"))},{"./_stream_duplex":50,_process:134,buffer:126,"core-util-is":55,events:130,inherits:56,isarray:57,stream:146,"string_decoder/":58,util:125}],53:[function(require,module,exports){function TransformState(options,stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=!1;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null,ts.writecb=null,util.isNullOrUndefined(data)||stream.push(data),cb&&cb(er);var rs=stream._readableState;rs.reading=!1,(rs.needReadable||rs.length<rs.highWaterMark)&&stream._read(rs.highWaterMark)}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options),this._transformState=new TransformState(options,this);var stream=this;this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("prefinish",function(){util.isFunction(this._flush)?this._flush(function(er){done(stream,er)}):done(stream)})}function done(stream,er){if(er)return stream.emit("error",er);var ws=stream._writableState,ts=stream._transformState;if(ws.length)throw new Error("calling transform done when ws.length != 0");if(ts.transforming)throw new Error("calling transform done when still transforming");return stream.push(null)}module.exports=Transform;var Duplex=require("./_stream_duplex"),util=require("core-util-is");util.inherits=require("inherits"),util.inherits(Transform,Duplex),Transform.prototype.push=function(chunk,encoding){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,chunk,encoding)},Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("not implemented")},Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;if(ts.writecb=cb,ts.writechunk=chunk,ts.writeencoding=encoding,!ts.transforming){var rs=this._readableState;(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)&&this._read(rs.highWaterMark)}},Transform.prototype._read=function(n){var ts=this._transformState;util.isNull(ts.writechunk)||!ts.writecb||ts.transforming?ts.needTransform=!0:(ts.transforming=!0,this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform))}},{"./_stream_duplex":50,"core-util-is":55,inherits:56}],54:[function(require,module,exports){(function(process){function WriteReq(chunk,encoding,cb){this.chunk=chunk,this.encoding=encoding,this.callback=cb}function WritableState(options,stream){var Duplex=require("./_stream_duplex");options=options||{};var hwm=options.highWaterMark,defaultHwm=options.objectMode?16:16384;this.highWaterMark=hwm||0===hwm?hwm:defaultHwm,this.objectMode=!!options.objectMode,stream instanceof Duplex&&(this.objectMode=this.objectMode||!!options.writableObjectMode),this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var noDecode=options.decodeStrings===!1;this.decodeStrings=!noDecode,this.defaultEncoding=options.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(er){onwrite(stream,er)},this.writecb=null,this.writelen=0,this.buffer=[],this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1}function Writable(options){var Duplex=require("./_stream_duplex");return this instanceof Writable||this instanceof Duplex?(this._writableState=new WritableState(options,this),this.writable=!0,void Stream.call(this)):new Writable(options)}function writeAfterEnd(stream,state,cb){var er=new Error("write after end");stream.emit("error",er),process.nextTick(function(){cb(er)})}function validChunk(stream,state,chunk,cb){var valid=!0;if(!(util.isBuffer(chunk)||util.isString(chunk)||util.isNullOrUndefined(chunk)||state.objectMode)){var er=new TypeError("Invalid non-string/buffer chunk");stream.emit("error",er),process.nextTick(function(){cb(er)}),valid=!1}return valid}function decodeChunk(state,chunk,encoding){return!state.objectMode&&state.decodeStrings!==!1&&util.isString(chunk)&&(chunk=new Buffer(chunk,encoding)),chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding),util.isBuffer(chunk)&&(encoding="buffer");var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;return ret||(state.needDrain=!0),state.writing||state.corked?state.buffer.push(new WriteReq(chunk,encoding,cb)):doWrite(stream,state,!1,len,chunk,encoding,cb),ret}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len,state.writecb=cb,state.writing=!0,state.sync=!0,writev?stream._writev(chunk,state.onwrite):stream._write(chunk,encoding,state.onwrite),state.sync=!1}function onwriteError(stream,state,sync,er,cb){sync?process.nextTick(function(){state.pendingcb--,cb(er)}):(state.pendingcb--,cb(er)),stream._writableState.errorEmitted=!0,stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=!1,state.writecb=null,state.length-=state.writelen,state.writelen=0}function onwrite(stream,er){var state=stream._writableState,sync=state.sync,cb=state.writecb;if(onwriteStateUpdate(state),er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(stream,state);finished||state.corked||state.bufferProcessing||!state.buffer.length||clearBuffer(stream,state),sync?process.nextTick(function(){afterWrite(stream,state,finished,cb)}):afterWrite(stream,state,finished,cb)}}function afterWrite(stream,state,finished,cb){finished||onwriteDrain(stream,state),state.pendingcb--,cb(),finishMaybe(stream,state)}function onwriteDrain(stream,state){0===state.length&&state.needDrain&&(state.needDrain=!1,stream.emit("drain"))}function clearBuffer(stream,state){if(state.bufferProcessing=!0,stream._writev&&state.buffer.length>1){for(var cbs=[],c=0;c<state.buffer.length;c++)cbs.push(state.buffer[c].callback);state.pendingcb++,doWrite(stream,state,!0,state.length,state.buffer,"",function(err){for(var i=0;i<cbs.length;i++)state.pendingcb--,cbs[i](err)}),state.buffer=[]}else{for(var c=0;c<state.buffer.length;c++){var entry=state.buffer[c],chunk=entry.chunk,encoding=entry.encoding,cb=entry.callback,len=state.objectMode?1:chunk.length;if(doWrite(stream,state,!1,len,chunk,encoding,cb),state.writing){c++;break}}c<state.buffer.length?state.buffer=state.buffer.slice(c):state.buffer.length=0}state.bufferProcessing=!1}function needFinish(stream,state){return state.ending&&0===state.length&&!state.finished&&!state.writing}function prefinish(stream,state){state.prefinished||(state.prefinished=!0,stream.emit("prefinish"))}function finishMaybe(stream,state){var need=needFinish(stream,state);return need&&(0===state.pendingcb?(prefinish(stream,state),state.finished=!0,stream.emit("finish")):prefinish(stream,state)),need}function endWritable(stream,state,cb){state.ending=!0,finishMaybe(stream,state),cb&&(state.finished?process.nextTick(cb):stream.once("finish",cb)),state.ended=!0}module.exports=Writable;var Buffer=require("buffer").Buffer;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var Stream=require("stream");util.inherits(Writable,Stream),Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState,ret=!1;return util.isFunction(encoding)&&(cb=encoding,encoding=null),util.isBuffer(chunk)?encoding="buffer":encoding||(encoding=state.defaultEncoding),util.isFunction(cb)||(cb=function(){}),state.ended?writeAfterEnd(this,state,cb):validChunk(this,state,chunk,cb)&&(state.pendingcb++,ret=writeOrBuffer(this,state,chunk,encoding,cb)),ret},Writable.prototype.cork=function(){var state=this._writableState;state.corked++},Writable.prototype.uncork=function(){var state=this._writableState;state.corked&&(state.corked--,state.writing||state.corked||state.finished||state.bufferProcessing||!state.buffer.length||clearBuffer(this,state))},Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))},Writable.prototype._writev=null,Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;util.isFunction(chunk)?(cb=chunk,
chunk=null,encoding=null):util.isFunction(encoding)&&(cb=encoding,encoding=null),util.isNullOrUndefined(chunk)||this.write(chunk,encoding),state.corked&&(state.corked=1,this.uncork()),state.ending||state.finished||endWritable(this,state,cb)}}).call(this,require("_process"))},{"./_stream_duplex":50,_process:134,buffer:126,"core-util-is":55,inherits:56,stream:146}],55:[function(require,module,exports){arguments[4][26][0].apply(exports,arguments)},{buffer:126,dup:26}],56:[function(require,module,exports){arguments[4][20][0].apply(exports,arguments)},{dup:20}],57:[function(require,module,exports){arguments[4][27][0].apply(exports,arguments)},{dup:27}],58:[function(require,module,exports){arguments[4][29][0].apply(exports,arguments)},{buffer:126,dup:29}],59:[function(require,module,exports){exports=module.exports=require("./lib/_stream_readable.js"),exports.Stream=require("stream"),exports.Readable=exports,exports.Writable=require("./lib/_stream_writable.js"),exports.Duplex=require("./lib/_stream_duplex.js"),exports.Transform=require("./lib/_stream_transform.js"),exports.PassThrough=require("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":50,"./lib/_stream_passthrough.js":51,"./lib/_stream_readable.js":52,"./lib/_stream_transform.js":53,"./lib/_stream_writable.js":54,stream:146}],60:[function(require,module,exports){arguments[4][48][0].apply(exports,arguments)},{"./lib/_stream_writable.js":54,dup:48}],61:[function(require,module,exports){function once(emitter,events,listener){var remove=[];return events.forEach(function(e){function onEvent(arg){listener(e,arg)!==!1&&remove.forEach(function(r){r()})}emitter.on(e,onEvent),remove.push(function(){emitter.removeListener(e,onEvent)})}),emitter}function peek(db,opts,cb){opts.limit=opts.reverse?2:1;once(db.createReadStream(opts),["data","error","end"],function(event,data){return opts.reverse&&data&&opts.start&&data.key.toString()>opts.start?!1:void("error"==event?cb(data):"end"==event?cb(new Error("range not found"),null,null):cb(null,data.key,data.value))})}function first(db,opts,cb){return cb||(cb=opts,opts={}),opts.reverse=!1,peek(db,fixRange(opts),cb)}function last(db,opts,cb){cb||(cb=opts,opts={});opts.start;return opts.reverse=!0,peek(db,fixRange(opts),function(err,key,value){if(err){var _start=opts.start;opts.start=null,peek(db,opts,function(_,key,value){if(!key)return cb(err,null,null);var _key=key.toString();_start>=_key&&(!opts.end||_key>=opts.end)?cb(_,key,value):cb(err,null,null)})}else cb(err,key,value)})}var fixRange=require("level-fix-range");exports=module.exports=peek,exports.first=first,exports.last=last},{"level-fix-range":62}],62:[function(require,module,exports){module.exports=function(opts){var reverse=opts.reverse,end=opts.end,start=opts.start,range=[start,end];return null!=start&&null!=end&&range.sort(),reverse&&(range=range.reverse()),opts.start=range[0],opts.end=range[1],opts}},{}],63:[function(require,module,exports){function addOperation(type,key,value,options){var operation={type:type,key:key,value:value,options:options};return options&&options.prefix&&(operation.prefix=options.prefix,delete options.prefix),this._operations.push(operation),this}function Batch(sdb){this._operations=[],this._sdb=sdb,this.put=addOperation.bind(this,"put"),this.del=addOperation.bind(this,"del")}var B=Batch.prototype;B.clear=function(){this._operations=[]},B.write=function(cb){this._sdb.batch(this._operations,cb)},module.exports=Batch},{}],64:[function(require,module,exports){(function(process){var SubDb=(require("events").EventEmitter,process.nextTick,require("./sub")),Batch=require("./batch"),fixRange=require("level-fix-range"),Hooks=require("level-hooks");module.exports=function(_db,options){function DB(){}function safeRange(fun){return function(opts){return opts=opts||{},opts=fixRange(opts),opts.reverse?opts.start=opts.start||sep:opts.end=opts.end||sep,fun.call(db,opts)}}DB.prototype=_db;var db=new DB;if(db.sublevel)return db;options=options||{};var sep=options.sep=options.sep||"";db._options=options,Hooks(db),db.sublevels={},db.sublevel=function(prefix,options){return db.sublevels[prefix]?db.sublevels[prefix]:new SubDb(db,prefix,options||this._options)},db.methods={},db.prefix=function(key){return""+(key||"")},db.pre=function(range,hook){return hook||(hook=range,range={max:sep}),db.hooks.pre(range,hook)},db.post=function(range,hook){return hook||(hook=range,range={max:sep}),db.hooks.post(range,hook)},db.readStream=db.createReadStream=safeRange(db.createReadStream),db.keyStream=db.createKeyStream=safeRange(db.createKeyStream),db.valuesStream=db.createValueStream=safeRange(db.createValueStream);var batch=db.batch;return db.batch=function(changes,opts,cb){return Array.isArray(changes)?(changes.forEach(function(e){e.prefix&&("function"==typeof e.prefix.prefix?e.key=e.prefix.prefix(e.key):"string"==typeof e.prefix&&(e.key=e.prefix+e.key))}),void batch.call(db,changes,opts,cb)):new Batch(db)},db}}).call(this,require("_process"))},{"./batch":63,"./sub":75,_process:134,events:130,"level-fix-range":65,"level-hooks":67}],65:[function(require,module,exports){var clone=require("clone");module.exports=function(opts){opts=clone(opts);var reverse=opts.reverse,end=opts.max||opts.end,start=opts.min||opts.start,range=[start,end];return null!=start&&null!=end&&range.sort(),reverse&&(range=range.reverse()),opts.start=range[0],opts.end=range[1],delete opts.min,delete opts.max,opts}},{clone:66}],66:[function(require,module,exports){(function(Buffer){"use strict";function objectToString(o){return Object.prototype.toString.call(o)}function clone(parent,circular,depth,prototype){function _clone(parent,depth){if(null===parent)return null;if(0==depth)return parent;var child,proto;if("object"!=typeof parent)return parent;if(util.isArray(parent))child=[];else if(util.isRegExp(parent))child=new RegExp(parent.source,util.getRegExpFlags(parent)),parent.lastIndex&&(child.lastIndex=parent.lastIndex);else if(util.isDate(parent))child=new Date(parent.getTime());else{if(useBuffer&&Buffer.isBuffer(parent))return child=new Buffer(parent.length),parent.copy(child),child;"undefined"==typeof prototype?(proto=Object.getPrototypeOf(parent),child=Object.create(proto)):(child=Object.create(prototype),proto=prototype)}if(circular){var index=allParents.indexOf(parent);if(-1!=index)return allChildren[index];allParents.push(parent),allChildren.push(child)}for(var i in parent){var attrs;proto&&(attrs=Object.getOwnPropertyDescriptor(proto,i)),attrs&&null==attrs.set||(child[i]=_clone(parent[i],depth-1))}return child}var allParents=[],allChildren=[],useBuffer="undefined"!=typeof Buffer;return"undefined"==typeof circular&&(circular=!0),"undefined"==typeof depth&&(depth=1/0),_clone(parent,depth)}var util={isArray:function(ar){return Array.isArray(ar)||"object"==typeof ar&&"[object Array]"===objectToString(ar)},isDate:function(d){return"object"==typeof d&&"[object Date]"===objectToString(d)},isRegExp:function(re){return"object"==typeof re&&"[object RegExp]"===objectToString(re)},getRegExpFlags:function(re){var flags="";return re.global&&(flags+="g"),re.ignoreCase&&(flags+="i"),re.multiline&&(flags+="m"),flags}};"object"==typeof module&&(module.exports=clone),clone.clonePrototype=function(parent){if(null===parent)return null;var c=function(){};return c.prototype=parent,new c}}).call(this,require("buffer").Buffer)},{buffer:126}],67:[function(require,module,exports){var ranges=require("string-range");module.exports=function(db){function getPrefix(p){return p&&("string"==typeof p?p:"string"==typeof p.prefix?p.prefix:"function"==typeof p.prefix?p.prefix():"")}function getKeyEncoding(db){return db&&db._getKeyEncoding?db._getKeyEncoding(db):void 0}function getValueEncoding(db){return db&&db._getValueEncoding?db._getValueEncoding(db):void 0}function remover(array,item){return function(){var i=array.indexOf(item);return~i?(array.splice(i,1),!0):!1}}function each(e){e&&e.type&&posthooks.forEach(function(h){h.test(e.key)&&h.hook(e)})}function callHooks(isBatch,b,opts,cb){try{b.forEach(function hook(e,i){prehooks.forEach(function(h){if(h.test(String(e.key))){var context={add:function(ch,db){if("undefined"==typeof ch)return this;if(ch===!1)return delete b[i];var prefix=getPrefix(ch.prefix)||getPrefix(db)||h.prefix||"";if(prefix&&(ch.prefix=prefix),ch.key=prefix+ch.key,h.safe&&h.test(String(ch.key)))throw new Error("prehook cannot insert into own range");var ke=ch.keyEncoding||getKeyEncoding(ch.prefix),ve=ch.valueEncoding||getValueEncoding(ch.prefix);return ke&&(ch.keyEncoding=ke),ve&&(ch.valueEncoding=ve),b.push(ch),hook(ch,b.length-1),this},put:function(ch,db){return"object"==typeof ch&&(ch.type="put"),this.add(ch,db)},del:function(ch,db){return"object"==typeof ch&&(ch.type="del"),this.add(ch,db)},veto:function(){return this.add(!1)}};h.hook.call(context,e,context.add,b)}})})}catch(err){return(cb||opts)(err)}if(b=b.filter(function(e){return e&&e.type}),1==b.length&&!isBatch){var change=b[0];return"put"==change.type?put.call(db,change.key,change.value,opts,cb):del.call(db,change.key,opts,cb)}return batch.call(db,b,opts,cb)}if(!db.hooks){var posthooks=[],prehooks=[];db.hooks={post:function(prefix,hook){hook||(hook=prefix,prefix="");var h={test:ranges.checker(prefix),hook:hook};return posthooks.push(h),remover(posthooks,h)},pre:function(prefix,hook){hook||(hook=prefix,prefix="");var h={test:ranges.checker(prefix),hook:hook,safe:!1!==prefix.safe};return prehooks.push(h),remover(prehooks,h)},posthooks:posthooks,prehooks:prehooks},db.on("put",function(key,val){each({type:"put",key:key,value:val})}),db.on("del",function(key,val){each({type:"del",key:key,value:val})}),db.on("batch",function(ary){ary.forEach(each)});var put=db.put,del=db.del,batch=db.batch;db.put=function(key,value,opts,cb){var batch=[{key:key,value:value,type:"put"}];return callHooks(!1,batch,opts,cb)},db.del=function(key,opts,cb){var batch=[{key:key,type:"del"}];return callHooks(!1,batch,opts,cb)},db.batch=function(batch,opts,cb){return callHooks(!0,batch,opts,cb)}}}},{"string-range":68}],68:[function(require,module,exports){var range=exports.range=function(obj){return null==obj?{}:"string"==typeof range?{min:range,max:range+""}:obj},checker=(exports.prefix=function(range,within,term){range=exports.range(range);var _range={};return term=term||"",range instanceof RegExp||"function"==typeof range?(_range.min=within,_range.max=within+term,_range.inner=function(k){var j=k.substring(within.length);return range.test?range.test(j):range(j)}):"object"==typeof range&&(_range.min=within+(range.min||range.start||""),_range.max=within+(range.max||range.end||term||"~"),_range.reverse=!!range.reverse),_range},exports.checker=function(range){return range||(range={}),"string"==typeof range?function(key){return 0==key.indexOf(range)}:range instanceof RegExp?function(key){return range.test(key)}:"object"==typeof range?function(key){var min=range.min||range.start,max=range.max||range.end;return key=String(key),(!min||key>=min)&&(!max||max>=key)&&(!range.inner||(range.inner.test?range.inner.test(key):range.inner(key)))}:"function"==typeof range?range:void 0});exports.satisfies=function(key,range){return checker(range)(key)}},{}],69:[function(require,module,exports){function hasKeys(source){return null!==source&&("object"==typeof source||"function"==typeof source)}module.exports=hasKeys},{}],70:[function(require,module,exports){function extend(){for(var target={},i=0;i<arguments.length;i++){var source=arguments[i];if(hasKeys(source))for(var keys=Keys(source),j=0;j<keys.length;j++){var name=keys[j];target[name]=source[name]}}return target}var Keys=require("object-keys"),hasKeys=require("./has-keys");module.exports=extend},{"./has-keys":69,"object-keys":71}],71:[function(require,module,exports){module.exports=Object.keys||require("./shim")},{"./shim":74}],72:[function(require,module,exports){var hasOwn=Object.prototype.hasOwnProperty,toString=Object.prototype.toString;module.exports=function(obj,fn,ctx){if("[object Function]"!==toString.call(fn))throw new TypeError("iterator must be a function");var l=obj.length;if(l===+l)for(var i=0;l>i;i++)fn.call(ctx,obj[i],i,obj);else for(var k in obj)hasOwn.call(obj,k)&&fn.call(ctx,obj[k],k,obj)}},{}],73:[function(require,module,exports){var objProto=Object.prototype,owns=objProto.hasOwnProperty,toString=objProto.toString,isActualNaN=function(value){return value!==value},NON_HOST_TYPES={"boolean":1,number:1,string:1,undefined:1},is=module.exports={};is.a=is.type=function(value,type){return typeof value===type},is.defined=function(value){return void 0!==value},is.empty=function(value){var key,type=toString.call(value);if("[object Array]"===type||"[object Arguments]"===type)return 0===value.length;if("[object Object]"===type){for(key in value)if(owns.call(value,key))return!1;return!0}return"[object String]"===type?""===value:!1},is.equal=function(value,other){var key,type=toString.call(value);if(type!==toString.call(other))return!1;if("[object Object]"===type){for(key in value)if(!is.equal(value[key],other[key]))return!1;return!0}if("[object Array]"===type){if(key=value.length,key!==other.length)return!1;for(;--key;)if(!is.equal(value[key],other[key]))return!1;return!0}return"[object Function]"===type?value.prototype===other.prototype:"[object Date]"===type?value.getTime()===other.getTime():value===other},is.hosted=function(value,host){var type=typeof host[value];return"object"===type?!!host[value]:!NON_HOST_TYPES[type]},is.instance=is["instanceof"]=function(value,constructor){return value instanceof constructor},is["null"]=function(value){return null===value},is.undefined=function(value){return void 0===value},is.arguments=function(value){var isStandardArguments="[object Arguments]"===toString.call(value),isOldArguments=!is.array(value)&&is.arraylike(value)&&is.object(value)&&is.fn(value.callee);return isStandardArguments||isOldArguments},is.array=function(value){return"[object Array]"===toString.call(value)},is.arguments.empty=function(value){return is.arguments(value)&&0===value.length},is.array.empty=function(value){return is.array(value)&&0===value.length},is.arraylike=function(value){return!!value&&!is["boolean"](value)&&owns.call(value,"length")&&isFinite(value.length)&&is.number(value.length)&&value.length>=0},is["boolean"]=function(value){return"[object Boolean]"===toString.call(value)},is["false"]=function(value){return is["boolean"](value)&&(value===!1||value.valueOf()===!1)},is["true"]=function(value){return is["boolean"](value)&&(value===!0||value.valueOf()===!0)},is.date=function(value){return"[object Date]"===toString.call(value)},is.element=function(value){return void 0!==value&&"undefined"!=typeof HTMLElement&&value instanceof HTMLElement&&1===value.nodeType},is.error=function(value){return"[object Error]"===toString.call(value)},is.fn=is["function"]=function(value){var isAlert="undefined"!=typeof window&&value===window.alert;return isAlert||"[object Function]"===toString.call(value)},is.number=function(value){return"[object Number]"===toString.call(value)},is.infinite=function(value){return value===1/0||value===-(1/0)},is.decimal=function(value){return is.number(value)&&!isActualNaN(value)&&!is.infinite(value)&&value%1!==0},is.divisibleBy=function(value,n){var isDividendInfinite=is.infinite(value),isDivisorInfinite=is.infinite(n),isNonZeroNumber=is.number(value)&&!isActualNaN(value)&&is.number(n)&&!isActualNaN(n)&&0!==n;return isDividendInfinite||isDivisorInfinite||isNonZeroNumber&&value%n===0},is["int"]=function(value){return is.number(value)&&!isActualNaN(value)&&value%1===0},is.maximum=function(value,others){if(isActualNaN(value))throw new TypeError("NaN is not a valid value");if(!is.arraylike(others))throw new TypeError("second argument must be array-like");for(var len=others.length;--len>=0;)if(value<others[len])return!1;return!0},is.minimum=function(value,others){if(isActualNaN(value))throw new TypeError("NaN is not a valid value");if(!is.arraylike(others))throw new TypeError("second argument must be array-like");for(var len=others.length;--len>=0;)if(value>others[len])return!1;return!0},is.nan=function(value){return!is.number(value)||value!==value},is.even=function(value){return is.infinite(value)||is.number(value)&&value===value&&value%2===0},is.odd=function(value){return is.infinite(value)||is.number(value)&&value===value&&value%2!==0},is.ge=function(value,other){if(isActualNaN(value)||isActualNaN(other))throw new TypeError("NaN is not a valid value");return!is.infinite(value)&&!is.infinite(other)&&value>=other},is.gt=function(value,other){if(isActualNaN(value)||isActualNaN(other))throw new TypeError("NaN is not a valid value");return!is.infinite(value)&&!is.infinite(other)&&value>other},is.le=function(value,other){if(isActualNaN(value)||isActualNaN(other))throw new TypeError("NaN is not a valid value");return!is.infinite(value)&&!is.infinite(other)&&other>=value},is.lt=function(value,other){if(isActualNaN(value)||isActualNaN(other))throw new TypeError("NaN is not a valid value");return!is.infinite(value)&&!is.infinite(other)&&other>value},is.within=function(value,start,finish){if(isActualNaN(value)||isActualNaN(start)||isActualNaN(finish))throw new TypeError("NaN is not a valid value");if(!is.number(value)||!is.number(start)||!is.number(finish))throw new TypeError("all arguments must be numbers");var isAnyInfinite=is.infinite(value)||is.infinite(start)||is.infinite(finish);return isAnyInfinite||value>=start&&finish>=value},is.object=function(value){return value&&"[object Object]"===toString.call(value)},is.hash=function(value){return is.object(value)&&value.constructor===Object&&!value.nodeType&&!value.setInterval},is.regexp=function(value){return"[object RegExp]"===toString.call(value)},is.string=function(value){return"[object String]"===toString.call(value)}},{}],74:[function(require,module,exports){!function(){"use strict";var keysShim,has=Object.prototype.hasOwnProperty,is=require("is"),forEach=require("foreach"),hasDontEnumBug=!{toString:null}.propertyIsEnumerable("toString"),dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"];keysShim=function(object){if(!is.object(object)&&!is.array(object))throw new TypeError("Object.keys called on a non-object");var name,theKeys=[];for(name in object)has.call(object,name)&&theKeys.push(name);return hasDontEnumBug&&forEach(dontEnums,function(dontEnum){has.call(object,dontEnum)&&theKeys.push(dontEnum)}),theKeys},module.exports=keysShim}()},{foreach:72,is:73}],75:[function(require,module,exports){function SubDB(db,prefix,options){if("string"==typeof options&&(console.error("db.sublevel(name, seperator<string>) is depreciated"),console.error("use db.sublevel(name, {sep: separator})) if you must"),options={sep:options}),!(this instanceof SubDB))return new SubDB(db,prefix,options);if(!db)throw new Error("must provide db");if(!prefix)throw new Error("must provide prefix");options=options||{},options.sep=options.sep||"",this._parent=db,this._options=options,this.options=options,this._prefix=prefix,this._root=root(this),db.sublevels[prefix]=this,this.sublevels={},this.methods={};var self=this;this.hooks={pre:function(){return self.pre.apply(self,arguments)},post:function(){return self.post.apply(self,arguments)}}}function selectivelyMerge(_opts,opts){["valueEncoding","encoding","keyEncoding","reverse","values","keys","limit","fillCache"].forEach(function(k){opts.hasOwnProperty(k)&&(_opts[k]=opts[k])})}function root(db){return db._parent?root(db._parent):db}var EventEmitter=require("events").EventEmitter,inherits=require("util").inherits,ranges=require("string-range"),fixRange=require("level-fix-range"),xtend=require("xtend"),Batch=require("./batch");inherits(SubDB,EventEmitter);var SDB=SubDB.prototype;SDB._key=function(key){var sep=this._options.sep;return sep+this._prefix+sep+key},SDB._getOptsAndCb=function(opts,cb){return"function"==typeof opts&&(cb=opts,opts={}),{opts:xtend(opts,this._options),cb:cb}},SDB.sublevel=function(prefix,options){return this.sublevels[prefix]?this.sublevels[prefix]:new SubDB(this,prefix,options||this._options)},SDB.put=function(key,value,opts,cb){var res=this._getOptsAndCb(opts,cb);this._root.put(this.prefix(key),value,res.opts,res.cb)},SDB.get=function(key,opts,cb){var res=this._getOptsAndCb(opts,cb);this._root.get(this.prefix(key),res.opts,res.cb)},SDB.del=function(key,opts,cb){var res=this._getOptsAndCb(opts,cb);this._root.del(this.prefix(key),res.opts,res.cb)},SDB.batch=function(changes,opts,cb){if(!Array.isArray(changes))return new Batch(this);var self=this,res=this._getOptsAndCb(opts,cb);changes.forEach(function(ch){"string"==typeof ch.prefix?ch.key=ch.prefix+ch.key:ch.key=(ch.prefix||self).prefix(ch.key),ch.prefix&&(ch.prefix=null)}),this._root.batch(changes,res.opts,res.cb)},SDB._getKeyEncoding=function(){return this.options.keyEncoding?this.options.keyEncoding:this._parent&&this._parent._getKeyEncoding?this._parent._getKeyEncoding():void 0},SDB._getValueEncoding=function(){return this.options.valueEncoding?this.options.valueEncoding:this._parent&&this._parent._getValueEncoding?this._parent._getValueEncoding():void 0},SDB.prefix=function(key){var sep=this._options.sep;return this._parent.prefix()+sep+this._prefix+sep+(key||"")},SDB.keyStream=SDB.createKeyStream=function(opts){return opts=opts||{},opts.keys=!0,opts.values=!1,this.createReadStream(opts)},SDB.valueStream=SDB.createValueStream=function(opts){return opts=opts||{},opts.keys=!1,opts.values=!0,opts.keys=!1,this.createReadStream(opts)},SDB.readStream=SDB.createReadStream=function(opts){opts=opts||{};var r=root(this),p=this.prefix(),_opts=ranges.prefix(opts,p);selectivelyMerge(_opts,xtend(opts,this._options));var s=r.createReadStream(_opts);if(_opts.values===!1){var read=s.read;if(read)s.read=function(size){var val=read.call(this,size);return val&&(val=val.substring(p.length)),val};else{var emit=s.emit;s.emit=function(event,val){"data"===event?emit.call(this,"data",val.substring(p.length)):emit.call(this,event,val)}}return s}if(_opts.keys===!1)return s;var read=s.read;return read?s.read=function(size){var d=read.call(this,size);return d&&(d.key=d.key.substring(p.length)),d}:s.on("data",function(d){d.key=d.key.substring(p.length)}),s},SDB.writeStream=SDB.createWriteStream=function(){var r=root(this),p=this.prefix(),ws=r.createWriteStream.apply(r,arguments),write=ws.write,encoding=this._options.encoding,valueEncoding=this._options.valueEncoding,keyEncoding=this._options.keyEncoding,nocheck=!encoding&&!valueEncoding&&!keyEncoding;return ws.write=nocheck?function(data){return data.key=p+data.key,write.call(ws,data)}:function(data){return data.key=p+data.key,encoding&&"undefined"==typeof data.encoding&&(data.encoding=encoding),valueEncoding&&"undefined"==typeof data.valueEncoding&&(data.valueEncoding=valueEncoding),keyEncoding&&"undefined"==typeof data.keyEncoding&&(data.keyEncoding=keyEncoding),write.call(ws,data)},ws},SDB.approximateSize=function(){var r=root(db);return r.approximateSize.apply(r,arguments)},SDB.pre=function(range,hook){hook||(hook=range,range=null),range=ranges.prefix(range,this.prefix(),this._options.sep);var r=root(this._parent),p=this.prefix();return r.hooks.pre(fixRange(range),function(ch,add,batch){hook({key:ch.key.substring(p.length),value:ch.value,type:ch.type},function(ch,_p){add(ch,ch.prefix?_p:_p||p)},batch)})},SDB.post=function(range,hook){hook||(hook=range,range=null);var r=root(this._parent),p=this.prefix();return range=ranges.prefix(range,p,this._options.sep),r.hooks.post(fixRange(range),function(data){hook({key:data.key.substring(p.length),value:data.value,type:data.type})})};module.exports=SubDB},{"./batch":63,events:130,"level-fix-range":65,"string-range":68,util:149,xtend:70}],76:[function(require,module,exports){function wrappy(fn,cb){function wrapper(){for(var args=new Array(arguments.length),i=0;i<args.length;i++)args[i]=arguments[i];var ret=fn.apply(this,args),cb=args[args.length-1];return"function"==typeof ret&&ret!==cb&&Object.keys(cb).forEach(function(k){ret[k]=cb[k]}),ret}if(fn&&cb)return wrappy(fn)(cb);if("function"!=typeof fn)throw new TypeError("need wrapper function");return Object.keys(fn).forEach(function(k){wrapper[k]=fn[k]}),wrapper}module.exports=wrappy},{}],77:[function(require,module,exports){function once(fn){var f=function(){return f.called?f.value:(f.called=!0,f.value=fn.apply(this,arguments))};return f.called=!1,f}var wrappy=require("wrappy");module.exports=wrappy(once),once.proto=once(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return once(this)},configurable:!0})})},{wrappy:76}],78:[function(require,module,exports){arguments[4][69][0].apply(exports,arguments)},{dup:69}],79:[function(require,module,exports){function extend(){for(var target={},i=0;i<arguments.length;i++){var source=arguments[i];if(hasKeys(source))for(var key in source)source.hasOwnProperty(key)&&(target[key]=source[key])}return target}var hasKeys=require("./has-keys");module.exports=extend},{"./has-keys":78}],80:[function(require,module,exports){(function(process){var path=require("path"),once=require("once"),concat=require("concat-stream"),stat=require("./stat"),xtend=require("xtend"),errno=require("./errno"),ROOT=stat({type:"directory",mode:511,size:4096}),normalize=function(key){return key="/"===key[0]?key:"/"+key,key=path.normalize(key),"/"===key?key:"/"===key[key.length-1]?key.slice(0,-1):key},prefix=function(key){var depth=key.split("/").length.toString(36);return"0000000000".slice(depth.length)+depth+key};module.exports=function(db){var that={};that.normalize=normalize,that.get=function(key,cb){return key=normalize(key),"/"===key?process.nextTick(cb.bind(null,null,ROOT,"/")):void db.get(prefix(key),{valueEncoding:"json"},function(err,doc){return err&&err.notFound?cb(errno.ENOENT(key),null,key):err?cb(err,null,key):void cb(null,stat(doc),key)})},that.writable=function(key,cb){return key=normalize(key),"/"===key?process.nextTick(cb.bind(null,errno.EPERM(key))):void that.follow(path.dirname(key),function(err,parent){return err?cb(err):parent.isDirectory()?void cb(null,key):cb(errno.ENOTDIR(key))})},that.list=function(key,cb){key=normalize(key);var start=prefix("/"===key?key:key+"/"),keys=db.createKeyStream({start:start,end:start+""});cb=once(cb),keys.on("error",cb),keys.pipe(concat({encoding:"object"},function(files){files=files.map(function(file){return file.split("/").pop()}),cb(null,files)}))};var resolve=function(dir,cb){var root="/",parts=dir.split("/").slice(1),loop=function(){that.get(path.join(root,parts.shift()),function(err,doc,key){return err?cb(err,doc,dir):(root=doc.target||key,parts.length?void loop():cb(null,doc,key))})};loop()};return that.follow=function(key,cb){resolve(normalize(key),function loop(err,doc,key){return err?cb(err,null,key):doc.target?that.get(doc.target,loop):void cb(null,stat(doc),key)})},that.update=function(key,opts,cb){that.get(key,function(err,doc,key){return err?cb(err):"/"===key?cb(errno.EPERM(key)):void that.put(key,xtend(doc,opts),cb)})},that.put=function(key,opts,cb){that.writable(key,function(err,key){return err?cb(err):void db.put(prefix(key),stat(opts),{valueEncoding:"json"},cb)})},that.del=function(key,cb){return key=normalize(key),"/"===key?process.nextTick(cb.bind(null,errno.EPERM(key))):void db.del(prefix(key),cb)},that}}).call(this,require("_process"))},{"./errno":17,"./stat":81,_process:134,"concat-stream":19,once:77,path:133,xtend:79}],81:[function(require,module,exports){var toDate=function(date){return date?"string"==typeof date?new Date(date):date:new Date},Stat=function(opts){this.uid=opts.uid||0,this.gid=opts.gid||0,this.mode=opts.mode||0,this.size=opts.size||0,this.mtime=toDate(opts.mtime),this.atime=toDate(opts.atime),this.ctime=toDate(opts.ctime),this.type=opts.type,this.target=opts.target,this.link=opts.link,this.blob=opts.blob};Stat.prototype.isDirectory=function(){return"directory"===this.type},Stat.prototype.isFile=function(){return"file"===this.type},Stat.prototype.isBlockDevice=function(){return!1},Stat.prototype.isCharacterDevice=function(){return!1},Stat.prototype.isSymbolicLink=function(){return"symlink"===this.type},Stat.prototype.isFIFO=function(){return!1},Stat.prototype.isSocket=function(){return!1},module.exports=function(opts){return new Stat(opts)}},{}],82:[function(require,module,exports){var events=require("events");module.exports=function(){var listeners={},that=new events.EventEmitter;return that.watch=function(key,cb){return listeners[key]||(listeners[key]=new events.EventEmitter,listeners[key].setMaxListeners(0)),cb&&listeners[key].on("change",cb),listeners[key]},that.watcher=function(key,cb){var watcher=new events.EventEmitter,onchange=function(){watcher.emit("change","change",key)};return that.watch(key,onchange),cb&&watcher.on("change",cb),watcher.close=function(){that.unwatch(key,onchange)},watcher},that.unwatch=function(key,cb){listeners[key]&&(cb?listeners[key].removeListener("change",cb):listeners[key].removeAllListeners("change"),listeners[key].listeners("change").length||delete listeners[key])},that.change=function(key){listeners[key]&&listeners[key].emit("change"),that.emit("change",key)},that.cb=function(key,cb){return function(err,val){key&&that.change(key),cb&&cb(err,val)}},that}},{events:130}],83:[function(require,module,exports){(function(Buffer){function Level(location){if(!(this instanceof Level))return new Level(location);if(!location)throw new Error("constructor requires at least a location argument");this.IDBOptions={},this.location=location}module.exports=Level;var IDB=require("idb-wrapper"),AbstractLevelDOWN=require("abstract-leveldown").AbstractLevelDOWN,util=require("util"),Iterator=require("./iterator"),isBuffer=require("isbuffer"),xtend=require("xtend"),toBuffer=require("typedarray-to-buffer");util.inherits(Level,AbstractLevelDOWN),Level.prototype._open=function(options,callback){var self=this,idbOpts={storeName:this.location,autoIncrement:!1,keyPath:null,onStoreReady:function(){callback&&callback(null,self.idb)},onError:function(err){callback&&callback(err)}};xtend(idbOpts,options),this.IDBOptions=idbOpts,this.idb=new IDB(idbOpts)},Level.prototype._get=function(key,options,callback){this.idb.get(key,function(value){if(void 0===value)return callback(new Error("NotFound"));var asBuffer=!0;return options.asBuffer===!1&&(asBuffer=!1),options.raw&&(asBuffer=!1),asBuffer&&(value=value instanceof Uint8Array?toBuffer(value):new Buffer(String(value))),callback(null,value,key)},callback)},Level.prototype._del=function(id,options,callback){this.idb.remove(id,callback,callback)},Level.prototype._put=function(key,value,options,callback){value instanceof ArrayBuffer&&(value=toBuffer(new Uint8Array(value)));var obj=this.convertEncoding(key,value,options);Buffer.isBuffer(obj.value)&&(obj.value=new Uint8Array(value.toArrayBuffer())),this.idb.put(obj.key,obj.value,function(){callback()},callback)},Level.prototype.convertEncoding=function(key,value,options){if(options.raw)return{key:key,value:value};if(value){var stringed=value.toString();"NaN"===stringed&&(value="NaN")}var valEnc=options.valueEncoding,obj={key:key,value:value};return!value||valEnc&&"binary"===valEnc||"object"!=typeof obj.value&&(obj.value=stringed),obj},Level.prototype.iterator=function(options){return"object"!=typeof options&&(options={}),new Iterator(this.idb,options)},Level.prototype._batch=function(array,options,callback){var i,k,copiedOp,currentOp,modified=[];if(0===array.length)return setTimeout(callback,0);for(i=0;i<array.length;i++){copiedOp={},currentOp=array[i],modified[i]=copiedOp;var converted=this.convertEncoding(currentOp.key,currentOp.value,options);currentOp.key=converted.key,currentOp.value=converted.value;for(k in currentOp)"type"===k&&"del"==currentOp[k]?copiedOp[k]="remove":copiedOp[k]=currentOp[k]}return this.idb.batch(modified,function(){callback()},callback)},Level.prototype._close=function(callback){this.idb.db.close(),callback()},Level.prototype._approximateSize=function(start,end,callback){
var err=new Error("Not implemented");if(callback)return callback(err);throw err},Level.prototype._isBuffer=function(obj){return Buffer.isBuffer(obj)},Level.destroy=function(db,callback){if("object"==typeof db)var prefix=db.IDBOptions.storePrefix||"IDBWrapper-",dbname=db.location;else var prefix="IDBWrapper-",dbname=db;var request=indexedDB.deleteDatabase(prefix+dbname);request.onsuccess=function(){callback()},request.onerror=function(err){callback(err)}};Level.prototype._checkKeyValue=function(obj,type){return null===obj||void 0===obj?new Error(type+" cannot be `null` or `undefined`"):null===obj||void 0===obj?new Error(type+" cannot be `null` or `undefined`"):isBuffer(obj)&&0===obj.byteLength?new Error(type+" cannot be an empty ArrayBuffer"):""===String(obj)?new Error(type+" cannot be an empty String"):0===obj.length?new Error(type+" cannot be an empty Array"):void 0}}).call(this,require("buffer").Buffer)},{"./iterator":84,"abstract-leveldown":87,buffer:126,"idb-wrapper":89,isbuffer:90,"typedarray-to-buffer":92,util:149,xtend:94}],84:[function(require,module,exports){function Iterator(db,options){options||(options={}),this.options=options,AbstractIterator.call(this,db),this._order=options.reverse?"DESC":"ASC",this._limit=options.limit,this._count=0,this._done=!1;var lower=ltgt.lowerBound(options),upper=ltgt.upperBound(options);this._keyRange=lower||upper?this.db.makeKeyRange({lower:lower,upper:upper,excludeLower:ltgt.lowerBoundExclusive(options),excludeUpper:ltgt.upperBoundExclusive(options)}):null,this.callback=null}var util=require("util"),AbstractIterator=require("abstract-leveldown").AbstractIterator,ltgt=require("ltgt");module.exports=Iterator,util.inherits(Iterator,AbstractIterator),Iterator.prototype.createIterator=function(){var self=this;self.iterator=self.db.iterate(function(){self.onItem.apply(self,arguments)},{keyRange:self._keyRange,autoContinue:!1,order:self._order,onError:function(err){console.log("horrible error",err)}})},Iterator.prototype.onItem=function(value,cursor,cursorTransaction){if(!cursor&&this.callback)return this.callback(),void(this.callback=!1);var shouldCall=!0;this._limit&&this._limit>0&&this._count++>=this._limit&&(shouldCall=!1),shouldCall&&this.callback(!1,cursor.key,cursor.value),cursor&&cursor["continue"]()},Iterator.prototype._next=function(callback){return callback?(this._started||(this.createIterator(),this._started=!0),void(this.callback=callback)):new Error("next() requires a callback argument")}},{"abstract-leveldown":87,ltgt:91,util:149}],85:[function(require,module,exports){(function(process){function AbstractChainedBatch(db){this._db=db,this._operations=[],this._written=!1}AbstractChainedBatch.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")},AbstractChainedBatch.prototype.put=function(key,value){this._checkWritten();var err=this._db._checkKeyValue(key,"key",this._db._isBuffer);if(err)throw err;if(err=this._db._checkKeyValue(value,"value",this._db._isBuffer))throw err;return this._db._isBuffer(key)||(key=String(key)),this._db._isBuffer(value)||(value=String(value)),"function"==typeof this._put?this._put(key,value):this._operations.push({type:"put",key:key,value:value}),this},AbstractChainedBatch.prototype.del=function(key){this._checkWritten();var err=this._db._checkKeyValue(key,"key",this._db._isBuffer);if(err)throw err;return this._db._isBuffer(key)||(key=String(key)),"function"==typeof this._del?this._del(key):this._operations.push({type:"del",key:key}),this},AbstractChainedBatch.prototype.clear=function(){return this._checkWritten(),this._operations=[],"function"==typeof this._clear&&this._clear(),this},AbstractChainedBatch.prototype.write=function(options,callback){if(this._checkWritten(),"function"==typeof options&&(callback=options),"function"!=typeof callback)throw new Error("write() requires a callback argument");return"object"!=typeof options&&(options={}),this._written=!0,"function"==typeof this._write?this._write(callback):"function"==typeof this._db._batch?this._db._batch(this._operations,options,callback):void process.nextTick(callback)},module.exports=AbstractChainedBatch}).call(this,require("_process"))},{_process:134}],86:[function(require,module,exports){(function(process){function AbstractIterator(db){this.db=db,this._ended=!1,this._nexting=!1}AbstractIterator.prototype.next=function(callback){var self=this;if("function"!=typeof callback)throw new Error("next() requires a callback argument");return self._ended?callback(new Error("cannot call next() after end()")):self._nexting?callback(new Error("cannot call next() before previous next() has completed")):(self._nexting=!0,"function"==typeof self._next?self._next(function(){self._nexting=!1,callback.apply(null,arguments)}):void process.nextTick(function(){self._nexting=!1,callback()}))},AbstractIterator.prototype.end=function(callback){if("function"!=typeof callback)throw new Error("end() requires a callback argument");return this._ended?callback(new Error("end() already called on iterator")):(this._ended=!0,"function"==typeof this._end?this._end(callback):void process.nextTick(callback))},module.exports=AbstractIterator}).call(this,require("_process"))},{_process:134}],87:[function(require,module,exports){(function(process,Buffer){function AbstractLevelDOWN(location){if(!arguments.length||void 0===location)throw new Error("constructor requires at least a location argument");if("string"!=typeof location)throw new Error("constructor requires a location string argument");this.location=location}var xtend=require("xtend"),AbstractIterator=require("./abstract-iterator"),AbstractChainedBatch=require("./abstract-chained-batch");AbstractLevelDOWN.prototype.open=function(options,callback){if("function"==typeof options&&(callback=options),"function"!=typeof callback)throw new Error("open() requires a callback argument");return"object"!=typeof options&&(options={}),"function"==typeof this._open?this._open(options,callback):void process.nextTick(callback)},AbstractLevelDOWN.prototype.close=function(callback){if("function"!=typeof callback)throw new Error("close() requires a callback argument");return"function"==typeof this._close?this._close(callback):void process.nextTick(callback)},AbstractLevelDOWN.prototype.get=function(key,options,callback){var err;if("function"==typeof options&&(callback=options),"function"!=typeof callback)throw new Error("get() requires a callback argument");return(err=this._checkKeyValue(key,"key",this._isBuffer))?callback(err):(this._isBuffer(key)||(key=String(key)),"object"!=typeof options&&(options={}),"function"==typeof this._get?this._get(key,options,callback):void process.nextTick(function(){callback(new Error("NotFound"))}))},AbstractLevelDOWN.prototype.put=function(key,value,options,callback){var err;if("function"==typeof options&&(callback=options),"function"!=typeof callback)throw new Error("put() requires a callback argument");return(err=this._checkKeyValue(key,"key",this._isBuffer))?callback(err):(err=this._checkKeyValue(value,"value",this._isBuffer))?callback(err):(this._isBuffer(key)||(key=String(key)),this._isBuffer(value)||process.browser||(value=String(value)),"object"!=typeof options&&(options={}),"function"==typeof this._put?this._put(key,value,options,callback):void process.nextTick(callback))},AbstractLevelDOWN.prototype.del=function(key,options,callback){var err;if("function"==typeof options&&(callback=options),"function"!=typeof callback)throw new Error("del() requires a callback argument");return(err=this._checkKeyValue(key,"key",this._isBuffer))?callback(err):(this._isBuffer(key)||(key=String(key)),"object"!=typeof options&&(options={}),"function"==typeof this._del?this._del(key,options,callback):void process.nextTick(callback))},AbstractLevelDOWN.prototype.batch=function(array,options,callback){if(!arguments.length)return this._chainedBatch();if("function"==typeof options&&(callback=options),"function"!=typeof callback)throw new Error("batch(array) requires a callback argument");if(!Array.isArray(array))return callback(new Error("batch(array) requires an array argument"));"object"!=typeof options&&(options={});for(var e,err,i=0,l=array.length;l>i;i++)if(e=array[i],"object"==typeof e){if(err=this._checkKeyValue(e.type,"type",this._isBuffer))return callback(err);if(err=this._checkKeyValue(e.key,"key",this._isBuffer))return callback(err);if("put"==e.type&&(err=this._checkKeyValue(e.value,"value",this._isBuffer)))return callback(err)}return"function"==typeof this._batch?this._batch(array,options,callback):void process.nextTick(callback)},AbstractLevelDOWN.prototype.approximateSize=function(start,end,callback){if(null==start||null==end||"function"==typeof start||"function"==typeof end)throw new Error("approximateSize() requires valid `start`, `end` and `callback` arguments");if("function"!=typeof callback)throw new Error("approximateSize() requires a callback argument");return this._isBuffer(start)||(start=String(start)),this._isBuffer(end)||(end=String(end)),"function"==typeof this._approximateSize?this._approximateSize(start,end,callback):void process.nextTick(function(){callback(null,0)})},AbstractLevelDOWN.prototype._setupIteratorOptions=function(options){var self=this;return options=xtend(options),["start","end","gt","gte","lt","lte"].forEach(function(o){options[o]&&self._isBuffer(options[o])&&0===options[o].length&&delete options[o]}),options.reverse=!!options.reverse,options.reverse&&options.lt&&(options.start=options.lt),options.reverse&&options.lte&&(options.start=options.lte),!options.reverse&&options.gt&&(options.start=options.gt),!options.reverse&&options.gte&&(options.start=options.gte),(options.reverse&&options.lt&&!options.lte||!options.reverse&&options.gt&&!options.gte)&&(options.exclusiveStart=!0),options},AbstractLevelDOWN.prototype.iterator=function(options){return"object"!=typeof options&&(options={}),options=this._setupIteratorOptions(options),"function"==typeof this._iterator?this._iterator(options):new AbstractIterator(this)},AbstractLevelDOWN.prototype._chainedBatch=function(){return new AbstractChainedBatch(this)},AbstractLevelDOWN.prototype._isBuffer=function(obj){return Buffer.isBuffer(obj)},AbstractLevelDOWN.prototype._checkKeyValue=function(obj,type){if(null===obj||void 0===obj)return new Error(type+" cannot be `null` or `undefined`");if(this._isBuffer(obj)){if(0===obj.length)return new Error(type+" cannot be an empty Buffer")}else if(""===String(obj))return new Error(type+" cannot be an empty String")},module.exports.AbstractLevelDOWN=AbstractLevelDOWN,module.exports.AbstractIterator=AbstractIterator,module.exports.AbstractChainedBatch=AbstractChainedBatch}).call(this,require("_process"),require("buffer").Buffer)},{"./abstract-chained-batch":85,"./abstract-iterator":86,_process:134,buffer:126,xtend:88}],88:[function(require,module,exports){function extend(){for(var target={},i=0;i<arguments.length;i++){var source=arguments[i];for(var key in source)source.hasOwnProperty(key)&&(target[key]=source[key])}return target}module.exports=extend},{}],89:[function(require,module,exports){!function(name,definition,global){"function"==typeof define?define(definition):"undefined"!=typeof module&&module.exports?module.exports=definition():global[name]=definition()}("IDBStore",function(){"use strict";var defaultErrorHandler=function(error){throw error},defaultSuccessHandler=function(){},defaults={storeName:"Store",storePrefix:"IDBWrapper-",dbVersion:1,keyPath:"id",autoIncrement:!0,onStoreReady:function(){},onError:defaultErrorHandler,indexes:[]},IDBStore=function(kwArgs,onStoreReady){"undefined"==typeof onStoreReady&&"function"==typeof kwArgs&&(onStoreReady=kwArgs),"[object Object]"!=Object.prototype.toString.call(kwArgs)&&(kwArgs={});for(var key in defaults)this[key]="undefined"!=typeof kwArgs[key]?kwArgs[key]:defaults[key];this.dbName=this.storePrefix+this.storeName,this.dbVersion=parseInt(this.dbVersion,10)||1,onStoreReady&&(this.onStoreReady=onStoreReady);var env="object"==typeof window?window:self;this.idb=env.indexedDB||env.webkitIndexedDB||env.mozIndexedDB||env.shimIndexedDB,this.keyRange=env.IDBKeyRange||env.webkitIDBKeyRange||env.mozIDBKeyRange,this.features={hasAutoIncrement:!env.mozIndexedDB},this.consts={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange",NEXT:"next",NEXT_NO_DUPLICATE:"nextunique",PREV:"prev",PREV_NO_DUPLICATE:"prevunique"},this.openDB()};IDBStore.prototype={constructor:IDBStore,version:"1.5",db:null,dbName:null,dbVersion:null,store:null,storeName:null,storePrefix:null,keyPath:null,autoIncrement:null,indexes:null,features:null,onStoreReady:null,onError:null,_insertIdCount:0,openDB:function(){var openRequest=this.idb.open(this.dbName,this.dbVersion),preventSuccessCallback=!1;openRequest.onerror=function(error){var gotVersionErr=!1;"error"in error.target?gotVersionErr="VersionError"==error.target.error.name:"errorCode"in error.target&&(gotVersionErr=12==error.target.errorCode),gotVersionErr?this.onError(new Error("The version number provided is lower than the existing one.")):this.onError(error)}.bind(this),openRequest.onsuccess=function(event){if(!preventSuccessCallback){if(this.db)return void this.onStoreReady();if(this.db=event.target.result,"string"==typeof this.db.version)return void this.onError(new Error("The IndexedDB implementation in this browser is outdated. Please upgrade your browser."));if(!this.db.objectStoreNames.contains(this.storeName))return void this.onError(new Error("Something is wrong with the IndexedDB implementation in this browser. Please upgrade your browser."));var emptyTransaction=this.db.transaction([this.storeName],this.consts.READ_ONLY);this.store=emptyTransaction.objectStore(this.storeName);var existingIndexes=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(indexData){var indexName=indexData.name;if(!indexName)return preventSuccessCallback=!0,void this.onError(new Error("Cannot create index: No index name given."));if(this.normalizeIndexData(indexData),this.hasIndex(indexName)){var actualIndex=this.store.index(indexName),complies=this.indexComplies(actualIndex,indexData);complies||(preventSuccessCallback=!0,this.onError(new Error('Cannot modify index "'+indexName+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))),existingIndexes.splice(existingIndexes.indexOf(indexName),1)}else preventSuccessCallback=!0,this.onError(new Error('Cannot create new index "'+indexName+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))},this),existingIndexes.length&&(preventSuccessCallback=!0,this.onError(new Error('Cannot delete index(es) "'+existingIndexes.toString()+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))),preventSuccessCallback||this.onStoreReady()}}.bind(this),openRequest.onupgradeneeded=function(event){if(this.db=event.target.result,this.db.objectStoreNames.contains(this.storeName))this.store=event.target.transaction.objectStore(this.storeName);else{var optionalParameters={autoIncrement:this.autoIncrement};null!==this.keyPath&&(optionalParameters.keyPath=this.keyPath),this.store=this.db.createObjectStore(this.storeName,optionalParameters)}var existingIndexes=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(indexData){var indexName=indexData.name;if(indexName||(preventSuccessCallback=!0,this.onError(new Error("Cannot create index: No index name given."))),this.normalizeIndexData(indexData),this.hasIndex(indexName)){var actualIndex=this.store.index(indexName),complies=this.indexComplies(actualIndex,indexData);complies||(this.store.deleteIndex(indexName),this.store.createIndex(indexName,indexData.keyPath,{unique:indexData.unique,multiEntry:indexData.multiEntry})),existingIndexes.splice(existingIndexes.indexOf(indexName),1)}else this.store.createIndex(indexName,indexData.keyPath,{unique:indexData.unique,multiEntry:indexData.multiEntry})},this),existingIndexes.length&&existingIndexes.forEach(function(_indexName){this.store.deleteIndex(_indexName)},this)}.bind(this)},deleteDatabase:function(onSuccess,onError){if(this.idb.deleteDatabase){this.db.close();var deleteRequest=this.idb.deleteDatabase(this.dbName);deleteRequest.onsuccess=onSuccess,deleteRequest.onerror=onError}else onError(new Error("Browser does not support IndexedDB deleteDatabase!"))},put:function(key,value,onSuccess,onError){null!==this.keyPath&&(onError=onSuccess,onSuccess=value,value=key),onError||(onError=defaultErrorHandler),onSuccess||(onSuccess=defaultSuccessHandler);var putRequest,hasSuccess=!1,result=null,putTransaction=this.db.transaction([this.storeName],this.consts.READ_WRITE);return putTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)},putTransaction.onabort=onError,putTransaction.onerror=onError,null!==this.keyPath?(this._addIdPropertyIfNeeded(value),putRequest=putTransaction.objectStore(this.storeName).put(value)):putRequest=putTransaction.objectStore(this.storeName).put(value,key),putRequest.onsuccess=function(event){hasSuccess=!0,result=event.target.result},putRequest.onerror=onError,putTransaction},get:function(key,onSuccess,onError){onError||(onError=defaultErrorHandler),onSuccess||(onSuccess=defaultSuccessHandler);var hasSuccess=!1,result=null,getTransaction=this.db.transaction([this.storeName],this.consts.READ_ONLY);getTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)},getTransaction.onabort=onError,getTransaction.onerror=onError;var getRequest=getTransaction.objectStore(this.storeName).get(key);return getRequest.onsuccess=function(event){hasSuccess=!0,result=event.target.result},getRequest.onerror=onError,getTransaction},remove:function(key,onSuccess,onError){onError||(onError=defaultErrorHandler),onSuccess||(onSuccess=defaultSuccessHandler);var hasSuccess=!1,result=null,removeTransaction=this.db.transaction([this.storeName],this.consts.READ_WRITE);removeTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)},removeTransaction.onabort=onError,removeTransaction.onerror=onError;var deleteRequest=removeTransaction.objectStore(this.storeName)["delete"](key);return deleteRequest.onsuccess=function(event){hasSuccess=!0,result=event.target.result},deleteRequest.onerror=onError,removeTransaction},batch:function(dataArray,onSuccess,onError){onError||(onError=defaultErrorHandler),onSuccess||(onSuccess=defaultSuccessHandler),"[object Array]"!=Object.prototype.toString.call(dataArray)&&onError(new Error("dataArray argument must be of type Array."));var batchTransaction=this.db.transaction([this.storeName],this.consts.READ_WRITE);batchTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(hasSuccess)},batchTransaction.onabort=onError,batchTransaction.onerror=onError;var count=dataArray.length,called=!1,hasSuccess=!1,onItemSuccess=function(){count--,0!==count||called||(called=!0,hasSuccess=!0)};return dataArray.forEach(function(operation){var type=operation.type,key=operation.key,value=operation.value,onItemError=function(err){batchTransaction.abort(),called||(called=!0,onError(err,type,key))};if("remove"==type){var deleteRequest=batchTransaction.objectStore(this.storeName)["delete"](key);deleteRequest.onsuccess=onItemSuccess,deleteRequest.onerror=onItemError}else if("put"==type){var putRequest;null!==this.keyPath?(this._addIdPropertyIfNeeded(value),putRequest=batchTransaction.objectStore(this.storeName).put(value)):putRequest=batchTransaction.objectStore(this.storeName).put(value,key),putRequest.onsuccess=onItemSuccess,putRequest.onerror=onItemError}},this),batchTransaction},putBatch:function(dataArray,onSuccess,onError){var batchData=dataArray.map(function(item){return{type:"put",value:item}});return this.batch(batchData,onSuccess,onError)},upsertBatch:function(dataArray,options,onSuccess,onError){"function"==typeof options&&(onSuccess=options,onError=onSuccess,options={}),onError||(onError=defaultErrorHandler),onSuccess||(onSuccess=defaultSuccessHandler),options||(options={}),"[object Array]"!=Object.prototype.toString.call(dataArray)&&onError(new Error("dataArray argument must be of type Array."));var batchTransaction=this.db.transaction([this.storeName],this.consts.READ_WRITE);batchTransaction.oncomplete=function(){hasSuccess?onSuccess(dataArray):onError(!1)},batchTransaction.onabort=onError,batchTransaction.onerror=onError;var keyField=options.keyField||this.keyPath,count=dataArray.length,called=!1,hasSuccess=!1,index=0,onItemSuccess=function(event){var record=dataArray[index++];record[keyField]=event.target.result,count--,0!==count||called||(called=!0,hasSuccess=!0)};return dataArray.forEach(function(record){var putRequest,key=record.key,onItemError=function(err){batchTransaction.abort(),called||(called=!0,onError(err))};null!==this.keyPath?(this._addIdPropertyIfNeeded(record),putRequest=batchTransaction.objectStore(this.storeName).put(record)):putRequest=batchTransaction.objectStore(this.storeName).put(record,key),putRequest.onsuccess=onItemSuccess,putRequest.onerror=onItemError},this),batchTransaction},removeBatch:function(keyArray,onSuccess,onError){var batchData=keyArray.map(function(key){return{type:"remove",key:key}});return this.batch(batchData,onSuccess,onError)},getBatch:function(keyArray,onSuccess,onError,arrayType){onError||(onError=defaultErrorHandler),onSuccess||(onSuccess=defaultSuccessHandler),arrayType||(arrayType="sparse"),"[object Array]"!=Object.prototype.toString.call(keyArray)&&onError(new Error("keyArray argument must be of type Array."));var batchTransaction=this.db.transaction([this.storeName],this.consts.READ_ONLY);batchTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)},batchTransaction.onabort=onError,batchTransaction.onerror=onError;var data=[],count=keyArray.length,called=!1,hasSuccess=!1,result=null,onItemSuccess=function(event){event.target.result||"dense"==arrayType?data.push(event.target.result):"sparse"==arrayType&&data.length++,count--,0===count&&(called=!0,hasSuccess=!0,result=data)};return keyArray.forEach(function(key){var onItemError=function(err){called=!0,result=err,onError(err),batchTransaction.abort()},getRequest=batchTransaction.objectStore(this.storeName).get(key);getRequest.onsuccess=onItemSuccess,getRequest.onerror=onItemError},this),batchTransaction},getAll:function(onSuccess,onError){onError||(onError=defaultErrorHandler),onSuccess||(onSuccess=defaultSuccessHandler);var getAllTransaction=this.db.transaction([this.storeName],this.consts.READ_ONLY),store=getAllTransaction.objectStore(this.storeName);return store.getAll?this._getAllNative(getAllTransaction,store,onSuccess,onError):this._getAllCursor(getAllTransaction,store,onSuccess,onError),getAllTransaction},_getAllNative:function(getAllTransaction,store,onSuccess,onError){var hasSuccess=!1,result=null;getAllTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)},getAllTransaction.onabort=onError,getAllTransaction.onerror=onError;var getAllRequest=store.getAll();getAllRequest.onsuccess=function(event){hasSuccess=!0,result=event.target.result},getAllRequest.onerror=onError},_getAllCursor:function(getAllTransaction,store,onSuccess,onError){var all=[],hasSuccess=!1,result=null;getAllTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)},getAllTransaction.onabort=onError,getAllTransaction.onerror=onError;var cursorRequest=store.openCursor();cursorRequest.onsuccess=function(event){var cursor=event.target.result;cursor?(all.push(cursor.value),cursor["continue"]()):(hasSuccess=!0,result=all)},cursorRequest.onError=onError},clear:function(onSuccess,onError){onError||(onError=defaultErrorHandler),onSuccess||(onSuccess=defaultSuccessHandler);var hasSuccess=!1,result=null,clearTransaction=this.db.transaction([this.storeName],this.consts.READ_WRITE);clearTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)},clearTransaction.onabort=onError,clearTransaction.onerror=onError;var clearRequest=clearTransaction.objectStore(this.storeName).clear();return clearRequest.onsuccess=function(event){hasSuccess=!0,result=event.target.result},clearRequest.onerror=onError,clearTransaction},_addIdPropertyIfNeeded:function(dataObj){this.features.hasAutoIncrement||"undefined"!=typeof dataObj[this.keyPath]||(dataObj[this.keyPath]=this._insertIdCount++ +Date.now())},getIndexList:function(){return this.store.indexNames},hasIndex:function(indexName){return this.store.indexNames.contains(indexName)},normalizeIndexData:function(indexData){indexData.keyPath=indexData.keyPath||indexData.name,indexData.unique=!!indexData.unique,indexData.multiEntry=!!indexData.multiEntry},indexComplies:function(actual,expected){var complies=["keyPath","unique","multiEntry"].every(function(key){if("multiEntry"==key&&void 0===actual[key]&&expected[key]===!1)return!0;if("keyPath"==key&&"[object Array]"==Object.prototype.toString.call(expected[key])){var exp=expected.keyPath,act=actual.keyPath;if("string"==typeof act)return exp.toString()==act;if("function"!=typeof act.contains&&"function"!=typeof act.indexOf)return!1;if(act.length!==exp.length)return!1;for(var i=0,m=exp.length;m>i;i++)if(!(act.contains&&act.contains(exp[i])||act.indexOf(-1!==exp[i])))return!1;return!0}return expected[key]==actual[key]});return complies},iterate:function(onItem,options){options=mixin({index:null,order:"ASC",autoContinue:!0,filterDuplicates:!1,keyRange:null,writeAccess:!1,onEnd:null,onError:defaultErrorHandler,limit:1/0,offset:0},options||{});var directionType="desc"==options.order.toLowerCase()?"PREV":"NEXT";options.filterDuplicates&&(directionType+="_NO_DUPLICATE");var hasSuccess=!1,cursorTransaction=this.db.transaction([this.storeName],this.consts[options.writeAccess?"READ_WRITE":"READ_ONLY"]),cursorTarget=cursorTransaction.objectStore(this.storeName);options.index&&(cursorTarget=cursorTarget.index(options.index));var recordCount=0;cursorTransaction.oncomplete=function(){return hasSuccess?void(options.onEnd?options.onEnd():onItem(null)):void options.onError(null)},cursorTransaction.onabort=options.onError,cursorTransaction.onerror=options.onError;var cursorRequest=cursorTarget.openCursor(options.keyRange,this.consts[directionType]);return cursorRequest.onerror=options.onError,cursorRequest.onsuccess=function(event){var cursor=event.target.result;cursor?options.offset?(cursor.advance(options.offset),options.offset=0):(onItem(cursor.value,cursor,cursorTransaction),recordCount++,options.autoContinue&&(recordCount+options.offset<options.limit?cursor["continue"]():hasSuccess=!0)):hasSuccess=!0},cursorTransaction},query:function(onSuccess,options){var result=[];return options=options||{},options.autoContinue=!0,options.writeAccess=!1,options.onEnd=function(){onSuccess(result)},this.iterate(function(item){result.push(item)},options)},count:function(onSuccess,options){options=mixin({index:null,keyRange:null},options||{});var onError=options.onError||defaultErrorHandler,hasSuccess=!1,result=null,cursorTransaction=this.db.transaction([this.storeName],this.consts.READ_ONLY);cursorTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)},cursorTransaction.onabort=onError,cursorTransaction.onerror=onError;var cursorTarget=cursorTransaction.objectStore(this.storeName);options.index&&(cursorTarget=cursorTarget.index(options.index));var countRequest=cursorTarget.count(options.keyRange);return countRequest.onsuccess=function(evt){hasSuccess=!0,result=evt.target.result},countRequest.onError=onError,cursorTransaction},makeKeyRange:function(options){var keyRange,hasLower="undefined"!=typeof options.lower,hasUpper="undefined"!=typeof options.upper,isOnly="undefined"!=typeof options.only;switch(!0){case isOnly:keyRange=this.keyRange.only(options.only);break;case hasLower&&hasUpper:keyRange=this.keyRange.bound(options.lower,options.upper,options.excludeLower,options.excludeUpper);break;case hasLower:keyRange=this.keyRange.lowerBound(options.lower,options.excludeLower);break;case hasUpper:keyRange=this.keyRange.upperBound(options.upper,options.excludeUpper);break;default:throw new Error('Cannot create KeyRange. Provide one or both of "lower" or "upper" value, or an "only" value.')}return keyRange}};var empty={},mixin=function(target,source){var name,s;for(name in source)s=source[name],s!==empty[name]&&s!==target[name]&&(target[name]=s);return target};return IDBStore.version=IDBStore.prototype.version,IDBStore},this)},{}],90:[function(require,module,exports){function isBuffer(o){return Buffer.isBuffer(o)||/\[object (.+Array|Array.+)\]/.test(Object.prototype.toString.call(o))}var Buffer=require("buffer").Buffer;module.exports=isBuffer},{buffer:126}],91:[function(require,module,exports){(function(Buffer){function has(obj,key){return Object.hasOwnProperty.call(obj,key)}function isDef(val){return void 0!==val&&""!==val}function has(range,name){return Object.hasOwnProperty.call(range,name)}function hasKey(range,name){return Object.hasOwnProperty.call(range,name)&&name}function id(e){return e}exports.compare=function(a,b){if(Buffer.isBuffer(a)){for(var l=Math.min(a.length,b.length),i=0;l>i;i++){var cmp=a[i]-b[i];if(cmp)return cmp}return a.length-b.length}return b>a?-1:a>b?1:0};var lowerBoundKey=exports.lowerBoundKey=function(range){return hasKey(range,"gt")||hasKey(range,"gte")||hasKey(range,"min")||(range.reverse?hasKey(range,"end"):hasKey(range,"start"))||void 0},lowerBound=exports.lowerBound=function(range){var k=lowerBoundKey(range);return k&&range[k]};exports.lowerBoundInclusive=function(range){return has(range,"gt")?!1:!0},exports.upperBoundInclusive=function(range){return has(range,"lt")||!range.minEx?!1:!0};var lowerBoundExclusive=exports.lowerBoundExclusive=function(range){return has(range,"gt")||range.minEx?!0:!1},upperBoundExclusive=exports.upperBoundExclusive=function(range){return has(range,"lt")?!0:!1},upperBoundKey=exports.upperBoundKey=function(range){return hasKey(range,"lt")||hasKey(range,"lte")||hasKey(range,"max")||(range.reverse?hasKey(range,"start"):hasKey(range,"end"))||void 0},upperBound=exports.upperBound=function(range){var k=upperBoundKey(range);return k&&range[k]};exports.toLtgt=function(range,_range,map,lower,upper){_range=_range||{},map=map||id;var defaults=arguments.length>3,lb=exports.lowerBoundKey(range),ub=exports.upperBoundKey(range);return lb?"gt"===lb?_range.gt=map(range.gt):_range.gte=map(range[lb]):defaults&&(_range.gte=lower),ub?"lt"===ub?_range.lt=map(range.lt):_range.lte=map(range[ub]):defaults&&(_range.lte=upper),_range.reverse=!!range.reverse,_range},exports.contains=function(range,key,compare){compare=compare||exports.compare;var lb=lowerBound(range);if(isDef(lb)){var cmp=compare(key,lb);if(0>cmp||0===cmp&&lowerBoundExclusive(range))return!1}var ub=upperBound(range);if(isDef(ub)){var cmp=compare(key,ub);if(cmp>0||0===cmp&&upperBoundExclusive(range))return!1}return!0},exports.filter=function(range,compare){return function(key){return exports.contains(range,key,compare)}}}).call(this,require("buffer").Buffer)},{buffer:126}],92:[function(require,module,exports){(function(Buffer){module.exports=function(arr){return"function"==typeof Buffer._augment&&Buffer.TYPED_ARRAY_SUPPORT?Buffer._augment(arr):new Buffer(arr)}}).call(this,require("buffer").Buffer)},{buffer:126}],93:[function(require,module,exports){arguments[4][69][0].apply(exports,arguments)},{dup:69}],94:[function(require,module,exports){arguments[4][70][0].apply(exports,arguments)},{"./has-keys":93,dup:70,"object-keys":96}],95:[function(require,module,exports){var hasOwn=Object.prototype.hasOwnProperty,toString=Object.prototype.toString,isFunction=function(fn){var isFunc="function"==typeof fn&&!(fn instanceof RegExp)||"[object Function]"===toString.call(fn);return isFunc||"undefined"==typeof window||(isFunc=fn===window.setTimeout||fn===window.alert||fn===window.confirm||fn===window.prompt),
isFunc};module.exports=function(obj,fn){if(!isFunction(fn))throw new TypeError("iterator must be a function");var i,k,isString="string"==typeof obj,l=obj.length,context=arguments.length>2?arguments[2]:null;if(l===+l)for(i=0;l>i;i++)null===context?fn(isString?obj.charAt(i):obj[i],i,obj):fn.call(context,isString?obj.charAt(i):obj[i],i,obj);else for(k in obj)hasOwn.call(obj,k)&&(null===context?fn(obj[k],k,obj):fn.call(context,obj[k],k,obj))}},{}],96:[function(require,module,exports){arguments[4][71][0].apply(exports,arguments)},{"./shim":98,dup:71}],97:[function(require,module,exports){var toString=Object.prototype.toString;module.exports=function isArguments(value){var str=toString.call(value),isArguments="[object Arguments]"===str;return isArguments||(isArguments="[object Array]"!==str&&null!==value&&"object"==typeof value&&"number"==typeof value.length&&value.length>=0&&"[object Function]"===toString.call(value.callee)),isArguments}},{}],98:[function(require,module,exports){!function(){"use strict";var keysShim,has=Object.prototype.hasOwnProperty,toString=Object.prototype.toString,forEach=require("./foreach"),isArgs=require("./isArguments"),hasDontEnumBug=!{toString:null}.propertyIsEnumerable("toString"),hasProtoEnumBug=function(){}.propertyIsEnumerable("prototype"),dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"];keysShim=function(object){var isObject=null!==object&&"object"==typeof object,isFunction="[object Function]"===toString.call(object),isArguments=isArgs(object),theKeys=[];if(!isObject&&!isFunction&&!isArguments)throw new TypeError("Object.keys called on a non-object");if(isArguments)forEach(object,function(value){theKeys.push(value)});else{var name,skipProto=hasProtoEnumBug&&isFunction;for(name in object)skipProto&&"prototype"===name||!has.call(object,name)||theKeys.push(name)}if(hasDontEnumBug){var ctor=object.constructor,skipConstructor=ctor&&ctor.prototype===object;forEach(dontEnums,function(dontEnum){skipConstructor&&"constructor"===dontEnum||!has.call(object,dontEnum)||theKeys.push(dontEnum)})}return theKeys},module.exports=keysShim}()},{"./foreach":95,"./isArguments":97}],99:[function(require,module,exports){function Batch(levelup){this._levelup=levelup,this.batch=levelup.db.batch(),this.ops=[]}var util=require("./util"),WriteError=require("./errors").WriteError,getOptions=util.getOptions,dispatchError=util.dispatchError;Batch.prototype.put=function(key_,value_,options){options=getOptions(this._levelup,options);var key=util.encodeKey(key_,options),value=util.encodeValue(value_,options);try{this.batch.put(key,value)}catch(e){throw new WriteError(e)}return this.ops.push({type:"put",key:key,value:value}),this},Batch.prototype.del=function(key_,options){options=getOptions(this._levelup,options);var key=util.encodeKey(key_,options);try{this.batch.del(key)}catch(err){throw new WriteError(err)}return this.ops.push({type:"del",key:key}),this},Batch.prototype.clear=function(){try{this.batch.clear()}catch(err){throw new WriteError(err)}return this.ops=[],this},Batch.prototype.write=function(callback){var levelup=this._levelup,ops=this.ops;try{this.batch.write(function(err){return err?dispatchError(levelup,new WriteError(err),callback):(levelup.emit("batch",ops),void(callback&&callback()))})}catch(err){throw new WriteError(err)}},module.exports=Batch},{"./errors":100,"./util":103}],100:[function(require,module,exports){var createError=require("errno").create,LevelUPError=createError("LevelUPError"),NotFoundError=createError("NotFoundError",LevelUPError);NotFoundError.prototype.notFound=!0,NotFoundError.prototype.status=404,module.exports={LevelUPError:LevelUPError,InitializationError:createError("InitializationError",LevelUPError),OpenError:createError("OpenError",LevelUPError),ReadError:createError("ReadError",LevelUPError),WriteError:createError("WriteError",LevelUPError),NotFoundError:NotFoundError,EncodingError:createError("EncodingError",LevelUPError)}},{errno:111}],101:[function(require,module,exports){(function(process){function getCallback(options,callback){return"function"==typeof options?options:callback}function LevelUP(location,options,callback){if(!(this instanceof LevelUP))return new LevelUP(location,options,callback);var error;if(EventEmitter.call(this),this.setMaxListeners(1/0),"function"==typeof location?(options="object"==typeof options?options:{},options.db=location,location=null):"object"==typeof location&&"function"==typeof location.db&&(options=location,location=null),"function"==typeof options&&(callback=options,options={}),(!options||"function"!=typeof options.db)&&"string"!=typeof location){if(error=new InitializationError("Must provide a location for the database"),callback)return process.nextTick(function(){callback(error)});throw error}options=getOptions(this,options),this.options=extend(defaultOptions,options),this._status="new",prr(this,"location",location,"e"),this.open(callback)}function utilStatic(name){return function(location,callback){getLevelDOWN()[name](location,callback||function(){})}}var EventEmitter=require("events").EventEmitter,inherits=require("util").inherits,extend=require("xtend"),prr=require("prr"),DeferredLevelDOWN=require("deferred-leveldown"),WriteError=require("./errors").WriteError,ReadError=require("./errors").ReadError,NotFoundError=require("./errors").NotFoundError,OpenError=require("./errors").OpenError,EncodingError=require("./errors").EncodingError,InitializationError=require("./errors").InitializationError,ReadStream=require("./read-stream"),WriteStream=require("./write-stream"),util=require("./util"),Batch=require("./batch"),getOptions=util.getOptions,defaultOptions=util.defaultOptions,getLevelDOWN=util.getLevelDOWN,dispatchError=util.dispatchError;inherits(LevelUP,EventEmitter),LevelUP.prototype.open=function(callback){var dbFactory,db,self=this;return this.isOpen()?(callback&&process.nextTick(function(){callback(null,self)}),this):this._isOpening()?callback&&this.once("open",function(){callback(null,self)}):(this.emit("opening"),this._status="opening",this.db=new DeferredLevelDOWN(this.location),dbFactory=this.options.db||getLevelDOWN(),db=dbFactory(this.location),void db.open(this.options,function(err){return err?dispatchError(self,new OpenError(err),callback):(self.db.setDb(db),self.db=db,self._status="open",callback&&callback(null,self),self.emit("open"),self.emit("ready"),void 0)}))},LevelUP.prototype.close=function(callback){var self=this;if(this.isOpen())this._status="closing",this.db.close(function(){self._status="closed",self.emit("closed"),callback&&callback.apply(null,arguments)}),this.emit("closing"),this.db=null;else{if("closed"==this._status&&callback)return process.nextTick(callback);"closing"==this._status&&callback?this.once("closed",callback):this._isOpening()&&this.once("open",function(){self.close(callback)})}},LevelUP.prototype.isOpen=function(){return"open"==this._status},LevelUP.prototype._isOpening=function(){return"opening"==this._status},LevelUP.prototype.isClosed=function(){return/^clos/.test(this._status)},LevelUP.prototype.get=function(key_,options,callback){var key,self=this;return callback=getCallback(options,callback),"function"!=typeof callback?dispatchError(this,new ReadError("get() requires key and callback arguments")):this._isOpening()||this.isOpen()?(options=util.getOptions(this,options),key=util.encodeKey(key_,options),options.asBuffer=util.isValueAsBuffer(options),void this.db.get(key,options,function(err,value){if(err)return err=/notfound/i.test(err)?new NotFoundError("Key not found in database ["+key_+"]",err):new ReadError(err),dispatchError(self,err,callback);if(callback){try{value=util.decodeValue(value,options)}catch(e){return callback(new EncodingError(e))}callback(null,value)}})):dispatchError(this,new ReadError("Database is not open"),callback)},LevelUP.prototype.put=function(key_,value_,options,callback){var key,value,self=this;return callback=getCallback(options,callback),null===key_||void 0===key_||null===value_||void 0===value_?dispatchError(this,new WriteError("put() requires key and value arguments"),callback):this._isOpening()||this.isOpen()?(options=getOptions(this,options),key=util.encodeKey(key_,options),value=util.encodeValue(value_,options),void this.db.put(key,value,options,function(err){return err?dispatchError(self,new WriteError(err),callback):(self.emit("put",key_,value_),void(callback&&callback()))})):dispatchError(this,new WriteError("Database is not open"),callback)},LevelUP.prototype.del=function(key_,options,callback){var key,self=this;return callback=getCallback(options,callback),null===key_||void 0===key_?dispatchError(this,new WriteError("del() requires a key argument"),callback):this._isOpening()||this.isOpen()?(options=getOptions(this,options),key=util.encodeKey(key_,options),void this.db.del(key,options,function(err){return err?dispatchError(self,new WriteError(err),callback):(self.emit("del",key_),void(callback&&callback()))})):dispatchError(this,new WriteError("Database is not open"),callback)},LevelUP.prototype.batch=function(arr_,options,callback){var keyEnc,valueEnc,arr,self=this;return arguments.length?(callback=getCallback(options,callback),Array.isArray(arr_)?this._isOpening()||this.isOpen()?(options=getOptions(this,options),keyEnc=options.keyEncoding,valueEnc=options.valueEncoding,arr=arr_.map(function(e){if(void 0===e.type||void 0===e.key)return{};var o,kEnc=e.keyEncoding||keyEnc,vEnc=e.valueEncoding||e.encoding||valueEnc;return"utf8"!=kEnc&&"binary"!=kEnc||"utf8"!=vEnc&&"binary"!=vEnc?(o={type:e.type,key:util.encodeKey(e.key,options,e)},void 0!==e.value&&(o.value=util.encodeValue(e.value,options,e)),o):e}),void this.db.batch(arr,options,function(err){return err?dispatchError(self,new WriteError(err),callback):(self.emit("batch",arr_),void(callback&&callback()))})):dispatchError(this,new WriteError("Database is not open"),callback):dispatchError(this,new WriteError("batch() requires an array argument"),callback)):new Batch(this)},LevelUP.prototype.approximateSize=function(start_,end_,callback){var start,end,self=this;return null===start_||void 0===start_||null===end_||void 0===end_||"function"!=typeof callback?dispatchError(this,new ReadError("approximateSize() requires start, end and callback arguments"),callback):(start=util.encodeKey(start_,this.options),end=util.encodeKey(end_,this.options),this._isOpening()||this.isOpen()?void this.db.approximateSize(start,end,function(err,size){return err?dispatchError(self,new OpenError(err),callback):void(callback&&callback(null,size))}):dispatchError(this,new WriteError("Database is not open"),callback))},LevelUP.prototype.readStream=LevelUP.prototype.createReadStream=function(options){var self=this;return options=extend(this.options,options),new ReadStream(options,this,function(options){return self.db.iterator(options)})},LevelUP.prototype.keyStream=LevelUP.prototype.createKeyStream=function(options){return this.createReadStream(extend(options,{keys:!0,values:!1}))},LevelUP.prototype.valueStream=LevelUP.prototype.createValueStream=function(options){return this.createReadStream(extend(options,{keys:!1,values:!0}))},LevelUP.prototype.writeStream=LevelUP.prototype.createWriteStream=function(options){return new WriteStream(extend(options),this)},LevelUP.prototype.toString=function(){return"LevelUP"},module.exports=LevelUP,module.exports.copy=util.copy,module.exports.destroy=utilStatic("destroy"),module.exports.repair=utilStatic("repair")}).call(this,require("_process"))},{"./batch":99,"./errors":100,"./read-stream":102,"./util":103,"./write-stream":104,_process:134,"deferred-leveldown":106,events:130,prr:112,util:149,xtend:123}],102:[function(require,module,exports){function ReadStream(options,db,iteratorFactory){if(!(this instanceof ReadStream))return new ReadStream(options,db,iteratorFactory);Readable.call(this,{objectMode:!0,highWaterMark:options.highWaterMark}),this._db=db,options=this._options=extend(defaultOptions,options),this._keyEncoding=options.keyEncoding||options.encoding,this._valueEncoding=options.valueEncoding||options.encoding,"undefined"!=typeof this._options.start&&(this._options.start=util.encodeKey(this._options.start,this._options)),"undefined"!=typeof this._options.end&&(this._options.end=util.encodeKey(this._options.end,this._options)),"number"!=typeof this._options.limit&&(this._options.limit=-1),this._options.keyAsBuffer=util.isKeyAsBuffer(this._options),this._options.valueAsBuffer=util.isValueAsBuffer(this._options),this._makeData=this._options.keys&&this._options.values?makeKeyValueData:this._options.keys?makeKeyData:this._options.values?makeValueData:makeNoData;var self=this;this._db.isOpen()?this._iterator=iteratorFactory(this._options):this._db.once("ready",function(){self._destroyed||(self._iterator=iteratorFactory(self._options))})}var Readable=require("readable-stream").Readable,inherits=require("util").inherits,extend=require("xtend"),EncodingError=require("./errors").EncodingError,util=require("./util"),defaultOptions={keys:!0,values:!0},makeKeyValueData=function(key,value){return{key:util.decodeKey(key,this._options),value:util.decodeValue(value,this._options)}},makeKeyData=function(key){return util.decodeKey(key,this._options)},makeValueData=function(_,value){return util.decodeValue(value,this._options)},makeNoData=function(){return null};inherits(ReadStream,Readable),ReadStream.prototype._read=function read(){var self=this;return self._db.isOpen()?void(self._destroyed||self._iterator.next(function(err,key,value){if(err||void 0===key&&void 0===value)return err||self._destroyed||self.push(null),self._cleanup(err);try{value=self._makeData(key,value)}catch(e){return self._cleanup(new EncodingError(e))}self._destroyed||self.push(value)})):self._db.once("ready",function(){read.call(self)})},ReadStream.prototype._cleanup=function(err){if(!this._destroyed){this._destroyed=!0;var self=this;err&&self.emit("error",err),self._iterator?self._iterator.end(function(){self._iterator=null,self.emit("close")}):self.emit("close")}},ReadStream.prototype.destroy=function(){this._cleanup()},ReadStream.prototype.toString=function(){return"LevelUP.ReadStream"},module.exports=ReadStream},{"./errors":100,"./util":103,"readable-stream":122,util:149,xtend:123}],103:[function(require,module,exports){(function(process,Buffer){function copy(srcdb,dstdb,callback){srcdb.readStream().pipe(dstdb.writeStream()).on("close",callback?callback:function(){}).on("error",callback?callback:function(err){throw err})}function getOptions(levelup,options){var s="string"==typeof options;return!s&&options&&options.encoding&&!options.valueEncoding&&(options.valueEncoding=options.encoding),extend(levelup&&levelup.options||{},s?encodingOpts[options]||encodingOpts[defaultOptions.valueEncoding]:options)}function getLevelDOWN(){if(leveldown)return leveldown;var leveldownVersion,requiredVersion=require("../package.json").devDependencies.leveldown,missingLevelDOWNError="Could not locate LevelDOWN, try `npm install leveldown`";try{leveldownVersion=require("leveldown/package").version}catch(e){throw new LevelUPError(missingLevelDOWNError)}if(!require("semver").satisfies(leveldownVersion,requiredVersion))throw new LevelUPError("Installed version of LevelDOWN ("+leveldownVersion+") does not match required version ("+requiredVersion+")");try{return leveldown=require("leveldown")}catch(e){throw new LevelUPError(missingLevelDOWNError)}}function dispatchError(levelup,error,callback){return"function"==typeof callback?callback(error):levelup.emit("error",error)}function getKeyEncoder(options,op){var type=op&&op.keyEncoding||options.keyEncoding||"utf8";return encodings[type]||type}function getValueEncoder(options,op){var type=op&&(op.valueEncoding||op.encoding)||options.valueEncoding||options.encoding||"utf8";return encodings[type]||type}function encodeKey(key,options,op){return getKeyEncoder(options,op).encode(key)}function encodeValue(value,options,op){return getValueEncoder(options,op).encode(value)}function decodeKey(key,options){return getKeyEncoder(options).decode(key)}function decodeValue(value,options){return getValueEncoder(options).decode(value)}function isValueAsBuffer(options,op){return getValueEncoder(options,op).buffer}function isKeyAsBuffer(options,op){return getKeyEncoder(options,op).buffer}var leveldown,extend=require("xtend"),LevelUPError=require("./errors").LevelUPError,encodingNames=["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le"],defaultOptions={createIfMissing:!0,errorIfExists:!1,keyEncoding:"utf8",valueEncoding:"utf8",compression:!0},encodings=function(){function isBinary(data){return void 0===data||null===data||Buffer.isBuffer(data)}var encodings={};return encodings.utf8=encodings["utf-8"]={encode:function(data){return isBinary(data)?data:String(data)},decode:function(data){return data},buffer:!1,type:"utf8"},encodings.json={encode:JSON.stringify,decode:JSON.parse,buffer:!1,type:"json"},encodingNames.forEach(function(type){encodings[type]||(encodings[type]={encode:function(data){return isBinary(data)?data:new Buffer(data,type)},decode:function(buffer){return process.browser?buffer.toString(type):buffer},buffer:!0,type:type})}),encodings}(),encodingOpts=function(){var eo={};return encodingNames.forEach(function(e){eo[e]={valueEncoding:e}}),eo}();module.exports={defaultOptions:defaultOptions,copy:copy,getOptions:getOptions,getLevelDOWN:getLevelDOWN,dispatchError:dispatchError,encodeKey:encodeKey,encodeValue:encodeValue,isValueAsBuffer:isValueAsBuffer,isKeyAsBuffer:isKeyAsBuffer,decodeValue:decodeValue,decodeKey:decodeKey}}).call(this,require("_process"),require("buffer").Buffer)},{"../package.json":124,"./errors":100,_process:134,buffer:126,leveldown:125,"leveldown/package":125,semver:125,xtend:123}],104:[function(require,module,exports){(function(process,global){function WriteStream(options,db){if(!(this instanceof WriteStream))return new WriteStream(options,db);Stream.call(this),this._options=extend(defaultOptions,getOptions(db,options)),this._db=db,this._buffer=[],this._status="init",this._end=!1,this.writable=!0,this.readable=!1;var self=this,ready=function(){self.writable&&(self._status="ready",self.emit("ready"),self._process())};db.isOpen()?setImmediate(ready):db.once("ready",ready)}var Stream=require("stream").Stream,inherits=require("util").inherits,extend=require("xtend"),bl=require("bl"),setImmediate=global.setImmediate||process.nextTick,getOptions=require("./util").getOptions,defaultOptions={type:"put"};inherits(WriteStream,Stream),WriteStream.prototype.write=function(data){return this.writable?(this._buffer.push(data),"init"!=this._status&&this._processDelayed(),this._options.maxBufferLength&&this._buffer.length>this._options.maxBufferLength?(this._writeBlock=!0,!1):!0):!1},WriteStream.prototype.end=function(data){var self=this;data&&this.write(data),setImmediate(function(){self._end=!0,self._process()})},WriteStream.prototype.destroy=function(){this.writable=!1,this.end()},WriteStream.prototype.destroySoon=function(){this.end()},WriteStream.prototype.add=function(entry){return entry.props?(entry.props.Directory?entry.pipe(this._db.writeStream(this._options)):(entry.props.File||entry.File||"File"==entry.type)&&this._write(entry),!0):void 0},WriteStream.prototype._processDelayed=function(){var self=this;setImmediate(function(){self._process()})},WriteStream.prototype._process=function(){var buffer,self=this,cb=function(err){return self.writable?("closed"!=self._status&&(self._status="ready"),err?(self.writable=!1,self.emit("error",err)):void self._process()):void 0};return"ready"!=self._status&&self.writable?void(self._buffer.length&&"closed"!=self._status&&self._processDelayed()):self._buffer.length&&self.writable?(self._status="writing",buffer=self._buffer,self._buffer=[],self._db.batch(buffer.map(function(d){return{type:d.type||self._options.type,key:d.key,value:d.value,keyEncoding:d.keyEncoding||self._options.keyEncoding,valueEncoding:d.valueEncoding||d.encoding||self._options.valueEncoding}}),cb),void(self._writeBlock&&(self._writeBlock=!1,self.emit("drain")))):void(self._end&&"closed"!=self._status&&(self._status="closed",self.writable=!1,self.emit("close")))},WriteStream.prototype._write=function(entry){var key=entry.path||entry.props.path,self=this;key&&entry.pipe(bl(function(err,data){return err?(self.writable=!1,self.emit("error",err)):(self._options.fstreamRoot&&key.indexOf(self._options.fstreamRoot)>-1&&(key=key.substr(self._options.fstreamRoot.length+1)),void self.write({key:key,value:data.slice(0)}))}))},WriteStream.prototype.toString=function(){return"LevelUP.WriteStream"},module.exports=WriteStream}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./util":103,_process:134,bl:105,stream:146,util:149,xtend:123}],105:[function(require,module,exports){(function(Buffer){function BufferList(callback){if(!(this instanceof BufferList))return new BufferList(callback);if(this._bufs=[],this.length=0,"function"==typeof callback){this._callback=callback;var piper=function(err){this._callback&&(this._callback(err),this._callback=null)}.bind(this);this.on("pipe",function(src){src.on("error",piper)}),this.on("unpipe",function(src){src.removeListener("error",piper)})}else Buffer.isBuffer(callback)?this.append(callback):Array.isArray(callback)&&callback.forEach(function(b){Buffer.isBuffer(b)&&this.append(b)}.bind(this));DuplexStream.call(this)}var DuplexStream=require("readable-stream").Duplex,util=require("util");util.inherits(BufferList,DuplexStream),BufferList.prototype._offset=function(offset){for(var _t,tot=0,i=0;i<this._bufs.length;i++){if(_t=tot+this._bufs[i].length,_t>offset)return[i,offset-tot];tot=_t}},BufferList.prototype.append=function(buf){return this._bufs.push(Buffer.isBuffer(buf)?buf:new Buffer(buf)),this.length+=buf.length,this},BufferList.prototype._write=function(buf,encoding,callback){this.append(buf),callback&&callback()},BufferList.prototype._read=function(size){return this.length?(size=Math.min(size,this.length),this.push(this.slice(0,size)),void this.consume(size)):this.push(null)},BufferList.prototype.end=function(chunk){DuplexStream.prototype.end.call(this,chunk),this._callback&&(this._callback(null,this.slice()),this._callback=null)},BufferList.prototype.get=function(index){return this.slice(index,index+1)[0]},BufferList.prototype.slice=function(start,end){return this.copy(null,0,start,end)},BufferList.prototype.copy=function(dst,dstStart,srcStart,srcEnd){if(("number"!=typeof srcStart||0>srcStart)&&(srcStart=0),("number"!=typeof srcEnd||srcEnd>this.length)&&(srcEnd=this.length),srcStart>=this.length)return dst||new Buffer(0);if(0>=srcEnd)return dst||new Buffer(0);var l,i,copy=!!dst,off=this._offset(srcStart),len=srcEnd-srcStart,bytes=len,bufoff=copy&&dstStart||0,start=off[1];if(0===srcStart&&srcEnd==this.length){if(!copy)return Buffer.concat(this._bufs);for(i=0;i<this._bufs.length;i++)this._bufs[i].copy(dst,bufoff),bufoff+=this._bufs[i].length;return dst}if(bytes<=this._bufs[off[0]].length-start)return copy?this._bufs[off[0]].copy(dst,dstStart,start,start+bytes):this._bufs[off[0]].slice(start,start+bytes);for(copy||(dst=new Buffer(len)),i=off[0];i<this._bufs.length;i++){if(l=this._bufs[i].length-start,!(bytes>l)){this._bufs[i].copy(dst,bufoff,start,start+bytes);break}this._bufs[i].copy(dst,bufoff,start),bufoff+=l,bytes-=l,start&&(start=0)}return dst},BufferList.prototype.toString=function(encoding,start,end){return this.slice(start,end).toString(encoding)},BufferList.prototype.consume=function(bytes){for(;this._bufs.length;){if(!(bytes>this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(bytes),this.length-=bytes;break}bytes-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},BufferList.prototype.duplicate=function(){for(var i=0,copy=new BufferList;i<this._bufs.length;i++)copy.append(this._bufs[i]);return copy},BufferList.prototype.destroy=function(){this._bufs.length=0,this.length=0,this.push(null)},function(){var methods={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1};for(var m in methods)!function(m){BufferList.prototype[m]=function(offset){return this.slice(offset,offset+methods[m])[m](0)}}(m)}(),module.exports=BufferList}).call(this,require("buffer").Buffer)},{buffer:126,"readable-stream":122,util:149}],106:[function(require,module,exports){(function(process,Buffer){function DeferredLevelDOWN(location){AbstractLevelDOWN.call(this,"string"==typeof location?location:""),this._db=void 0,this._operations=[]}var util=require("util"),AbstractLevelDOWN=require("abstract-leveldown").AbstractLevelDOWN;util.inherits(DeferredLevelDOWN,AbstractLevelDOWN),DeferredLevelDOWN.prototype.setDb=function(db){this._db=db,this._operations.forEach(function(op){db[op.method].apply(db,op.args)})},DeferredLevelDOWN.prototype._open=function(options,callback){return process.nextTick(callback)},DeferredLevelDOWN.prototype._operation=function(method,args){return this._db?this._db[method].apply(this._db,args):void this._operations.push({method:method,args:args})},"put get del batch approximateSize".split(" ").forEach(function(m){DeferredLevelDOWN.prototype["_"+m]=function(){this._operation(m,arguments)}}),DeferredLevelDOWN.prototype._isBuffer=function(obj){return Buffer.isBuffer(obj)},DeferredLevelDOWN.prototype._iterator=function(){throw new TypeError("not implemented")},module.exports=DeferredLevelDOWN}).call(this,require("_process"),require("buffer").Buffer)},{_process:134,"abstract-leveldown":109,buffer:126,util:149}],107:[function(require,module,exports){arguments[4][85][0].apply(exports,arguments)},{_process:134,dup:85}],108:[function(require,module,exports){arguments[4][86][0].apply(exports,arguments)},{_process:134,dup:86}],109:[function(require,module,exports){arguments[4][87][0].apply(exports,arguments)},{"./abstract-chained-batch":107,"./abstract-iterator":108,_process:134,buffer:126,dup:87,xtend:123}],110:[function(require,module,exports){arguments[4][33][0].apply(exports,arguments)},{dup:33,prr:112}],111:[function(require,module,exports){arguments[4][34][0].apply(exports,arguments)},{"./custom":110,dup:34}],112:[function(require,module,exports){arguments[4][35][0].apply(exports,arguments)},{dup:35}],113:[function(require,module,exports){arguments[4][38][0].apply(exports,arguments)},{"./_stream_readable":115,"./_stream_writable":117,_process:134,"core-util-is":118,dup:38,inherits:119}],114:[function(require,module,exports){arguments[4][39][0].apply(exports,arguments)},{"./_stream_transform":116,"core-util-is":118,dup:39,inherits:119}],115:[function(require,module,exports){arguments[4][40][0].apply(exports,arguments)},{_process:134,buffer:126,"core-util-is":118,dup:40,events:130,inherits:119,isarray:120,stream:146,"string_decoder/":121}],116:[function(require,module,exports){arguments[4][41][0].apply(exports,arguments)},{"./_stream_duplex":113,"core-util-is":118,dup:41,inherits:119}],117:[function(require,module,exports){arguments[4][42][0].apply(exports,arguments)},{"./_stream_duplex":113,_process:134,buffer:126,"core-util-is":118,dup:42,inherits:119,stream:146}],118:[function(require,module,exports){arguments[4][26][0].apply(exports,arguments)},{buffer:126,dup:26}],119:[function(require,module,exports){arguments[4][20][0].apply(exports,arguments)},{dup:20}],120:[function(require,module,exports){arguments[4][27][0].apply(exports,arguments)},{dup:27}],121:[function(require,module,exports){arguments[4][29][0].apply(exports,arguments)},{buffer:126,dup:29}],122:[function(require,module,exports){arguments[4][47][0].apply(exports,arguments)},{"./lib/_stream_duplex.js":113,"./lib/_stream_passthrough.js":114,"./lib/_stream_readable.js":115,"./lib/_stream_transform.js":116,"./lib/_stream_writable.js":117,dup:47,stream:146}],123:[function(require,module,exports){arguments[4][88][0].apply(exports,arguments)},{dup:88}],124:[function(require,module,exports){module.exports={name:"levelup",description:"Fast & simple storage - a Node.js-style LevelDB wrapper",version:"0.18.6",contributors:[{name:"Rod Vagg",email:"r@va.gg",url:"https://github.com/rvagg"},{name:"John Chesley",email:"john@chesl.es",url:"https://github.com/chesles/"},{name:"Jake Verbaten",email:"raynos2@gmail.com",url:"https://github.com/raynos"},{name:"Dominic Tarr",email:"dominic.tarr@gmail.com",url:"https://github.com/dominictarr"},{name:"Max Ogden",email:"max@maxogden.com",url:"https://github.com/maxogden"},{name:"Lars-Magnus Skog",email:"lars.magnus.skog@gmail.com",url:"https://github.com/ralphtheninja"},{name:"David Bjrklund",email:"david.bjorklund@gmail.com",url:"https://github.com/kesla"},{name:"Julian Gruber",email:"julian@juliangruber.com",url:"https://github.com/juliangruber"},{name:"Paolo Fragomeni",email:"paolo@async.ly",url:"https://github.com/hij1nx"},{name:"Anton Whalley",email:"anton.whalley@nearform.com",url:"https://github.com/No9"},{name:"Matteo Collina",email:"matteo.collina@gmail.com",url:"https://github.com/mcollina"},{name:"Pedro Teixeira",email:"pedro.teixeira@gmail.com",url:"https://github.com/pgte"},{name:"James Halliday",email:"mail@substack.net",url:"https://github.com/substack"}],repository:{type:"git",url:"git+https://github.com/rvagg/node-levelup.git"},homepage:"https://github.com/rvagg/node-levelup",keywords:["leveldb","stream","database","db","store","storage","json"],main:"lib/levelup.js",dependencies:{bl:"~0.8.1","deferred-leveldown":"~0.2.0",errno:"~0.1.1",prr:"~0.0.0","readable-stream":"~1.0.26",semver:"~2.3.1",xtend:"~3.0.0"},devDependencies:{leveldown:"~0.10.0",bustermove:"*",tap:"*",referee:"*",rimraf:"*",async:"*",fstream:"*",tar:"*",mkfiletree:"*",readfiletree:"*","slow-stream":">=0.0.4",delayed:"*",boganipsum:"*",du:"*",memdown:"*","msgpack-js":"*"},browser:{leveldown:!1,"leveldown/package":!1,semver:!1},scripts:{test:"tap test/*-test.js --stderr",functionaltests:"node ./test/functional/fstream-test.js && node ./test/functional/binary-data-test.js && node ./test/functional/compat-test.js",alltests:"npm test && npm run-script functionaltests"},license:"MIT",gitHead:"213e989e2b75273e2b44c23f84f95e35bff7ea11",bugs:{url:"https://github.com/rvagg/node-levelup/issues"},_id:"levelup@0.18.6",_shasum:"e6a01cb089616c8ecc0291c2a9bd3f0c44e3e5eb",_from:"levelup@>=0.18.2 <0.19.0",_npmVersion:"1.4.14",_npmUser:{name:"rvagg",email:"rod@vagg.org"},maintainers:[{name:"rvagg",email:"rod@vagg.org"}],dist:{shasum:"e6a01cb089616c8ecc0291c2a9bd3f0c44e3e5eb",tarball:"http://registry.npmjs.org/levelup/-/levelup-0.18.6.tgz"},directories:{},_resolved:"https://registry.npmjs.org/levelup/-/levelup-0.18.6.tgz",readme:"ERROR: No README data found!"}},{}],125:[function(require,module,exports){},{}],126:[function(require,module,exports){function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Buffer(arg){return this instanceof Buffer?(this.length=0,this.parent=void 0,"number"==typeof arg?fromNumber(this,arg):"string"==typeof arg?fromString(this,arg,arguments.length>1?arguments[1]:"utf8"):fromObject(this,arg)):arguments.length>1?new Buffer(arg,arguments[1]):new Buffer(arg)}function fromNumber(that,length){if(that=allocate(that,0>length?0:0|checked(length)),!Buffer.TYPED_ARRAY_SUPPORT)for(var i=0;length>i;i++)that[i]=0;return that}function fromString(that,string,encoding){("string"!=typeof encoding||""===encoding)&&(encoding="utf8");var length=0|byteLength(string,encoding);return that=allocate(that,length),that.write(string,encoding),that}function fromObject(that,object){if(Buffer.isBuffer(object))return fromBuffer(that,object);if(isArray(object))return fromArray(that,object);if(null==object)throw new TypeError("must start with number, buffer, array or string");return"undefined"!=typeof ArrayBuffer&&object.buffer instanceof ArrayBuffer?fromTypedArray(that,object):object.length?fromArrayLike(that,object):fromJsonObject(that,object);
}function fromBuffer(that,buffer){var length=0|checked(buffer.length);return that=allocate(that,length),buffer.copy(that,0,0,length),that}function fromArray(that,array){var length=0|checked(array.length);that=allocate(that,length);for(var i=0;length>i;i+=1)that[i]=255&array[i];return that}function fromTypedArray(that,array){var length=0|checked(array.length);that=allocate(that,length);for(var i=0;length>i;i+=1)that[i]=255&array[i];return that}function fromArrayLike(that,array){var length=0|checked(array.length);that=allocate(that,length);for(var i=0;length>i;i+=1)that[i]=255&array[i];return that}function fromJsonObject(that,object){var array,length=0;"Buffer"===object.type&&isArray(object.data)&&(array=object.data,length=0|checked(array.length)),that=allocate(that,length);for(var i=0;length>i;i+=1)that[i]=255&array[i];return that}function allocate(that,length){Buffer.TYPED_ARRAY_SUPPORT?that=Buffer._augment(new Uint8Array(length)):(that.length=length,that._isBuffer=!0);var fromPool=0!==length&&length<=Buffer.poolSize>>>1;return fromPool&&(that.parent=rootParent),that}function checked(length){if(length>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|length}function SlowBuffer(subject,encoding){if(!(this instanceof SlowBuffer))return new SlowBuffer(subject,encoding);var buf=new Buffer(subject,encoding);return delete buf.parent,buf}function byteLength(string,encoding){"string"!=typeof string&&(string=""+string);var len=string.length;if(0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"binary":case"raw":case"raws":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if(start=0|start,end=void 0===end||end===1/0?this.length:0|end,encoding||(encoding="utf8"),0>start&&(start=0),end>this.length&&(end=this.length),start>=end)return"";for(;;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"binary":return binarySlice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length),length>remaining&&(length=remaining)):length=remaining;var strLen=string.length;if(strLen%2!==0)throw new Error("Invalid hex string");length>strLen/2&&(length=strLen/2);for(var i=0;length>i;i++){var parsed=parseInt(string.substr(2*i,2),16);if(isNaN(parsed))throw new Error("Invalid hex string");buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function binaryWrite(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}function base64Slice(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}function utf8Slice(buf,start,end){var res="",tmp="";end=Math.min(buf.length,end);for(var i=start;end>i;i++)buf[i]<=127?(res+=decodeUtf8Char(tmp)+String.fromCharCode(buf[i]),tmp=""):tmp+="%"+buf[i].toString(16);return res+decodeUtf8Char(tmp)}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;end>i;i++)ret+=String.fromCharCode(127&buf[i]);return ret}function binarySlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;end>i;i++)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){var len=buf.length;(!start||0>start)&&(start=0),(!end||0>end||end>len)&&(end=len);for(var out="",i=start;end>i;i++)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!==0||0>offset)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError("buffer must be a Buffer instance");if(value>max||min>value)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range")}function objectWriteUInt16(buf,value,offset,littleEndian){0>value&&(value=65535+value+1);for(var i=0,j=Math.min(buf.length-offset,2);j>i;i++)buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>8*(littleEndian?i:1-i)}function objectWriteUInt32(buf,value,offset,littleEndian){0>value&&(value=4294967295+value+1);for(var i=0,j=Math.min(buf.length-offset,4);j>i;i++)buf[offset+i]=value>>>8*(littleEndian?i:3-i)&255}function checkIEEE754(buf,value,offset,ext,max,min){if(value>max||min>value)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range");if(0>offset)throw new RangeError("index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}function base64clean(str){if(str=stringtrim(str).replace(INVALID_BASE64_RE,""),str.length<2)return"";for(;str.length%4!==0;)str+="=";return str}function stringtrim(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")}function toHex(n){return 16>n?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(string,units){units=units||1/0;for(var codePoint,length=string.length,leadSurrogate=null,bytes=[],i=0;length>i;i++){if(codePoint=string.charCodeAt(i),codePoint>55295&&57344>codePoint){if(!leadSurrogate){if(codePoint>56319){(units-=3)>-1&&bytes.push(239,191,189);continue}if(i+1===length){(units-=3)>-1&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(56320>codePoint){(units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=leadSurrogate-55296<<10|codePoint-56320|65536,leadSurrogate=null}else leadSurrogate&&((units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=null);if(128>codePoint){if((units-=1)<0)break;bytes.push(codePoint)}else if(2048>codePoint){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(65536>codePoint){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(2097152>codePoint))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function asciiToBytes(str){for(var byteArray=[],i=0;i<str.length;i++)byteArray.push(255&str.charCodeAt(i));return byteArray}function utf16leToBytes(str,units){for(var c,hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);i++)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;length>i&&!(i+offset>=dst.length||i>=src.length);i++)dst[i+offset]=src[i];return i}function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}var base64=require("base64-js"),ieee754=require("ieee754"),isArray=require("is-array");exports.Buffer=Buffer,exports.SlowBuffer=SlowBuffer,exports.INSPECT_MAX_BYTES=50,Buffer.poolSize=8192;var rootParent={};Buffer.TYPED_ARRAY_SUPPORT=function(){try{var buf=new ArrayBuffer(0),arr=new Uint8Array(buf);return arr.foo=function(){return 42},42===arr.foo()&&"function"==typeof arr.subarray&&0===new Uint8Array(1).subarray(1,1).byteLength}catch(e){return!1}}(),Buffer.isBuffer=function(b){return!(null==b||!b._isBuffer)},Buffer.compare=function(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);len>i&&a[i]===b[i];)++i;return i!==len&&(x=a[i],y=b[i]),y>x?-1:x>y?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!isArray(list))throw new TypeError("list argument must be an Array of Buffers.");if(0===list.length)return new Buffer(0);if(1===list.length)return list[0];var i;if(void 0===length)for(length=0,i=0;i<list.length;i++)length+=list[i].length;var buf=new Buffer(length),pos=0;for(i=0;i<list.length;i++){var item=list[i];item.copy(buf,pos),pos+=item.length}return buf},Buffer.byteLength=byteLength,Buffer.prototype.length=void 0,Buffer.prototype.parent=void 0,Buffer.prototype.toString=function(){var length=0|this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b?!0:0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES;return this.length>0&&(str=this.toString("hex",0,max).match(/.{2}/g).join(" "),this.length>max&&(str+=" ... ")),"<Buffer "+str+">"},Buffer.prototype.compare=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b?0:Buffer.compare(this,b)},Buffer.prototype.indexOf=function(val,byteOffset){function arrayIndexOf(arr,val,byteOffset){for(var foundIndex=-1,i=0;byteOffset+i<arr.length;i++)if(arr[byteOffset+i]===val[-1===foundIndex?0:i-foundIndex]){if(-1===foundIndex&&(foundIndex=i),i-foundIndex+1===val.length)return byteOffset+foundIndex}else foundIndex=-1;return-1}if(byteOffset>2147483647?byteOffset=2147483647:-2147483648>byteOffset&&(byteOffset=-2147483648),byteOffset>>=0,0===this.length)return-1;if(byteOffset>=this.length)return-1;if(0>byteOffset&&(byteOffset=Math.max(this.length+byteOffset,0)),"string"==typeof val)return 0===val.length?-1:String.prototype.indexOf.call(this,val,byteOffset);if(Buffer.isBuffer(val))return arrayIndexOf(this,val,byteOffset);if("number"==typeof val)return Buffer.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,val,byteOffset):arrayIndexOf(this,[val],byteOffset);throw new TypeError("val must be string, number or Buffer")},Buffer.prototype.get=function(offset){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(offset)},Buffer.prototype.set=function(v,offset){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(v,offset)},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else if(isFinite(offset))offset=0|offset,isFinite(length)?(length=0|length,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0);else{var swap=encoding;encoding=offset,offset=0|length,length=swap}var remaining=this.length-offset;if((void 0===length||length>remaining)&&(length=remaining),string.length>0&&(0>length||0>offset)||offset>this.length)throw new RangeError("attempt to write outside buffer bounds");encoding||(encoding="utf8");for(var loweredCase=!1;;)switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"binary":return binaryWrite(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},Buffer.prototype.slice=function(start,end){var len=this.length;start=~~start,end=void 0===end?len:~~end,0>start?(start+=len,0>start&&(start=0)):start>len&&(start=len),0>end?(end+=len,0>end&&(end=0)):end>len&&(end=len),start>end&&(end=start);var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT)newBuf=Buffer._augment(this.subarray(start,end));else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,void 0);for(var i=0;sliceLen>i;i++)newBuf[i]=this[i+start]}return newBuf.length&&(newBuf.parent=this.parent||this),newBuf},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;byteLength>0&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];i>0&&(mul*=256);)val+=this[offset+--i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){value=+value,offset=0|offset,byteLength=0|byteLength,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){value=+value,offset=0|offset,byteLength=0|byteLength,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var i=byteLength-1,mul=1;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),this[offset]=value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=value):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset=0|offset,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0,mul=1,sub=0>value?1:0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset=0|offset,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1,mul=1,sub=0>value?1:0;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),0>value&&(value=255+value+1),this[offset]=value,offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),0>value&&(value=4294967295+value+1),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),end>0&&start>end&&(end=start),end===start)return 0;if(0===target.length||0===this.length)return 0;if(0>targetStart)throw new RangeError("targetStart out of bounds");if(0>start||start>=this.length)throw new RangeError("sourceStart out of bounds");if(0>end)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);var len=end-start;if(1e3>len||!Buffer.TYPED_ARRAY_SUPPORT)for(var i=0;len>i;i++)target[i+targetStart]=this[i+start];else target._set(this.subarray(start,start+len),targetStart);return len},Buffer.prototype.fill=function(value,start,end){if(value||(value=0),start||(start=0),end||(end=this.length),start>end)throw new RangeError("end < start");if(end!==start&&0!==this.length){if(0>start||start>=this.length)throw new RangeError("start out of bounds");if(0>end||end>this.length)throw new RangeError("end out of bounds");var i;if("number"==typeof value)for(i=start;end>i;i++)this[i]=value;else{var bytes=utf8ToBytes(value.toString()),len=bytes.length;for(i=start;end>i;i++)this[i]=bytes[i%len]}return this}},Buffer.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(Buffer.TYPED_ARRAY_SUPPORT)return new Buffer(this).buffer;for(var buf=new Uint8Array(this.length),i=0,len=buf.length;len>i;i+=1)buf[i]=this[i];return buf.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var BP=Buffer.prototype;Buffer._augment=function(arr){return arr.constructor=Buffer,arr._isBuffer=!0,arr._set=arr.set,arr.get=BP.get,arr.set=BP.set,arr.write=BP.write,arr.toString=BP.toString,arr.toLocaleString=BP.toString,arr.toJSON=BP.toJSON,arr.equals=BP.equals,arr.compare=BP.compare,arr.indexOf=BP.indexOf,arr.copy=BP.copy,arr.slice=BP.slice,arr.readUIntLE=BP.readUIntLE,arr.readUIntBE=BP.readUIntBE,arr.readUInt8=BP.readUInt8,arr.readUInt16LE=BP.readUInt16LE,arr.readUInt16BE=BP.readUInt16BE,arr.readUInt32LE=BP.readUInt32LE,arr.readUInt32BE=BP.readUInt32BE,arr.readIntLE=BP.readIntLE,arr.readIntBE=BP.readIntBE,arr.readInt8=BP.readInt8,arr.readInt16LE=BP.readInt16LE,arr.readInt16BE=BP.readInt16BE,arr.readInt32LE=BP.readInt32LE,arr.readInt32BE=BP.readInt32BE,arr.readFloatLE=BP.readFloatLE,arr.readFloatBE=BP.readFloatBE,arr.readDoubleLE=BP.readDoubleLE,arr.readDoubleBE=BP.readDoubleBE,arr.writeUInt8=BP.writeUInt8,arr.writeUIntLE=BP.writeUIntLE,arr.writeUIntBE=BP.writeUIntBE,arr.writeUInt16LE=BP.writeUInt16LE,arr.writeUInt16BE=BP.writeUInt16BE,arr.writeUInt32LE=BP.writeUInt32LE,arr.writeUInt32BE=BP.writeUInt32BE,arr.writeIntLE=BP.writeIntLE,arr.writeIntBE=BP.writeIntBE,arr.writeInt8=BP.writeInt8,arr.writeInt16LE=BP.writeInt16LE,arr.writeInt16BE=BP.writeInt16BE,arr.writeInt32LE=BP.writeInt32LE,arr.writeInt32BE=BP.writeInt32BE,arr.writeFloatLE=BP.writeFloatLE,arr.writeFloatBE=BP.writeFloatBE,arr.writeDoubleLE=BP.writeDoubleLE,arr.writeDoubleBE=BP.writeDoubleBE,arr.fill=BP.fill,arr.inspect=BP.inspect,arr.toArrayBuffer=BP.toArrayBuffer,arr};var INVALID_BASE64_RE=/[^+\/0-9A-z\-]/g},{"base64-js":127,ieee754:128,"is-array":129}],127:[function(require,module,exports){var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(exports){"use strict";function decode(elt){var code=elt.charCodeAt(0);return code===PLUS||code===PLUS_URL_SAFE?62:code===SLASH||code===SLASH_URL_SAFE?63:NUMBER>code?-1:NUMBER+10>code?code-NUMBER+26+26:UPPER+26>code?code-UPPER:LOWER+26>code?code-LOWER+26:void 0}function b64ToByteArray(b64){function push(v){arr[L++]=v}var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var len=b64.length;placeHolders="="===b64.charAt(len-2)?2:"="===b64.charAt(len-1)?1:0,arr=new Arr(3*b64.length/4-placeHolders),l=placeHolders>0?b64.length-4:b64.length;var L=0;for(i=0,j=0;l>i;i+=4,j+=3)tmp=decode(b64.charAt(i))<<18|decode(b64.charAt(i+1))<<12|decode(b64.charAt(i+2))<<6|decode(b64.charAt(i+3)),push((16711680&tmp)>>16),push((65280&tmp)>>8),push(255&tmp);return 2===placeHolders?(tmp=decode(b64.charAt(i))<<2|decode(b64.charAt(i+1))>>4,push(255&tmp)):1===placeHolders&&(tmp=decode(b64.charAt(i))<<10|decode(b64.charAt(i+1))<<4|decode(b64.charAt(i+2))>>2,push(tmp>>8&255),push(255&tmp)),arr}function uint8ToBase64(uint8){function encode(num){return lookup.charAt(num)}function tripletToBase64(num){return encode(num>>18&63)+encode(num>>12&63)+encode(num>>6&63)+encode(63&num)}var i,temp,length,extraBytes=uint8.length%3,output="";for(i=0,length=uint8.length-extraBytes;length>i;i+=3)temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2],output+=tripletToBase64(temp);switch(extraBytes){case 1:temp=uint8[uint8.length-1],output+=encode(temp>>2),output+=encode(temp<<4&63),output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1],output+=encode(temp>>10),output+=encode(temp>>4&63),output+=encode(temp<<2&63),output+="="}return output}var Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,PLUS="+".charCodeAt(0),SLASH="/".charCodeAt(0),NUMBER="0".charCodeAt(0),LOWER="a".charCodeAt(0),UPPER="A".charCodeAt(0),PLUS_URL_SAFE="-".charCodeAt(0),SLASH_URL_SAFE="_".charCodeAt(0);exports.toByteArray=b64ToByteArray,exports.fromByteArray=uint8ToBase64}("undefined"==typeof exports?this.base64js={}:exports)},{}],128:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:(s?-1:1)*(1/0);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=0>value||0===value&&0>1/value?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias),value*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],129:[function(require,module,exports){var isArray=Array.isArray,str=Object.prototype.toString;module.exports=isArray||function(val){return!!val&&"[object Array]"==str.call(val)}},{}],130:[function(require,module,exports){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(arg){return"function"==typeof arg}function isNumber(arg){return"number"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isUndefined(arg){return void 0===arg}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||0>n||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(er=arguments[1],er instanceof Error)throw er;throw TypeError('Uncaught, unspecified "error" event.')}if(handler=this._events[type],isUndefined(handler))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:for(len=arguments.length,args=new Array(len-1),i=1;len>i;i++)args[i-1]=arguments[i];handler.apply(this,args)}else if(isObject(handler)){for(len=arguments.length,args=new Array(len-1),i=1;len>i;i++)args[i-1]=arguments[i];for(listeners=handler.slice(),len=listeners.length,i=0;len>i;i++)listeners[i].apply(this,args)}return!0},EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned){var m;m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,m&&m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),"function"==typeof console.trace&&console.trace())}return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(type,listener){function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(list=this._events[type],length=list.length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;i-->0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(0>position)return this;
1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(listeners=this._events[type],isFunction(listeners))this.removeListener(type,listeners);else for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){var ret;return ret=this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[]},EventEmitter.listenerCount=function(emitter,type){var ret;return ret=emitter._events&&emitter._events[type]?isFunction(emitter._events[type])?1:emitter._events[type].length:0}},{}],131:[function(require,module,exports){arguments[4][20][0].apply(exports,arguments)},{dup:20}],132:[function(require,module,exports){arguments[4][27][0].apply(exports,arguments)},{dup:27}],133:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){for(var up=0,i=parts.length-1;i>=0;i--){var last=parts[i];"."===last?parts.splice(i,1):".."===last?(parts.splice(i,1),up++):up&&(parts.splice(i,1),up--)}if(allowAboveRoot)for(;up--;up)parts.unshift("..");return parts}function filter(xs,f){if(xs.filter)return xs.filter(f);for(var res=[],i=0;i<xs.length;i++)f(xs[i],i,xs)&&res.push(xs[i]);return res}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){for(var resolvedPath="",resolvedAbsolute=!1,i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if("string"!=typeof path)throw new TypeError("Arguments to path.resolve must be strings");path&&(resolvedPath=path+"/"+resolvedPath,resolvedAbsolute="/"===path.charAt(0))}return resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/"),(resolvedAbsolute?"/":"")+resolvedPath||"."},exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash="/"===substr(path,-1);return path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/"),path||isAbsolute||(path="."),path&&trailingSlash&&(path+="/"),(isAbsolute?"/":"")+path},exports.isAbsolute=function(path){return"/"===path.charAt(0)},exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if("string"!=typeof p)throw new TypeError("Arguments to path.join must be strings");return p}).join("/"))},exports.relative=function(from,to){function trim(arr){for(var start=0;start<arr.length&&""===arr[start];start++);for(var end=arr.length-1;end>=0&&""===arr[end];end--);return start>end?[]:arr.slice(start,end-start+1)}from=exports.resolve(from).substr(1),to=exports.resolve(to).substr(1);for(var fromParts=trim(from.split("/")),toParts=trim(to.split("/")),length=Math.min(fromParts.length,toParts.length),samePartsLength=length,i=0;length>i;i++)if(fromParts[i]!==toParts[i]){samePartsLength=i;break}for(var outputParts=[],i=samePartsLength;i<fromParts.length;i++)outputParts.push("..");return outputParts=outputParts.concat(toParts.slice(samePartsLength)),outputParts.join("/")},exports.sep="/",exports.delimiter=":",exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];return root||dir?(dir&&(dir=dir.substr(0,dir.length-1)),root+dir):"."},exports.basename=function(path,ext){var f=splitPath(path)[2];return ext&&f.substr(-1*ext.length)===ext&&(f=f.substr(0,f.length-ext.length)),f},exports.extname=function(path){return splitPath(path)[3]};var substr="b"==="ab".substr(-1)?function(str,start,len){return str.substr(start,len)}:function(str,start,len){return 0>start&&(start=str.length+start),str.substr(start,len)}}).call(this,require("_process"))},{_process:134}],134:[function(require,module,exports){function cleanUpNextTick(){draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue()}function drainQueue(){if(!draining){var timeout=setTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,clearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var currentQueue,process=module.exports={},queue=[],draining=!1,queueIndex=-1;process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||setTimeout(drainQueue,0)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],135:[function(require,module,exports){arguments[4][37][0].apply(exports,arguments)},{"./lib/_stream_duplex.js":136,dup:37}],136:[function(require,module,exports){arguments[4][38][0].apply(exports,arguments)},{"./_stream_readable":138,"./_stream_writable":140,_process:134,"core-util-is":141,dup:38,inherits:131}],137:[function(require,module,exports){arguments[4][39][0].apply(exports,arguments)},{"./_stream_transform":139,"core-util-is":141,dup:39,inherits:131}],138:[function(require,module,exports){arguments[4][52][0].apply(exports,arguments)},{"./_stream_duplex":136,_process:134,buffer:126,"core-util-is":141,dup:52,events:130,inherits:131,isarray:132,stream:146,"string_decoder/":147,util:125}],139:[function(require,module,exports){arguments[4][53][0].apply(exports,arguments)},{"./_stream_duplex":136,"core-util-is":141,dup:53,inherits:131}],140:[function(require,module,exports){arguments[4][54][0].apply(exports,arguments)},{"./_stream_duplex":136,_process:134,buffer:126,"core-util-is":141,dup:54,inherits:131,stream:146}],141:[function(require,module,exports){arguments[4][26][0].apply(exports,arguments)},{buffer:126,dup:26}],142:[function(require,module,exports){module.exports=require("./lib/_stream_passthrough.js")},{"./lib/_stream_passthrough.js":137}],143:[function(require,module,exports){arguments[4][59][0].apply(exports,arguments)},{"./lib/_stream_duplex.js":136,"./lib/_stream_passthrough.js":137,"./lib/_stream_readable.js":138,"./lib/_stream_transform.js":139,"./lib/_stream_writable.js":140,dup:59,stream:146}],144:[function(require,module,exports){module.exports=require("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":139}],145:[function(require,module,exports){arguments[4][48][0].apply(exports,arguments)},{"./lib/_stream_writable.js":140,dup:48}],146:[function(require,module,exports){function Stream(){EE.call(this)}module.exports=Stream;var EE=require("events").EventEmitter,inherits=require("inherits");inherits(Stream,EE),Stream.Readable=require("readable-stream/readable.js"),Stream.Writable=require("readable-stream/writable.js"),Stream.Duplex=require("readable-stream/duplex.js"),Stream.Transform=require("readable-stream/transform.js"),Stream.PassThrough=require("readable-stream/passthrough.js"),Stream.Stream=Stream,Stream.prototype.pipe=function(dest,options){function ondata(chunk){dest.writable&&!1===dest.write(chunk)&&source.pause&&source.pause()}function ondrain(){source.readable&&source.resume&&source.resume()}function onend(){didOnEnd||(didOnEnd=!0,dest.end())}function onclose(){didOnEnd||(didOnEnd=!0,"function"==typeof dest.destroy&&dest.destroy())}function onerror(er){if(cleanup(),0===EE.listenerCount(this,"error"))throw er}function cleanup(){source.removeListener("data",ondata),dest.removeListener("drain",ondrain),source.removeListener("end",onend),source.removeListener("close",onclose),source.removeListener("error",onerror),dest.removeListener("error",onerror),source.removeListener("end",cleanup),source.removeListener("close",cleanup),dest.removeListener("close",cleanup)}var source=this;source.on("data",ondata),dest.on("drain",ondrain),dest._isStdio||options&&options.end===!1||(source.on("end",onend),source.on("close",onclose));var didOnEnd=!1;return source.on("error",onerror),dest.on("error",onerror),source.on("end",cleanup),source.on("close",cleanup),dest.on("close",cleanup),dest.emit("pipe",source),dest}},{events:130,inherits:131,"readable-stream/duplex.js":135,"readable-stream/passthrough.js":142,"readable-stream/readable.js":143,"readable-stream/transform.js":144,"readable-stream/writable.js":145}],147:[function(require,module,exports){arguments[4][29][0].apply(exports,arguments)},{buffer:126,dup:29}],148:[function(require,module,exports){module.exports=function(arg){return arg&&"object"==typeof arg&&"function"==typeof arg.copy&&"function"==typeof arg.fill&&"function"==typeof arg.readUInt8}},{}],149:[function(require,module,exports){(function(process,global){function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(ctx.depth=arguments[2]),arguments.length>=4&&(ctx.colors=arguments[3]),isBoolean(opts)?ctx.showHidden=opts:opts&&exports._extend(ctx,opts),isUndefined(ctx.showHidden)&&(ctx.showHidden=!1),isUndefined(ctx.depth)&&(ctx.depth=2),isUndefined(ctx.colors)&&(ctx.colors=!1),isUndefined(ctx.customInspect)&&(ctx.customInspect=!0),ctx.colors&&(ctx.stylize=stylizeWithColor),formatValue(ctx,obj,ctx.depth)}function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];return style?"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m":str}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};return array.forEach(function(val,idx){hash[val]=!0}),hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&(!value.constructor||value.constructor.prototype!==value)){var ret=value.inspect(recurseTimes,ctx);return isString(ret)||(ret=formatValue(ctx,ret,recurseTimes)),ret}var primitive=formatPrimitive(ctx,value);if(primitive)return primitive;var keys=Object.keys(value),visibleKeys=arrayToHash(keys);if(ctx.showHidden&&(keys=Object.getOwnPropertyNames(value)),isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0))return formatError(value);if(0===keys.length){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value))return ctx.stylize(RegExp.prototype.toString.call(value),"regexp");if(isDate(value))return ctx.stylize(Date.prototype.toString.call(value),"date");if(isError(value))return formatError(value)}var base="",array=!1,braces=["{","}"];if(isArray(value)&&(array=!0,braces=["[","]"]),isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)&&(base=" "+RegExp.prototype.toString.call(value)),isDate(value)&&(base=" "+Date.prototype.toUTCString.call(value)),isError(value)&&(base=" "+formatError(value)),0===keys.length&&(!array||0==value.length))return braces[0]+base+braces[1];if(0>recurseTimes)return isRegExp(value)?ctx.stylize(RegExp.prototype.toString.call(value),"regexp"):ctx.stylize("[Object]","special");ctx.seen.push(value);var output;return output=array?formatArray(ctx,value,recurseTimes,visibleKeys,keys):keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)}),ctx.seen.pop(),reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}return isNumber(value)?ctx.stylize(""+value,"number"):isBoolean(value)?ctx.stylize(""+value,"boolean"):isNull(value)?ctx.stylize("null","null"):void 0}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){for(var output=[],i=0,l=value.length;l>i;++i)hasOwnProperty(value,String(i))?output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),!0)):output.push("");return keys.forEach(function(key){key.match(/^\d+$/)||output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,!0))}),output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;if(desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]},desc.get?str=desc.set?ctx.stylize("[Getter/Setter]","special"):ctx.stylize("[Getter]","special"):desc.set&&(str=ctx.stylize("[Setter]","special")),hasOwnProperty(visibleKeys,key)||(name="["+key+"]"),str||(ctx.seen.indexOf(desc.value)<0?(str=isNull(recurseTimes)?formatValue(ctx,desc.value,null):formatValue(ctx,desc.value,recurseTimes-1),str.indexOf("\n")>-1&&(str=array?str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2):"\n"+str.split("\n").map(function(line){return"   "+line}).join("\n"))):str=ctx.stylize("[Circular]","special")),isUndefined(name)){if(array&&key.match(/^\d+$/))return str;name=JSON.stringify(""+key),name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(name=name.substr(1,name.length-2),name=ctx.stylize(name,"name")):(name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),name=ctx.stylize(name,"string"))}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0,length=output.reduce(function(prev,cur){return numLinesEst++,cur.indexOf("\n")>=0&&numLinesEst++,prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);return length>60?braces[0]+(""===base?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]:braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}function isBoolean(arg){return"boolean"==typeof arg}function isNull(arg){return null===arg}function isNullOrUndefined(arg){return null==arg}function isNumber(arg){return"number"==typeof arg}function isString(arg){return"string"==typeof arg}function isSymbol(arg){return"symbol"==typeof arg}function isUndefined(arg){return void 0===arg}function isRegExp(re){return isObject(re)&&"[object RegExp]"===objectToString(re)}function isObject(arg){return"object"==typeof arg&&null!==arg}function isDate(d){return isObject(d)&&"[object Date]"===objectToString(d)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(arg){return"function"==typeof arg}function isPrimitive(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||"undefined"==typeof arg}function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return 10>n?"0"+n.toString(10):n.toString(10)}function timestamp(){var d=new Date,time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){for(var objects=[],i=0;i<arguments.length;i++)objects.push(inspect(arguments[i]));return objects.join(" ")}for(var i=1,args=arguments,len=args.length,str=String(f).replace(formatRegExp,function(x){if("%%"===x)return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}}),x=args[i];len>i;x=args[++i])str+=isNull(x)||!isObject(x)?" "+x:" "+inspect(x);return str},exports.deprecate=function(fn,msg){function deprecated(){if(!warned){if(process.throwDeprecation)throw new Error(msg);process.traceDeprecation?console.trace(msg):console.error(msg),warned=!0}return fn.apply(this,arguments)}if(isUndefined(global.process))return function(){return exports.deprecate(fn,msg).apply(this,arguments)};if(process.noDeprecation===!0)return fn;var warned=!1;return deprecated};var debugEnviron,debugs={};exports.debuglog=function(set){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),set=set.toUpperCase(),!debugs[set])if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else debugs[set]=function(){};return debugs[set]},exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=require("./support/isBuffer");var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))},exports.inherits=require("inherits"),exports._extend=function(origin,add){if(!add||!isObject(add))return origin;for(var keys=Object.keys(add),i=keys.length;i--;)origin[keys[i]]=add[keys[i]];return origin}}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":148,_process:134,inherits:131}],150:[function(require,module,exports){!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):global.moment=factory()}(this,function(){"use strict";function utils_hooks__hooks(){return hookCallback.apply(null,arguments)}function setHookCallback(callback){hookCallback=callback}function isArray(input){return"[object Array]"===Object.prototype.toString.call(input)}function isDate(input){return input instanceof Date||"[object Date]"===Object.prototype.toString.call(input)}function map(arr,fn){var i,res=[];for(i=0;i<arr.length;++i)res.push(fn(arr[i],i));return res}function hasOwnProp(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function extend(a,b){for(var i in b)hasOwnProp(b,i)&&(a[i]=b[i]);return hasOwnProp(b,"toString")&&(a.toString=b.toString),hasOwnProp(b,"valueOf")&&(a.valueOf=b.valueOf),a}function create_utc__createUTC(input,format,locale,strict){return createLocalOrUTC(input,format,locale,strict,!0).utc()}function defaultParsingFlags(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function getParsingFlags(m){return null==m._pf&&(m._pf=defaultParsingFlags()),m._pf}function valid__isValid(m){if(null==m._isValid){var flags=getParsingFlags(m);m._isValid=!isNaN(m._d.getTime())&&flags.overflow<0&&!flags.empty&&!flags.invalidMonth&&!flags.nullInput&&!flags.invalidFormat&&!flags.userInvalidated,m._strict&&(m._isValid=m._isValid&&0===flags.charsLeftOver&&0===flags.unusedTokens.length&&void 0===flags.bigHour)}return m._isValid}function valid__createInvalid(flags){var m=create_utc__createUTC(NaN);return null!=flags?extend(getParsingFlags(m),flags):getParsingFlags(m).userInvalidated=!0,m}function copyConfig(to,from){var i,prop,val;if("undefined"!=typeof from._isAMomentObject&&(to._isAMomentObject=from._isAMomentObject),"undefined"!=typeof from._i&&(to._i=from._i),"undefined"!=typeof from._f&&(to._f=from._f),"undefined"!=typeof from._l&&(to._l=from._l),"undefined"!=typeof from._strict&&(to._strict=from._strict),"undefined"!=typeof from._tzm&&(to._tzm=from._tzm),"undefined"!=typeof from._isUTC&&(to._isUTC=from._isUTC),"undefined"!=typeof from._offset&&(to._offset=from._offset),"undefined"!=typeof from._pf&&(to._pf=getParsingFlags(from)),"undefined"!=typeof from._locale&&(to._locale=from._locale),momentProperties.length>0)for(i in momentProperties)prop=momentProperties[i],val=from[prop],"undefined"!=typeof val&&(to[prop]=val);return to}function Moment(config){copyConfig(this,config),this._d=new Date(+config._d),updateInProgress===!1&&(updateInProgress=!0,utils_hooks__hooks.updateOffset(this),updateInProgress=!1)}function isMoment(obj){return obj instanceof Moment||null!=obj&&null!=obj._isAMomentObject}function toInt(argumentForCoercion){var coercedNumber=+argumentForCoercion,value=0;return 0!==coercedNumber&&isFinite(coercedNumber)&&(value=coercedNumber>=0?Math.floor(coercedNumber):Math.ceil(coercedNumber)),value}function compareArrays(array1,array2,dontConvert){var i,len=Math.min(array1.length,array2.length),lengthDiff=Math.abs(array1.length-array2.length),diffs=0;for(i=0;len>i;i++)(dontConvert&&array1[i]!==array2[i]||!dontConvert&&toInt(array1[i])!==toInt(array2[i]))&&diffs++;return diffs+lengthDiff}function Locale(){}function normalizeLocale(key){return key?key.toLowerCase().replace("_","-"):key}function chooseLocale(names){for(var j,next,locale,split,i=0;i<names.length;){for(split=normalizeLocale(names[i]).split("-"),j=split.length,next=normalizeLocale(names[i+1]),next=next?next.split("-"):null;j>0;){if(locale=loadLocale(split.slice(0,j).join("-")))return locale;if(next&&next.length>=j&&compareArrays(split,next,!0)>=j-1)break;j--}i++}return null}function loadLocale(name){var oldLocale=null;if(!locales[name]&&"undefined"!=typeof module&&module&&module.exports)try{oldLocale=globalLocale._abbr,require("./locale/"+name),locale_locales__getSetGlobalLocale(oldLocale)}catch(e){}return locales[name]}function locale_locales__getSetGlobalLocale(key,values){var data;return key&&(data="undefined"==typeof values?locale_locales__getLocale(key):defineLocale(key,values),data&&(globalLocale=data)),globalLocale._abbr}function defineLocale(name,values){return null!==values?(values.abbr=name,locales[name]||(locales[name]=new Locale),locales[name].set(values),locale_locales__getSetGlobalLocale(name),locales[name]):(delete locales[name],null)}function locale_locales__getLocale(key){var locale;if(key&&key._locale&&key._locale._abbr&&(key=key._locale._abbr),!key)return globalLocale;if(!isArray(key)){if(locale=loadLocale(key))return locale;key=[key]}return chooseLocale(key)}function addUnitAlias(unit,shorthand){var lowerCase=unit.toLowerCase();aliases[lowerCase]=aliases[lowerCase+"s"]=aliases[shorthand]=unit}function normalizeUnits(units){return"string"==typeof units?aliases[units]||aliases[units.toLowerCase()]:void 0}function normalizeObjectUnits(inputObject){var normalizedProp,prop,normalizedInput={};for(prop in inputObject)hasOwnProp(inputObject,prop)&&(normalizedProp=normalizeUnits(prop),normalizedProp&&(normalizedInput[normalizedProp]=inputObject[prop]));return normalizedInput}function makeGetSet(unit,keepTime){return function(value){return null!=value?(get_set__set(this,unit,value),utils_hooks__hooks.updateOffset(this,keepTime),this):get_set__get(this,unit)}}function get_set__get(mom,unit){return mom._d["get"+(mom._isUTC?"UTC":"")+unit]()}function get_set__set(mom,unit,value){return mom._d["set"+(mom._isUTC?"UTC":"")+unit](value)}function getSet(units,value){var unit;if("object"==typeof units)for(unit in units)this.set(unit,units[unit]);else if(units=normalizeUnits(units),"function"==typeof this[units])return this[units](value);return this}function zeroFill(number,targetLength,forceSign){for(var output=""+Math.abs(number),sign=number>=0;output.length<targetLength;)output="0"+output;return(sign?forceSign?"+":"":"-")+output}function addFormatToken(token,padded,ordinal,callback){var func=callback;"string"==typeof callback&&(func=function(){return this[callback]()}),token&&(formatTokenFunctions[token]=func),padded&&(formatTokenFunctions[padded[0]]=function(){return zeroFill(func.apply(this,arguments),padded[1],padded[2])}),ordinal&&(formatTokenFunctions[ordinal]=function(){return this.localeData().ordinal(func.apply(this,arguments),token)})}function removeFormattingTokens(input){return input.match(/\[[\s\S]/)?input.replace(/^\[|\]$/g,""):input.replace(/\\/g,"")}function makeFormatFunction(format){var i,length,array=format.match(formattingTokens);for(i=0,length=array.length;length>i;i++)formatTokenFunctions[array[i]]?array[i]=formatTokenFunctions[array[i]]:array[i]=removeFormattingTokens(array[i]);return function(mom){var output="";for(i=0;length>i;i++)output+=array[i]instanceof Function?array[i].call(mom,format):array[i];return output}}function formatMoment(m,format){return m.isValid()?(format=expandFormat(format,m.localeData()),formatFunctions[format]||(formatFunctions[format]=makeFormatFunction(format)),formatFunctions[format](m)):m.localeData().invalidDate()}function expandFormat(format,locale){function replaceLongDateFormatTokens(input){return locale.longDateFormat(input)||input}var i=5;for(localFormattingTokens.lastIndex=0;i>=0&&localFormattingTokens.test(format);)format=format.replace(localFormattingTokens,replaceLongDateFormatTokens),localFormattingTokens.lastIndex=0,i-=1;return format}function addRegexToken(token,regex,strictRegex){regexes[token]="function"==typeof regex?regex:function(isStrict){return isStrict&&strictRegex?strictRegex:regex}}function getParseRegexForToken(token,config){return hasOwnProp(regexes,token)?regexes[token](config._strict,config._locale):new RegExp(unescapeFormat(token))}function unescapeFormat(s){return s.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(matched,p1,p2,p3,p4){return p1||p2||p3||p4}).replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function addParseToken(token,callback){var i,func=callback;for("string"==typeof token&&(token=[token]),"number"==typeof callback&&(func=function(input,array){array[callback]=toInt(input)}),i=0;i<token.length;i++)tokens[token[i]]=func}function addWeekParseToken(token,callback){addParseToken(token,function(input,array,config,token){config._w=config._w||{},callback(input,config._w,config,token)})}function addTimeToArrayFromToken(token,input,config){null!=input&&hasOwnProp(tokens,token)&&tokens[token](input,config._a,config,token)}function daysInMonth(year,month){return new Date(Date.UTC(year,month+1,0)).getUTCDate()}function localeMonths(m){return this._months[m.month()]}function localeMonthsShort(m){return this._monthsShort[m.month()]}function localeMonthsParse(monthName,format,strict){var i,mom,regex;for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),i=0;12>i;i++){if(mom=create_utc__createUTC([2e3,i]),strict&&!this._longMonthsParse[i]&&(this._longMonthsParse[i]=new RegExp("^"+this.months(mom,"").replace(".","")+"$","i"),this._shortMonthsParse[i]=new RegExp("^"+this.monthsShort(mom,"").replace(".","")+"$","i")),strict||this._monthsParse[i]||(regex="^"+this.months(mom,"")+"|^"+this.monthsShort(mom,""),this._monthsParse[i]=new RegExp(regex.replace(".",""),"i")),strict&&"MMMM"===format&&this._longMonthsParse[i].test(monthName))return i;if(strict&&"MMM"===format&&this._shortMonthsParse[i].test(monthName))return i;if(!strict&&this._monthsParse[i].test(monthName))return i}}function setMonth(mom,value){var dayOfMonth;return"string"==typeof value&&(value=mom.localeData().monthsParse(value),"number"!=typeof value)?mom:(dayOfMonth=Math.min(mom.date(),daysInMonth(mom.year(),value)),mom._d["set"+(mom._isUTC?"UTC":"")+"Month"](value,dayOfMonth),mom)}function getSetMonth(value){return null!=value?(setMonth(this,value),utils_hooks__hooks.updateOffset(this,!0),this):get_set__get(this,"Month")}function getDaysInMonth(){return daysInMonth(this.year(),this.month())}function checkOverflow(m){var overflow,a=m._a;return a&&-2===getParsingFlags(m).overflow&&(overflow=a[MONTH]<0||a[MONTH]>11?MONTH:a[DATE]<1||a[DATE]>daysInMonth(a[YEAR],a[MONTH])?DATE:a[HOUR]<0||a[HOUR]>24||24===a[HOUR]&&(0!==a[MINUTE]||0!==a[SECOND]||0!==a[MILLISECOND])?HOUR:a[MINUTE]<0||a[MINUTE]>59?MINUTE:a[SECOND]<0||a[SECOND]>59?SECOND:a[MILLISECOND]<0||a[MILLISECOND]>999?MILLISECOND:-1,getParsingFlags(m)._overflowDayOfYear&&(YEAR>overflow||overflow>DATE)&&(overflow=DATE),getParsingFlags(m).overflow=overflow),m}function warn(msg){utils_hooks__hooks.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+msg)}function deprecate(msg,fn){var firstTime=!0,msgWithStack=msg+"\n"+(new Error).stack;return extend(function(){return firstTime&&(warn(msgWithStack),firstTime=!1),fn.apply(this,arguments)},fn)}function deprecateSimple(name,msg){deprecations[name]||(warn(msg),deprecations[name]=!0)}function configFromISO(config){var i,l,string=config._i,match=from_string__isoRegex.exec(string);if(match){for(getParsingFlags(config).iso=!0,i=0,l=isoDates.length;l>i;i++)if(isoDates[i][1].exec(string)){config._f=isoDates[i][0]+(match[6]||" ");break}for(i=0,l=isoTimes.length;l>i;i++)if(isoTimes[i][1].exec(string)){config._f+=isoTimes[i][0];break}string.match(matchOffset)&&(config._f+="Z"),configFromStringAndFormat(config)}else config._isValid=!1}function configFromString(config){var matched=aspNetJsonRegex.exec(config._i);return null!==matched?void(config._d=new Date(+matched[1])):(configFromISO(config),void(config._isValid===!1&&(delete config._isValid,utils_hooks__hooks.createFromInputFallback(config))))}function createDate(y,m,d,h,M,s,ms){var date=new Date(y,m,d,h,M,s,ms);return 1970>y&&date.setFullYear(y),date}function createUTCDate(y){var date=new Date(Date.UTC.apply(null,arguments));return 1970>y&&date.setUTCFullYear(y),date}function daysInYear(year){return isLeapYear(year)?366:365}function isLeapYear(year){return year%4===0&&year%100!==0||year%400===0}function getIsLeapYear(){return isLeapYear(this.year())}function weekOfYear(mom,firstDayOfWeek,firstDayOfWeekOfYear){var adjustedMoment,end=firstDayOfWeekOfYear-firstDayOfWeek,daysToDayOfWeek=firstDayOfWeekOfYear-mom.day();return daysToDayOfWeek>end&&(daysToDayOfWeek-=7),end-7>daysToDayOfWeek&&(daysToDayOfWeek+=7),adjustedMoment=local__createLocal(mom).add(daysToDayOfWeek,"d"),{week:Math.ceil(adjustedMoment.dayOfYear()/7),year:adjustedMoment.year()}}function localeWeek(mom){return weekOfYear(mom,this._week.dow,this._week.doy).week}function localeFirstDayOfWeek(){return this._week.dow}function localeFirstDayOfYear(){return this._week.doy}function getSetWeek(input){var week=this.localeData().week(this);return null==input?week:this.add(7*(input-week),"d")}function getSetISOWeek(input){var week=weekOfYear(this,1,4).week;return null==input?week:this.add(7*(input-week),"d")}function dayOfYearFromWeeks(year,week,weekday,firstDayOfWeekOfYear,firstDayOfWeek){var daysToAdd,dayOfYear,d=createUTCDate(year,0,1).getUTCDay();return d=0===d?7:d,weekday=null!=weekday?weekday:firstDayOfWeek,daysToAdd=firstDayOfWeek-d+(d>firstDayOfWeekOfYear?7:0)-(firstDayOfWeek>d?7:0),dayOfYear=7*(week-1)+(weekday-firstDayOfWeek)+daysToAdd+1,{year:dayOfYear>0?year:year-1,dayOfYear:dayOfYear>0?dayOfYear:daysInYear(year-1)+dayOfYear}}function getSetDayOfYear(input){var dayOfYear=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;
return null==input?dayOfYear:this.add(input-dayOfYear,"d")}function defaults(a,b,c){return null!=a?a:null!=b?b:c}function currentDateArray(config){var now=new Date;return config._useUTC?[now.getUTCFullYear(),now.getUTCMonth(),now.getUTCDate()]:[now.getFullYear(),now.getMonth(),now.getDate()]}function configFromArray(config){var i,date,currentDate,yearToUse,input=[];if(!config._d){for(currentDate=currentDateArray(config),config._w&&null==config._a[DATE]&&null==config._a[MONTH]&&dayOfYearFromWeekInfo(config),config._dayOfYear&&(yearToUse=defaults(config._a[YEAR],currentDate[YEAR]),config._dayOfYear>daysInYear(yearToUse)&&(getParsingFlags(config)._overflowDayOfYear=!0),date=createUTCDate(yearToUse,0,config._dayOfYear),config._a[MONTH]=date.getUTCMonth(),config._a[DATE]=date.getUTCDate()),i=0;3>i&&null==config._a[i];++i)config._a[i]=input[i]=currentDate[i];for(;7>i;i++)config._a[i]=input[i]=null==config._a[i]?2===i?1:0:config._a[i];24===config._a[HOUR]&&0===config._a[MINUTE]&&0===config._a[SECOND]&&0===config._a[MILLISECOND]&&(config._nextDay=!0,config._a[HOUR]=0),config._d=(config._useUTC?createUTCDate:createDate).apply(null,input),null!=config._tzm&&config._d.setUTCMinutes(config._d.getUTCMinutes()-config._tzm),config._nextDay&&(config._a[HOUR]=24)}}function dayOfYearFromWeekInfo(config){var w,weekYear,week,weekday,dow,doy,temp;w=config._w,null!=w.GG||null!=w.W||null!=w.E?(dow=1,doy=4,weekYear=defaults(w.GG,config._a[YEAR],weekOfYear(local__createLocal(),1,4).year),week=defaults(w.W,1),weekday=defaults(w.E,1)):(dow=config._locale._week.dow,doy=config._locale._week.doy,weekYear=defaults(w.gg,config._a[YEAR],weekOfYear(local__createLocal(),dow,doy).year),week=defaults(w.w,1),null!=w.d?(weekday=w.d,dow>weekday&&++week):weekday=null!=w.e?w.e+dow:dow),temp=dayOfYearFromWeeks(weekYear,week,weekday,doy,dow),config._a[YEAR]=temp.year,config._dayOfYear=temp.dayOfYear}function configFromStringAndFormat(config){if(config._f===utils_hooks__hooks.ISO_8601)return void configFromISO(config);config._a=[],getParsingFlags(config).empty=!0;var i,parsedInput,tokens,token,skipped,string=""+config._i,stringLength=string.length,totalParsedInputLength=0;for(tokens=expandFormat(config._f,config._locale).match(formattingTokens)||[],i=0;i<tokens.length;i++)token=tokens[i],parsedInput=(string.match(getParseRegexForToken(token,config))||[])[0],parsedInput&&(skipped=string.substr(0,string.indexOf(parsedInput)),skipped.length>0&&getParsingFlags(config).unusedInput.push(skipped),string=string.slice(string.indexOf(parsedInput)+parsedInput.length),totalParsedInputLength+=parsedInput.length),formatTokenFunctions[token]?(parsedInput?getParsingFlags(config).empty=!1:getParsingFlags(config).unusedTokens.push(token),addTimeToArrayFromToken(token,parsedInput,config)):config._strict&&!parsedInput&&getParsingFlags(config).unusedTokens.push(token);getParsingFlags(config).charsLeftOver=stringLength-totalParsedInputLength,string.length>0&&getParsingFlags(config).unusedInput.push(string),getParsingFlags(config).bigHour===!0&&config._a[HOUR]<=12&&config._a[HOUR]>0&&(getParsingFlags(config).bigHour=void 0),config._a[HOUR]=meridiemFixWrap(config._locale,config._a[HOUR],config._meridiem),configFromArray(config),checkOverflow(config)}function meridiemFixWrap(locale,hour,meridiem){var isPm;return null==meridiem?hour:null!=locale.meridiemHour?locale.meridiemHour(hour,meridiem):null!=locale.isPM?(isPm=locale.isPM(meridiem),isPm&&12>hour&&(hour+=12),isPm||12!==hour||(hour=0),hour):hour}function configFromStringAndArray(config){var tempConfig,bestMoment,scoreToBeat,i,currentScore;if(0===config._f.length)return getParsingFlags(config).invalidFormat=!0,void(config._d=new Date(NaN));for(i=0;i<config._f.length;i++)currentScore=0,tempConfig=copyConfig({},config),null!=config._useUTC&&(tempConfig._useUTC=config._useUTC),tempConfig._f=config._f[i],configFromStringAndFormat(tempConfig),valid__isValid(tempConfig)&&(currentScore+=getParsingFlags(tempConfig).charsLeftOver,currentScore+=10*getParsingFlags(tempConfig).unusedTokens.length,getParsingFlags(tempConfig).score=currentScore,(null==scoreToBeat||scoreToBeat>currentScore)&&(scoreToBeat=currentScore,bestMoment=tempConfig));extend(config,bestMoment||tempConfig)}function configFromObject(config){if(!config._d){var i=normalizeObjectUnits(config._i);config._a=[i.year,i.month,i.day||i.date,i.hour,i.minute,i.second,i.millisecond],configFromArray(config)}}function createFromConfig(config){var res,input=config._i,format=config._f;return config._locale=config._locale||locale_locales__getLocale(config._l),null===input||void 0===format&&""===input?valid__createInvalid({nullInput:!0}):("string"==typeof input&&(config._i=input=config._locale.preparse(input)),isMoment(input)?new Moment(checkOverflow(input)):(isArray(format)?configFromStringAndArray(config):format?configFromStringAndFormat(config):isDate(input)?config._d=input:configFromInput(config),res=new Moment(checkOverflow(config)),res._nextDay&&(res.add(1,"d"),res._nextDay=void 0),res))}function configFromInput(config){var input=config._i;void 0===input?config._d=new Date:isDate(input)?config._d=new Date(+input):"string"==typeof input?configFromString(config):isArray(input)?(config._a=map(input.slice(0),function(obj){return parseInt(obj,10)}),configFromArray(config)):"object"==typeof input?configFromObject(config):"number"==typeof input?config._d=new Date(input):utils_hooks__hooks.createFromInputFallback(config)}function createLocalOrUTC(input,format,locale,strict,isUTC){var c={};return"boolean"==typeof locale&&(strict=locale,locale=void 0),c._isAMomentObject=!0,c._useUTC=c._isUTC=isUTC,c._l=locale,c._i=input,c._f=format,c._strict=strict,createFromConfig(c)}function local__createLocal(input,format,locale,strict){return createLocalOrUTC(input,format,locale,strict,!1)}function pickBy(fn,moments){var res,i;if(1===moments.length&&isArray(moments[0])&&(moments=moments[0]),!moments.length)return local__createLocal();for(res=moments[0],i=1;i<moments.length;++i)moments[i][fn](res)&&(res=moments[i]);return res}function min(){var args=[].slice.call(arguments,0);return pickBy("isBefore",args)}function max(){var args=[].slice.call(arguments,0);return pickBy("isAfter",args)}function Duration(duration){var normalizedInput=normalizeObjectUnits(duration),years=normalizedInput.year||0,quarters=normalizedInput.quarter||0,months=normalizedInput.month||0,weeks=normalizedInput.week||0,days=normalizedInput.day||0,hours=normalizedInput.hour||0,minutes=normalizedInput.minute||0,seconds=normalizedInput.second||0,milliseconds=normalizedInput.millisecond||0;this._milliseconds=+milliseconds+1e3*seconds+6e4*minutes+36e5*hours,this._days=+days+7*weeks,this._months=+months+3*quarters+12*years,this._data={},this._locale=locale_locales__getLocale(),this._bubble()}function isDuration(obj){return obj instanceof Duration}function offset(token,separator){addFormatToken(token,0,0,function(){var offset=this.utcOffset(),sign="+";return 0>offset&&(offset=-offset,sign="-"),sign+zeroFill(~~(offset/60),2)+separator+zeroFill(~~offset%60,2)})}function offsetFromString(string){var matches=(string||"").match(matchOffset)||[],chunk=matches[matches.length-1]||[],parts=(chunk+"").match(chunkOffset)||["-",0,0],minutes=+(60*parts[1])+toInt(parts[2]);return"+"===parts[0]?minutes:-minutes}function cloneWithOffset(input,model){var res,diff;return model._isUTC?(res=model.clone(),diff=(isMoment(input)||isDate(input)?+input:+local__createLocal(input))-+res,res._d.setTime(+res._d+diff),utils_hooks__hooks.updateOffset(res,!1),res):local__createLocal(input).local()}function getDateOffset(m){return 15*-Math.round(m._d.getTimezoneOffset()/15)}function getSetOffset(input,keepLocalTime){var localAdjust,offset=this._offset||0;return null!=input?("string"==typeof input&&(input=offsetFromString(input)),Math.abs(input)<16&&(input=60*input),!this._isUTC&&keepLocalTime&&(localAdjust=getDateOffset(this)),this._offset=input,this._isUTC=!0,null!=localAdjust&&this.add(localAdjust,"m"),offset!==input&&(!keepLocalTime||this._changeInProgress?add_subtract__addSubtract(this,create__createDuration(input-offset,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,utils_hooks__hooks.updateOffset(this,!0),this._changeInProgress=null)),this):this._isUTC?offset:getDateOffset(this)}function getSetZone(input,keepLocalTime){return null!=input?("string"!=typeof input&&(input=-input),this.utcOffset(input,keepLocalTime),this):-this.utcOffset()}function setOffsetToUTC(keepLocalTime){return this.utcOffset(0,keepLocalTime)}function setOffsetToLocal(keepLocalTime){return this._isUTC&&(this.utcOffset(0,keepLocalTime),this._isUTC=!1,keepLocalTime&&this.subtract(getDateOffset(this),"m")),this}function setOffsetToParsedOffset(){return this._tzm?this.utcOffset(this._tzm):"string"==typeof this._i&&this.utcOffset(offsetFromString(this._i)),this}function hasAlignedHourOffset(input){return input=input?local__createLocal(input).utcOffset():0,(this.utcOffset()-input)%60===0}function isDaylightSavingTime(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function isDaylightSavingTimeShifted(){if(this._a){var other=this._isUTC?create_utc__createUTC(this._a):local__createLocal(this._a);return this.isValid()&&compareArrays(this._a,other.toArray())>0}return!1}function isLocal(){return!this._isUTC}function isUtcOffset(){return this._isUTC}function isUtc(){return this._isUTC&&0===this._offset}function create__createDuration(input,key){var sign,ret,diffRes,duration=input,match=null;return isDuration(input)?duration={ms:input._milliseconds,d:input._days,M:input._months}:"number"==typeof input?(duration={},key?duration[key]=input:duration.milliseconds=input):(match=aspNetRegex.exec(input))?(sign="-"===match[1]?-1:1,duration={y:0,d:toInt(match[DATE])*sign,h:toInt(match[HOUR])*sign,m:toInt(match[MINUTE])*sign,s:toInt(match[SECOND])*sign,ms:toInt(match[MILLISECOND])*sign}):(match=create__isoRegex.exec(input))?(sign="-"===match[1]?-1:1,duration={y:parseIso(match[2],sign),M:parseIso(match[3],sign),d:parseIso(match[4],sign),h:parseIso(match[5],sign),m:parseIso(match[6],sign),s:parseIso(match[7],sign),w:parseIso(match[8],sign)}):null==duration?duration={}:"object"==typeof duration&&("from"in duration||"to"in duration)&&(diffRes=momentsDifference(local__createLocal(duration.from),local__createLocal(duration.to)),duration={},duration.ms=diffRes.milliseconds,duration.M=diffRes.months),ret=new Duration(duration),isDuration(input)&&hasOwnProp(input,"_locale")&&(ret._locale=input._locale),ret}function parseIso(inp,sign){var res=inp&&parseFloat(inp.replace(",","."));return(isNaN(res)?0:res)*sign}function positiveMomentsDifference(base,other){var res={milliseconds:0,months:0};return res.months=other.month()-base.month()+12*(other.year()-base.year()),base.clone().add(res.months,"M").isAfter(other)&&--res.months,res.milliseconds=+other-+base.clone().add(res.months,"M"),res}function momentsDifference(base,other){var res;return other=cloneWithOffset(other,base),base.isBefore(other)?res=positiveMomentsDifference(base,other):(res=positiveMomentsDifference(other,base),res.milliseconds=-res.milliseconds,res.months=-res.months),res}function createAdder(direction,name){return function(val,period){var dur,tmp;return null===period||isNaN(+period)||(deprecateSimple(name,"moment()."+name+"(period, number) is deprecated. Please use moment()."+name+"(number, period)."),tmp=val,val=period,period=tmp),val="string"==typeof val?+val:val,dur=create__createDuration(val,period),add_subtract__addSubtract(this,dur,direction),this}}function add_subtract__addSubtract(mom,duration,isAdding,updateOffset){var milliseconds=duration._milliseconds,days=duration._days,months=duration._months;updateOffset=null==updateOffset?!0:updateOffset,milliseconds&&mom._d.setTime(+mom._d+milliseconds*isAdding),days&&get_set__set(mom,"Date",get_set__get(mom,"Date")+days*isAdding),months&&setMonth(mom,get_set__get(mom,"Month")+months*isAdding),updateOffset&&utils_hooks__hooks.updateOffset(mom,days||months)}function moment_calendar__calendar(time){var now=time||local__createLocal(),sod=cloneWithOffset(now,this).startOf("day"),diff=this.diff(sod,"days",!0),format=-6>diff?"sameElse":-1>diff?"lastWeek":0>diff?"lastDay":1>diff?"sameDay":2>diff?"nextDay":7>diff?"nextWeek":"sameElse";return this.format(this.localeData().calendar(format,this,local__createLocal(now)))}function clone(){return new Moment(this)}function isAfter(input,units){var inputMs;return units=normalizeUnits("undefined"!=typeof units?units:"millisecond"),"millisecond"===units?(input=isMoment(input)?input:local__createLocal(input),+this>+input):(inputMs=isMoment(input)?+input:+local__createLocal(input),inputMs<+this.clone().startOf(units))}function isBefore(input,units){var inputMs;return units=normalizeUnits("undefined"!=typeof units?units:"millisecond"),"millisecond"===units?(input=isMoment(input)?input:local__createLocal(input),+input>+this):(inputMs=isMoment(input)?+input:+local__createLocal(input),+this.clone().endOf(units)<inputMs)}function isBetween(from,to,units){return this.isAfter(from,units)&&this.isBefore(to,units)}function isSame(input,units){var inputMs;return units=normalizeUnits(units||"millisecond"),"millisecond"===units?(input=isMoment(input)?input:local__createLocal(input),+this===+input):(inputMs=+local__createLocal(input),+this.clone().startOf(units)<=inputMs&&inputMs<=+this.clone().endOf(units))}function absFloor(number){return 0>number?Math.ceil(number):Math.floor(number)}function diff(input,units,asFloat){var delta,output,that=cloneWithOffset(input,this),zoneDelta=6e4*(that.utcOffset()-this.utcOffset());return units=normalizeUnits(units),"year"===units||"month"===units||"quarter"===units?(output=monthDiff(this,that),"quarter"===units?output/=3:"year"===units&&(output/=12)):(delta=this-that,output="second"===units?delta/1e3:"minute"===units?delta/6e4:"hour"===units?delta/36e5:"day"===units?(delta-zoneDelta)/864e5:"week"===units?(delta-zoneDelta)/6048e5:delta),asFloat?output:absFloor(output)}function monthDiff(a,b){var anchor2,adjust,wholeMonthDiff=12*(b.year()-a.year())+(b.month()-a.month()),anchor=a.clone().add(wholeMonthDiff,"months");return 0>b-anchor?(anchor2=a.clone().add(wholeMonthDiff-1,"months"),adjust=(b-anchor)/(anchor-anchor2)):(anchor2=a.clone().add(wholeMonthDiff+1,"months"),adjust=(b-anchor)/(anchor2-anchor)),-(wholeMonthDiff+adjust)}function toString(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function moment_format__toISOString(){var m=this.clone().utc();return 0<m.year()&&m.year()<=9999?"function"==typeof Date.prototype.toISOString?this.toDate().toISOString():formatMoment(m,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):formatMoment(m,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}function format(inputString){var output=formatMoment(this,inputString||utils_hooks__hooks.defaultFormat);return this.localeData().postformat(output)}function from(time,withoutSuffix){return this.isValid()?create__createDuration({to:this,from:time}).locale(this.locale()).humanize(!withoutSuffix):this.localeData().invalidDate()}function fromNow(withoutSuffix){return this.from(local__createLocal(),withoutSuffix)}function to(time,withoutSuffix){return this.isValid()?create__createDuration({from:this,to:time}).locale(this.locale()).humanize(!withoutSuffix):this.localeData().invalidDate()}function toNow(withoutSuffix){return this.to(local__createLocal(),withoutSuffix)}function locale(key){var newLocaleData;return void 0===key?this._locale._abbr:(newLocaleData=locale_locales__getLocale(key),null!=newLocaleData&&(this._locale=newLocaleData),this)}function localeData(){return this._locale}function startOf(units){switch(units=normalizeUnits(units)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===units&&this.weekday(0),"isoWeek"===units&&this.isoWeekday(1),"quarter"===units&&this.month(3*Math.floor(this.month()/3)),this}function endOf(units){return units=normalizeUnits(units),void 0===units||"millisecond"===units?this:this.startOf(units).add(1,"isoWeek"===units?"week":units).subtract(1,"ms")}function to_type__valueOf(){return+this._d-6e4*(this._offset||0)}function unix(){return Math.floor(+this/1e3)}function toDate(){return this._offset?new Date(+this):this._d}function toArray(){var m=this;return[m.year(),m.month(),m.date(),m.hour(),m.minute(),m.second(),m.millisecond()]}function moment_valid__isValid(){return valid__isValid(this)}function parsingFlags(){return extend({},getParsingFlags(this))}function invalidAt(){return getParsingFlags(this).overflow}function addWeekYearFormatToken(token,getter){addFormatToken(0,[token,token.length],0,getter)}function weeksInYear(year,dow,doy){return weekOfYear(local__createLocal([year,11,31+dow-doy]),dow,doy).week}function getSetWeekYear(input){var year=weekOfYear(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return null==input?year:this.add(input-year,"y")}function getSetISOWeekYear(input){var year=weekOfYear(this,1,4).year;return null==input?year:this.add(input-year,"y")}function getISOWeeksInYear(){return weeksInYear(this.year(),1,4)}function getWeeksInYear(){var weekInfo=this.localeData()._week;return weeksInYear(this.year(),weekInfo.dow,weekInfo.doy)}function getSetQuarter(input){return null==input?Math.ceil((this.month()+1)/3):this.month(3*(input-1)+this.month()%3)}function parseWeekday(input,locale){if("string"==typeof input)if(isNaN(input)){if(input=locale.weekdaysParse(input),"number"!=typeof input)return null}else input=parseInt(input,10);return input}function localeWeekdays(m){return this._weekdays[m.day()]}function localeWeekdaysShort(m){return this._weekdaysShort[m.day()]}function localeWeekdaysMin(m){return this._weekdaysMin[m.day()]}function localeWeekdaysParse(weekdayName){var i,mom,regex;for(this._weekdaysParse||(this._weekdaysParse=[]),i=0;7>i;i++)if(this._weekdaysParse[i]||(mom=local__createLocal([2e3,1]).day(i),regex="^"+this.weekdays(mom,"")+"|^"+this.weekdaysShort(mom,"")+"|^"+this.weekdaysMin(mom,""),this._weekdaysParse[i]=new RegExp(regex.replace(".",""),"i")),this._weekdaysParse[i].test(weekdayName))return i}function getSetDayOfWeek(input){var day=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=input?(input=parseWeekday(input,this.localeData()),this.add(input-day,"d")):day}function getSetLocaleDayOfWeek(input){var weekday=(this.day()+7-this.localeData()._week.dow)%7;return null==input?weekday:this.add(input-weekday,"d")}function getSetISODayOfWeek(input){return null==input?this.day()||7:this.day(this.day()%7?input:input-7)}function meridiem(token,lowercase){addFormatToken(token,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),lowercase)})}function matchMeridiem(isStrict,locale){return locale._meridiemParse}function localeIsPM(input){return"p"===(input+"").toLowerCase().charAt(0)}function localeMeridiem(hours,minutes,isLower){return hours>11?isLower?"pm":"PM":isLower?"am":"AM"}function millisecond__milliseconds(token){addFormatToken(0,[token,3],0,"millisecond")}function getZoneAbbr(){return this._isUTC?"UTC":""}function getZoneName(){return this._isUTC?"Coordinated Universal Time":""}function moment__createUnix(input){return local__createLocal(1e3*input)}function moment__createInZone(){return local__createLocal.apply(null,arguments).parseZone()}function locale_calendar__calendar(key,mom,now){var output=this._calendar[key];return"function"==typeof output?output.call(mom,now):output}function longDateFormat(key){var output=this._longDateFormat[key];return!output&&this._longDateFormat[key.toUpperCase()]&&(output=this._longDateFormat[key.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(val){return val.slice(1)}),this._longDateFormat[key]=output),output}function invalidDate(){return this._invalidDate}function ordinal(number){return this._ordinal.replace("%d",number)}function preParsePostFormat(string){return string}function relative__relativeTime(number,withoutSuffix,string,isFuture){var output=this._relativeTime[string];return"function"==typeof output?output(number,withoutSuffix,string,isFuture):output.replace(/%d/i,number)}function pastFuture(diff,output){var format=this._relativeTime[diff>0?"future":"past"];return"function"==typeof format?format(output):format.replace(/%s/i,output)}function locale_set__set(config){var prop,i;for(i in config)prop=config[i],"function"==typeof prop?this[i]=prop:this["_"+i]=prop;this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)}function lists__get(format,index,field,setter){var locale=locale_locales__getLocale(),utc=create_utc__createUTC().set(setter,index);return locale[field](utc,format)}function list(format,index,field,count,setter){if("number"==typeof format&&(index=format,format=void 0),format=format||"",null!=index)return lists__get(format,index,field,setter);var i,out=[];for(i=0;count>i;i++)out[i]=lists__get(format,i,field,setter);return out}function lists__listMonths(format,index){return list(format,index,"months",12,"month")}function lists__listMonthsShort(format,index){return list(format,index,"monthsShort",12,"month")}function lists__listWeekdays(format,index){return list(format,index,"weekdays",7,"day")}function lists__listWeekdaysShort(format,index){return list(format,index,"weekdaysShort",7,"day")}function lists__listWeekdaysMin(format,index){return list(format,index,"weekdaysMin",7,"day")}function duration_abs__abs(){var data=this._data;return this._milliseconds=mathAbs(this._milliseconds),this._days=mathAbs(this._days),this._months=mathAbs(this._months),data.milliseconds=mathAbs(data.milliseconds),data.seconds=mathAbs(data.seconds),data.minutes=mathAbs(data.minutes),data.hours=mathAbs(data.hours),data.months=mathAbs(data.months),data.years=mathAbs(data.years),this}function duration_add_subtract__addSubtract(duration,input,value,direction){var other=create__createDuration(input,value);return duration._milliseconds+=direction*other._milliseconds,duration._days+=direction*other._days,duration._months+=direction*other._months,duration._bubble()}function duration_add_subtract__add(input,value){return duration_add_subtract__addSubtract(this,input,value,1)}function duration_add_subtract__subtract(input,value){return duration_add_subtract__addSubtract(this,input,value,-1)}function bubble(){var seconds,minutes,hours,milliseconds=this._milliseconds,days=this._days,months=this._months,data=this._data,years=0;return data.milliseconds=milliseconds%1e3,seconds=absFloor(milliseconds/1e3),data.seconds=seconds%60,minutes=absFloor(seconds/60),data.minutes=minutes%60,hours=absFloor(minutes/60),data.hours=hours%24,days+=absFloor(hours/24),years=absFloor(daysToYears(days)),days-=absFloor(yearsToDays(years)),months+=absFloor(days/30),days%=30,years+=absFloor(months/12),months%=12,data.days=days,data.months=months,data.years=years,this}function daysToYears(days){return 400*days/146097}function yearsToDays(years){return 146097*years/400}function as(units){var days,months,milliseconds=this._milliseconds;if(units=normalizeUnits(units),"month"===units||"year"===units)return days=this._days+milliseconds/864e5,months=this._months+12*daysToYears(days),"month"===units?months:months/12;switch(days=this._days+Math.round(yearsToDays(this._months/12)),units){case"week":return days/7+milliseconds/6048e5;case"day":return days+milliseconds/864e5;case"hour":return 24*days+milliseconds/36e5;case"minute":return 1440*days+milliseconds/6e4;case"second":return 86400*days+milliseconds/1e3;case"millisecond":return Math.floor(864e5*days)+milliseconds;default:throw new Error("Unknown unit "+units)}}function duration_as__valueOf(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*toInt(this._months/12)}function makeAs(alias){return function(){return this.as(alias)}}function duration_get__get(units){return units=normalizeUnits(units),this[units+"s"]()}function makeGetter(name){return function(){return this._data[name]}}function weeks(){return absFloor(this.days()/7)}function substituteTimeAgo(string,number,withoutSuffix,isFuture,locale){return locale.relativeTime(number||1,!!withoutSuffix,string,isFuture)}function duration_humanize__relativeTime(posNegDuration,withoutSuffix,locale){var duration=create__createDuration(posNegDuration).abs(),seconds=round(duration.as("s")),minutes=round(duration.as("m")),hours=round(duration.as("h")),days=round(duration.as("d")),months=round(duration.as("M")),years=round(duration.as("y")),a=seconds<thresholds.s&&["s",seconds]||1===minutes&&["m"]||minutes<thresholds.m&&["mm",minutes]||1===hours&&["h"]||hours<thresholds.h&&["hh",hours]||1===days&&["d"]||days<thresholds.d&&["dd",days]||1===months&&["M"]||months<thresholds.M&&["MM",months]||1===years&&["y"]||["yy",years];return a[2]=withoutSuffix,a[3]=+posNegDuration>0,a[4]=locale,substituteTimeAgo.apply(null,a)}function duration_humanize__getSetRelativeTimeThreshold(threshold,limit){return void 0===thresholds[threshold]?!1:void 0===limit?thresholds[threshold]:(thresholds[threshold]=limit,!0)}function humanize(withSuffix){var locale=this.localeData(),output=duration_humanize__relativeTime(this,!withSuffix,locale);return withSuffix&&(output=locale.pastFuture(+this,output)),locale.postformat(output)}function iso_string__toISOString(){var Y=iso_string__abs(this.years()),M=iso_string__abs(this.months()),D=iso_string__abs(this.days()),h=iso_string__abs(this.hours()),m=iso_string__abs(this.minutes()),s=iso_string__abs(this.seconds()+this.milliseconds()/1e3),total=this.asSeconds();return total?(0>total?"-":"")+"P"+(Y?Y+"Y":"")+(M?M+"M":"")+(D?D+"D":"")+(h||m||s?"T":"")+(h?h+"H":"")+(m?m+"M":"")+(s?s+"S":""):"P0D"}var hookCallback,globalLocale,momentProperties=utils_hooks__hooks.momentProperties=[],updateInProgress=!1,locales={},aliases={},formattingTokens=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|x|X|zz?|ZZ?|.)/g,localFormattingTokens=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,formatFunctions={},formatTokenFunctions={},match1=/\d/,match2=/\d\d/,match3=/\d{3}/,match4=/\d{4}/,match6=/[+-]?\d{6}/,match1to2=/\d\d?/,match1to3=/\d{1,3}/,match1to4=/\d{1,4}/,match1to6=/[+-]?\d{1,6}/,matchUnsigned=/\d+/,matchSigned=/[+-]?\d+/,matchOffset=/Z|[+-]\d\d:?\d\d/gi,matchTimestamp=/[+-]?\d+(\.\d{1,3})?/,matchWord=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,regexes={},tokens={},YEAR=0,MONTH=1,DATE=2,HOUR=3,MINUTE=4,SECOND=5,MILLISECOND=6;addFormatToken("M",["MM",2],"Mo",function(){return this.month()+1}),addFormatToken("MMM",0,0,function(format){return this.localeData().monthsShort(this,format)}),addFormatToken("MMMM",0,0,function(format){return this.localeData().months(this,format)}),addUnitAlias("month","M"),addRegexToken("M",match1to2),addRegexToken("MM",match1to2,match2),addRegexToken("MMM",matchWord),addRegexToken("MMMM",matchWord),addParseToken(["M","MM"],function(input,array){array[MONTH]=toInt(input)-1}),addParseToken(["MMM","MMMM"],function(input,array,config,token){var month=config._locale.monthsParse(input,token,config._strict);null!=month?array[MONTH]=month:getParsingFlags(config).invalidMonth=input});var defaultLocaleMonths="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),defaultLocaleMonthsShort="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),deprecations={};utils_hooks__hooks.suppressDeprecationWarnings=!1;var from_string__isoRegex=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,isoDates=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],isoTimes=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],aspNetJsonRegex=/^\/?Date\((\-?\d+)/i;utils_hooks__hooks.createFromInputFallback=deprecate("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(config){config._d=new Date(config._i+(config._useUTC?" UTC":""))}),addFormatToken(0,["YY",2],0,function(){return this.year()%100}),addFormatToken(0,["YYYY",4],0,"year"),addFormatToken(0,["YYYYY",5],0,"year"),addFormatToken(0,["YYYYYY",6,!0],0,"year"),addUnitAlias("year","y"),addRegexToken("Y",matchSigned),addRegexToken("YY",match1to2,match2),addRegexToken("YYYY",match1to4,match4),addRegexToken("YYYYY",match1to6,match6),addRegexToken("YYYYYY",match1to6,match6),addParseToken(["YYYY","YYYYY","YYYYYY"],YEAR),addParseToken("YY",function(input,array){array[YEAR]=utils_hooks__hooks.parseTwoDigitYear(input)}),utils_hooks__hooks.parseTwoDigitYear=function(input){return toInt(input)+(toInt(input)>68?1900:2e3)};var getSetYear=makeGetSet("FullYear",!1);addFormatToken("w",["ww",2],"wo","week"),addFormatToken("W",["WW",2],"Wo","isoWeek"),addUnitAlias("week","w"),addUnitAlias("isoWeek","W"),addRegexToken("w",match1to2),addRegexToken("ww",match1to2,match2),addRegexToken("W",match1to2),addRegexToken("WW",match1to2,match2),addWeekParseToken(["w","ww","W","WW"],function(input,week,config,token){week[token.substr(0,1)]=toInt(input)});var defaultLocaleWeek={dow:0,doy:6};addFormatToken("DDD",["DDDD",3],"DDDo","dayOfYear"),addUnitAlias("dayOfYear","DDD"),addRegexToken("DDD",match1to3),addRegexToken("DDDD",match3),addParseToken(["DDD","DDDD"],function(input,array,config){config._dayOfYear=toInt(input)}),utils_hooks__hooks.ISO_8601=function(){};var prototypeMin=deprecate("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(){var other=local__createLocal.apply(null,arguments);return this>other?this:other}),prototypeMax=deprecate("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(){var other=local__createLocal.apply(null,arguments);return other>this?this:other});offset("Z",":"),offset("ZZ",""),addRegexToken("Z",matchOffset),addRegexToken("ZZ",matchOffset),addParseToken(["Z","ZZ"],function(input,array,config){config._useUTC=!0,config._tzm=offsetFromString(input)});var chunkOffset=/([\+\-]|\d\d)/gi;utils_hooks__hooks.updateOffset=function(){};var aspNetRegex=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,create__isoRegex=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/;create__createDuration.fn=Duration.prototype;var add_subtract__add=createAdder(1,"add"),add_subtract__subtract=createAdder(-1,"subtract");utils_hooks__hooks.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";var lang=deprecate("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(key){return void 0===key?this.localeData():this.locale(key)});addFormatToken(0,["gg",2],0,function(){return this.weekYear()%100}),addFormatToken(0,["GG",2],0,function(){return this.isoWeekYear()%100}),addWeekYearFormatToken("gggg","weekYear"),addWeekYearFormatToken("ggggg","weekYear"),addWeekYearFormatToken("GGGG","isoWeekYear"),addWeekYearFormatToken("GGGGG","isoWeekYear"),addUnitAlias("weekYear","gg"),addUnitAlias("isoWeekYear","GG"),addRegexToken("G",matchSigned),addRegexToken("g",matchSigned),addRegexToken("GG",match1to2,match2),addRegexToken("gg",match1to2,match2),addRegexToken("GGGG",match1to4,match4),addRegexToken("gggg",match1to4,match4),addRegexToken("GGGGG",match1to6,match6),addRegexToken("ggggg",match1to6,match6),addWeekParseToken(["gggg","ggggg","GGGG","GGGGG"],function(input,week,config,token){
week[token.substr(0,2)]=toInt(input)}),addWeekParseToken(["gg","GG"],function(input,week,config,token){week[token]=utils_hooks__hooks.parseTwoDigitYear(input)}),addFormatToken("Q",0,0,"quarter"),addUnitAlias("quarter","Q"),addRegexToken("Q",match1),addParseToken("Q",function(input,array){array[MONTH]=3*(toInt(input)-1)}),addFormatToken("D",["DD",2],"Do","date"),addUnitAlias("date","D"),addRegexToken("D",match1to2),addRegexToken("DD",match1to2,match2),addRegexToken("Do",function(isStrict,locale){return isStrict?locale._ordinalParse:locale._ordinalParseLenient}),addParseToken(["D","DD"],DATE),addParseToken("Do",function(input,array){array[DATE]=toInt(input.match(match1to2)[0],10)});var getSetDayOfMonth=makeGetSet("Date",!0);addFormatToken("d",0,"do","day"),addFormatToken("dd",0,0,function(format){return this.localeData().weekdaysMin(this,format)}),addFormatToken("ddd",0,0,function(format){return this.localeData().weekdaysShort(this,format)}),addFormatToken("dddd",0,0,function(format){return this.localeData().weekdays(this,format)}),addFormatToken("e",0,0,"weekday"),addFormatToken("E",0,0,"isoWeekday"),addUnitAlias("day","d"),addUnitAlias("weekday","e"),addUnitAlias("isoWeekday","E"),addRegexToken("d",match1to2),addRegexToken("e",match1to2),addRegexToken("E",match1to2),addRegexToken("dd",matchWord),addRegexToken("ddd",matchWord),addRegexToken("dddd",matchWord),addWeekParseToken(["dd","ddd","dddd"],function(input,week,config){var weekday=config._locale.weekdaysParse(input);null!=weekday?week.d=weekday:getParsingFlags(config).invalidWeekday=input}),addWeekParseToken(["d","e","E"],function(input,week,config,token){week[token]=toInt(input)});var defaultLocaleWeekdays="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),defaultLocaleWeekdaysShort="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),defaultLocaleWeekdaysMin="Su_Mo_Tu_We_Th_Fr_Sa".split("_");addFormatToken("H",["HH",2],0,"hour"),addFormatToken("h",["hh",2],0,function(){return this.hours()%12||12}),meridiem("a",!0),meridiem("A",!1),addUnitAlias("hour","h"),addRegexToken("a",matchMeridiem),addRegexToken("A",matchMeridiem),addRegexToken("H",match1to2),addRegexToken("h",match1to2),addRegexToken("HH",match1to2,match2),addRegexToken("hh",match1to2,match2),addParseToken(["H","HH"],HOUR),addParseToken(["a","A"],function(input,array,config){config._isPm=config._locale.isPM(input),config._meridiem=input}),addParseToken(["h","hh"],function(input,array,config){array[HOUR]=toInt(input),getParsingFlags(config).bigHour=!0});var defaultLocaleMeridiemParse=/[ap]\.?m?\.?/i,getSetHour=makeGetSet("Hours",!0);addFormatToken("m",["mm",2],0,"minute"),addUnitAlias("minute","m"),addRegexToken("m",match1to2),addRegexToken("mm",match1to2,match2),addParseToken(["m","mm"],MINUTE);var getSetMinute=makeGetSet("Minutes",!1);addFormatToken("s",["ss",2],0,"second"),addUnitAlias("second","s"),addRegexToken("s",match1to2),addRegexToken("ss",match1to2,match2),addParseToken(["s","ss"],SECOND);var getSetSecond=makeGetSet("Seconds",!1);addFormatToken("S",0,0,function(){return~~(this.millisecond()/100)}),addFormatToken(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),millisecond__milliseconds("SSS"),millisecond__milliseconds("SSSS"),addUnitAlias("millisecond","ms"),addRegexToken("S",match1to3,match1),addRegexToken("SS",match1to3,match2),addRegexToken("SSS",match1to3,match3),addRegexToken("SSSS",matchUnsigned),addParseToken(["S","SS","SSS","SSSS"],function(input,array){array[MILLISECOND]=toInt(1e3*("0."+input))});var getSetMillisecond=makeGetSet("Milliseconds",!1);addFormatToken("z",0,0,"zoneAbbr"),addFormatToken("zz",0,0,"zoneName");var momentPrototype__proto=Moment.prototype;momentPrototype__proto.add=add_subtract__add,momentPrototype__proto.calendar=moment_calendar__calendar,momentPrototype__proto.clone=clone,momentPrototype__proto.diff=diff,momentPrototype__proto.endOf=endOf,momentPrototype__proto.format=format,momentPrototype__proto.from=from,momentPrototype__proto.fromNow=fromNow,momentPrototype__proto.to=to,momentPrototype__proto.toNow=toNow,momentPrototype__proto.get=getSet,momentPrototype__proto.invalidAt=invalidAt,momentPrototype__proto.isAfter=isAfter,momentPrototype__proto.isBefore=isBefore,momentPrototype__proto.isBetween=isBetween,momentPrototype__proto.isSame=isSame,momentPrototype__proto.isValid=moment_valid__isValid,momentPrototype__proto.lang=lang,momentPrototype__proto.locale=locale,momentPrototype__proto.localeData=localeData,momentPrototype__proto.max=prototypeMax,momentPrototype__proto.min=prototypeMin,momentPrototype__proto.parsingFlags=parsingFlags,momentPrototype__proto.set=getSet,momentPrototype__proto.startOf=startOf,momentPrototype__proto.subtract=add_subtract__subtract,momentPrototype__proto.toArray=toArray,momentPrototype__proto.toDate=toDate,momentPrototype__proto.toISOString=moment_format__toISOString,momentPrototype__proto.toJSON=moment_format__toISOString,momentPrototype__proto.toString=toString,momentPrototype__proto.unix=unix,momentPrototype__proto.valueOf=to_type__valueOf,momentPrototype__proto.year=getSetYear,momentPrototype__proto.isLeapYear=getIsLeapYear,momentPrototype__proto.weekYear=getSetWeekYear,momentPrototype__proto.isoWeekYear=getSetISOWeekYear,momentPrototype__proto.quarter=momentPrototype__proto.quarters=getSetQuarter,momentPrototype__proto.month=getSetMonth,momentPrototype__proto.daysInMonth=getDaysInMonth,momentPrototype__proto.week=momentPrototype__proto.weeks=getSetWeek,momentPrototype__proto.isoWeek=momentPrototype__proto.isoWeeks=getSetISOWeek,momentPrototype__proto.weeksInYear=getWeeksInYear,momentPrototype__proto.isoWeeksInYear=getISOWeeksInYear,momentPrototype__proto.date=getSetDayOfMonth,momentPrototype__proto.day=momentPrototype__proto.days=getSetDayOfWeek,momentPrototype__proto.weekday=getSetLocaleDayOfWeek,momentPrototype__proto.isoWeekday=getSetISODayOfWeek,momentPrototype__proto.dayOfYear=getSetDayOfYear,momentPrototype__proto.hour=momentPrototype__proto.hours=getSetHour,momentPrototype__proto.minute=momentPrototype__proto.minutes=getSetMinute,momentPrototype__proto.second=momentPrototype__proto.seconds=getSetSecond,momentPrototype__proto.millisecond=momentPrototype__proto.milliseconds=getSetMillisecond,momentPrototype__proto.utcOffset=getSetOffset,momentPrototype__proto.utc=setOffsetToUTC,momentPrototype__proto.local=setOffsetToLocal,momentPrototype__proto.parseZone=setOffsetToParsedOffset,momentPrototype__proto.hasAlignedHourOffset=hasAlignedHourOffset,momentPrototype__proto.isDST=isDaylightSavingTime,momentPrototype__proto.isDSTShifted=isDaylightSavingTimeShifted,momentPrototype__proto.isLocal=isLocal,momentPrototype__proto.isUtcOffset=isUtcOffset,momentPrototype__proto.isUtc=isUtc,momentPrototype__proto.isUTC=isUtc,momentPrototype__proto.zoneAbbr=getZoneAbbr,momentPrototype__proto.zoneName=getZoneName,momentPrototype__proto.dates=deprecate("dates accessor is deprecated. Use date instead.",getSetDayOfMonth),momentPrototype__proto.months=deprecate("months accessor is deprecated. Use month instead",getSetMonth),momentPrototype__proto.years=deprecate("years accessor is deprecated. Use year instead",getSetYear),momentPrototype__proto.zone=deprecate("moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779",getSetZone);var momentPrototype=momentPrototype__proto,defaultCalendar={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},defaultLongDateFormat={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM D, YYYY LT"},defaultInvalidDate="Invalid date",defaultOrdinal="%d",defaultOrdinalParse=/\d{1,2}/,defaultRelativeTime={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},prototype__proto=Locale.prototype;prototype__proto._calendar=defaultCalendar,prototype__proto.calendar=locale_calendar__calendar,prototype__proto._longDateFormat=defaultLongDateFormat,prototype__proto.longDateFormat=longDateFormat,prototype__proto._invalidDate=defaultInvalidDate,prototype__proto.invalidDate=invalidDate,prototype__proto._ordinal=defaultOrdinal,prototype__proto.ordinal=ordinal,prototype__proto._ordinalParse=defaultOrdinalParse,prototype__proto.preparse=preParsePostFormat,prototype__proto.postformat=preParsePostFormat,prototype__proto._relativeTime=defaultRelativeTime,prototype__proto.relativeTime=relative__relativeTime,prototype__proto.pastFuture=pastFuture,prototype__proto.set=locale_set__set,prototype__proto.months=localeMonths,prototype__proto._months=defaultLocaleMonths,prototype__proto.monthsShort=localeMonthsShort,prototype__proto._monthsShort=defaultLocaleMonthsShort,prototype__proto.monthsParse=localeMonthsParse,prototype__proto.week=localeWeek,prototype__proto._week=defaultLocaleWeek,prototype__proto.firstDayOfYear=localeFirstDayOfYear,prototype__proto.firstDayOfWeek=localeFirstDayOfWeek,prototype__proto.weekdays=localeWeekdays,prototype__proto._weekdays=defaultLocaleWeekdays,prototype__proto.weekdaysMin=localeWeekdaysMin,prototype__proto._weekdaysMin=defaultLocaleWeekdaysMin,prototype__proto.weekdaysShort=localeWeekdaysShort,prototype__proto._weekdaysShort=defaultLocaleWeekdaysShort,prototype__proto.weekdaysParse=localeWeekdaysParse,prototype__proto.isPM=localeIsPM,prototype__proto._meridiemParse=defaultLocaleMeridiemParse,prototype__proto.meridiem=localeMeridiem,locale_locales__getSetGlobalLocale("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(number){var b=number%10,output=1===toInt(number%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return number+output}}),utils_hooks__hooks.lang=deprecate("moment.lang is deprecated. Use moment.locale instead.",locale_locales__getSetGlobalLocale),utils_hooks__hooks.langData=deprecate("moment.langData is deprecated. Use moment.localeData instead.",locale_locales__getLocale);var mathAbs=Math.abs,asMilliseconds=makeAs("ms"),asSeconds=makeAs("s"),asMinutes=makeAs("m"),asHours=makeAs("h"),asDays=makeAs("d"),asWeeks=makeAs("w"),asMonths=makeAs("M"),asYears=makeAs("y"),duration_get__milliseconds=makeGetter("milliseconds"),seconds=makeGetter("seconds"),minutes=makeGetter("minutes"),hours=makeGetter("hours"),days=makeGetter("days"),months=makeGetter("months"),years=makeGetter("years"),round=Math.round,thresholds={s:45,m:45,h:22,d:26,M:11},iso_string__abs=Math.abs,duration_prototype__proto=Duration.prototype;duration_prototype__proto.abs=duration_abs__abs,duration_prototype__proto.add=duration_add_subtract__add,duration_prototype__proto.subtract=duration_add_subtract__subtract,duration_prototype__proto.as=as,duration_prototype__proto.asMilliseconds=asMilliseconds,duration_prototype__proto.asSeconds=asSeconds,duration_prototype__proto.asMinutes=asMinutes,duration_prototype__proto.asHours=asHours,duration_prototype__proto.asDays=asDays,duration_prototype__proto.asWeeks=asWeeks,duration_prototype__proto.asMonths=asMonths,duration_prototype__proto.asYears=asYears,duration_prototype__proto.valueOf=duration_as__valueOf,duration_prototype__proto._bubble=bubble,duration_prototype__proto.get=duration_get__get,duration_prototype__proto.milliseconds=duration_get__milliseconds,duration_prototype__proto.seconds=seconds,duration_prototype__proto.minutes=minutes,duration_prototype__proto.hours=hours,duration_prototype__proto.days=days,duration_prototype__proto.weeks=weeks,duration_prototype__proto.months=months,duration_prototype__proto.years=years,duration_prototype__proto.humanize=humanize,duration_prototype__proto.toISOString=iso_string__toISOString,duration_prototype__proto.toString=iso_string__toISOString,duration_prototype__proto.toJSON=iso_string__toISOString,duration_prototype__proto.locale=locale,duration_prototype__proto.localeData=localeData,duration_prototype__proto.toIsoString=deprecate("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",iso_string__toISOString),duration_prototype__proto.lang=lang,addFormatToken("X",0,0,"unix"),addFormatToken("x",0,0,"valueOf"),addRegexToken("x",matchSigned),addRegexToken("X",matchTimestamp),addParseToken("X",function(input,array,config){config._d=new Date(1e3*parseFloat(input,10))}),addParseToken("x",function(input,array,config){config._d=new Date(toInt(input))}),utils_hooks__hooks.version="2.10.3",setHookCallback(local__createLocal),utils_hooks__hooks.fn=momentPrototype,utils_hooks__hooks.min=min,utils_hooks__hooks.max=max,utils_hooks__hooks.utc=create_utc__createUTC,utils_hooks__hooks.unix=moment__createUnix,utils_hooks__hooks.months=lists__listMonths,utils_hooks__hooks.isDate=isDate,utils_hooks__hooks.locale=locale_locales__getSetGlobalLocale,utils_hooks__hooks.invalid=valid__createInvalid,utils_hooks__hooks.duration=create__createDuration,utils_hooks__hooks.isMoment=isMoment,utils_hooks__hooks.weekdays=lists__listWeekdays,utils_hooks__hooks.parseZone=moment__createInZone,utils_hooks__hooks.localeData=locale_locales__getLocale,utils_hooks__hooks.isDuration=isDuration,utils_hooks__hooks.monthsShort=lists__listMonthsShort,utils_hooks__hooks.weekdaysMin=lists__listWeekdaysMin,utils_hooks__hooks.defineLocale=defineLocale,utils_hooks__hooks.weekdaysShort=lists__listWeekdaysShort,utils_hooks__hooks.normalizeUnits=normalizeUnits,utils_hooks__hooks.relativeTimeThreshold=duration_humanize__getSetRelativeTimeThreshold;var _moment=utils_hooks__hooks;return _moment})},{}],151:[function(require,module,exports){function randomBytes(size){for(var r,r,bytes=new Array(size),i=0;size>i;i++)0==(3&i)&&(r=4294967296*Math.random()),bytes[i]=r>>>((3&i)<<3)&255;return bytes}function byteArrayToBase64(uint8){function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]}var temp,length,i,lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",extraBytes=uint8.length%3,output="";for(i=0,length=uint8.length-extraBytes;length>i;i+=3)temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2],output+=tripletToBase64(temp);switch(extraBytes){case 1:temp=uint8[uint8.length-1],output+=lookup[temp>>2],output+=lookup[temp<<4&63],output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1],output+=lookup[temp>>10],output+=lookup[temp>>4&63],output+=lookup[temp<<2&63],output+="="}return output}function uid(len){return byteArrayToBase64(randomBytes(Math.ceil(Math.max(8,2*len)))).replace(/[+\/]/g,"").slice(0,len)}module.exports.uid=uid},{}],152:[function(require,module,exports){function exists(filename,callback){return"undefined"==typeof localStorage?(console.log("WARNING - This browser doesn't support localStorage, no data will be saved in NeDB!"),callback()):callback(null!==localStorage.getItem(filename)?!0:!1)}function rename(filename,newFilename,callback){return"undefined"==typeof localStorage?(console.log("WARNING - This browser doesn't support localStorage, no data will be saved in NeDB!"),callback()):(null===localStorage.getItem(filename)?localStorage.removeItem(newFilename):(localStorage.setItem(newFilename,localStorage.getItem(filename)),localStorage.removeItem(filename)),callback())}function writeFile(filename,contents,options,callback){return"undefined"==typeof localStorage?(console.log("WARNING - This browser doesn't support localStorage, no data will be saved in NeDB!"),callback()):("function"==typeof options&&(callback=options),localStorage.setItem(filename,contents),callback())}function appendFile(filename,toAppend,options,callback){if("undefined"==typeof localStorage)return console.log("WARNING - This browser doesn't support localStorage, no data will be saved in NeDB!"),callback();"function"==typeof options&&(callback=options);var contents=localStorage.getItem(filename)||"";return contents+=toAppend,localStorage.setItem(filename,contents),callback()}function readFile(filename,options,callback){if("undefined"==typeof localStorage)return console.log("WARNING - This browser doesn't support localStorage, no data will be saved in NeDB!"),callback();"function"==typeof options&&(callback=options);var contents=localStorage.getItem(filename)||"";return callback(null,contents)}function unlink(filename,callback){return"undefined"==typeof localStorage?(console.log("WARNING - This browser doesn't support localStorage, no data will be saved in NeDB!"),callback()):(localStorage.removeItem(filename),callback())}function mkdirp(dir,callback){return callback()}module.exports.exists=exists,module.exports.rename=rename,module.exports.writeFile=writeFile,module.exports.appendFile=appendFile,module.exports.readFile=readFile,module.exports.unlink=unlink,module.exports.mkdirp=mkdirp},{}],153:[function(require,module,exports){var Datastore=require("./lib/datastore");module.exports=Datastore},{"./lib/datastore":155}],154:[function(require,module,exports){function Cursor(db,query,execFn){this.db=db,this.query=query||{},execFn&&(this.execFn=execFn)}var model=require("./model"),_=require("underscore");Cursor.prototype.limit=function(limit){return this._limit=limit,this},Cursor.prototype.skip=function(skip){return this._skip=skip,this},Cursor.prototype.sort=function(sortQuery){return this._sort=sortQuery,this},Cursor.prototype.projection=function(projection){return this._projection=projection,this},Cursor.prototype.project=function(candidates){var keepId,action,keys,res=[],self=this;return void 0===this._projection||0===Object.keys(this._projection).length?candidates:(keepId=0===this._projection._id?!1:!0,this._projection=_.omit(this._projection,"_id"),keys=Object.keys(this._projection),keys.forEach(function(k){if(void 0!==action&&self._projection[k]!==action)throw"Can't both keep and omit fields except for _id";action=self._projection[k]}),candidates.forEach(function(candidate){var toPush=1===action?_.pick(candidate,keys):_.omit(candidate,keys);keepId?toPush._id=candidate._id:delete toPush._id,res.push(toPush)}),res)},Cursor.prototype._exec=function(callback){var i,keys,key,candidates=this.db.getCandidates(this.query),res=[],added=0,skipped=0,self=this,error=null;try{for(i=0;i<candidates.length;i+=1)if(model.match(candidates[i],this.query))if(this._sort)res.push(candidates[i]);else if(this._skip&&this._skip>skipped)skipped+=1;else if(res.push(candidates[i]),added+=1,this._limit&&this._limit<=added)break}catch(err){return callback(err)}if(this._sort){keys=Object.keys(this._sort);var criteria=[];for(i=0;i<keys.length;i++)key=keys[i],criteria.push({key:key,direction:self._sort[key]});res.sort(function(a,b){var criterion,compare,i;for(i=0;i<criteria.length;i++)if(criterion=criteria[i],compare=criterion.direction*model.compareThings(model.getDotValue(a,criterion.key),model.getDotValue(b,criterion.key)),0!==compare)return compare;return 0});var limit=this._limit||res.length,skip=this._skip||0;res=res.slice(skip,skip+limit)}try{res=this.project(res)}catch(e){error=e,res=void 0}return this.execFn?this.execFn(error,res,callback):callback(error,res)},Cursor.prototype.exec=function(){this.db.executor.push({"this":this,fn:this._exec,arguments:arguments})},module.exports=Cursor},{"./model":158,underscore:165}],155:[function(require,module,exports){function Datastore(options){var filename;"string"==typeof options?(filename=options,this.inMemoryOnly=!1):(options=options||{},filename=options.filename,this.inMemoryOnly=options.inMemoryOnly||!1,this.autoload=options.autoload||!1),filename&&"string"==typeof filename&&0!==filename.length?this.filename=filename:(this.filename=null,this.inMemoryOnly=!0),this.persistence=new Persistence({db:this,nodeWebkitAppName:options.nodeWebkitAppName,afterSerialization:options.afterSerialization,beforeDeserialization:options.beforeDeserialization,corruptAlertThreshold:options.corruptAlertThreshold}),this.executor=new Executor,this.inMemoryOnly&&(this.executor.ready=!0),this.indexes={},this.indexes._id=new Index({fieldName:"_id",unique:!0}),this.autoload&&this.loadDatabase(options.onload||function(err){if(err)throw err})}var customUtils=require("./customUtils"),model=require("./model"),async=require("async"),Executor=require("./executor"),Index=require("./indexes"),util=require("util"),_=require("underscore"),Persistence=require("./persistence"),Cursor=require("./cursor");Datastore.prototype.loadDatabase=function(){this.executor.push({"this":this.persistence,fn:this.persistence.loadDatabase,arguments:arguments},!0)},Datastore.prototype.getAllData=function(){return this.indexes._id.getAll()},Datastore.prototype.resetIndexes=function(newData){var self=this;Object.keys(this.indexes).forEach(function(i){self.indexes[i].reset(newData)})},Datastore.prototype.ensureIndex=function(options,cb){var callback=cb||function(){};if(options=options||{},!options.fieldName)return callback({missingFieldName:!0});if(this.indexes[options.fieldName])return callback(null);this.indexes[options.fieldName]=new Index(options);try{this.indexes[options.fieldName].insert(this.getAllData())}catch(e){return delete this.indexes[options.fieldName],callback(e)}this.persistence.persistNewState([{$$indexCreated:options}],function(err){return callback(err?err:null)})},Datastore.prototype.removeIndex=function(fieldName,cb){var callback=cb||function(){};delete this.indexes[fieldName],this.persistence.persistNewState([{$$indexRemoved:fieldName}],function(err){return callback(err?err:null)})},Datastore.prototype.addToIndexes=function(doc){var i,failingIndex,error,keys=Object.keys(this.indexes);for(i=0;i<keys.length;i+=1)try{this.indexes[keys[i]].insert(doc)}catch(e){failingIndex=i,error=e;break}if(error){for(i=0;failingIndex>i;i+=1)this.indexes[keys[i]].remove(doc);throw error}},Datastore.prototype.removeFromIndexes=function(doc){var self=this;Object.keys(this.indexes).forEach(function(i){self.indexes[i].remove(doc)})},Datastore.prototype.updateIndexes=function(oldDoc,newDoc){var i,failingIndex,error,keys=Object.keys(this.indexes);for(i=0;i<keys.length;i+=1)try{this.indexes[keys[i]].update(oldDoc,newDoc)}catch(e){failingIndex=i,error=e;break}if(error){for(i=0;failingIndex>i;i+=1)this.indexes[keys[i]].revertUpdate(oldDoc,newDoc);throw error}},Datastore.prototype.getCandidates=function(query){var usableQueryKeys,indexNames=Object.keys(this.indexes);return usableQueryKeys=[],Object.keys(query).forEach(function(k){("string"==typeof query[k]||"number"==typeof query[k]||"boolean"==typeof query[k]||util.isDate(query[k])||null===query[k])&&usableQueryKeys.push(k)}),usableQueryKeys=_.intersection(usableQueryKeys,indexNames),usableQueryKeys.length>0?this.indexes[usableQueryKeys[0]].getMatching(query[usableQueryKeys[0]]):(usableQueryKeys=[],Object.keys(query).forEach(function(k){query[k]&&query[k].hasOwnProperty("$in")&&usableQueryKeys.push(k)}),usableQueryKeys=_.intersection(usableQueryKeys,indexNames),usableQueryKeys.length>0?this.indexes[usableQueryKeys[0]].getMatching(query[usableQueryKeys[0]].$in):(usableQueryKeys=[],Object.keys(query).forEach(function(k){query[k]&&(query[k].hasOwnProperty("$lt")||query[k].hasOwnProperty("$lte")||query[k].hasOwnProperty("$gt")||query[k].hasOwnProperty("$gte"))&&usableQueryKeys.push(k)}),usableQueryKeys=_.intersection(usableQueryKeys,indexNames),usableQueryKeys.length>0?this.indexes[usableQueryKeys[0]].getBetweenBounds(query[usableQueryKeys[0]]):this.getAllData()))},Datastore.prototype._insert=function(newDoc,cb){var callback=cb||function(){};try{this._insertInCache(newDoc)}catch(e){return callback(e)}this.persistence.persistNewState(util.isArray(newDoc)?newDoc:[newDoc],function(err){return err?callback(err):callback(null,newDoc)})},Datastore.prototype.createNewId=function(){var tentativeId=customUtils.uid(16);return this.indexes._id.getMatching(tentativeId).length>0&&(tentativeId=this.createNewId()),tentativeId},Datastore.prototype.prepareDocumentForInsertion=function(newDoc){var preparedDoc,self=this;return util.isArray(newDoc)?(preparedDoc=[],newDoc.forEach(function(doc){preparedDoc.push(self.prepareDocumentForInsertion(doc))})):(void 0===newDoc._id&&(newDoc._id=this.createNewId()),preparedDoc=model.deepCopy(newDoc),model.checkObject(preparedDoc)),preparedDoc},Datastore.prototype._insertInCache=function(newDoc){util.isArray(newDoc)?this._insertMultipleDocsInCache(newDoc):this.addToIndexes(this.prepareDocumentForInsertion(newDoc))},Datastore.prototype._insertMultipleDocsInCache=function(newDocs){var i,failingI,error,preparedDocs=this.prepareDocumentForInsertion(newDocs);for(i=0;i<preparedDocs.length;i+=1)try{this.addToIndexes(preparedDocs[i])}catch(e){error=e,failingI=i;break}if(error){for(i=0;failingI>i;i+=1)this.removeFromIndexes(preparedDocs[i]);throw error}},Datastore.prototype.insert=function(){this.executor.push({"this":this,fn:this._insert,arguments:arguments})},Datastore.prototype.count=function(query,callback){var cursor=new Cursor(this,query,function(err,docs,callback){return err?callback(err):callback(null,docs.length)});return"function"!=typeof callback?cursor:void cursor.exec(callback)},Datastore.prototype.find=function(query,projection,callback){switch(arguments.length){case 1:projection={};break;case 2:"function"==typeof projection&&(callback=projection,projection={})}var cursor=new Cursor(this,query,function(err,docs,callback){var i,res=[];if(err)return callback(err);for(i=0;i<docs.length;i+=1)res.push(model.deepCopy(docs[i]));return callback(null,res)});return cursor.projection(projection),"function"!=typeof callback?cursor:void cursor.exec(callback)},Datastore.prototype.findOne=function(query,projection,callback){switch(arguments.length){case 1:projection={};break;case 2:"function"==typeof projection&&(callback=projection,projection={})}var cursor=new Cursor(this,query,function(err,docs,callback){return err?callback(err):1===docs.length?callback(null,model.deepCopy(docs[0])):callback(null,null)});return cursor.projection(projection).limit(1),"function"!=typeof callback?cursor:void cursor.exec(callback)},Datastore.prototype._update=function(query,updateQuery,options,cb){var callback,multi,upsert,i,self=this,numReplaced=0;"function"==typeof options&&(cb=options,options={}),callback=cb||function(){},multi=void 0!==options.multi?options.multi:!1,upsert=void 0!==options.upsert?options.upsert:!1,async.waterfall([function(cb){if(!upsert)return cb();var cursor=new Cursor(self,query);cursor.limit(1)._exec(function(err,docs){if(err)return callback(err);if(1===docs.length)return cb();var toBeInserted;try{model.checkObject(updateQuery),toBeInserted=updateQuery}catch(e){try{toBeInserted=model.modify(model.deepCopy(query,!0),updateQuery)}catch(err){return callback(err)}}return self._insert(toBeInserted,function(err,newDoc){return err?callback(err):callback(null,1,newDoc)})})},function(){var modifiedDoc,candidates=self.getCandidates(query),modifications=[];try{for(i=0;i<candidates.length;i+=1)model.match(candidates[i],query)&&(multi||0===numReplaced)&&(numReplaced+=1,modifiedDoc=model.modify(candidates[i],updateQuery),modifications.push({oldDoc:candidates[i],newDoc:modifiedDoc}))}catch(err){return callback(err)}try{self.updateIndexes(modifications)}catch(err){return callback(err)}self.persistence.persistNewState(_.pluck(modifications,"newDoc"),function(err){return err?callback(err):callback(null,numReplaced)})}])},Datastore.prototype.update=function(){this.executor.push({"this":this,fn:this._update,arguments:arguments})},Datastore.prototype._remove=function(query,options,cb){var callback,multi,self=this,numRemoved=0,removedDocs=[],candidates=this.getCandidates(query);"function"==typeof options&&(cb=options,options={}),callback=cb||function(){},multi=void 0!==options.multi?options.multi:!1;try{candidates.forEach(function(d){model.match(d,query)&&(multi||0===numRemoved)&&(numRemoved+=1,removedDocs.push({$$deleted:!0,_id:d._id}),self.removeFromIndexes(d))})}catch(err){return callback(err)}self.persistence.persistNewState(removedDocs,function(err){return err?callback(err):callback(null,numRemoved)})},Datastore.prototype.remove=function(){this.executor.push({"this":this,fn:this._remove,arguments:arguments})},module.exports=Datastore},{"./cursor":154,"./customUtils":151,"./executor":156,"./indexes":157,"./model":158,"./persistence":159,async:160,underscore:165,util:149}],156:[function(require,module,exports){(function(process){function Executor(){this.buffer=[],this.ready=!1,this.queue=async.queue(function(task,cb){var callback,i,lastArg=task.arguments[task.arguments.length-1],newArguments=[];for(i=0;i<task.arguments.length;i+=1)newArguments.push(task.arguments[i]);"function"==typeof lastArg?(callback=function(){"function"==typeof setImmediate?setImmediate(cb):process.nextTick(cb),lastArg.apply(null,arguments)},newArguments[newArguments.length-1]=callback):(callback=function(){cb()},newArguments.push(callback)),task.fn.apply(task["this"],newArguments)},1)}var async=require("async");Executor.prototype.push=function(task,forceQueuing){this.ready||forceQueuing?this.queue.push(task):this.buffer.push(task)},Executor.prototype.processBuffer=function(){var i;for(this.ready=!0,i=0;i<this.buffer.length;i+=1)this.queue.push(this.buffer[i]);this.buffer=[]},module.exports=Executor}).call(this,require("_process"))},{_process:134,async:160}],157:[function(require,module,exports){function checkValueEquality(a,b){return a===b}function projectForUnique(elt){return null===elt?"$null":"string"==typeof elt?"$string"+elt:"boolean"==typeof elt?"$boolean"+elt:"number"==typeof elt?"$number"+elt:util.isArray(elt)?"$date"+elt.getTime():elt}function Index(options){this.fieldName=options.fieldName,this.unique=options.unique||!1,this.sparse=options.sparse||!1,this.treeOptions={unique:this.unique,compareKeys:model.compareThings,checkValueEquality:checkValueEquality},this.reset()}function append(array,toAppend){var i;for(i=0;i<toAppend.length;i+=1)array.push(toAppend[i])}var BinarySearchTree=require("binary-search-tree").AVLTree,model=require("./model"),_=require("underscore"),util=require("util");Index.prototype.reset=function(newData){this.tree=new BinarySearchTree(this.treeOptions),newData&&this.insert(newData)},Index.prototype.insert=function(doc){var key,keys,i,failingI,error;if(util.isArray(doc))return void this.insertMultipleDocs(doc);if(key=model.getDotValue(doc,this.fieldName),void 0!==key||!this.sparse)if(util.isArray(key)){for(keys=_.uniq(key,projectForUnique),i=0;i<keys.length;i+=1)try{this.tree.insert(keys[i],doc)}catch(e){error=e,failingI=i;break}if(error){for(i=0;failingI>i;i+=1)this.tree["delete"](keys[i],doc);throw error}}else this.tree.insert(key,doc)},Index.prototype.insertMultipleDocs=function(docs){var i,error,failingI;for(i=0;i<docs.length;i+=1)try{this.insert(docs[i])}catch(e){error=e,failingI=i;break}if(error){for(i=0;failingI>i;i+=1)this.remove(docs[i]);throw error}},Index.prototype.remove=function(doc){var key,self=this;return util.isArray(doc)?void doc.forEach(function(d){self.remove(d)}):(key=model.getDotValue(doc,this.fieldName),void(void 0===key&&this.sparse||(util.isArray(key)?_.uniq(key,projectForUnique).forEach(function(_key){self.tree["delete"](_key,doc)}):this.tree["delete"](key,doc))))},Index.prototype.update=function(oldDoc,newDoc){if(util.isArray(oldDoc))return void this.updateMultipleDocs(oldDoc);this.remove(oldDoc);try{this.insert(newDoc)}catch(e){throw this.insert(oldDoc),e}},Index.prototype.updateMultipleDocs=function(pairs){var i,failingI,error;for(i=0;i<pairs.length;i+=1)this.remove(pairs[i].oldDoc);for(i=0;i<pairs.length;i+=1)try{this.insert(pairs[i].newDoc)}catch(e){error=e,failingI=i;break}if(error){for(i=0;failingI>i;i+=1)this.remove(pairs[i].newDoc);for(i=0;i<pairs.length;i+=1)this.insert(pairs[i].oldDoc);throw error}},Index.prototype.revertUpdate=function(oldDoc,newDoc){var revert=[];util.isArray(oldDoc)?(oldDoc.forEach(function(pair){revert.push({oldDoc:pair.newDoc,newDoc:pair.oldDoc})}),this.update(revert)):this.update(newDoc,oldDoc)},Index.prototype.getMatching=function(value){var res,self=this;return util.isArray(value)?(res=[],value.forEach(function(v){
append(res,self.getMatching(v))}),res):this.tree.search(value)},Index.prototype.getBetweenBounds=function(query){return this.tree.betweenBounds(query)},Index.prototype.getAll=function(){var res=[];return this.tree.executeOnEveryNode(function(node){var i;for(i=0;i<node.data.length;i+=1)res.push(node.data[i])}),res},module.exports=Index},{"./model":158,"binary-search-tree":161,underscore:165,util:149}],158:[function(require,module,exports){function checkKey(k,v){if("number"==typeof k&&(k=k.toString()),!("$"!==k[0]||"$$date"===k&&"number"==typeof v||"$$deleted"===k&&v===!0||"$$indexCreated"===k||"$$indexRemoved"===k))throw"Field names cannot begin with the $ character";if(-1!==k.indexOf("."))throw"Field names cannot contain a ."}function checkObject(obj){util.isArray(obj)&&obj.forEach(function(o){checkObject(o)}),"object"==typeof obj&&null!==obj&&Object.keys(obj).forEach(function(k){checkKey(k,obj[k]),checkObject(obj[k])})}function serialize(obj){var res;return res=JSON.stringify(obj,function(k,v){return checkKey(k,v),void 0===v?void 0:null===v?null:"function"==typeof this[k].getTime?{$$date:this[k].getTime()}:v})}function deserialize(rawData){return JSON.parse(rawData,function(k,v){return"$$date"===k?new Date(v):"string"==typeof v||"number"==typeof v||"boolean"==typeof v||null===v?v:v&&v.$$date?v.$$date:v})}function deepCopy(obj,strictKeys){var res;return"boolean"==typeof obj||"number"==typeof obj||"string"==typeof obj||null===obj||util.isDate(obj)?obj:util.isArray(obj)?(res=[],obj.forEach(function(o){res.push(deepCopy(o,strictKeys))}),res):"object"==typeof obj?(res={},Object.keys(obj).forEach(function(k){(!strictKeys||"$"!==k[0]&&-1===k.indexOf("."))&&(res[k]=deepCopy(obj[k],strictKeys))}),res):void 0}function isPrimitiveType(obj){return"boolean"==typeof obj||"number"==typeof obj||"string"==typeof obj||null===obj||util.isDate(obj)||util.isArray(obj)}function compareNSB(a,b){return b>a?-1:a>b?1:0}function compareArrays(a,b){var i,comp;for(i=0;i<Math.min(a.length,b.length);i+=1)if(comp=compareThings(a[i],b[i]),0!==comp)return comp;return compareNSB(a.length,b.length)}function compareThings(a,b){var aKeys,bKeys,comp,i;if(void 0===a)return void 0===b?0:-1;if(void 0===b)return void 0===a?0:1;if(null===a)return null===b?0:-1;if(null===b)return null===a?0:1;if("number"==typeof a)return"number"==typeof b?compareNSB(a,b):-1;if("number"==typeof b)return"number"==typeof a?compareNSB(a,b):1;if("string"==typeof a)return"string"==typeof b?compareNSB(a,b):-1;if("string"==typeof b)return"string"==typeof a?compareNSB(a,b):1;if("boolean"==typeof a)return"boolean"==typeof b?compareNSB(a,b):-1;if("boolean"==typeof b)return"boolean"==typeof a?compareNSB(a,b):1;if(util.isDate(a))return util.isDate(b)?compareNSB(a.getTime(),b.getTime()):-1;if(util.isDate(b))return util.isDate(a)?compareNSB(a.getTime(),b.getTime()):1;if(util.isArray(a))return util.isArray(b)?compareArrays(a,b):-1;if(util.isArray(b))return util.isArray(a)?compareArrays(a,b):1;for(aKeys=Object.keys(a).sort(),bKeys=Object.keys(b).sort(),i=0;i<Math.min(aKeys.length,bKeys.length);i+=1)if(comp=compareThings(a[aKeys[i]],b[bKeys[i]]),0!==comp)return comp;return compareNSB(aKeys.length,bKeys.length)}function createModifierFunction(modifier){return function(obj,field,value){var fieldParts="string"==typeof field?field.split("."):field;1===fieldParts.length?lastStepModifierFunctions[modifier](obj,field,value):(obj[fieldParts[0]]=obj[fieldParts[0]]||{},modifierFunctions[modifier](obj[fieldParts[0]],fieldParts.slice(1),value))}}function modify(obj,updateQuery){var newDoc,modifiers,keys=Object.keys(updateQuery),firstChars=_.map(keys,function(item){return item[0]}),dollarFirstChars=_.filter(firstChars,function(c){return"$"===c});if(-1!==keys.indexOf("_id")&&updateQuery._id!==obj._id)throw"You cannot change a document's _id";if(0!==dollarFirstChars.length&&dollarFirstChars.length!==firstChars.length)throw"You cannot mix modifiers and normal fields";if(0===dollarFirstChars.length?(newDoc=deepCopy(updateQuery),newDoc._id=obj._id):(modifiers=_.uniq(keys),newDoc=deepCopy(obj),modifiers.forEach(function(m){var keys;if(!modifierFunctions[m])throw"Unknown modifier "+m;try{keys=Object.keys(updateQuery[m])}catch(e){throw"Modifier "+m+"'s argument must be an object"}keys.forEach(function(k){modifierFunctions[m](newDoc,k,updateQuery[m][k])})})),checkObject(newDoc),obj._id!==newDoc._id)throw"You can't change a document's _id";return newDoc}function getDotValue(obj,field){var i,objs,fieldParts="string"==typeof field?field.split("."):field;if(!obj)return void 0;if(0===fieldParts.length)return obj;if(1===fieldParts.length)return obj[fieldParts[0]];if(util.isArray(obj[fieldParts[0]])){if(i=parseInt(fieldParts[1],10),"number"==typeof i&&!isNaN(i))return getDotValue(obj[fieldParts[0]][i],fieldParts.slice(2));for(objs=new Array,i=0;i<obj[fieldParts[0]].length;i+=1)objs.push(getDotValue(obj[fieldParts[0]][i],fieldParts.slice(1)));return objs}return getDotValue(obj[fieldParts[0]],fieldParts.slice(1))}function areThingsEqual(a,b){var aKeys,bKeys,i;if(null===a||"string"==typeof a||"boolean"==typeof a||"number"==typeof a||null===b||"string"==typeof b||"boolean"==typeof b||"number"==typeof b)return a===b;if(util.isDate(a)||util.isDate(b))return util.isDate(a)&&util.isDate(b)&&a.getTime()===b.getTime();if(util.isArray(a)||util.isArray(b)||void 0===a||void 0===b)return!1;try{aKeys=Object.keys(a),bKeys=Object.keys(b)}catch(e){return!1}if(aKeys.length!==bKeys.length)return!1;for(i=0;i<aKeys.length;i+=1){if(-1===bKeys.indexOf(aKeys[i]))return!1;if(!areThingsEqual(a[aKeys[i]],b[aKeys[i]]))return!1}return!0}function areComparable(a,b){return"string"==typeof a||"number"==typeof a||util.isDate(a)||"string"==typeof b||"number"==typeof b||util.isDate(b)?typeof a!=typeof b?!1:!0:!1}function match(obj,query){var queryKeys,queryKey,queryValue,i;if(isPrimitiveType(obj)||isPrimitiveType(query))return matchQueryPart({needAKey:obj},"needAKey",query);for(queryKeys=Object.keys(query),i=0;i<queryKeys.length;i+=1)if(queryKey=queryKeys[i],queryValue=query[queryKey],"$"===queryKey[0]){if(!logicalOperators[queryKey])throw"Unknown logical operator "+queryKey;if(!logicalOperators[queryKey](obj,queryValue))return!1}else if(!matchQueryPart(obj,queryKey,queryValue))return!1;return!0}function matchQueryPart(obj,queryKey,queryValue,treatObjAsValue){var i,keys,firstChars,dollarFirstChars,objValue=getDotValue(obj,queryKey);if(util.isArray(objValue)&&!treatObjAsValue){if(null!==queryValue&&"object"==typeof queryValue&&!util.isRegExp(queryValue))for(keys=Object.keys(queryValue),i=0;i<keys.length;i+=1)if(arrayComparisonFunctions[keys[i]])return matchQueryPart(obj,queryKey,queryValue,!0);for(i=0;i<objValue.length;i+=1)if(matchQueryPart({k:objValue[i]},"k",queryValue))return!0;return!1}if(null!==queryValue&&"object"==typeof queryValue&&!util.isRegExp(queryValue)){if(keys=Object.keys(queryValue),firstChars=_.map(keys,function(item){return item[0]}),dollarFirstChars=_.filter(firstChars,function(c){return"$"===c}),0!==dollarFirstChars.length&&dollarFirstChars.length!==firstChars.length)throw"You cannot mix operators and normal fields";if(dollarFirstChars.length>0){for(i=0;i<keys.length;i+=1){if(!comparisonFunctions[keys[i]])throw"Unknown comparison function "+keys[i];if(!comparisonFunctions[keys[i]](objValue,queryValue[keys[i]]))return!1}return!0}}return util.isRegExp(queryValue)?comparisonFunctions.$regex(objValue,queryValue):areThingsEqual(objValue,queryValue)?!0:!1}var util=require("util"),_=require("underscore"),modifierFunctions={},lastStepModifierFunctions={},comparisonFunctions={},logicalOperators={},arrayComparisonFunctions={};lastStepModifierFunctions.$set=function(obj,field,value){obj[field]=value},lastStepModifierFunctions.$unset=function(obj,field,value){delete obj[field]},lastStepModifierFunctions.$push=function(obj,field,value){if(obj.hasOwnProperty(field)||(obj[field]=[]),!util.isArray(obj[field]))throw"Can't $push an element on non-array values";if(null!==value&&"object"==typeof value&&value.$each){if(Object.keys(value).length>1)throw"Can't use another field in conjunction with $each";if(!util.isArray(value.$each))throw"$each requires an array value";value.$each.forEach(function(v){obj[field].push(v)})}else obj[field].push(value)},lastStepModifierFunctions.$addToSet=function(obj,field,value){var addToSet=!0;if(obj.hasOwnProperty(field)||(obj[field]=[]),!util.isArray(obj[field]))throw"Can't $addToSet an element on non-array values";if(null!==value&&"object"==typeof value&&value.$each){if(Object.keys(value).length>1)throw"Can't use another field in conjunction with $each";if(!util.isArray(value.$each))throw"$each requires an array value";value.$each.forEach(function(v){lastStepModifierFunctions.$addToSet(obj,field,v)})}else obj[field].forEach(function(v){0===compareThings(v,value)&&(addToSet=!1)}),addToSet&&obj[field].push(value)},lastStepModifierFunctions.$pop=function(obj,field,value){if(!util.isArray(obj[field]))throw"Can't $pop an element from non-array values";if("number"!=typeof value)throw value+" isn't an integer, can't use it with $pop";0!==value&&(value>0?obj[field]=obj[field].slice(0,obj[field].length-1):obj[field]=obj[field].slice(1))},lastStepModifierFunctions.$pull=function(obj,field,value){var arr,i;if(!util.isArray(obj[field]))throw"Can't $pull an element from non-array values";for(arr=obj[field],i=arr.length-1;i>=0;i-=1)match(arr[i],value)&&arr.splice(i,1)},lastStepModifierFunctions.$inc=function(obj,field,value){if("number"!=typeof value)throw value+" must be a number";if("number"!=typeof obj[field]){if(_.has(obj,field))throw"Don't use the $inc modifier on non-number fields";obj[field]=value}else obj[field]+=value},Object.keys(lastStepModifierFunctions).forEach(function(modifier){modifierFunctions[modifier]=createModifierFunction(modifier)}),comparisonFunctions.$lt=function(a,b){return areComparable(a,b)&&b>a},comparisonFunctions.$lte=function(a,b){return areComparable(a,b)&&b>=a},comparisonFunctions.$gt=function(a,b){return areComparable(a,b)&&a>b},comparisonFunctions.$gte=function(a,b){return areComparable(a,b)&&a>=b},comparisonFunctions.$ne=function(a,b){return void 0===a?!0:!areThingsEqual(a,b)},comparisonFunctions.$in=function(a,b){var i;if(!util.isArray(b))throw"$in operator called with a non-array";for(i=0;i<b.length;i+=1)if(areThingsEqual(a,b[i]))return!0;return!1},comparisonFunctions.$nin=function(a,b){if(!util.isArray(b))throw"$nin operator called with a non-array";return!comparisonFunctions.$in(a,b)},comparisonFunctions.$regex=function(a,b){if(!util.isRegExp(b))throw"$regex operator called with non regular expression";return"string"!=typeof a?!1:b.test(a)},comparisonFunctions.$exists=function(value,exists){return exists=exists||""===exists?!0:!1,void 0===value?!exists:exists},comparisonFunctions.$size=function(obj,value){if(!util.isArray(obj))return!1;if(value%1!==0)throw"$size operator called without an integer";return obj.length==value},arrayComparisonFunctions.$size=!0,logicalOperators.$or=function(obj,query){var i;if(!util.isArray(query))throw"$or operator used without an array";for(i=0;i<query.length;i+=1)if(match(obj,query[i]))return!0;return!1},logicalOperators.$and=function(obj,query){var i;if(!util.isArray(query))throw"$and operator used without an array";for(i=0;i<query.length;i+=1)if(!match(obj,query[i]))return!1;return!0},logicalOperators.$not=function(obj,query){return!match(obj,query)},logicalOperators.$where=function(obj,fn){var result;if(!_.isFunction(fn))throw"$where operator used without a function";if(result=fn.call(obj),!_.isBoolean(result))throw"$where function must return boolean";return result},module.exports.serialize=serialize,module.exports.deserialize=deserialize,module.exports.deepCopy=deepCopy,module.exports.checkObject=checkObject,module.exports.isPrimitiveType=isPrimitiveType,module.exports.modify=modify,module.exports.getDotValue=getDotValue,module.exports.match=match,module.exports.areThingsEqual=areThingsEqual,module.exports.compareThings=compareThings},{underscore:165,util:149}],159:[function(require,module,exports){(function(process){function Persistence(options){var i,j,randomString;if(this.db=options.db,this.inMemoryOnly=this.db.inMemoryOnly,this.filename=this.db.filename,this.corruptAlertThreshold=void 0!==options.corruptAlertThreshold?options.corruptAlertThreshold:.1,!this.inMemoryOnly&&this.filename){if("~"===this.filename.charAt(this.filename.length-1))throw"The datafile name can't end with a ~, which is reserved for automatic backup files";this.tempFilename=this.filename+"~",this.oldFilename=this.filename+"~~"}if(options.afterSerialization&&!options.beforeDeserialization)throw"Serialization hook defined but deserialization hook undefined, cautiously refusing to start NeDB to prevent dataloss";if(!options.afterSerialization&&options.beforeDeserialization)throw"Serialization hook undefined but deserialization hook defined, cautiously refusing to start NeDB to prevent dataloss";for(this.afterSerialization=options.afterSerialization||function(s){return s},this.beforeDeserialization=options.beforeDeserialization||function(s){return s},i=1;30>i;i+=1)for(j=0;10>j;j+=1)if(randomString=customUtils.uid(i),this.beforeDeserialization(this.afterSerialization(randomString))!==randomString)throw"beforeDeserialization is not the reverse of afterSerialization, cautiously refusing to start NeDB to prevent dataloss";this.filename&&options.nodeWebkitAppName&&(console.log("=================================================================="),console.log("WARNING: The nodeWebkitAppName option is deprecated"),console.log("To get the path to the directory where Node Webkit stores the data"),console.log("for your app, use the internal nw.gui module like this"),console.log("require('nw.gui').App.dataPath"),console.log("See https://github.com/rogerwang/node-webkit/issues/500"),console.log("=================================================================="),this.filename=Persistence.getNWAppFilename(options.nodeWebkitAppName,this.filename),this.tempFilename=Persistence.getNWAppFilename(options.nodeWebkitAppName,this.tempFilename),this.oldFilename=Persistence.getNWAppFilename(options.nodeWebkitAppName,this.oldFilename))}var storage=require("./storage"),path=require("path"),model=require("./model"),async=require("async"),customUtils=require("./customUtils"),Index=require("./indexes");Persistence.ensureDirectoryExists=function(dir,cb){var callback=cb||function(){};storage.mkdirp(dir,function(err){return callback(err)})},Persistence.ensureFileDoesntExist=function(file,callback){storage.exists(file,function(exists){return exists?void storage.unlink(file,function(err){return callback(err)}):callback(null)})},Persistence.getNWAppFilename=function(appName,relativeFilename){var home;switch(process.platform){case"win32":case"win64":if(home=process.env.LOCALAPPDATA||process.env.APPDATA,!home)throw"Couldn't find the base application data folder";home=path.join(home,appName);break;case"darwin":if(home=process.env.HOME,!home)throw"Couldn't find the base application data directory";home=path.join(home,"Library","Application Support",appName);break;case"linux":if(home=process.env.HOME,!home)throw"Couldn't find the base application data directory";home=path.join(home,".config",appName);break;default:throw"Can't use the Node Webkit relative path for platform "+process.platform}return path.join(home,"nedb-data",relativeFilename)},Persistence.prototype.persistCachedDatabase=function(cb){var callback=cb||function(){},toPersist="",self=this;return this.inMemoryOnly?callback(null):(this.db.getAllData().forEach(function(doc){toPersist+=self.afterSerialization(model.serialize(doc))+"\n"}),Object.keys(this.db.indexes).forEach(function(fieldName){"_id"!=fieldName&&(toPersist+=self.afterSerialization(model.serialize({$$indexCreated:{fieldName:fieldName,unique:self.db.indexes[fieldName].unique,sparse:self.db.indexes[fieldName].sparse}}))+"\n")}),void async.waterfall([async.apply(Persistence.ensureFileDoesntExist,self.tempFilename),async.apply(Persistence.ensureFileDoesntExist,self.oldFilename),function(cb){storage.exists(self.filename,function(exists){return exists?void storage.rename(self.filename,self.oldFilename,function(err){return cb(err)}):cb()})},function(cb){storage.writeFile(self.tempFilename,toPersist,function(err){return cb(err)})},function(cb){storage.rename(self.tempFilename,self.filename,function(err){return cb(err)})},async.apply(Persistence.ensureFileDoesntExist,self.oldFilename)],function(err){return callback(err?err:null)}))},Persistence.prototype.compactDatafile=function(){this.db.executor.push({"this":this,fn:this.persistCachedDatabase,arguments:[]})},Persistence.prototype.setAutocompactionInterval=function(interval){var self=this,minInterval=5e3,realInterval=Math.max(interval||0,minInterval);this.stopAutocompaction(),this.autocompactionIntervalId=setInterval(function(){self.compactDatafile()},realInterval)},Persistence.prototype.stopAutocompaction=function(){this.autocompactionIntervalId&&clearInterval(this.autocompactionIntervalId)},Persistence.prototype.persistNewState=function(newDocs,cb){var self=this,toPersist="",callback=cb||function(){};return self.inMemoryOnly?callback(null):(newDocs.forEach(function(doc){toPersist+=self.afterSerialization(model.serialize(doc))+"\n"}),0===toPersist.length?callback(null):void storage.appendFile(self.filename,toPersist,"utf8",function(err){return callback(err)}))},Persistence.prototype.treatRawData=function(rawData){var i,data=rawData.split("\n"),dataById={},tdata=[],indexes={},corruptItems=-1;for(i=0;i<data.length;i+=1){var doc;try{doc=model.deserialize(this.beforeDeserialization(data[i])),doc._id?doc.$$deleted===!0?delete dataById[doc._id]:dataById[doc._id]=doc:doc.$$indexCreated&&void 0!=doc.$$indexCreated.fieldName?indexes[doc.$$indexCreated.fieldName]=doc.$$indexCreated:"string"==typeof doc.$$indexRemoved&&delete indexes[doc.$$indexRemoved]}catch(e){corruptItems+=1}}if(data.length>0&&corruptItems/data.length>this.corruptAlertThreshold)throw"More than 10% of the data file is corrupt, the wrong beforeDeserialization hook may be used. Cautiously refusing to start NeDB to prevent dataloss";return Object.keys(dataById).forEach(function(k){tdata.push(dataById[k])}),{data:tdata,indexes:indexes}},Persistence.prototype.ensureDatafileIntegrity=function(callback){var self=this;storage.exists(self.filename,function(filenameExists){return filenameExists?callback(null):void storage.exists(self.oldFilename,function(oldFilenameExists){return oldFilenameExists?void storage.rename(self.oldFilename,self.filename,function(err){return callback(err)}):storage.writeFile(self.filename,"","utf8",function(err){callback(err)})})})},Persistence.prototype.loadDatabase=function(cb){var callback=cb||function(){},self=this;return self.db.resetIndexes(),self.inMemoryOnly?callback(null):void async.waterfall([function(cb){Persistence.ensureDirectoryExists(path.dirname(self.filename),function(err){self.ensureDatafileIntegrity(function(exists){storage.readFile(self.filename,"utf8",function(err,rawData){if(err)return cb(err);try{var treatedData=self.treatRawData(rawData)}catch(e){return cb(e)}Object.keys(treatedData.indexes).forEach(function(key){self.db.indexes[key]=new Index(treatedData.indexes[key])});try{self.db.resetIndexes(treatedData.data)}catch(e){return self.db.resetIndexes(),cb(e)}self.db.persistence.persistCachedDatabase(cb)})})})}],function(err){return err?callback(err):(self.db.executor.processBuffer(),callback(null))})},module.exports=Persistence}).call(this,require("_process"))},{"./customUtils":151,"./indexes":157,"./model":158,"./storage":152,_process:134,async:160,path:133}],160:[function(require,module,exports){(function(process){!function(){function only_once(fn){var called=!1;return function(){if(called)throw new Error("Callback was already called.");called=!0,fn.apply(root,arguments)}}var root,previous_async,async={};root=this,null!=root&&(previous_async=root.async),async.noConflict=function(){return root.async=previous_async,async};var _each=function(arr,iterator){if(arr.forEach)return arr.forEach(iterator);for(var i=0;i<arr.length;i+=1)iterator(arr[i],i,arr)},_map=function(arr,iterator){if(arr.map)return arr.map(iterator);var results=[];return _each(arr,function(x,i,a){results.push(iterator(x,i,a))}),results},_reduce=function(arr,iterator,memo){return arr.reduce?arr.reduce(iterator,memo):(_each(arr,function(x,i,a){memo=iterator(memo,x,i,a)}),memo)},_keys=function(obj){if(Object.keys)return Object.keys(obj);var keys=[];for(var k in obj)obj.hasOwnProperty(k)&&keys.push(k);return keys};"undefined"!=typeof process&&process.nextTick?(async.nextTick=process.nextTick,"undefined"!=typeof setImmediate?async.setImmediate=function(fn){setImmediate(fn)}:async.setImmediate=async.nextTick):"function"==typeof setImmediate?(async.nextTick=function(fn){setImmediate(fn)},async.setImmediate=async.nextTick):(async.nextTick=function(fn){setTimeout(fn,0)},async.setImmediate=async.nextTick),async.each=function(arr,iterator,callback){if(callback=callback||function(){},!arr.length)return callback();var completed=0;_each(arr,function(x){iterator(x,only_once(function(err){err?(callback(err),callback=function(){}):(completed+=1,completed>=arr.length&&callback(null))}))})},async.forEach=async.each,async.eachSeries=function(arr,iterator,callback){if(callback=callback||function(){},!arr.length)return callback();var completed=0,iterate=function(){iterator(arr[completed],function(err){err?(callback(err),callback=function(){}):(completed+=1,completed>=arr.length?callback(null):iterate())})};iterate()},async.forEachSeries=async.eachSeries,async.eachLimit=function(arr,limit,iterator,callback){var fn=_eachLimit(limit);fn.apply(null,[arr,iterator,callback])},async.forEachLimit=async.eachLimit;var _eachLimit=function(limit){return function(arr,iterator,callback){if(callback=callback||function(){},!arr.length||0>=limit)return callback();var completed=0,started=0,running=0;!function replenish(){if(completed>=arr.length)return callback();for(;limit>running&&started<arr.length;)started+=1,running+=1,iterator(arr[started-1],function(err){err?(callback(err),callback=function(){}):(completed+=1,running-=1,completed>=arr.length?callback():replenish())})}()}},doParallel=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.each].concat(args))}},doParallelLimit=function(limit,fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[_eachLimit(limit)].concat(args))}},doSeries=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.eachSeries].concat(args))}},_asyncMap=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}}),eachfn(arr,function(x,callback){iterator(x.value,function(err,v){results[x.index]=v,callback(err)})},function(err){callback(err,results)})};async.map=doParallel(_asyncMap),async.mapSeries=doSeries(_asyncMap),async.mapLimit=function(arr,limit,iterator,callback){return _mapLimit(limit)(arr,iterator,callback)};var _mapLimit=function(limit){return doParallelLimit(limit,_asyncMap)};async.reduce=function(arr,memo,iterator,callback){async.eachSeries(arr,function(x,callback){iterator(memo,x,function(err,v){memo=v,callback(err)})},function(err){callback(err,memo)})},async.inject=async.reduce,async.foldl=async.reduce,async.reduceRight=function(arr,memo,iterator,callback){var reversed=_map(arr,function(x){return x}).reverse();async.reduce(reversed,memo,iterator,callback)},async.foldr=async.reduceRight;var _filter=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}}),eachfn(arr,function(x,callback){iterator(x.value,function(v){v&&results.push(x),callback()})},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.filter=doParallel(_filter),async.filterSeries=doSeries(_filter),async.select=async.filter,async.selectSeries=async.filterSeries;var _reject=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}}),eachfn(arr,function(x,callback){iterator(x.value,function(v){v||results.push(x),callback()})},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.reject=doParallel(_reject),async.rejectSeries=doSeries(_reject);var _detect=function(eachfn,arr,iterator,main_callback){eachfn(arr,function(x,callback){iterator(x,function(result){result?(main_callback(x),main_callback=function(){}):callback()})},function(err){main_callback()})};async.detect=doParallel(_detect),async.detectSeries=doSeries(_detect),async.some=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){v&&(main_callback(!0),main_callback=function(){}),callback()})},function(err){main_callback(!1)})},async.any=async.some,async.every=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){v||(main_callback(!1),main_callback=function(){}),callback()})},function(err){main_callback(!0)})},async.all=async.every,async.sortBy=function(arr,iterator,callback){async.map(arr,function(x,callback){iterator(x,function(err,criteria){err?callback(err):callback(null,{value:x,criteria:criteria})})},function(err,results){if(err)return callback(err);var fn=function(left,right){var a=left.criteria,b=right.criteria;return b>a?-1:a>b?1:0};callback(null,_map(results.sort(fn),function(x){return x.value}))})},async.auto=function(tasks,callback){callback=callback||function(){};var keys=_keys(tasks);if(!keys.length)return callback(null);var results={},listeners=[],addListener=function(fn){listeners.unshift(fn)},removeListener=function(fn){for(var i=0;i<listeners.length;i+=1)if(listeners[i]===fn)return void listeners.splice(i,1)},taskComplete=function(){_each(listeners.slice(0),function(fn){fn()})};addListener(function(){_keys(results).length===keys.length&&(callback(null,results),callback=function(){})}),_each(keys,function(k){var task=tasks[k]instanceof Function?[tasks[k]]:tasks[k],taskCallback=function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1&&(args=args[0]),err){var safeResults={};_each(_keys(results),function(rkey){safeResults[rkey]=results[rkey]}),safeResults[k]=args,callback(err,safeResults),callback=function(){}}else results[k]=args,async.setImmediate(taskComplete)},requires=task.slice(0,Math.abs(task.length-1))||[],ready=function(){return _reduce(requires,function(a,x){return a&&results.hasOwnProperty(x)},!0)&&!results.hasOwnProperty(k)};if(ready())task[task.length-1](taskCallback,results);else{var listener=function(){ready()&&(removeListener(listener),task[task.length-1](taskCallback,results))};addListener(listener)}})},async.waterfall=function(tasks,callback){if(callback=callback||function(){},tasks.constructor!==Array){var err=new Error("First argument to waterfall must be an array of functions");return callback(err)}if(!tasks.length)return callback();var wrapIterator=function(iterator){return function(err){if(err)callback.apply(null,arguments),callback=function(){};else{var args=Array.prototype.slice.call(arguments,1),next=iterator.next();next?args.push(wrapIterator(next)):args.push(callback),async.setImmediate(function(){iterator.apply(null,args)})}}};wrapIterator(async.iterator(tasks))()};var _parallel=function(eachfn,tasks,callback){if(callback=callback||function(){},tasks.constructor===Array)eachfn.map(tasks,function(fn,callback){fn&&fn(function(err){var args=Array.prototype.slice.call(arguments,1);args.length<=1&&(args=args[0]),callback.call(null,err,args)})},callback);else{var results={};eachfn.each(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);args.length<=1&&(args=args[0]),results[k]=args,callback(err)})},function(err){callback(err,results)})}};async.parallel=function(tasks,callback){_parallel({map:async.map,each:async.each},tasks,callback)},async.parallelLimit=function(tasks,limit,callback){_parallel({map:_mapLimit(limit),each:_eachLimit(limit)},tasks,callback)},async.series=function(tasks,callback){if(callback=callback||function(){},tasks.constructor===Array)async.mapSeries(tasks,function(fn,callback){fn&&fn(function(err){var args=Array.prototype.slice.call(arguments,1);args.length<=1&&(args=args[0]),callback.call(null,err,args)})},callback);else{var results={};async.eachSeries(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);args.length<=1&&(args=args[0]),results[k]=args,callback(err)})},function(err){callback(err,results)})}},async.iterator=function(tasks){var makeCallback=function(index){var fn=function(){return tasks.length&&tasks[index].apply(null,arguments),fn.next()};return fn.next=function(){return index<tasks.length-1?makeCallback(index+1):null},fn};return makeCallback(0)},async.apply=function(fn){var args=Array.prototype.slice.call(arguments,1);return function(){return fn.apply(null,args.concat(Array.prototype.slice.call(arguments)))}};var _concat=function(eachfn,arr,fn,callback){var r=[];eachfn(arr,function(x,cb){fn(x,function(err,y){r=r.concat(y||[]),cb(err)})},function(err){callback(err,r)})};async.concat=doParallel(_concat),async.concatSeries=doSeries(_concat),async.whilst=function(test,iterator,callback){test()?iterator(function(err){return err?callback(err):void async.whilst(test,iterator,callback)}):callback()},async.doWhilst=function(iterator,test,callback){iterator(function(err){return err?callback(err):void(test()?async.doWhilst(iterator,test,callback):callback())})},async.until=function(test,iterator,callback){test()?callback():iterator(function(err){return err?callback(err):void async.until(test,iterator,callback)})},async.doUntil=function(iterator,test,callback){iterator(function(err){return err?callback(err):void(test()?callback():async.doUntil(iterator,test,callback))})},async.queue=function(worker,concurrency){function _insert(q,data,pos,callback){data.constructor!==Array&&(data=[data]),_each(data,function(task){var item={data:task,callback:"function"==typeof callback?callback:null};pos?q.tasks.unshift(item):q.tasks.push(item),q.saturated&&q.tasks.length===concurrency&&q.saturated(),async.setImmediate(q.process)})}void 0===concurrency&&(concurrency=1);var workers=0,q={tasks:[],concurrency:concurrency,saturated:null,empty:null,drain:null,push:function(data,callback){_insert(q,data,!1,callback)},unshift:function(data,callback){_insert(q,data,!0,callback)},process:function(){if(workers<q.concurrency&&q.tasks.length){var task=q.tasks.shift();q.empty&&0===q.tasks.length&&q.empty(),workers+=1;var next=function(){workers-=1,task.callback&&task.callback.apply(task,arguments),q.drain&&q.tasks.length+workers===0&&q.drain(),q.process()},cb=only_once(next);worker(task.data,cb)}},length:function(){return q.tasks.length},running:function(){return workers}};return q},async.cargo=function(worker,payload){var working=!1,tasks=[],cargo={tasks:tasks,payload:payload,saturated:null,empty:null,drain:null,push:function(data,callback){data.constructor!==Array&&(data=[data]),_each(data,function(task){tasks.push({data:task,callback:"function"==typeof callback?callback:null}),cargo.saturated&&tasks.length===payload&&cargo.saturated()}),async.setImmediate(cargo.process)},process:function process(){if(!working){if(0===tasks.length)return void(cargo.drain&&cargo.drain());var ts="number"==typeof payload?tasks.splice(0,payload):tasks.splice(0),ds=_map(ts,function(task){return task.data});cargo.empty&&cargo.empty(),working=!0,worker(ds,function(){working=!1;var args=arguments;_each(ts,function(data){data.callback&&data.callback.apply(null,args)}),process()})}},length:function(){return tasks.length},running:function(){return working}};return cargo};var _console_fn=function(name){return function(fn){var args=Array.prototype.slice.call(arguments,1);
fn.apply(null,args.concat([function(err){var args=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(err?console.error&&console.error(err):console[name]&&_each(args,function(x){console[name](x)}))}]))}};async.log=_console_fn("log"),async.dir=_console_fn("dir"),async.memoize=function(fn,hasher){var memo={},queues={};hasher=hasher||function(x){return x};var memoized=function(){var args=Array.prototype.slice.call(arguments),callback=args.pop(),key=hasher.apply(null,args);key in memo?callback.apply(null,memo[key]):key in queues?queues[key].push(callback):(queues[key]=[callback],fn.apply(null,args.concat([function(){memo[key]=arguments;var q=queues[key];delete queues[key];for(var i=0,l=q.length;l>i;i++)q[i].apply(null,arguments)}])))};return memoized.memo=memo,memoized.unmemoized=fn,memoized},async.unmemoize=function(fn){return function(){return(fn.unmemoized||fn).apply(null,arguments)}},async.times=function(count,iterator,callback){for(var counter=[],i=0;count>i;i++)counter.push(i);return async.map(counter,iterator,callback)},async.timesSeries=function(count,iterator,callback){for(var counter=[],i=0;count>i;i++)counter.push(i);return async.mapSeries(counter,iterator,callback)},async.compose=function(){var fns=Array.prototype.reverse.call(arguments);return function(){var that=this,args=Array.prototype.slice.call(arguments),callback=args.pop();async.reduce(fns,args,function(newargs,fn,cb){fn.apply(that,newargs.concat([function(){var err=arguments[0],nextargs=Array.prototype.slice.call(arguments,1);cb(err,nextargs)}]))},function(err,results){callback.apply(that,[err].concat(results))})}};var _applyEach=function(eachfn,fns){var go=function(){var that=this,args=Array.prototype.slice.call(arguments),callback=args.pop();return eachfn(fns,function(fn,cb){fn.apply(that,args.concat([cb]))},callback)};if(arguments.length>2){var args=Array.prototype.slice.call(arguments,2);return go.apply(this,args)}return go};async.applyEach=doParallel(_applyEach),async.applyEachSeries=doSeries(_applyEach),async.forever=function(fn,callback){function next(err){if(err){if(callback)return callback(err);throw err}fn(next)}next()},"undefined"!=typeof define&&define.amd?define([],function(){return async}):"undefined"!=typeof module&&module.exports?module.exports=async:root.async=async}()}).call(this,require("_process"))},{_process:134}],161:[function(require,module,exports){module.exports.BinarySearchTree=require("./lib/bst"),module.exports.AVLTree=require("./lib/avltree")},{"./lib/avltree":162,"./lib/bst":163}],162:[function(require,module,exports){function AVLTree(options){this.tree=new _AVLTree(options)}function _AVLTree(options){options=options||{},this.left=null,this.right=null,this.parent=void 0!==options.parent?options.parent:null,options.hasOwnProperty("key")&&(this.key=options.key),this.data=options.hasOwnProperty("value")?[options.value]:[],this.unique=options.unique||!1,this.compareKeys=options.compareKeys||customUtils.defaultCompareKeysFunction,this.checkValueEquality=options.checkValueEquality||customUtils.defaultCheckValueEquality}var BinarySearchTree=require("./bst"),customUtils=require("./customUtils"),util=require("util");require("underscore");util.inherits(_AVLTree,BinarySearchTree),AVLTree._AVLTree=_AVLTree,_AVLTree.prototype.checkHeightCorrect=function(){var leftH,rightH;if(this.hasOwnProperty("key")){if(this.left&&void 0===this.left.height)throw"Undefined height for node "+this.left.key;if(this.right&&void 0===this.right.height)throw"Undefined height for node "+this.right.key;if(void 0===this.height)throw"Undefined height for node "+this.key;if(leftH=this.left?this.left.height:0,rightH=this.right?this.right.height:0,this.height!==1+Math.max(leftH,rightH))throw"Height constraint failed for node "+this.key;this.left&&this.left.checkHeightCorrect(),this.right&&this.right.checkHeightCorrect()}},_AVLTree.prototype.balanceFactor=function(){var leftH=this.left?this.left.height:0,rightH=this.right?this.right.height:0;return leftH-rightH},_AVLTree.prototype.checkBalanceFactors=function(){if(Math.abs(this.balanceFactor())>1)throw"Tree is unbalanced at node "+this.key;this.left&&this.left.checkBalanceFactors(),this.right&&this.right.checkBalanceFactors()},_AVLTree.prototype.checkIsAVLT=function(){_AVLTree.super_.prototype.checkIsBST.call(this),this.checkHeightCorrect(),this.checkBalanceFactors()},AVLTree.prototype.checkIsAVLT=function(){this.tree.checkIsAVLT()},_AVLTree.prototype.rightRotation=function(){var b,ah,bh,ch,q=this,p=this.left;return p?(b=p.right,q.parent?(p.parent=q.parent,q.parent.left===q?q.parent.left=p:q.parent.right=p):p.parent=null,p.right=q,q.parent=p,q.left=b,b&&(b.parent=q),ah=p.left?p.left.height:0,bh=b?b.height:0,ch=q.right?q.right.height:0,q.height=Math.max(bh,ch)+1,p.height=Math.max(ah,q.height)+1,p):this},_AVLTree.prototype.leftRotation=function(){var b,ah,bh,ch,p=this,q=this.right;return q?(b=q.left,p.parent?(q.parent=p.parent,p.parent.left===p?p.parent.left=q:p.parent.right=q):q.parent=null,q.left=p,p.parent=q,p.right=b,b&&(b.parent=p),ah=p.left?p.left.height:0,bh=b?b.height:0,ch=q.right?q.right.height:0,p.height=Math.max(ah,bh)+1,q.height=Math.max(ch,p.height)+1,q):this},_AVLTree.prototype.rightTooSmall=function(){return this.balanceFactor()<=1?this:(this.left.balanceFactor()<0&&this.left.leftRotation(),this.rightRotation())},_AVLTree.prototype.leftTooSmall=function(){return this.balanceFactor()>=-1?this:(this.right.balanceFactor()>0&&this.right.rightRotation(),this.leftRotation())},_AVLTree.prototype.rebalanceAlongPath=function(path){var rotated,i,newRoot=this;if(!this.hasOwnProperty("key"))return delete this.height,this;for(i=path.length-1;i>=0;i-=1)path[i].height=1+Math.max(path[i].left?path[i].left.height:0,path[i].right?path[i].right.height:0),path[i].balanceFactor()>1&&(rotated=path[i].rightTooSmall(),0===i&&(newRoot=rotated)),path[i].balanceFactor()<-1&&(rotated=path[i].leftTooSmall(),0===i&&(newRoot=rotated));return newRoot},_AVLTree.prototype.insert=function(key,value){var insertPath=[],currentNode=this;if(!this.hasOwnProperty("key"))return this.key=key,this.data.push(value),this.height=1,this;for(;;){if(0===currentNode.compareKeys(currentNode.key,key)){if(currentNode.unique)throw{message:"Can't insert key "+key+", it violates the unique constraint",key:key,errorType:"uniqueViolated"};return currentNode.data.push(value),this}if(insertPath.push(currentNode),currentNode.compareKeys(key,currentNode.key)<0){if(!currentNode.left){insertPath.push(currentNode.createLeftChild({key:key,value:value}));break}currentNode=currentNode.left}else{if(!currentNode.right){insertPath.push(currentNode.createRightChild({key:key,value:value}));break}currentNode=currentNode.right}}return this.rebalanceAlongPath(insertPath)},AVLTree.prototype.insert=function(key,value){var newTree=this.tree.insert(key,value);newTree&&(this.tree=newTree)},_AVLTree.prototype["delete"]=function(key,value){var replaceWith,newData=[],currentNode=this,deletePath=[];if(!this.hasOwnProperty("key"))return this;for(;;){if(0===currentNode.compareKeys(key,currentNode.key))break;if(deletePath.push(currentNode),currentNode.compareKeys(key,currentNode.key)<0){if(!currentNode.left)return this;currentNode=currentNode.left}else{if(!currentNode.right)return this;currentNode=currentNode.right}}if(currentNode.data.length>1&&value)return currentNode.data.forEach(function(d){currentNode.checkValueEquality(d,value)||newData.push(d)}),currentNode.data=newData,this;if(!currentNode.left&&!currentNode.right)return currentNode===this?(delete currentNode.key,currentNode.data=[],delete currentNode.height,this):(currentNode.parent.left===currentNode?currentNode.parent.left=null:currentNode.parent.right=null,this.rebalanceAlongPath(deletePath));if(!currentNode.left||!currentNode.right)return replaceWith=currentNode.left?currentNode.left:currentNode.right,currentNode===this?(replaceWith.parent=null,replaceWith):(currentNode.parent.left===currentNode?(currentNode.parent.left=replaceWith,replaceWith.parent=currentNode.parent):(currentNode.parent.right=replaceWith,replaceWith.parent=currentNode.parent),this.rebalanceAlongPath(deletePath));if(deletePath.push(currentNode),replaceWith=currentNode.left,!replaceWith.right)return currentNode.key=replaceWith.key,currentNode.data=replaceWith.data,currentNode.left=replaceWith.left,replaceWith.left&&(replaceWith.left.parent=currentNode),this.rebalanceAlongPath(deletePath);for(;;){if(!replaceWith.right)break;deletePath.push(replaceWith),replaceWith=replaceWith.right}return currentNode.key=replaceWith.key,currentNode.data=replaceWith.data,replaceWith.parent.right=replaceWith.left,replaceWith.left&&(replaceWith.left.parent=replaceWith.parent),this.rebalanceAlongPath(deletePath)},AVLTree.prototype["delete"]=function(key,value){var newTree=this.tree["delete"](key,value);newTree&&(this.tree=newTree)},["getNumberOfKeys","search","betweenBounds","prettyPrint","executeOnEveryNode"].forEach(function(fn){AVLTree.prototype[fn]=function(){return this.tree[fn].apply(this.tree,arguments)}}),module.exports=AVLTree},{"./bst":163,"./customUtils":164,underscore:165,util:149}],163:[function(require,module,exports){function BinarySearchTree(options){options=options||{},this.left=null,this.right=null,this.parent=void 0!==options.parent?options.parent:null,options.hasOwnProperty("key")&&(this.key=options.key),this.data=options.hasOwnProperty("value")?[options.value]:[],this.unique=options.unique||!1,this.compareKeys=options.compareKeys||customUtils.defaultCompareKeysFunction,this.checkValueEquality=options.checkValueEquality||customUtils.defaultCheckValueEquality}function append(array,toAppend){var i;for(i=0;i<toAppend.length;i+=1)array.push(toAppend[i])}var customUtils=require("./customUtils");BinarySearchTree.prototype.getMaxKeyDescendant=function(){return this.right?this.right.getMaxKeyDescendant():this},BinarySearchTree.prototype.getMaxKey=function(){return this.getMaxKeyDescendant().key},BinarySearchTree.prototype.getMinKeyDescendant=function(){return this.left?this.left.getMinKeyDescendant():this},BinarySearchTree.prototype.getMinKey=function(){return this.getMinKeyDescendant().key},BinarySearchTree.prototype.checkAllNodesFullfillCondition=function(test){this.hasOwnProperty("key")&&(test(this.key,this.data),this.left&&this.left.checkAllNodesFullfillCondition(test),this.right&&this.right.checkAllNodesFullfillCondition(test))},BinarySearchTree.prototype.checkNodeOrdering=function(){var self=this;this.hasOwnProperty("key")&&(this.left&&(this.left.checkAllNodesFullfillCondition(function(k){if(self.compareKeys(k,self.key)>=0)throw"Tree with root "+self.key+" is not a binary search tree"}),this.left.checkNodeOrdering()),this.right&&(this.right.checkAllNodesFullfillCondition(function(k){if(self.compareKeys(k,self.key)<=0)throw"Tree with root "+self.key+" is not a binary search tree"}),this.right.checkNodeOrdering()))},BinarySearchTree.prototype.checkInternalPointers=function(){if(this.left){if(this.left.parent!==this)throw"Parent pointer broken for key "+this.key;this.left.checkInternalPointers()}if(this.right){if(this.right.parent!==this)throw"Parent pointer broken for key "+this.key;this.right.checkInternalPointers()}},BinarySearchTree.prototype.checkIsBST=function(){if(this.checkNodeOrdering(),this.checkInternalPointers(),this.parent)throw"The root shouldn't have a parent"},BinarySearchTree.prototype.getNumberOfKeys=function(){var res;return this.hasOwnProperty("key")?(res=1,this.left&&(res+=this.left.getNumberOfKeys()),this.right&&(res+=this.right.getNumberOfKeys()),res):0},BinarySearchTree.prototype.createSimilar=function(options){return options=options||{},options.unique=this.unique,options.compareKeys=this.compareKeys,options.checkValueEquality=this.checkValueEquality,new this.constructor(options)},BinarySearchTree.prototype.createLeftChild=function(options){var leftChild=this.createSimilar(options);return leftChild.parent=this,this.left=leftChild,leftChild},BinarySearchTree.prototype.createRightChild=function(options){var rightChild=this.createSimilar(options);return rightChild.parent=this,this.right=rightChild,rightChild},BinarySearchTree.prototype.insert=function(key,value){if(!this.hasOwnProperty("key"))return this.key=key,void this.data.push(value);if(0===this.compareKeys(this.key,key)){if(this.unique)throw{message:"Can't insert key "+key+", it violates the unique constraint",key:key,errorType:"uniqueViolated"};return void this.data.push(value)}this.compareKeys(key,this.key)<0?this.left?this.left.insert(key,value):this.createLeftChild({key:key,value:value}):this.right?this.right.insert(key,value):this.createRightChild({key:key,value:value})},BinarySearchTree.prototype.search=function(key){return this.hasOwnProperty("key")?0===this.compareKeys(this.key,key)?this.data:this.compareKeys(key,this.key)<0?this.left?this.left.search(key):[]:this.right?this.right.search(key):[]:[]},BinarySearchTree.prototype.getLowerBoundMatcher=function(query){var self=this;return query.hasOwnProperty("$gt")||query.hasOwnProperty("$gte")?query.hasOwnProperty("$gt")&&query.hasOwnProperty("$gte")?0===self.compareKeys(query.$gte,query.$gt)?function(key){return self.compareKeys(key,query.$gt)>0}:self.compareKeys(query.$gte,query.$gt)>0?function(key){return self.compareKeys(key,query.$gte)>=0}:function(key){return self.compareKeys(key,query.$gt)>0}:query.hasOwnProperty("$gt")?function(key){return self.compareKeys(key,query.$gt)>0}:function(key){return self.compareKeys(key,query.$gte)>=0}:function(){return!0}},BinarySearchTree.prototype.getUpperBoundMatcher=function(query){var self=this;return query.hasOwnProperty("$lt")||query.hasOwnProperty("$lte")?query.hasOwnProperty("$lt")&&query.hasOwnProperty("$lte")?0===self.compareKeys(query.$lte,query.$lt)?function(key){return self.compareKeys(key,query.$lt)<0}:self.compareKeys(query.$lte,query.$lt)<0?function(key){return self.compareKeys(key,query.$lte)<=0}:function(key){return self.compareKeys(key,query.$lt)<0}:query.hasOwnProperty("$lt")?function(key){return self.compareKeys(key,query.$lt)<0}:function(key){return self.compareKeys(key,query.$lte)<=0}:function(){return!0}},BinarySearchTree.prototype.betweenBounds=function(query,lbm,ubm){var res=[];return this.hasOwnProperty("key")?(lbm=lbm||this.getLowerBoundMatcher(query),ubm=ubm||this.getUpperBoundMatcher(query),lbm(this.key)&&this.left&&append(res,this.left.betweenBounds(query,lbm,ubm)),lbm(this.key)&&ubm(this.key)&&append(res,this.data),ubm(this.key)&&this.right&&append(res,this.right.betweenBounds(query,lbm,ubm)),res):[]},BinarySearchTree.prototype.deleteIfLeaf=function(){return this.left||this.right?!1:this.parent?(this.parent.left===this?this.parent.left=null:this.parent.right=null,!0):(delete this.key,this.data=[],!0)},BinarySearchTree.prototype.deleteIfOnlyOneChild=function(){var child;return this.left&&!this.right&&(child=this.left),!this.left&&this.right&&(child=this.right),child?this.parent?(this.parent.left===this?(this.parent.left=child,child.parent=this.parent):(this.parent.right=child,child.parent=this.parent),!0):(this.key=child.key,this.data=child.data,this.left=null,child.left&&(this.left=child.left,child.left.parent=this),this.right=null,child.right&&(this.right=child.right,child.right.parent=this),!0):!1},BinarySearchTree.prototype["delete"]=function(key,value){var replaceWith,newData=[],self=this;if(this.hasOwnProperty("key")){if(this.compareKeys(key,this.key)<0)return void(this.left&&this.left["delete"](key,value));if(this.compareKeys(key,this.key)>0)return void(this.right&&this.right["delete"](key,value));if(0!==!this.compareKeys(key,this.key))return this.data.length>1&&void 0!==value?(this.data.forEach(function(d){self.checkValueEquality(d,value)||newData.push(d)}),void(self.data=newData)):void(this.deleteIfLeaf()||this.deleteIfOnlyOneChild()||(Math.random()>=.5?(replaceWith=this.left.getMaxKeyDescendant(),this.key=replaceWith.key,this.data=replaceWith.data,this===replaceWith.parent?(this.left=replaceWith.left,replaceWith.left&&(replaceWith.left.parent=replaceWith.parent)):(replaceWith.parent.right=replaceWith.left,replaceWith.left&&(replaceWith.left.parent=replaceWith.parent))):(replaceWith=this.right.getMinKeyDescendant(),this.key=replaceWith.key,this.data=replaceWith.data,this===replaceWith.parent?(this.right=replaceWith.right,replaceWith.right&&(replaceWith.right.parent=replaceWith.parent)):(replaceWith.parent.left=replaceWith.right,replaceWith.right&&(replaceWith.right.parent=replaceWith.parent)))))}},BinarySearchTree.prototype.executeOnEveryNode=function(fn){this.left&&this.left.executeOnEveryNode(fn),fn(this),this.right&&this.right.executeOnEveryNode(fn)},BinarySearchTree.prototype.prettyPrint=function(printData,spacing){spacing=spacing||"",console.log(spacing+"* "+this.key),printData&&console.log(spacing+"* "+this.data),(this.left||this.right)&&(this.left?this.left.prettyPrint(printData,spacing+"  "):console.log(spacing+"  *"),this.right?this.right.prettyPrint(printData,spacing+"  "):console.log(spacing+"  *"))},module.exports=BinarySearchTree},{"./customUtils":164}],164:[function(require,module,exports){function getRandomArray(n){var res,next;return 0===n?[]:1===n?[0]:(res=getRandomArray(n-1),next=Math.floor(Math.random()*n),res.splice(next,0,n-1),res)}function defaultCompareKeysFunction(a,b){if(b>a)return-1;if(a>b)return 1;if(a===b)return 0;throw{message:"Couldn't compare elements",a:a,b:b}}function defaultCheckValueEquality(a,b){return a===b}module.exports.getRandomArray=getRandomArray,module.exports.defaultCompareKeysFunction=defaultCompareKeysFunction,module.exports.defaultCheckValueEquality=defaultCheckValueEquality},{}],165:[function(require,module,exports){(function(){var root=this,previousUnderscore=root._,breaker={},ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype,push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,_=function(obj){return obj instanceof _?obj:this instanceof _?void(this._wrapped=obj):new _(obj)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=_),exports._=_):root._=_,_.VERSION="1.4.4";var each=_.each=_.forEach=function(obj,iterator,context){if(null!=obj)if(nativeForEach&&obj.forEach===nativeForEach)obj.forEach(iterator,context);else if(obj.length===+obj.length){for(var i=0,l=obj.length;l>i;i++)if(iterator.call(context,obj[i],i,obj)===breaker)return}else for(var key in obj)if(_.has(obj,key)&&iterator.call(context,obj[key],key,obj)===breaker)return};_.map=_.collect=function(obj,iterator,context){var results=[];return null==obj?results:nativeMap&&obj.map===nativeMap?obj.map(iterator,context):(each(obj,function(value,index,list){results[results.length]=iterator.call(context,value,index,list)}),results)};var reduceError="Reduce of empty array with no initial value";_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;if(null==obj&&(obj=[]),nativeReduce&&obj.reduce===nativeReduce)return context&&(iterator=_.bind(iterator,context)),initial?obj.reduce(iterator,memo):obj.reduce(iterator);if(each(obj,function(value,index,list){initial?memo=iterator.call(context,memo,value,index,list):(memo=value,initial=!0)}),!initial)throw new TypeError(reduceError);return memo},_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;if(null==obj&&(obj=[]),nativeReduceRight&&obj.reduceRight===nativeReduceRight)return context&&(iterator=_.bind(iterator,context)),initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator);var length=obj.length;if(length!==+length){var keys=_.keys(obj);length=keys.length}if(each(obj,function(value,index,list){index=keys?keys[--length]:--length,initial?memo=iterator.call(context,memo,obj[index],index,list):(memo=obj[index],initial=!0)}),!initial)throw new TypeError(reduceError);return memo},_.find=_.detect=function(obj,iterator,context){var result;return any(obj,function(value,index,list){return iterator.call(context,value,index,list)?(result=value,!0):void 0}),result},_.filter=_.select=function(obj,iterator,context){var results=[];return null==obj?results:nativeFilter&&obj.filter===nativeFilter?obj.filter(iterator,context):(each(obj,function(value,index,list){iterator.call(context,value,index,list)&&(results[results.length]=value)}),results)},_.reject=function(obj,iterator,context){return _.filter(obj,function(value,index,list){return!iterator.call(context,value,index,list)},context)},_.every=_.all=function(obj,iterator,context){iterator||(iterator=_.identity);var result=!0;return null==obj?result:nativeEvery&&obj.every===nativeEvery?obj.every(iterator,context):(each(obj,function(value,index,list){return(result=result&&iterator.call(context,value,index,list))?void 0:breaker}),!!result)};var any=_.some=_.any=function(obj,iterator,context){iterator||(iterator=_.identity);var result=!1;return null==obj?result:nativeSome&&obj.some===nativeSome?obj.some(iterator,context):(each(obj,function(value,index,list){return result||(result=iterator.call(context,value,index,list))?breaker:void 0}),!!result)};_.contains=_.include=function(obj,target){return null==obj?!1:nativeIndexOf&&obj.indexOf===nativeIndexOf?-1!=obj.indexOf(target):any(obj,function(value){return value===target})},_.invoke=function(obj,method){var args=slice.call(arguments,2),isFunc=_.isFunction(method);return _.map(obj,function(value){return(isFunc?method:value[method]).apply(value,args)})},_.pluck=function(obj,key){return _.map(obj,function(value){return value[key]})},_.where=function(obj,attrs,first){return _.isEmpty(attrs)?first?null:[]:_[first?"find":"filter"](obj,function(value){for(var key in attrs)if(attrs[key]!==value[key])return!1;return!0})},_.findWhere=function(obj,attrs){return _.where(obj,attrs,!0)},_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535)return Math.max.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return-(1/0);var result={computed:-(1/0),value:-(1/0)};return each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed>=result.computed&&(result={value:value,computed:computed})}),result.value},_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535)return Math.min.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return 1/0;var result={computed:1/0,value:1/0};return each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed<result.computed&&(result={value:value,computed:computed})}),result.value},_.shuffle=function(obj){var rand,index=0,shuffled=[];return each(obj,function(value){rand=_.random(index++),shuffled[index-1]=shuffled[rand],shuffled[rand]=value}),shuffled};var lookupIterator=function(value){return _.isFunction(value)?value:function(obj){return obj[value]}};_.sortBy=function(obj,value,context){var iterator=lookupIterator(value);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iterator.call(context,value,index,list)}}).sort(function(left,right){var a=left.criteria,b=right.criteria;if(a!==b){if(a>b||void 0===a)return 1;if(b>a||void 0===b)return-1}return left.index<right.index?-1:1}),"value")};var group=function(obj,value,context,behavior){var result={},iterator=lookupIterator(value||_.identity);return each(obj,function(value,index){var key=iterator.call(context,value,index,obj);behavior(result,key,value)}),result};_.groupBy=function(obj,value,context){return group(obj,value,context,function(result,key,value){(_.has(result,key)?result[key]:result[key]=[]).push(value)})},_.countBy=function(obj,value,context){return group(obj,value,context,function(result,key){_.has(result,key)||(result[key]=0),result[key]++})},_.sortedIndex=function(array,obj,iterator,context){iterator=null==iterator?_.identity:lookupIterator(iterator);for(var value=iterator.call(context,obj),low=0,high=array.length;high>low;){var mid=low+high>>>1;iterator.call(context,array[mid])<value?low=mid+1:high=mid}return low},_.toArray=function(obj){return obj?_.isArray(obj)?slice.call(obj):obj.length===+obj.length?_.map(obj,_.identity):_.values(obj):[]},_.size=function(obj){return null==obj?0:obj.length===+obj.length?obj.length:_.keys(obj).length},_.first=_.head=_.take=function(array,n,guard){return null==array?void 0:null==n||guard?array[0]:slice.call(array,0,n)},_.initial=function(array,n,guard){return slice.call(array,0,array.length-(null==n||guard?1:n))},_.last=function(array,n,guard){return null==array?void 0:null==n||guard?array[array.length-1]:slice.call(array,Math.max(array.length-n,0))},_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,null==n||guard?1:n)},_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,output){return each(input,function(value){_.isArray(value)?shallow?push.apply(output,value):flatten(value,shallow,output):output.push(value)}),output};_.flatten=function(array,shallow){return flatten(array,shallow,[])},_.without=function(array){return _.difference(array,slice.call(arguments,1))},_.uniq=_.unique=function(array,isSorted,iterator,context){_.isFunction(isSorted)&&(context=iterator,iterator=isSorted,isSorted=!1);var initial=iterator?_.map(array,iterator,context):array,results=[],seen=[];return each(initial,function(value,index){(isSorted?index&&seen[seen.length-1]===value:_.contains(seen,value))||(seen.push(value),results.push(array[index]))}),results},_.union=function(){return _.uniq(concat.apply(ArrayProto,arguments))},_.intersection=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.indexOf(other,item)>=0})})},_.difference=function(array){var rest=concat.apply(ArrayProto,slice.call(arguments,1));return _.filter(array,function(value){return!_.contains(rest,value)})},_.zip=function(){for(var args=slice.call(arguments),length=_.max(_.pluck(args,"length")),results=new Array(length),i=0;length>i;i++)results[i]=_.pluck(args,""+i);return results},_.object=function(list,values){if(null==list)return{};for(var result={},i=0,l=list.length;l>i;i++)values?result[list[i]]=values[i]:result[list[i][0]]=list[i][1];return result},_.indexOf=function(array,item,isSorted){if(null==array)return-1;var i=0,l=array.length;if(isSorted){if("number"!=typeof isSorted)return i=_.sortedIndex(array,item),array[i]===item?i:-1;i=0>isSorted?Math.max(0,l+isSorted):isSorted}if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item,isSorted);for(;l>i;i++)if(array[i]===item)return i;return-1},_.lastIndexOf=function(array,item,from){if(null==array)return-1;var hasIndex=null!=from;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf)return hasIndex?array.lastIndexOf(item,from):array.lastIndexOf(item);for(var i=hasIndex?from:array.length;i--;)if(array[i]===item)return i;return-1},_.range=function(start,stop,step){arguments.length<=1&&(stop=start||0,start=0),step=arguments[2]||1;for(var len=Math.max(Math.ceil((stop-start)/step),0),idx=0,range=new Array(len);len>idx;)range[idx++]=start,start+=step;return range},_.bind=function(func,context){if(func.bind===nativeBind&&nativeBind)return nativeBind.apply(func,slice.call(arguments,1));var args=slice.call(arguments,2);return function(){return func.apply(context,args.concat(slice.call(arguments)))}},_.partial=function(func){var args=slice.call(arguments,1);return function(){return func.apply(this,args.concat(slice.call(arguments)))}},_.bindAll=function(obj){var funcs=slice.call(arguments,1);return 0===funcs.length&&(funcs=_.functions(obj)),each(funcs,function(f){obj[f]=_.bind(obj[f],obj)}),obj},_.memoize=function(func,hasher){var memo={};return hasher||(hasher=_.identity),function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:memo[key]=func.apply(this,arguments)}},_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)},_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)))},_.throttle=function(func,wait){var context,args,timeout,result,previous=0,later=function(){previous=new Date,timeout=null,result=func.apply(context,args)};return function(){var now=new Date,remaining=wait-(now-previous);return context=this,args=arguments,0>=remaining?(clearTimeout(timeout),timeout=null,previous=now,result=func.apply(context,args)):timeout||(timeout=setTimeout(later,remaining)),result}},_.debounce=function(func,wait,immediate){var timeout,result;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||(result=func.apply(context,args))},callNow=immediate&&!timeout;return clearTimeout(timeout),timeout=setTimeout(later,wait),callNow&&(result=func.apply(context,args)),result}},_.once=function(func){var memo,ran=!1;return function(){return ran?memo:(ran=!0,memo=func.apply(this,arguments),func=null,memo)}},_.wrap=function(func,wrapper){return function(){var args=[func];return push.apply(args,arguments),wrapper.apply(this,args)}},_.compose=function(){var funcs=arguments;return function(){for(var args=arguments,i=funcs.length-1;i>=0;i--)args=[funcs[i].apply(this,args)];return args[0]}},_.after=function(times,func){return 0>=times?func():function(){return--times<1?func.apply(this,arguments):void 0}},_.keys=nativeKeys||function(obj){if(obj!==Object(obj))throw new TypeError("Invalid object");var keys=[];for(var key in obj)_.has(obj,key)&&(keys[keys.length]=key);return keys},_.values=function(obj){var values=[];for(var key in obj)_.has(obj,key)&&values.push(obj[key]);return values},_.pairs=function(obj){var pairs=[];for(var key in obj)_.has(obj,key)&&pairs.push([key,obj[key]]);return pairs},_.invert=function(obj){var result={};for(var key in obj)_.has(obj,key)&&(result[obj[key]]=key);return result},_.functions=_.methods=function(obj){var names=[];for(var key in obj)_.isFunction(obj[key])&&names.push(key);return names.sort()},_.extend=function(obj){return each(slice.call(arguments,1),function(source){if(source)for(var prop in source)obj[prop]=source[prop]}),obj},_.pick=function(obj){var copy={},keys=concat.apply(ArrayProto,slice.call(arguments,1));return each(keys,function(key){key in obj&&(copy[key]=obj[key])}),copy},_.omit=function(obj){var copy={},keys=concat.apply(ArrayProto,slice.call(arguments,1));for(var key in obj)_.contains(keys,key)||(copy[key]=obj[key]);return copy},_.defaults=function(obj){return each(slice.call(arguments,1),function(source){if(source)for(var prop in source)null==obj[prop]&&(obj[prop]=source[prop])}),obj},_.clone=function(obj){return _.isObject(obj)?_.isArray(obj)?obj.slice():_.extend({},obj):obj},_.tap=function(obj,interceptor){return interceptor(obj),obj};var eq=function(a,b,aStack,bStack){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof _&&(a=a._wrapped),b instanceof _&&(b=b._wrapped);var className=toString.call(a);if(className!=toString.call(b))return!1;switch(className){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var length=aStack.length;length--;)if(aStack[length]==a)return bStack[length]==b;aStack.push(a),bStack.push(b);var size=0,result=!0;if("[object Array]"==className){if(size=a.length,result=size==b.length)for(;size--&&(result=eq(a[size],b[size],aStack,bStack)););
}else{var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor))return!1;for(var key in a)if(_.has(a,key)&&(size++,!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack))))break;if(result){for(key in b)if(_.has(b,key)&&!size--)break;result=!size}}return aStack.pop(),bStack.pop(),result};_.isEqual=function(a,b){return eq(a,b,[],[])},_.isEmpty=function(obj){if(null==obj)return!0;if(_.isArray(obj)||_.isString(obj))return 0===obj.length;for(var key in obj)if(_.has(obj,key))return!1;return!0},_.isElement=function(obj){return!(!obj||1!==obj.nodeType)},_.isArray=nativeIsArray||function(obj){return"[object Array]"==toString.call(obj)},_.isObject=function(obj){return obj===Object(obj)},each(["Arguments","Function","String","Number","Date","RegExp"],function(name){_["is"+name]=function(obj){return toString.call(obj)=="[object "+name+"]"}}),_.isArguments(arguments)||(_.isArguments=function(obj){return!(!obj||!_.has(obj,"callee"))}),"function"!=typeof/./&&(_.isFunction=function(obj){return"function"==typeof obj}),_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))},_.isNaN=function(obj){return _.isNumber(obj)&&obj!=+obj},_.isBoolean=function(obj){return obj===!0||obj===!1||"[object Boolean]"==toString.call(obj)},_.isNull=function(obj){return null===obj},_.isUndefined=function(obj){return void 0===obj},_.has=function(obj,key){return hasOwnProperty.call(obj,key)},_.noConflict=function(){return root._=previousUnderscore,this},_.identity=function(value){return value},_.times=function(n,iterator,context){for(var accum=Array(n),i=0;n>i;i++)accum[i]=iterator.call(context,i);return accum},_.random=function(min,max){return null==max&&(max=min,min=0),min+Math.floor(Math.random()*(max-min+1))};var entityMap={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};entityMap.unescape=_.invert(entityMap.escape);var entityRegexes={escape:new RegExp("["+_.keys(entityMap.escape).join("")+"]","g"),unescape:new RegExp("("+_.keys(entityMap.unescape).join("|")+")","g")};_.each(["escape","unescape"],function(method){_[method]=function(string){return null==string?"":(""+string).replace(entityRegexes[method],function(match){return entityMap[method][match]})}}),_.result=function(object,property){if(null==object)return null;var value=object[property];return _.isFunction(value)?value.call(object):value},_.mixin=function(obj){each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];return push.apply(args,arguments),result.call(this,func.apply(_,args))}})};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/,escapes={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g;_.template=function(text,data,settings){var render;settings=_.defaults({},settings,_.templateSettings);var matcher=new RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g"),index=0,source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){return source+=text.slice(index,offset).replace(escaper,function(match){return"\\"+escapes[match]}),escape&&(source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"),interpolate&&(source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"),evaluate&&(source+="';\n"+evaluate+"\n__p+='"),index=offset+match.length,match}),source+="';\n",settings.variable||(source="with(obj||{}){\n"+source+"}\n"),source="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{render=new Function(settings.variable||"obj","_",source)}catch(e){throw e.source=source,e}if(data)return render(data,_);var template=function(data){return render.call(this,data,_)};return template.source="function("+(settings.variable||"obj")+"){\n"+source+"}",template},_.chain=function(obj){return _(obj).chain()};var result=function(obj){return this._chain?_(obj).chain():obj};_.mixin(_),each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;return method.apply(obj,arguments),"shift"!=name&&"splice"!=name||0!==obj.length||delete obj[0],result.call(this,obj)}}),each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments))}}),_.extend(_.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)},{}]},{},[5]);
//# sourceMappingURL=main.min.js.map